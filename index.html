<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HELM">
    <meta name="theme-color" content="#1a1f2e">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSIyMiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjYiLz4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI4IiBmaWxsPSIjM2I4MmY2Ii8+CiAgPGxpbmUgeDE9IjUwIiB5MT0iMTAiIHgyPSI1MCIgeTI9IjI4IiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjUwIiB5MT0iNzIiIHgyPSI1MCIgeTI9IjkwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjEwIiB5MT0iNTAiIHgyPSIyOCIgeTI9IjUwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjcyIiB5MT0iNTAiIHgyPSI5MCIgeTI9IjUwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjIxLjciIHkxPSIyMS43IiB4Mj0iMzQuMyIgeTI9IjM0LjMiIHN0cm9rZT0iIzNiODJmNiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8bGluZSB4MT0iNjUuNyIgeTE9IjY1LjciIHgyPSI3OC4zIiB5Mj0iNzguMyIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogIDxsaW5lIHgxPSI3OC4zIiB5MT0iMjEuNyIgeDI9IjY1LjciIHkyPSIzNC4zIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjM0LjMiIHkxPSI2NS43IiB4Mj0iMjEuNyIgeTI9Ijc4LjMiIHN0cm9rZT0iIzNiODJmNiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cg==">
    <title>‚ò∏ HELM - Navigate memecoin chaos</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --accent: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --purple: #a855f7;
            --gold: #fbbf24;
            --border: rgba(148, 163, 184, 0.2);
        }
        
        body.light-theme {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-hover: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border: rgba(0,0,0,0.1);
        }
        
        body.neon-theme {
            --bg-primary: #0a0014;
            --bg-secondary: #1a0033;
            --bg-card: #2d1b4e;
            --bg-hover: #3d2b5e;
            --text-primary: #ffffff;
            --text-secondary: #e9d5ff;
            --accent: #ff00ff;
            --success: #00ff88;
            --danger: #ff0066;
            --warning: #ffcc00;
            --border: rgba(255,0,255,0.3);
        }

        body {
            font-family: -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        body {
            overflow-x: hidden !important;
            width: 100vw !important;
            position: relative !important;
        }
        
        #root {
            overflow-x: hidden !important;
            max-width: 100vw !important;
        }
        
        * {
            max-width: 100vw;
        }

        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes levelUp {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes badgeUnlock {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .fade-in { animation: fadeIn 0.3s ease; }
        .slide-in { animation: slideIn 0.3s ease; }
        .level-up { animation: levelUp 0.5s ease; }
        .badge-unlock { animation: badgeUnlock 0.6s ease; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header {
            padding: 20px;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .logo { 
            font-size: 2rem; 
            font-weight: bold;
            background: linear-gradient(135deg, var(--accent), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .tagline { color: var(--text-secondary); font-size: 0.9rem; }
        
        .card {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin: 20px 0;
            transition: all 0.3s ease;
            animation: fadeIn 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        button {
            padding: 12px 24px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin: 5px;
            transition: all 0.2s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        button.success { background: var(--success); }
        button.danger { background: var(--danger); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
        
        .loading { animation: pulse 1.5s ease-in-out infinite; }
        .spinner { display: inline-block; animation: spin 1s linear infinite; }

        input, textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            margin: 10px 0;
            transition: all 0.2s ease;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }
        
        .tab:hover { background: var(--bg-hover); transform: translateY(-2px); }
        .tab.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .stat-value { font-size: 2rem; font-weight: bold; color: var(--accent); margin-bottom: 5px; }
        .stat-label { color: var(--text-secondary); font-size: 0.9rem; }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 16px 24px;
            border-radius: 8px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            min-width: 300px;
        }
        
        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }
        
        /* GAMIFICATION STYLES */
        .xp-bar-container {
            width: 100%;
            height: 20px;
            background: var(--bg-primary);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--border);
            margin: 10px 0;
        }
        
        .xp-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--purple));
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .level-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--purple), var(--accent));
            border-radius: 20px;
            font-weight: bold;
            font-size: 1rem;
        }
        
        .badge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .badge-item {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .badge-item.unlocked {
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }
        
        .badge-item.locked {
            opacity: 0.4;
            filter: grayscale(1);
        }
        
        .badge-item:hover {
            transform: scale(1.05);
        }
        
        .badge-icon {
            font-size: 3rem;
            margin-bottom: 8px;
        }
        
        .badge-name {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
        
        .badge-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .streak-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .xp-gain-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid var(--gold);
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.5);
            z-index: 10001;
            animation: levelUp 0.5s ease;
            text-align: center;
        }
        
        .theme-selector {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .theme-selector:hover { background: var(--bg-hover); }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           MOBILE RESPONSIVE ‚Äî 768px and below
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        @media (max-width: 768px) {
          /* ‚îÄ‚îÄ HEADER: Compact ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
          .header { 
            padding: 6px 10px !important; 
            margin-bottom: 8px !important;
            padding-top: max(6px, env(safe-area-inset-top)) !important;
          }
          
          /* Header flex layout */
          .header > div {
            display: flex !important;
            gap: 6px !important;
            align-items: center !important;
            width: 100% !important;
            flex-wrap: nowrap !important;
          }
          
          /* Logo area (left) - compact */
          .header > div > div:first-child {
            display: flex !important;
            align-items: center !important;
            gap: 4px !important;
            flex-shrink: 0 !important;
            min-width: 0 !important;
          }
          
          .header .logo { 
            font-size: 0.9rem !important;
            display: flex !important;
            align-items: center !important;
            gap: 3px !important;
          }
          .header .logo img { 
            width: 18px !important; 
            height: 18px !important; 
          }
          
          /* Hide tagline on mobile */
          .header .logo + div {
            display: none !important;
          }
          
          /* Hide level badge on mobile */
          .level-badge {
            display: none !important;
          }
          
          /* Balance cards (middle) */
          .header > div > div:nth-child(2) {
            display: flex !important;
            gap: 4px !important;
            justify-content: center !important;
            overflow: hidden !important;
            flex: 1 !important;
            min-width: 0 !important;
          }
          
          .header > div > div:nth-child(2) > div {
            padding: 3px 6px !important;
            font-size: 0.7rem !important;
            min-width: 0 !important;
            flex: 1 !important;
            max-width: 72px !important;
          }
          
          .header > div > div:nth-child(2) > div > div:first-child {
            font-size: 0.6rem !important;
            margin-bottom: 0 !important;
          }
          
          .header > div > div:nth-child(2) > div > div:nth-child(2) {
            font-size: 0.8rem !important;
            font-weight: bold !important;
          }
          
          .header > div > div:nth-child(2) > div > div:last-child {
            font-size: 0.6rem !important;
            margin-top: 0 !important;
          }
          
          /* Right buttons area */
          .header > div > div:last-child {
            display: flex !important;
            gap: 4px !important;
            justify-content: flex-end !important;
            flex-shrink: 0 !important;
          }
          
          /* All header buttons compact */
          .header button {
            padding: 5px 8px !important;
            font-size: 0.8rem !important;
            min-height: 30px !important;
            min-width: 30px !important;
          }
          
          /* Missions button - icon-only class applied via JS */
          .missions-btn-mobile {
            width: 34px !important;
            padding: 5px !important;
            font-size: 1.1rem !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
          }
          
          /* Show/hide helpers */
          .hide-mobile { display: none !important; }
          .show-mobile { display: inline !important; }

          /* Settings button */
          .header button:last-child {
            font-size: 1.1rem !important;
          }

          /* ‚îÄ‚îÄ TABS: Scrollable, bigger touch targets ‚îÄ‚îÄ‚îÄ‚îÄ */
          .tabs {
            gap: 6px; margin: 8px 0 12px 0;
            overflow-x: auto; overflow-y: hidden;
            flex-wrap: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding: 0 12px 6px 12px;
            scroll-behavior: smooth;
          }
          .tabs::-webkit-scrollbar { display: none; }
          .tab { 
            padding: 10px 14px !important;
            font-size: 0.8rem !important;
            white-space: nowrap; 
            flex-shrink: 0;
            min-height: 44px !important;
            display: flex;
            align-items: center;
            touch-action: manipulation;
          }

          /* ‚îÄ‚îÄ CONTAINERS & CARDS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
          .container { 
            padding: 0 10px 20px 10px !important;
            padding-bottom: max(20px, env(safe-area-inset-bottom)) !important;
          }
          .card { 
            padding: 12px !important; 
            margin: 8px 0 !important;
            border-radius: 10px !important;
          }

          /* ‚îÄ‚îÄ INPUTS: Prevent iOS zoom ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
          input[type="text"], 
          input[type="number"],
          textarea {
            font-size: 16px !important;
            padding: 12px !important;
            min-height: 44px !important;
          }

          /* ‚îÄ‚îÄ BUTTONS: Bigger touch targets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
          button {
            min-height: 44px !important;
            padding: 12px 18px !important;
            font-size: 0.9rem !important;
            touch-action: manipulation;
          }

          /* ‚îÄ‚îÄ MODALS: Full screen ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
          .modal-overlay { padding: 0 !important; }
          .modal-content {
            width: 100% !important;
            max-width: 100% !important;
            max-height: 95vh !important;
            margin: 0 !important;
            border-radius: 16px 16px 0 0 !important;
            position: fixed !important;
            bottom: 0 !important;
          }

          /* ‚îÄ‚îÄ TOUCH IMPROVEMENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
          * {
            -webkit-tap-highlight-color: rgba(99,102,241,0.1);
            -webkit-touch-callout: none;
          }
          
          button, .tab, .clickable {
            user-select: none;
            -webkit-user-select: none;
          }
          
          /* ‚îÄ‚îÄ PORTFOLIO: Action buttons grid ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
          .pos-actions {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 6px !important;
          }
          .pos-abtn {
            padding: 10px 6px !important;
            font-size: 0.72rem !important;
            min-height: 38px !important;
          }
          /* Make last button (Details) span full width if odd */
          .pos-actions .pos-abtn:last-child:nth-child(odd) {
            grid-column: 1 / -1;
          }
          
          /* Quick buttons row */
          .pos-quick {
            gap: 4px !important;
          }
          .pos-qbtn {
            padding: 7px 8px !important;
            font-size: 0.7rem !important;
            min-height: 34px !important;
          }
        }

        @media (max-width: 390px) {
          .header .logo { font-size: 1rem !important; }
          .header img { width: 20px !important; height: 20px !important; }
          .tab { padding: 8px 11px !important; font-size: 0.75rem !important; }
          .card { padding: 10px !important; }
          button { padding: 10px 14px !important; font-size: 0.85rem !important; }
        }

        @media (max-width: 360px) {
          .tab { padding: 7px 9px; font-size: 0.72rem; }
          .card { padding: 11px; }
        }

    /* Ocultar TRENDING e Reset */
    .header > div[style*="flexWrap: 'wrap'"] { display: none !important; }
    .reset-btn { display: none !important; }

    /* ‚îÄ‚îÄ UTILITY CLASSES (replace repeated inline styles) ‚îÄ‚îÄ */
    .u-flex { display: flex; }
    .u-flex-col { display: flex; flex-direction: column; }
    .u-flex-between { display: flex; justify-content: space-between; }
    .u-items-center { align-items: center; }
    .u-gap4 { gap: 4px; }
    .u-gap7 { gap: 7px; }
    .u-gap8 { gap: 8px; }
    .u-gap12 { gap: 12px; }
    .u-bold { font-weight: bold; }
    .u-text-sec { color: var(--text-secondary); }
    .u-text-warn { color: var(--warning); }
    .u-text-ok { color: var(--success); }
    .u-text-bad { color: var(--danger); }
    .u-fs-xs { font-size: 0.68rem; }
    .u-fs-sm { font-size: 0.75rem; }
    .u-fs-md { font-size: 0.82rem; }
    .u-fs-base { font-size: 0.86rem; }
    .u-fs-lg { font-size: 1.05rem; }
    .u-fs-xl { font-size: 1.8rem; }
    .u-lh { line-height: 1.45; }
    .u-mb8 { margin-bottom: 8px; }
    .u-mb14 { margin-bottom: 14px; }
    .u-dim { opacity: 0.5; flex-shrink: 0; }
    .u-upper { text-transform: uppercase; letter-spacing: 0.08em; }
    .u-card-inner { background: var(--bg-primary); border-radius: 10px; padding: 12px; }

    /* ‚îÄ‚îÄ NEW PORTFOLIO CARD DESIGN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .pos-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      margin-top: 12px;
    }
    .pos-card:hover { border-color: rgba(148,163,184,0.25); }
    .pos-card.pos-loss { border-left: 3px solid var(--danger); }
    .pos-card.pos-win { border-left: 3px solid var(--success); }

    .pos-summary {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      cursor: pointer;
      gap: 10px;
      user-select: none;
      -webkit-user-select: none;
    }
    .pos-left { display: flex; align-items: center; gap: 11px; min-width: 0; flex: 1; }
    .token-avatar {
      width: 38px; height: 38px; border-radius: 9px;
      background: var(--bg-primary); display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 0.72rem; color: var(--accent); flex-shrink: 0;
      letter-spacing: -0.02em; border: 1px solid rgba(59,130,246,0.15);
    }
    .token-info { min-width: 0; }
    .token-name-row { font-weight: 700; font-size: 0.92rem; display: flex; align-items: center; gap: 7px; flex-wrap: wrap; }
    .token-tag {
      font-size: 0.6rem; font-weight: 600; padding: 2px 7px; border-radius: 5px;
      text-transform: uppercase; letter-spacing: 0.04em;
      background: rgba(59,130,246,0.12); color: var(--accent);
    }
    .token-meta-line { font-size: 0.73rem; color: var(--text-secondary); margin-top: 2px; }
    .pos-right { text-align: right; flex-shrink: 0; }
    .pnl-val { font-weight: 700; font-size: 1rem; letter-spacing: -0.02em; }
    .pnl-val.up { color: var(--success); }
    .pnl-val.down { color: var(--danger); }
    .pnl-pct { font-size: 0.7rem; margin-top: 1px; opacity: 0.75; }
    .pnl-pct.up { color: var(--success); }
    .pnl-pct.down { color: var(--danger); }
    .expand-arrow {
      font-size: 0.6rem; color: var(--text-secondary); transition: transform 0.25s;
      display: inline-block; margin-left: 4px;
    }
    .expand-arrow.open { transform: rotate(180deg); }

    .pos-quick {
      display: flex; gap: 6px; padding: 0 16px 12px;
    }
    .pos-qbtn {
      padding: 7px 14px; border-radius: 8px; border: 1px solid var(--border);
      background: transparent; color: var(--text-secondary); font-family: inherit;
      font-size: 0.76rem; font-weight: 500; cursor: pointer; transition: all 0.2s;
    }
    .pos-qbtn:hover { background: var(--bg-hover); color: var(--text-primary); transform: translateY(-1px); }
    .pos-qbtn.qsell {
      background: rgba(239,68,68,0.08); border-color: rgba(239,68,68,0.25); color: var(--danger); font-weight: 600;
    }
    .pos-qbtn.qsell:hover { background: rgba(239,68,68,0.16); }
    .pos-qbtn.qupdate {
      background: rgba(59,130,246,0.08); border-color: rgba(59,130,246,0.2); color: var(--accent);
    }

    .pos-details {
      max-height: 0; overflow: hidden; opacity: 0;
      transition: max-height 0.35s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.25s ease;
    }
    .pos-details.open { max-height: 400px; opacity: 1; }
    .pos-details-inner { padding: 0 16px 14px; border-top: 1px solid var(--border); }

    .pos-stats-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px;
      background: var(--border); border-radius: 9px; overflow: hidden; margin: 12px 0;
    }
    .pos-stat {
      background: var(--bg-primary); padding: 10px 8px; text-align: center;
    }
    .pos-stat .ps-label {
      font-size: 0.62rem; text-transform: uppercase; letter-spacing: 0.06em;
      color: var(--text-secondary); margin-bottom: 3px;
    }
    .pos-stat .ps-value { font-size: 0.8rem; font-weight: 600; color: var(--text-primary); }

    .pos-actions {
      display: flex; gap: 6px; flex-wrap: wrap;
    }
    .pos-abtn {
      flex: 1; min-width: 0; display: flex; align-items: center; justify-content: center; gap: 4px;
      padding: 9px 6px; border-radius: 8px; border: 1px solid var(--border);
      background: var(--bg-primary); color: var(--text-secondary);
      font-family: inherit; font-size: 0.73rem; font-weight: 600; cursor: pointer; transition: all 0.2s;
      white-space: nowrap;
    }
    .pos-abtn:hover { background: var(--bg-hover); border-color: rgba(148,163,184,0.25); color: var(--text-primary); transform: translateY(-1px); }
    .pos-abtn.abtn-accent { background: rgba(59,130,246,0.1); border-color: rgba(59,130,246,0.25); color: var(--accent); }

    /* Responsive show/hide helpers (desktop defaults) */
    .hide-mobile { display: inline; }
    .show-mobile { display: none; }

    /* ‚îÄ‚îÄ GLOSSARY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .gloss-search {
      width: 100%; padding: 12px 14px 12px 38px; border-radius: 10px;
      border: 1px solid var(--border); background: var(--bg-primary);
      color: var(--text-primary); font-size: 0.9rem; font-family: inherit;
      box-sizing: border-box; outline: none;
    }
    .gloss-search:focus { border-color: var(--accent); }
    .gloss-search-wrap {
      position: relative; margin-bottom: 16px;
    }
    .gloss-search-icon {
      position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
      font-size: 1rem; pointer-events: none;
    }
    .gloss-cats {
      display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 16px;
    }
    .gloss-cat {
      padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;
      border: 1px solid var(--border); background: var(--bg-card);
      color: var(--text-secondary); cursor: pointer; transition: all 0.2s;
      font-family: inherit;
    }
    .gloss-cat.active {
      background: rgba(59,130,246,0.15); border-color: rgba(59,130,246,0.4);
      color: var(--accent);
    }
    .gloss-item {
      padding: 12px 14px; border-radius: 10px; margin-bottom: 6px;
      border: 1px solid var(--border); background: var(--bg-card);
      cursor: pointer; transition: all 0.2s;
    }
    .gloss-item:hover { border-color: rgba(148,163,184,0.3); }
    .gloss-item.open { border-color: rgba(59,130,246,0.3); background: rgba(59,130,246,0.04); }
    .gloss-term {
      display: flex; justify-content: space-between; align-items: center;
    }
    .gloss-word { font-weight: 700; font-size: 0.88rem; }
    .gloss-tag {
      font-size: 0.65rem; padding: 2px 7px; border-radius: 4px;
      background: rgba(139,92,246,0.1); color: #a78bfa; font-weight: 600;
    }
    .gloss-def {
      margin-top: 8px; font-size: 0.82rem; color: var(--text-secondary);
      line-height: 1.55; display: none;
    }
    .gloss-item.open .gloss-def { display: block; }
    .gloss-example {
      margin-top: 6px; padding: 8px 10px; border-radius: 6px;
      background: var(--bg-primary); font-size: 0.78rem; font-style: italic;
      color: var(--text-secondary); border-left: 2px solid var(--accent);
    }

    /* ‚îÄ‚îÄ TOOLTIP (contextual on flags) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .flag-term {
      text-decoration: underline dotted; text-underline-offset: 2px;
      cursor: help; transition: color 0.2s;
    }
    .flag-term:hover { color: var(--accent); }
    .term-tooltip {
      position: fixed; z-index: 2500; max-width: 300px;
      background: var(--bg-card); border: 1px solid var(--accent);
      border-radius: 12px; padding: 14px 16px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.5);
      animation: sfSlideUp 0.2s ease;
    }
    .term-tooltip .tt-word {
      font-weight: 800; font-size: 0.9rem; margin-bottom: 4px;
    }
    .term-tooltip .tt-def {
      font-size: 0.8rem; color: var(--text-secondary); line-height: 1.5;
    }
    .term-tooltip .tt-close {
      position: absolute; top: 8px; right: 10px; background: none; border: none;
      color: var(--text-secondary); cursor: pointer; font-size: 0.9rem; padding: 0;
      min-height: auto;
    }

    .partial-badge-new {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 3px 8px; background: rgba(16,185,129,0.08);
      border: 1px solid rgba(16,185,129,0.25); border-radius: 6px;
      font-size: 0.68rem; font-weight: 600; color: var(--success); margin-bottom: 8px;
    }

    /* ‚îÄ‚îÄ NEW TRADE HISTORY ITEMS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .hist-item {
      display: flex; align-items: center; gap: 11px;
      padding: 13px 14px; background: var(--bg-primary);
      border-radius: 9px; margin-top: 8px; transition: all 0.2s; cursor: pointer;
    }
    .hist-item:hover { background: var(--bg-hover); }
    .hist-bar { width: 3px; height: 34px; border-radius: 3px; flex-shrink: 0; }
    .hist-bar.hw { background: var(--success); box-shadow: 0 0 6px rgba(16,185,129,0.3); }
    .hist-bar.hl { background: var(--danger); box-shadow: 0 0 6px rgba(239,68,68,0.3); }
    .hist-info { flex: 1; min-width: 0; }
    .hist-name { font-weight: 600; font-size: 0.87rem; }
    .hist-meta {
      font-size: 0.7rem; color: var(--text-secondary); margin-top: 2px;
      display: flex; align-items: center; gap: 5px; flex-wrap: wrap;
    }
    .hist-dot { width: 3px; height: 3px; border-radius: 50%; background: var(--text-secondary); opacity: 0.4; flex-shrink: 0; }
    .hist-pnl { text-align: right; flex-shrink: 0; }
    .hist-pnl .hval { font-weight: 700; font-size: 0.9rem; }
    .hist-pnl .hval.hw { color: var(--success); }
    .hist-pnl .hval.hl { color: var(--danger); }
    .hist-pnl .hpct { font-size: 0.68rem; opacity: 0.65; }
    .hist-pnl .hpct.hw { color: var(--success); }
    .hist-pnl .hpct.hl { color: var(--danger); }

    /* ‚îÄ‚îÄ STARTER FLOW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .sf-overlay {
      position: fixed; inset: 0; z-index: 2000;
      display: flex; align-items: center; justify-content: center;
      padding: 20px;
    }
    .sf-backdrop {
      position: absolute; inset: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(4px);
    }
    .sf-card {
      position: relative; z-index: 1;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 20px; max-width: 420px; width: 100%;
      padding: 36px 28px; text-align: center;
      box-shadow: 0 20px 80px rgba(0,0,0,0.6);
      animation: sfSlideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    @keyframes sfSlideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .sf-icon { font-size: 3rem; margin-bottom: 16px; }
    .sf-title {
      font-size: 1.3rem; font-weight: 800; margin-bottom: 8px;
      letter-spacing: -0.02em;
    }
    .sf-desc {
      font-size: 0.88rem; color: var(--text-secondary);
      line-height: 1.55; margin-bottom: 24px;
    }
    .sf-btn {
      width: 100%; padding: 14px; border-radius: 12px; border: none;
      font-size: 0.95rem; font-weight: 700; cursor: pointer;
      font-family: inherit; transition: all 0.2s;
    }
    .sf-btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--purple));
      color: white;
    }
    .sf-btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(59,130,246,0.3); }
    .sf-btn-skip {
      background: none; border: none; color: var(--text-secondary);
      font-size: 0.78rem; padding: 12px; cursor: pointer; font-family: inherit;
      margin-top: 8px;
    }
    .sf-btn-skip:hover { color: var(--text-primary); }
    .sf-steps {
      display: flex; justify-content: center; gap: 6px; margin-bottom: 24px;
    }
    .sf-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--border); transition: all 0.3s;
    }
    .sf-dot.active { background: var(--accent); width: 24px; border-radius: 4px; }
    .sf-dot.done { background: var(--success); }
    .sf-highlight-box {
      background: var(--bg-primary); border: 1px solid var(--border);
      border-radius: 12px; padding: 14px; margin: 16px 0;
      text-align: left;
    }
    .sf-flag { display: flex; align-items: center; gap: 8px; padding: 4px 0; font-size: 0.82rem; }
    .sf-flag-green { color: var(--success); }
    .sf-flag-red { color: var(--danger); }
    .sf-token-pill {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(59,130,246,0.1); border: 1px solid rgba(59,130,246,0.25);
      border-radius: 8px; padding: 6px 14px; font-weight: 700;
      color: var(--accent); margin: 8px 0;
    }
    .sf-tooltip {
      position: fixed; z-index: 2001;
      background: var(--bg-card); border: 1px solid var(--accent);
      border-radius: 14px; padding: 18px 22px; max-width: 320px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.5);
      animation: sfSlideUp 0.3s ease;
    }
    .sf-tooltip::after {
      content: ''; position: absolute; top: -8px; left: 50%;
      transform: translateX(-50%); width: 16px; height: 16px;
      background: var(--bg-card); border-left: 1px solid var(--accent);
      border-top: 1px solid var(--accent); transform: translateX(-50%) rotate(45deg);
    }
    .sf-tooltip.arrow-bottom::after {
      top: auto; bottom: -8px;
      border-left: none; border-top: none;
      border-right: 1px solid var(--accent); border-bottom: 1px solid var(--accent);
    }
    .sf-pulse {
      animation: sfPulse 2s infinite;
    }
    @keyframes sfPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(59,130,246,0.4); }
      50% { box-shadow: 0 0 0 8px rgba(59,130,246,0); }
    }
</style>
    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
</head>
<body>
    <div id="root"></div>

    <script>
/*
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * HELM ‚Äî Paper Trading Simulator for Solana Memecoins
 * https://github.com/macdopk/helm
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * 
 * CHANGELOG:
 * 
 * ARCHITECTURE NOTES:
 * 
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 */

// Future modules: config/supabase.js, config/constants.js
const SUPABASE_URL  = 'https://dlzlcwzkagodbgienqke.supabase.co';   // e.g. https://xxxx.supabase.co
const SUPABASE_KEY  = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsemxjd3prYWdvZGJnaWVucWtlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNjA2NTIsImV4cCI6MjA4NjgzNjY1Mn0.SAAna48TFcIj_nTrKgM4DDyPOi43Fo9bp9qJ6n_sw9o'; // public anon key

const _sbReady = SUPABASE_URL !== 'YOUR_SUPABASE_URL';
// Supabase Auth Client - ser√° inicializado ap√≥s carregar
let supabaseClient = null;

// Aguardar o SDK carregar
window.addEventListener('DOMContentLoaded', () => {
  
  if (typeof supabase === 'undefined') {
    console.error('‚ùå Supabase SDK n√£o carregou!');
    alert('Error: Could not load auth system. Check your connection.');
    return;
  }
  
  try {
    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    // Limpar localStorage antigo (dados sem autentica√ß√£o)
    // S√≥ faz isso uma vez na primeira inicializa√ß√£o com auth
    if (!localStorage.getItem('helm_auth_initialized')) {
      localStorage.clear();
      localStorage.setItem('helm_auth_initialized', 'true');
    }
    
    // Configurar listener de mudan√ßas de auth
    supabaseClient.auth.onAuthStateChange((event, session) => {
      currentUser = session?.user || null;
      authService.notifyListeners();
      
      // Handle password recovery redirect
      if (event === 'PASSWORD_RECOVERY') {
        window._helmPasswordRecovery = true;
        window.dispatchEvent(new Event('helm-password-recovery'));
      }
    });
    
  } catch (error) {
    console.error('‚ùå Erro ao inicializar Supabase:', error);
    alert('Error connecting to server. Please reload the page.');
  }
});

let currentUser = null;
let authListeners = [];

const authService = {
  // Helper para garantir que supabaseClient est√° pronto
  async ensureClient() {
    // Aguardar at√© 5 segundos (50 x 100ms)
    for (let i = 0; i < 50; i++) {
      if (supabaseClient) {
        return true;
      }
      await new Promise(resolve => setTimeout(resolve, 100));
    }
    console.error('‚ùå supabaseClient n√£o inicializou ap√≥s 5 segundos');
    return false;
  },

  // Get current session
  async getSession() {
    const ready = await authService.ensureClient();
    if (!ready) return null;
    const { data: { session } } = await supabaseClient.auth.getSession();
    currentUser = session?.user || null;
    return session;
  },

  // Sign up with email/password
  async signUp(email, password) {
    const ready = await authService.ensureClient();
    if (!ready) return { error: { message: 'Authentication not ready' } };
    const { data, error } = await supabaseClient.auth.signUp({
      email,
      password,
      options: {
        emailRedirectTo: window.location.origin
      }
    });
    if (!error) {
      currentUser = data.user;
      this.notifyListeners();
    }
    return { data, error };
  },

  // Sign in with email/password
  async signIn(email, password) {
    const ready = await authService.ensureClient();
    if (!ready) {
      console.error('‚ùå Client n√£o est√° pronto');
      return { error: { message: 'Authentication not ready' } };
    }
    const { data, error } = await supabaseClient.auth.signInWithPassword({
      email,
      password
    });
    if (!error) {
      currentUser = data.user;
      this.notifyListeners();
    }
    return { data, error };
  },

  // Sign out
  async signOut() {
    const ready = await authService.ensureClient();
    if (!ready) return { error: null };
    
    const { error } = await supabaseClient.auth.signOut();
    if (!error) {
      // Clear all HELM user data from localStorage AFTER successful signOut
      localStorage.removeItem('helmUser');
      localStorage.removeItem('helmUserKey');
      localStorage.removeItem('helmAuthKey');
      localStorage.removeItem('helmMissions');
      localStorage.removeItem('helmAds');
      localStorage.removeItem('helmStarterDone');
      currentUser = null;
      this.notifyListeners();
    }
    return { error };
  },

  // Reset password (sends email)
  async resetPassword(email) {
    const ready = await authService.ensureClient();
    if (!ready) return { error: { message: 'Authentication not ready' } };
    const { data, error } = await supabaseClient.auth.resetPasswordForEmail(email, {
      redirectTo: window.location.origin
    });
    return { data, error };
  },

  // Update password (after recovery)
  async updatePassword(newPassword) {
    const ready = await authService.ensureClient();
    if (!ready) return { error: { message: 'Authentication not ready' } };
    const { data, error } = await supabaseClient.auth.updateUser({
      password: newPassword
    });
    return { data, error };
  },

  // Get current user
  getUser() {
    return currentUser;
  },

  // Subscribe to auth changes
  onAuthChange(callback) {
    authListeners.push(callback);
    return () => {
      authListeners = authListeners.filter(cb => cb !== callback);
    };
  },

  // Notify all listeners
  notifyListeners() {
    authListeners.forEach(cb => cb(currentUser));
  }
};
function AuthScreen() {
  const [mode, setMode] = React.useState('login'); // 'login', 'signup', 'forgot', 'reset_password'
  const [email, setEmail] = React.useState('');
  const [password, setPassword] = React.useState('');
  const [confirmPassword, setConfirmPassword] = React.useState('');
  const [loading, setLoading] = React.useState(false);
  const [message, setMessage] = React.useState(null);

  // Listen for password recovery redirect from Supabase
  React.useEffect(() => {
    const handleRecovery = () => {
      setMode('reset_password');
      setMessage({ type: 'success', text: 'üîë Set your new password below.' });
    };
    // Check if already flagged (user clicked email link)
    if (window._helmPasswordRecovery) {
      handleRecovery();
    }
    window.addEventListener('helm-password-recovery', handleRecovery);
    return () => window.removeEventListener('helm-password-recovery', handleRecovery);
  }, []);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setMessage(null);

    if (mode === 'reset_password') {
      // Setting new password after recovery
      if (password.length < 6) {
        setMessage({ type: 'error', text: 'Password must be at least 6 characters.' });
        setLoading(false);
        return;
      }
      if (password !== confirmPassword) {
        setMessage({ type: 'error', text: 'Passwords do not match.' });
        setLoading(false);
        return;
      }
      const { error } = await authService.updatePassword(password);
      if (error) {
        setMessage({ type: 'error', text: error.message });
      } else {
        window._helmPasswordRecovery = false;
        window.dispatchEvent(new Event('helm-recovery-done'));
        setMessage({ type: 'success', text: '‚úÖ Password updated! Redirecting to login...' });
        setTimeout(() => {
          setMode('login');
          setPassword('');
          setConfirmPassword('');
        }, 2000);
      }
    } else if (mode === 'forgot') {
      const { error } = await authService.resetPassword(email);
      if (error) {
        setMessage({ type: 'error', text: error.message });
      } else {
        setMessage({ 
          type: 'success', 
          text: '‚úÖ Password reset link sent! Check your email (including spam folder).' 
        });
      }
    } else if (mode === 'login') {
      const { error } = await authService.signIn(email, password);
      if (error) {
        setMessage({ type: 'error', text: error.message });
      }
    } else {
      // signup
      if (password.length < 6) {
        setMessage({ type: 'error', text: 'Password must be at least 6 characters.' });
        setLoading(false);
        return;
      }
      const { data, error } = await authService.signUp(email, password);
      if (error) {
        setMessage({ type: 'error', text: error.message });
      } else {
        // Check if email confirmation is required
        if (data?.user?.identities?.length === 0) {
          setMessage({ type: 'error', text: 'This email is already registered. Try logging in.' });
        } else if (data?.user && !data?.session) {
          setMessage({ type: 'success', text: '‚úÖ Check your email to confirm your account, then login.' });
        } else {
          setMessage({ type: 'success', text: '‚úÖ Account created! You can login now.' });
        }
      }
    }
    setLoading(false);
  };

  return React.createElement('div', {
    style: {
      minHeight: '100vh',
      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '20px'
    }
  },
    React.createElement('div', {
      style: {
        background: 'rgba(255, 255, 255, 0.1)',
        backdropFilter: 'blur(10px)',
        borderRadius: '20px',
        padding: '40px',
        maxWidth: '400px',
        width: '100%',
        boxShadow: '0 8px 32px rgba(0, 0, 0, 0.3)',
        border: '1px solid rgba(255, 255, 255, 0.2)'
      }
    },
      // Logo/Header
      React.createElement('div', {
        style: {
          textAlign: 'center',
          marginBottom: '30px'
        }
      },
        React.createElement('div', {
          style: {
            margin: '0 0 10px 0',
            display: 'flex',
            justifyContent: 'center'
          }
        }, React.createElement('img', {
          src: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSIyMiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjYiLz4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI4IiBmaWxsPSIjM2I4MmY2Ii8+CiAgPGxpbmUgeDE9IjUwIiB5MT0iMTAiIHgyPSI1MCIgeTI9IjI4IiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjUwIiB5MT0iNzIiIHgyPSI1MCIgeTI9IjkwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjEwIiB5MT0iNTAiIHgyPSIyOCIgeTI9IjUwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjcyIiB5MT0iNTAiIHgyPSI5MCIgeTI9IjUwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjIxLjciIHkxPSIyMS43IiB4Mj0iMzQuMyIgeTI9IjM0LjMiIHN0cm9rZT0iIzNiODJmNiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8bGluZSB4MT0iNjUuNyIgeTE9IjY1LjciIHgyPSI3OC4zIiB5Mj0iNzguMyIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogIDxsaW5lIHgxPSI3OC4zIiB5MT0iMjEuNyIgeDI9IjY1LjciIHkyPSIzNC4zIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjM0LjMiIHkxPSI2NS43IiB4Mj0iMjEuNyIgeTI9Ijc4LjMiIHN0cm9rZT0iIzNiODJmNiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cg==",
          alt: "HELM",
          style: { width: '56px', height: '56px' }
        })),
        React.createElement('h2', {
          style: {
            fontSize: '32px',
            fontWeight: 'bold',
            color: 'white',
            margin: '0 0 8px 0'
          }
        }, 'HELM'),
        React.createElement('p', {
          style: {
            color: 'rgba(255, 255, 255, 0.8)',
            fontSize: '14px',
            margin: 0
          }
        }, 'Learn, Train & Paper Trade Solana Memecoins')
      ),

      // Message
      message && React.createElement('div', {
        style: {
          padding: '12px',
          borderRadius: '8px',
          marginBottom: '20px',
          fontSize: '14px',
          background: message.type === 'error' 
            ? 'rgba(239, 68, 68, 0.2)' 
            : 'rgba(16, 185, 129, 0.2)',
          color: message.type === 'error' ? '#fca5a5' : '#6ee7b7',
          border: `1px solid ${message.type === 'error' ? 'rgba(239, 68, 68, 0.5)' : 'rgba(16, 185, 129, 0.5)'}`
        }
      }, message.text),

      // Tabs
      mode === 'reset_password' ?
        React.createElement('div', {
          style: { textAlign: 'center', marginBottom: '20px' }
        },
          React.createElement('div', {
            style: { fontSize: '28px', marginBottom: '8px' }
          }, 'üîë'),
          React.createElement('h3', {
            style: { color: 'white', margin: '0 0 4px', fontSize: '20px' }
          }, 'Set New Password')
        )
      :
      mode === 'forgot' ? 
        React.createElement('button', {
          onClick: () => setMode('login'),
          style: {
            marginBottom: '20px',
            padding: '10px 20px',
            borderRadius: '8px',
            border: 'none',
            fontSize: '14px',
            cursor: 'pointer',
            background: 'rgba(255, 255, 255, 0.1)',
            color: 'rgba(255, 255, 255, 0.7)',
            transition: 'all 0.3s'
          }
        }, '‚Üê Back to Login')
      :
      React.createElement('div', {
        style: {
          display: 'flex',
          gap: '10px',
          marginBottom: '25px'
        }
      },
        React.createElement('button', {
          onClick: () => setMode('login'),
          style: {
            flex: 1,
            padding: '12px',
            borderRadius: '10px',
            border: 'none',
            fontSize: '16px',
            fontWeight: 'bold',
            cursor: 'pointer',
            background: mode === 'login' ? 'white' : 'rgba(255, 255, 255, 0.1)',
            color: mode === 'login' ? '#667eea' : 'rgba(255, 255, 255, 0.7)',
            transition: 'all 0.3s'
          }
        }, 'Login'),
        React.createElement('button', {
          onClick: () => setMode('signup'),
          style: {
            flex: 1,
            padding: '12px',
            borderRadius: '10px',
            border: 'none',
            fontSize: '16px',
            fontWeight: 'bold',
            cursor: 'pointer',
            background: mode === 'signup' ? 'white' : 'rgba(255, 255, 255, 0.1)',
            color: mode === 'signup' ? '#667eea' : 'rgba(255, 255, 255, 0.7)',
            transition: 'all 0.3s'
          }
        }, 'Sign Up')
      ),

      // Form
      React.createElement('form', { onSubmit: handleSubmit },
        mode !== 'reset_password' && React.createElement('div', { style: { marginBottom: '20px' } },
          React.createElement('label', {
            style: {
              display: 'block',
              color: 'rgba(255, 255, 255, 0.9)',
              fontSize: '14px',
              fontWeight: '500',
              marginBottom: '8px'
            }
          }, 'Email'),
          React.createElement('input', {
            type: 'email',
            placeholder: 'your@email.com',
            value: email,
            onChange: (e) => setEmail(e.target.value),
            required: mode !== 'reset_password',
            style: {
              width: '100%',
              padding: '14px',
              borderRadius: '10px',
              border: '1px solid rgba(255, 255, 255, 0.2)',
              background: 'rgba(255, 255, 255, 0.1)',
              color: 'white',
              fontSize: '16px',
              outline: 'none',
              boxSizing: 'border-box'
            }
          })
        ),
        (mode !== 'forgot') && React.createElement('div', { style: { marginBottom: mode === 'reset_password' ? '15px' : '25px' } },
          React.createElement('label', {
            style: {
              display: 'block',
              color: 'rgba(255, 255, 255, 0.9)',
              fontSize: '14px',
              fontWeight: '500',
              marginBottom: '8px'
            }
          }, mode === 'reset_password' ? 'New Password' : 'Password'),
          React.createElement('input', {
            type: 'password',
            placeholder: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢',
            value: password,
            onChange: (e) => setPassword(e.target.value),
            required: mode !== 'forgot',
            minLength: 6,
            style: {
              width: '100%',
              padding: '14px',
              borderRadius: '10px',
              border: '1px solid rgba(255, 255, 255, 0.2)',
              background: 'rgba(255, 255, 255, 0.1)',
              color: 'white',
              fontSize: '16px',
              outline: 'none',
              boxSizing: 'border-box'
            }
          })
        ),
        mode === 'reset_password' && React.createElement('div', { style: { marginBottom: '25px' } },
          React.createElement('label', {
            style: {
              display: 'block',
              color: 'rgba(255, 255, 255, 0.9)',
              fontSize: '14px',
              fontWeight: '500',
              marginBottom: '8px'
            }
          }, 'Confirm Password'),
          React.createElement('input', {
            type: 'password',
            placeholder: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢',
            value: confirmPassword,
            onChange: (e) => setConfirmPassword(e.target.value),
            required: true,
            minLength: 6,
            style: {
              width: '100%',
              padding: '14px',
              borderRadius: '10px',
              border: '1px solid rgba(255, 255, 255, 0.2)',
              background: 'rgba(255, 255, 255, 0.1)',
              color: 'white',
              fontSize: '16px',
              outline: 'none',
              boxSizing: 'border-box'
            }
          })
        ),
        mode === 'login' && React.createElement('div', {
          style: {
            textAlign: 'right',
            marginBottom: '20px',
            marginTop: '-10px'
          }
        },
          React.createElement('button', {
            type: 'button',
            onClick: () => setMode('forgot'),
            style: {
              background: 'none',
              border: 'none',
              color: 'rgba(255, 255, 255, 0.7)',
              fontSize: '13px',
              cursor: 'pointer',
              textDecoration: 'underline',
              padding: 0
            }
          }, 'Forgot password?')
        ),
        React.createElement('button', {
          type: 'submit',
          disabled: loading,
          style: {
            width: '100%',
            padding: '14px',
            borderRadius: '10px',
            border: 'none',
            background: loading ? 'rgba(255, 255, 255, 0.3)' : 'white',
            color: '#667eea',
            fontSize: '16px',
            fontWeight: 'bold',
            cursor: loading ? 'not-allowed' : 'pointer',
            transition: 'all 0.3s'
          }
        }, loading ? 'üîÑ Processing...' : mode === 'reset_password' ? 'üîí Update Password' : mode === 'forgot' ? 'üìß Send Reset Link' : mode === 'login' ? 'üîì Login' : 'üöÄ Create Account')
      ),

      // Footer
      React.createElement('div', {
        style: {
          marginTop: '25px',
          textAlign: 'center',
          fontSize: '13px',
          color: 'rgba(255, 255, 255, 0.6)'
        }
      } /* Footer removed */)
    )
  );
}

// AUTH WRAPPER - Protects the main app
function AuthWrapper({ children }) {
  const [user, setUser] = React.useState(null);
  const [loading, setLoading] = React.useState(true);
  const [isRecovery, setIsRecovery] = React.useState(false);

  React.useEffect(() => {
    let mounted = true;
    
    // Check initial session
    authService.getSession()
      .then(() => {
        if (mounted) {
          setUser(authService.getUser());
          setLoading(false);
        }
      })
      .catch((error) => {
        console.error('Auth init error:', error);
        if (mounted) {
          setLoading(false);
        }
      });

    // Subscribe to auth changes
    const unsubscribe = authService.onAuthChange((newUser) => {
      if (mounted) {
        setUser(newUser);
      }
    });

    // Listen for password recovery event
    const handleRecovery = () => {
      if (mounted) setIsRecovery(true);
    };
    const handleRecoveryDone = () => {
      if (mounted) setIsRecovery(false);
    };
    if (window._helmPasswordRecovery) setIsRecovery(true);
    window.addEventListener('helm-password-recovery', handleRecovery);
    window.addEventListener('helm-recovery-done', handleRecoveryDone);

    return () => {
      mounted = false;
      unsubscribe();
      window.removeEventListener('helm-password-recovery', handleRecovery);
      window.removeEventListener('helm-recovery-done', handleRecoveryDone);
    };
  }, []);

  if (loading) {
    return React.createElement('div', {
      style: {
        minHeight: '100vh',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
        color: 'white',
        fontSize: '24px'
      }
    }, 'üîÑ Loading...');
  }

  // Show AuthScreen for password recovery even if user session exists
  if (!user || isRecovery) {
    return React.createElement(AuthScreen);
  }

  return children;
}

// Export for use in main app
window.authService = authService;
window.AuthWrapper = AuthWrapper;

const helmStorage = {
  // Helper para pegar token JWT do usu√°rio
  async getAuthToken() {
    if (!supabaseClient) return SUPABASE_KEY;
    try {
      const { data: { session } } = await supabaseClient.auth.getSession();
      return session?.access_token || SUPABASE_KEY;
    } catch (e) {
      return SUPABASE_KEY;
    }
  },

  // Helper para pegar user_id
  async getUserId() {
    if (!supabaseClient) return null;
    try {
      const { data: { session } } = await supabaseClient.auth.getSession();
      return session?.user?.id || null;
    } catch (e) {
      return null;
    }
  },

  // SET key/value ‚Äî shared=true goes to Supabase, false goes to localStorage
  set: async (key, value, shared = false) => {
    const v = typeof value === 'string' ? value : JSON.stringify(value);
    if (shared && _sbReady && supabaseClient) {
      const token = await helmStorage.getAuthToken();
      const userId = await helmStorage.getUserId();
      
      const res = await fetch(`${SUPABASE_URL}/rest/v1/helm_storage`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'apikey': SUPABASE_KEY,
          'Authorization': 'Bearer ' + token,
          'Prefer': 'resolution=merge-duplicates',
        },
        body: JSON.stringify({ 
          key, 
          value: v, 
          user_id: userId,
          updated_at: new Date().toISOString() 
        }),
      });
      if (!res.ok) {
        console.error('Supabase set failed:', res.status, await res.text());
        throw new Error('Supabase set failed: ' + res.status);
      }
    } else {
      // Se n√£o tem auth, salvar local
      localStorage.setItem(key, v);
    }
    return { key, value: v };
  },

  // GET key ‚Äî shared=true reads from Supabase, false from localStorage
  get: async (key, shared = false) => {
    if (shared && _sbReady && supabaseClient) {
      const token = await helmStorage.getAuthToken();
      
      const res = await fetch(
        `${SUPABASE_URL}/rest/v1/helm_storage?key=eq.${encodeURIComponent(key)}&select=key,value`,
        { headers: { 
          'apikey': SUPABASE_KEY, 
          'Authorization': 'Bearer ' + token 
        } }
      );
      if (!res.ok) throw new Error('Supabase get failed: ' + res.status);
      const rows = await res.json();
      if (!rows.length) throw new Error('Key not found: ' + key);
      return { key, value: rows[0].value };
    } else {
      const v = localStorage.getItem(key);
      if (v === null) throw new Error('Key not found: ' + key);
      return { key, value: v };
    }
  },

  // LIST keys by prefix ‚Äî shared=true reads from Supabase
  list: async (prefix = '', shared = false) => {
    if (shared && _sbReady && supabaseClient) {
      const token = await helmStorage.getAuthToken();
      
      const res = await fetch(
        `${SUPABASE_URL}/rest/v1/helm_storage?key=like.${encodeURIComponent(prefix + '%')}&select=key&order=updated_at.desc&limit=200`,
        { headers: { 
          'apikey': SUPABASE_KEY, 
          'Authorization': 'Bearer ' + token 
        } }
      );
      if (!res.ok) throw new Error('Supabase list failed: ' + res.status);
      const rows = await res.json();
      return { keys: rows.map(r => r.key), prefix };
    } else {
      return { keys: Object.keys(localStorage).filter(k => k.startsWith(prefix)), prefix };
    }
  },

  // DELETE key
  delete: async (key, shared = false) => {
    if (shared && _sbReady && supabaseClient) {
      const token = await helmStorage.getAuthToken();
      
      await fetch(
        `${SUPABASE_URL}/rest/v1/helm_storage?key=eq.${encodeURIComponent(key)}`,
        {
          method: 'DELETE',
          headers: { 
            'apikey': SUPABASE_KEY, 
            'Authorization': 'Bearer ' + token 
          }
        }
      );
    } else {
      localStorage.removeItem(key);
    }
    return { key, deleted: true };
  },
};

// Expose as window.storage so the rest of the app uses it transparently
window.storage = helmStorage;

const {
  useState,
  useEffect,
  useRef
} = React;

// GAMIFICATION CONSTANTS
const XP_TYPES = {
  HOT_STREAK_3: 200,
  HOT_STREAK_5: 500,
  HOT_STREAK_10: 1000
};

// XP based on P&L ‚Äî bigger profit = more XP; losses reduce XP
const calcXPFromPnL = pnlSOL => {
  if (pnlSOL > 0) {
    if (pnlSOL >= 5.0) return 500;
    if (pnlSOL >= 2.0) return 300;
    if (pnlSOL >= 1.0) return 150;
    if (pnlSOL >= 0.5) return 75;
    if (pnlSOL >= 0.1) return 25;
    return 10;
  } else if (pnlSOL < 0) {
    const loss = Math.abs(pnlSOL);
    if (loss >= 5.0) return -500;
    if (loss >= 2.0) return -300;
    if (loss >= 1.0) return -150;
    if (loss >= 0.5) return -75;
    if (loss >= 0.1) return -25;
    return -10;
  }
  return 0;
};
const ALL_BADGES = {
  first_trade: {
    icon: 'üéØ',
    name: 'First Trade',
    desc: 'Made first trade'
  },
  first_profit: {
    icon: 'üí∞',
    name: 'First Win',
    desc: 'First profitable trade'
  },
  hot_streak_3: {
    icon: 'üî•',
    name: 'Hat Trick',
    desc: '3 wins in a row'
  },
  hot_streak_5: {
    icon: 'üî•üî•',
    name: 'On Fire',
    desc: '5 wins in a row'
  },
  hot_streak_10: {
    icon: 'üî•üî•üî•',
    name: 'Unstoppable',
    desc: '10 wins in a row!'
  },
  win_rate_50: {
    icon: 'ü•â',
    name: 'Bronze',
    desc: '50% win rate (10+ trades)'
  },
  win_rate_60: {
    icon: 'ü•à',
    name: 'Silver',
    desc: '60% win rate (10+ trades)'
  },
  win_rate_70: {
    icon: 'ü•á',
    name: 'Gold',
    desc: '70% win rate (10+ trades)'
  },
  win_rate_80: {
    icon: 'üíé',
    name: 'Diamond',
    desc: '80% win rate (10+ trades)'
  },
  analyst: {
    icon: 'üîç',
    name: 'Analyst',
    desc: '10+ tokens analyzed'
  },
  trader_10: {
    icon: 'üìä',
    name: 'Active',
    desc: '10 total trades'
  },
  trader_50: {
    icon: 'üìà',
    name: 'Experienced',
    desc: '50 total trades'
  },
  trader_100: {
    icon: 'üöÄ',
    name: 'Pro',
    desc: '100 total trades'
  }
};
const LEVELS = [{
  level: 1,
  xp: 0,
  name: 'Normie',
  icon: 'üå±'
}, {
  level: 2,
  xp: 500,
  name: 'Observer',
  icon: 'üëÄ'
}, {
  level: 3,
  xp: 1500,
  name: 'Ape',
  icon: 'üê∏'
}, {
  level: 4,
  xp: 3500,
  name: 'Degen',
  icon: 'üé∞'
}, {
  level: 5,
  xp: 7000,
  name: 'True Degen',
  icon: 'üî•'
}, {
  level: 6,
  xp: 12000,
  name: 'Diamond Hands',
  icon: 'üíé'
}, {
  level: 7,
  xp: 20000,
  name: 'Master Degen',
  icon: 'üß†'
}, {
  level: 8,
  xp: 35000,
  name: 'Whale',
  icon: 'üêã'
}, {
  level: 9,
  xp: 60000,
  name: 'Alpha Caller',
  icon: 'üëë'
}, {
  level: 10,
  xp: 100000,
  name: 'Insider',
  icon: 'üè¥‚Äç‚ò†Ô∏è'
}];
function Toast({
  message,
  type = 'success',
  onClose
}) {
  const duration = type === 'info' ? 7000 : 3000;
  useEffect(() => {
    const timer = setTimeout(onClose, duration);
    return () => clearTimeout(timer);
  }, []);
  return /*#__PURE__*/React.createElement("div", {
    className: `toast ${type}`,
    onClick: onClose,
    style: type === 'info' ? {
      maxWidth: '360px', lineHeight: '1.5', fontSize: '0.82rem',
      background: 'linear-gradient(135deg,rgba(59,130,246,0.25),rgba(139,92,246,0.25))',
      border: '1px solid rgba(139,92,246,0.5)', cursor: 'pointer', padding: '14px 16px'
    } : {}
  },
    type === 'success' && '‚úÖ ',
    type === 'error' && '‚ùå ',
    type === 'warning' && '‚ö†Ô∏è ',
    message,
    type === 'info' && /*#__PURE__*/React.createElement("div", {style:{fontSize:'0.72rem',opacity:0.6,marginTop:'4px'}}, "Tap to dismiss")
  );
}

function XPGainPopup({
  xp,
  reason,
  onClose
}) {
  useEffect(() => {
    const timer = setTimeout(onClose, 2000);
    return () => clearTimeout(timer);
  }, []);
  const isLoss = xp < 0;
  return /*#__PURE__*/React.createElement("div", {
    className: "xp-gain-popup",
    style: {
      borderColor: isLoss ? 'var(--danger)' : 'var(--gold)',
      boxShadow: isLoss ? '0 0 40px rgba(239,68,68,0.4)' : '0 0 40px rgba(251,191,36,0.5)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '3rem',
      marginBottom: '10px'
    }
  }, isLoss ? 'üíî' : '‚ú®'), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2rem',
      fontWeight: 'bold',
      color: isLoss ? 'var(--danger)' : 'var(--gold)',
      marginBottom: '5px'
    }
  }, isLoss ? '' : '+', xp, " XP"), /*#__PURE__*/React.createElement("div", {
    style: {
      color: 'var(--text-secondary)'
    }
  }, reason));
}
function ApeModal({
  analysis,
  balance,
  onConfirm,
  onClose
}) {
  const [amt, setAmt] = React.useState('0.1');
  const [reason, setReason] = React.useState('');
  const [tab, setTab] = React.useState('ape'); // 'ape' | 'chart'
  const REASONS = [{
    id: 'FOMO',
    label: 'üî• FOMO'
  }, {
    id: 'KOL',
    label: 'üì¢ KOL CALL'
  }, {
    id: 'DEV',
    label: 'üõ†Ô∏è TRUSTED DEV'
  }, {
    id: 'COMMUNITY',
    label: 'üí™ STRONG COMMUNITY'
  }, {
    id: 'TECHNICAL',
    label: 'üìä TECHNICAL'
  }, {
    id: 'FUNDAMENTAL',
    label: 'üî¨ FUNDAMENTALS'
  }];
  const chartUrl = analysis?.address ? `https://dexscreener.com/solana/${analysis.address}?embed=1&theme=dark&trades=0&info=0` : null;
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.8)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      maxWidth: '520px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
      overflow: 'hidden'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      borderBottom: '1px solid var(--border)'
    }
  }, [['ape', 'üöÄ APE'], ['chart', 'üìä Chart']].map(([id, label]) => /*#__PURE__*/React.createElement("div", {
    key: id,
    onClick: () => setTab(id),
    style: {
      flex: 1,
      padding: '14px',
      textAlign: 'center',
      fontWeight: 'bold',
      fontSize: '0.9rem',
      cursor: 'pointer',
      transition: 'all 0.15s',
      background: tab === id ? 'rgba(59,130,246,0.1)' : 'transparent',
      color: tab === id ? 'var(--accent)' : 'var(--text-secondary)',
      borderBottom: tab === id ? '2px solid var(--accent)' : '2px solid transparent'
    }
  }, label))), tab === 'ape' && /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '28px'
    }
  }, /*#__PURE__*/React.createElement("h3", {
    style: {
      marginBottom: '4px'
    }
  }, "\uD83D\uDE80 APE into ", analysis?.symbol), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem',
      marginBottom: '20px'
    }
  }, "Available balance: ", /*#__PURE__*/React.createElement("strong", null, balance.toFixed(2), " SOL")), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '6px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Amount (SOL)"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      marginBottom: '12px'
    }
  }, [['0.1','0.1'], ['0.5','0.5'], ['1','1'], ['ALL', balance.toFixed(2)]].map(([label, v]) => /*#__PURE__*/React.createElement("button", {
    key: label,
    onClick: () => setAmt(v),
    style: {
      flex: 1,
      margin: 0,
      padding: '8px 4px',
      fontSize: '0.82rem',
      background: amt === v ? (label === 'ALL' ? 'var(--purple)' : 'var(--accent)') : 'var(--bg-primary)',
      border: `1px solid ${amt === v ? (label === 'ALL' ? 'var(--purple)' : 'var(--accent)') : 'var(--border)'}`,
      color: amt === v ? 'white' : 'var(--text-secondary)',
      borderRadius: '6px',
      cursor: 'pointer',
      fontWeight: label === 'ALL' ? '700' : '500'
    }
  }, label))), /*#__PURE__*/React.createElement("input", {
    value: amt,
    onChange: e => setAmt(e.target.value),
    type: "number",
    step: "0.01",
    min: "0.01",
    style: {
      marginBottom: '20px'
    }
  }), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '10px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Why are you buying?"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '8px',
      marginBottom: '20px'
    }
  }, REASONS.map(r => /*#__PURE__*/React.createElement("div", {
    key: r.id,
    onClick: () => setReason(r.id),
    style: {
      padding: '10px',
      borderRadius: '10px',
      cursor: 'pointer',
      transition: 'all 0.15s',
      textAlign: 'center',
      fontWeight: 'bold',
      fontSize: '0.85rem',
      border: `2px solid ${reason === r.id ? 'var(--accent)' : 'var(--border)'}`,
      background: reason === r.id ? 'rgba(59,130,246,0.15)' : 'var(--bg-primary)',
      color: reason === r.id ? 'var(--accent)' : 'var(--text-primary)'
    }
  }, r.label))), (() => {
    const vol = analysis?.volume24h || 0;
    const slipPct = vol >= 5000000 ? 0.002 : vol >= 1000000 ? 0.005 : vol >= 500000 ? 0.008 : vol >= 100000 ? 0.012 : vol >= 50000 ? 0.018 : vol >= 10000 ? 0.025 : 0.04;
    const slipSOL = parseFloat(amt || 0) * slipPct;
    const tier = vol >= 5000000 ? 'High liq' : vol >= 100000 ? 'Medium liq' : vol >= 10000 ? 'Low liq' : 'Very low liq';
    const tc = vol >= 5000000 ? 'var(--success)' : vol >= 100000 ? 'var(--warning)' : 'var(--danger)';
    return /*#__PURE__*/React.createElement("div", {
      style: {
        background: 'rgba(239,68,68,0.08)',
        border: '1px solid rgba(239,68,68,0.2)',
        borderRadius: '10px',
        padding: '10px 14px',
        marginBottom: '12px',
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center'
      }
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.72rem',
        color: 'var(--text-secondary)',
        marginBottom: '2px'
      }
    }, "Est. slippage (buy)"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        color: 'var(--danger)',
        fontSize: '0.9rem'
      }
    }, "-", slipSOL.toFixed(4), " SOL ", /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.75rem',
        opacity: 0.7
      }
    }, "(", (slipPct * 100).toFixed(1), "%)"))), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.72rem',
        color: tc,
        fontWeight: 'bold'
      }
    }, tier), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.7rem',
        color: 'var(--text-secondary)'
      }
    }, "Vol: $", vol >= 1000000 ? (vol / 1e6).toFixed(1) + 'M' : vol >= 1000 ? (vol / 1000).toFixed(0) + 'k' : '<1k')));
  })(), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Cancel"), /*#__PURE__*/React.createElement("button", {
    onClick: () => reason && onConfirm(parseFloat(amt), reason),
    className: "success",
    style: {
      flex: 2,
      margin: 0,
      fontSize: '1rem',
      letterSpacing: '1px',
      opacity: reason ? 1 : 0.5,
      cursor: reason ? 'pointer' : 'not-allowed'
    }
  }, "\uD83D\uDE80 APE")), !reason && /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--warning)',
      fontSize: '0.78rem',
      textAlign: 'center',
      marginTop: '8px'
    }
  }, "Select a reason to continue")), tab === 'chart' && /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      flexDirection: 'column'
    }
  }, chartUrl ? /*#__PURE__*/React.createElement("iframe", {
    src: chartUrl,
    style: {
      width: '100%',
      height: '420px',
      border: 'none'
    },
    title: "DexScreener Chart"
  }) : /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '60px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, "No chart available"), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '16px',
      display: 'flex',
      gap: '10px',
      borderTop: '1px solid var(--border)'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Close"), /*#__PURE__*/React.createElement("button", {
    onClick: () => setTab('ape'),
    className: "success",
    style: {
      flex: 2,
      margin: 0
    }
  }, "\uD83D\uDE80 Go APE")))));
}
function DCAModal({
  trade,
  balance,
  onConfirm,
  onClose
}) {
  const [amt, setAmt] = React.useState('0.1');
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.8)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      padding: '28px',
      maxWidth: '380px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("h3", {
    style: {
      marginBottom: '6px'
    }
  }, "\uD83D\uDCC9 DCA \u2014 ", trade.tokenSymbol), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem',
      marginBottom: '4px'
    }
  }, "Avg price: ", /*#__PURE__*/React.createElement("strong", null, "$", trade.avgEntryPrice.toFixed(8))), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem',
      marginBottom: '20px'
    }
  }, "Balance: ", /*#__PURE__*/React.createElement("strong", null, balance.toFixed(2), " SOL")), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '8px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Add (SOL)"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      marginBottom: '12px'
    }
  }, [['0.1','0.1'], ['0.5','0.5'], ['1','1'], ['ALL', balance.toFixed(2)]].map(([label, v]) => /*#__PURE__*/React.createElement("button", {
    key: label,
    onClick: () => setAmt(v),
    style: {
      flex: 1,
      margin: 0,
      padding: '8px 4px',
      fontSize: '0.82rem',
      background: amt === v ? (label === 'ALL' ? 'var(--purple)' : 'var(--accent)') : 'var(--bg-primary)',
      border: `1px solid ${amt === v ? (label === 'ALL' ? 'var(--purple)' : 'var(--accent)') : 'var(--border)'}`,
      color: amt === v ? 'white' : 'var(--text-secondary)',
      borderRadius: '6px',
      cursor: 'pointer',
      fontWeight: label === 'ALL' ? '700' : '500'
    }
  }, label))), /*#__PURE__*/React.createElement("input", {
    value: amt,
    onChange: e => setAmt(e.target.value),
    type: "number",
    step: "0.01",
    min: "0.01",
    style: {
      marginBottom: '20px'
    }
  }), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Cancel"), /*#__PURE__*/React.createElement("button", {
    onClick: () => onConfirm(parseFloat(amt), trade),
    className: "success",
    style: {
      flex: 2,
      margin: 0
    }
  }, "\uD83D\uDCC9 Confirm DCA"))));
}
function PartialModal({
  trade,
  onConfirm,
  onClose
}) {
  const [pct, setPct] = React.useState('50');
  const [sellReason, setSellReason] = React.useState('');
  const solAmt = (trade.totalInvested * (parseFloat(pct) || 0) / 100).toFixed(3);
  const SELL_REASONS = [{
    id: 'TARGET',
    label: 'üéØ PROFIT TARGET HIT'
  }, {
    id: 'STOPLOSS',
    label: 'üõë STOP LOSS'
  }];
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.8)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      padding: '28px',
      maxWidth: '380px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("h3", {
    style: {
      marginBottom: '6px'
    }
  }, "\uD83D\uDCCA Partial Sell \u2014 ", trade.tokenSymbol), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem',
      marginBottom: '20px'
    }
  }, "Position: ", /*#__PURE__*/React.createElement("strong", null, trade.totalInvested.toFixed(3), " SOL")), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '8px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "How much to sell?"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      marginBottom: '12px',
      flexWrap: 'wrap'
    }
  }, ['25', '50', '75', '100'].map(v => /*#__PURE__*/React.createElement("button", {
    key: v,
    onClick: () => setPct(v),
    style: {
      flex: 1,
      minWidth: '50px',
      margin: 0,
      padding: '10px 4px',
      fontSize: '0.9rem',
      fontWeight: 'bold',
      background: pct === v ? 'var(--warning)' : 'var(--bg-primary)',
      border: `1px solid ${pct === v ? 'var(--warning)' : 'var(--border)'}`,
      color: pct === v ? '#0f172a' : 'var(--text-secondary)',
      borderRadius: '6px',
      cursor: 'pointer'
    }
  }, v, "%"))), /*#__PURE__*/React.createElement("input", {
    value: pct,
    onChange: e => setPct(e.target.value),
    type: "number",
    step: "1",
    min: "1",
    max: "100",
    style: {
      marginBottom: '8px'
    }
  }), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.82rem',
      marginBottom: '20px'
    }
  }, "= ", /*#__PURE__*/React.createElement("strong", null, solAmt, " SOL"), " of position"), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '10px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Why are you selling?"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '8px',
      marginBottom: '20px'
    }
  }, SELL_REASONS.map(r => /*#__PURE__*/React.createElement("div", {
    key: r.id,
    onClick: () => setSellReason(r.id),
    style: {
      padding: '12px',
      borderRadius: '10px',
      cursor: 'pointer',
      transition: 'all 0.15s',
      textAlign: 'center',
      fontWeight: 'bold',
      fontSize: '0.85rem',
      border: `2px solid ${sellReason === r.id ? 'var(--warning)' : 'var(--border)'}`,
      background: sellReason === r.id ? 'rgba(245,158,11,0.15)' : 'var(--bg-primary)',
      color: sellReason === r.id ? 'var(--warning)' : 'var(--text-primary)'
    }
  }, r.label))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Cancel"), /*#__PURE__*/React.createElement("button", {
    onClick: () => sellReason && onConfirm(parseFloat(pct), trade, sellReason),
    className: "warning",
    style: {
      flex: 2,
      margin: 0,
      opacity: sellReason ? 1 : 0.5,
      cursor: sellReason ? 'pointer' : 'not-allowed'
    }
  }, "\uD83D\uDCCA Confirm Sell")), !sellReason && /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--warning)',
      fontSize: '0.78rem',
      textAlign: 'center',
      marginTop: '8px'
    }
  }, "Selecione o motivo para continuar")));
}
function CloseModal({
  trade,
  onConfirm,
  onClose
}) {
  const [sellReason, setSellReason] = React.useState('');

  // Determine if trade is currently in profit or loss based on currentPrice
  const cp = trade.currentPrice || trade.avgEntryPrice;
  const isProfit = cp >= trade.avgEntryPrice;

  // Reason categories: profit=true means only valid when in profit, profit=false only valid in loss, profit=null = always valid
  const SELL_REASONS = [{
    id: 'TAKE_PROFIT',
    label: 'üéØ Take Profit',
    profit: true,
    desc: 'Only available when in profit'
  }, {
    id: 'STOP_LOSS',
    label: 'üõë Stop Loss',
    profit: false,
    desc: 'Only available when in loss'
  }, {
    id: 'RUG',
    label: '‚ò†Ô∏è Rug / Scam',
    profit: null,
    desc: null
  }, {
    id: 'BAD_ENTRY',
    label: '‚ùå Bad Entry',
    profit: null,
    desc: null
  }, {
    id: 'NARRATIVE',
    label: 'üîÑ Narrative Changed',
    profit: null,
    desc: null
  }, {
    id: 'LIQUIDITY',
    label: 'üí∏ Need Liquidity',
    profit: null,
    desc: null
  }];
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.8)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      padding: '28px',
      maxWidth: '380px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("h3", {
    style: {
      marginBottom: '4px'
    }
  }, "\uD83D\uDCB0 Close Position \u2014 ", trade.tokenSymbol), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '10px',
      marginBottom: '20px'
    }
  }, /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem',
      margin: 0
    }
  }, "Full position: ", /*#__PURE__*/React.createElement("strong", null, trade.totalInvested.toFixed(3), " SOL")), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.75rem',
      padding: '2px 9px',
      borderRadius: '20px',
      fontWeight: 'bold',
      background: isProfit ? 'rgba(16,185,129,0.15)' : 'rgba(239,68,68,0.15)',
      color: isProfit ? 'var(--success)' : 'var(--danger)',
      border: `1px solid ${isProfit ? 'rgba(16,185,129,0.3)' : 'rgba(239,68,68,0.3)'}`
    }
  }, isProfit ? '‚ñ≤ Profit' : '‚ñº Loss')), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '10px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Why are you exiting?"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '8px',
      marginBottom: '24px'
    }
  }, SELL_REASONS.map(r => {
    const disabled = r.profit === true ? !isProfit : r.profit === false ? isProfit : false;
    const selected = sellReason === r.id;
    return /*#__PURE__*/React.createElement("div", {
      key: r.id,
      onClick: () => !disabled && setSellReason(r.id),
      title: disabled ? r.desc : '',
      style: {
        padding: '12px 8px',
        borderRadius: '10px',
        cursor: disabled ? 'not-allowed' : 'pointer',
        transition: 'all 0.15s',
        textAlign: 'center',
        fontWeight: 'bold',
        fontSize: '0.85rem',
        opacity: disabled ? 0.35 : 1,
        border: `2px solid ${selected ? 'var(--accent)' : 'var(--border)'}`,
        background: selected ? 'rgba(59,130,246,0.15)' : 'var(--bg-primary)',
        color: selected ? 'var(--accent)' : disabled ? 'var(--text-secondary)' : 'var(--text-primary)',
        userSelect: 'none'
      }
    }, r.label);
  })), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Cancel"), /*#__PURE__*/React.createElement("button", {
    onClick: () => sellReason && onConfirm(trade.id, sellReason),
    className: "danger",
    style: {
      flex: 2,
      margin: 0,
      opacity: sellReason ? 1 : 0.5,
      cursor: sellReason ? 'pointer' : 'not-allowed'
    }
  }, "\uD83D\uDCB0 Close Position")), !sellReason && /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--warning)',
      fontSize: '0.78rem',
      textAlign: 'center',
      marginTop: '8px'
    }
  }, "Select a reason to continue")));
}
function TradeInfoModal({
  trade,
  onClose
}) {
  const cp = trade.currentPrice || trade.avgEntryPrice;
  const pc = trade.avgEntryPrice ? (cp - trade.avgEntryPrice) / trade.avgEntryPrice * 100 : 0;
  const pPnl = (trade.partialExits || []).reduce((s, e) => s + e.pnl, 0);
  const uPnl = trade.totalInvested * (pc / 100);
  const tPnl = pPnl + uPnl;
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.8)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      padding: '24px',
      maxWidth: '440px',
      width: '100%',
      border: '1px solid var(--border)',
      maxHeight: '85vh',
      overflowY: 'auto',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'flex-start',
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    style: {
      fontSize: '1.3rem'
    }
  }, trade.tokenSymbol), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem'
    }
  }, trade.tokenName)), /*#__PURE__*/React.createElement("div", {
    style: {
      textAlign: 'right'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '1.4rem',
      fontWeight: 'bold',
      color: tPnl >= 0 ? 'var(--success)' : 'var(--danger)'
    }
  }, tPnl >= 0 ? '+' : '', tPnl.toFixed(4), " SOL"), /*#__PURE__*/React.createElement("small", {
    style: {
      color: pc >= 0 ? 'var(--success)' : 'var(--danger)'
    }
  }, pc >= 0 ? '+' : '', pc.toFixed(2), "%"))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '10px',
      marginBottom: '16px'
    }
  }, [{
    label: 'Invested',
    val: `${trade.totalInvested.toFixed(4)} SOL`
  }, {
    label: 'Slippage',
    val: trade.slippageCost ? `-${((trade.slippageCost || 0) + (trade.exitSlipCost || 0)).toFixed(4)} SOL` : '‚Äî',
    color: 'var(--danger)'
  }, {
    label: 'Avg Price',
    val: `$${trade.avgEntryPrice.toFixed(8)}`
  }, {
    label: 'Current Price',
    val: `$${cp.toFixed(8)}`
  }, {
    label: 'Realizado',
    val: `${pPnl >= 0 ? '+' : ''}${pPnl.toFixed(4)} SOL`,
    color: pPnl >= 0 ? 'var(--success)' : 'var(--danger)'
  }].map(s => /*#__PURE__*/React.createElement("div", {
    key: s.label,
    style: {
      background: 'var(--bg-primary)',
      padding: '10px',
      borderRadius: '8px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.75rem',
      marginBottom: '3px'
    }
  }, s.label), /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '0.9rem',
      color: s.color || 'var(--text-primary)'
    }
  }, s.val)))), trade.buyReason && trade.buyReason !== '‚Äî' && /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'rgba(59,130,246,0.1)',
      border: '1px solid rgba(59,130,246,0.3)',
      borderRadius: '8px',
      padding: '10px',
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.78rem'
    }
  }, "Motivo da compra: "), /*#__PURE__*/React.createElement("strong", {
    style: {
      color: 'var(--accent)'
    }
  }, trade.buyReason)), trade.entries?.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '14px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.75rem',
      fontWeight: 'bold',
      marginBottom: '6px',
      textTransform: 'uppercase',
      letterSpacing: '1px'
    }
  }, "Entries"), trade.entries.map((e, i) => /*#__PURE__*/React.createElement("div", {
    key: i,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '7px 10px',
      background: 'var(--bg-primary)',
      borderRadius: '6px',
      marginBottom: '4px',
      fontSize: '0.82rem'
    }
  }, /*#__PURE__*/React.createElement("span", null, "#", i + 1, " \u2014 ", e.amountSOL.toFixed(3), " SOL"), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)'
    }
  }, "$", e.price.toFixed(8))))), (trade.partialExits || []).length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '14px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.75rem',
      fontWeight: 'bold',
      marginBottom: '6px',
      textTransform: 'uppercase',
      letterSpacing: '1px'
    }
  }, "Partial Exits"), trade.partialExits.map((e, i) => /*#__PURE__*/React.createElement("div", {
    key: i,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '7px 10px',
      background: 'var(--bg-primary)',
      borderRadius: '6px',
      marginBottom: '4px',
      fontSize: '0.82rem'
    }
  }, /*#__PURE__*/React.createElement("span", null, e.percentage, "% \u2014 ", e.soldSOL?.toFixed(3), " SOL"), /*#__PURE__*/React.createElement("span", {
    style: {
      color: e.pnl >= 0 ? 'var(--success)' : 'var(--danger)'
    }
  }, e.pnl >= 0 ? '+' : '', e.pnl.toFixed(4), " SOL")))), /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-primary)',
      borderRadius: '8px',
      padding: '10px',
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.72rem',
      marginBottom: '3px'
    }
  }, "Contract"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.73rem',
      wordBreak: 'break-all',
      color: 'var(--text-primary)'
    }
  }, trade.tokenAddress || '‚Äî')), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => window.open(`https://dexscreener.com/solana/${trade.tokenAddress}`, '_blank'),
    style: {
      flex: 1,
      margin: 0,
      background: 'rgba(16,185,129,0.15)',
      border: '1px solid var(--success)',
      color: 'var(--success)'
    }
  }, "\uD83D\uDCC8 DexScreener"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Close"))));
}
function RankingTable({
  ranking,
  rankingLoading,
  userId,
  user
}) {
  const [sortBy, setSortBy] = React.useState('xp');
  const SORT_OPTS = [{
    id: 'xp',
    label: '‚≠ê XP'
  }, {
    id: 'totalPnl',
    label: 'üí∞ P&L'
  }, {
    id: 'winRate',
    label: 'üéØ Win Rate'
  }];
  const sorted = [...ranking].sort((a, b) => {
    if (sortBy === 'winRate') return b.winRate - a.winRate;
    if (sortBy === 'totalPnl') return b.totalPnl - a.totalPnl;
    return b.xp - a.xp;
  });
  const MEDALS = ['ü•á', 'ü•à', 'ü•â'];
  return /*#__PURE__*/React.createElement("div", {
    className: "card",
    style: {
      padding: '0',
      overflow: 'hidden'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      borderBottom: '1px solid var(--border)'
    }
  }, SORT_OPTS.map(o => /*#__PURE__*/React.createElement("div", {
    key: o.id,
    onClick: () => setSortBy(o.id),
    style: {
      flex: 1,
      padding: '12px',
      textAlign: 'center',
      cursor: 'pointer',
      fontSize: '0.85rem',
      fontWeight: 'bold',
      borderBottom: sortBy === o.id ? '2px solid var(--accent)' : '2px solid transparent',
      color: sortBy === o.id ? 'var(--accent)' : 'var(--text-secondary)',
      background: sortBy === o.id ? 'rgba(59,130,246,0.06)' : 'transparent',
      transition: 'all 0.15s'
    }
  }, o.label))), rankingLoading ? /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '40px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, "\u23F3 Loading ranking...") : sorted.length === 0 ? /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '40px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2rem',
      marginBottom: '10px'
    }
  }, "\uD83C\uDFDC\uFE0F"), "No traders in the ranking yet.", /*#__PURE__*/React.createElement("br", null), /*#__PURE__*/React.createElement("small", null, "Close a trade to see it here!")) : sorted.map((r, i) => {
    const isMe = r.id === userId;
    const levelIdx = Math.max(0, Math.min(LEVELS.length - 1, (r.level || 1) - 1));
    const lvl = LEVELS[levelIdx] || LEVELS[0];
    return /*#__PURE__*/React.createElement("div", {
      key: r.id,
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '12px',
        padding: '14px 18px',
        borderBottom: '1px solid var(--border)',
        background: isMe ? 'rgba(59,130,246,0.06)' : 'transparent'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        width: '32px',
        textAlign: 'center',
        flexShrink: 0,
        fontSize: i < 3 ? '1.4rem' : '1rem',
        fontWeight: 'bold',
        color: i < 3 ? 'inherit' : 'var(--text-secondary)'
      }
    }, i < 3 ? MEDALS[i] : `#${i + 1}`), /*#__PURE__*/React.createElement("div", {
      style: {
        width: '38px',
        height: '38px',
        borderRadius: '50%',
        flexShrink: 0,
        background: 'var(--bg-primary)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        fontSize: '1.2rem',
        border: isMe ? '2px solid var(--accent)' : '1px solid var(--border)'
      }
    }, lvl.icon), /*#__PURE__*/React.createElement("div", {
      style: {
        flex: 1,
        minWidth: 0
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.92rem',
        color: isMe ? 'var(--accent)' : 'var(--text-primary)',
        overflow: 'hidden',
        textOverflow: 'ellipsis',
        whiteSpace: 'nowrap'
      }
    }, r.username, " ", isMe && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.7rem',
        color: 'var(--accent)'
      }
    }, "\u2190 you")), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, lvl.name, " \xB7 ", r.trades, " trades")), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right',
        flexShrink: 0
      }
    }, sortBy === 'xp' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        color: 'var(--accent)',
        fontSize: '0.95rem'
      }
    }, r.xp.toLocaleString(), " XP"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: r.totalPnl >= 0 ? 'var(--success)' : 'var(--danger)'
      }
    }, r.totalPnl >= 0 ? '+' : '', r.totalPnl.toFixed(2), " SOL")), sortBy === 'totalPnl' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.95rem',
        color: r.totalPnl >= 0 ? 'var(--success)' : 'var(--danger)'
      }
    }, r.totalPnl >= 0 ? '+' : '', r.totalPnl.toFixed(2), " SOL"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, r.xp.toLocaleString(), " XP")), sortBy === 'winRate' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.95rem',
        color: r.winRate >= 50 ? 'var(--success)' : 'var(--warning)'
      }
    }, r.winRate, "% wins"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, r.xp.toLocaleString(), " XP"))));
  }));
}

const COMMUNITY_TOPICS = [{
  id: 'dicas',
  label: 'üí° Tips/Tutorials',
  color: '#3b82f6',
  expiry: null,
  lucrativos: true
}, {
  id: 'alertas',
  label: 'üö® Rug/Alerts',
  color: '#ef4444',
  expiry: 48
}, {
  id: 'kols',
  label: 'üì¢ KOLs',
  color: '#8b5cf6',
  expiry: null
}, {
  id: 'noticias',
  label: 'üì∞ News',
  color: '#06b6d4',
  expiry: 72
}, {
  id: 'calls',
  label: 'üî• Calls',
  color: '#f59e0b',
  expiry: 24
}, {
  id: 'baleias',
  label: 'üê≥ Whales',
  color: '#10b981',
  expiry: 24
}, {
  id: 'geral',
  label: 'ü§ù General',
  color: '#94a3b8',
  expiry: null
}];
const MAX_POSTS_PER_DAY = 3; // max 3 posts per day
const MIN_WINRATE_DICAS = 50; // min win rate for Tips/Tutorials
const XP_PER_LIKE = 10;
const XP_PER_REPORT = -20;
const MIN_LEVEL_VERIFIED = 5;
function CommunityTab({
  user,
  onXPChange,
  traderWinRate
}) {
  const [topic, setTopic] = React.useState('dicas');
  const [posts, setPosts] = React.useState([]);
  const [postsLoading, setPostsLoading] = React.useState(false);
  const [composing, setComposing] = React.useState(false);
  const [draft, setDraft] = React.useState('');
  const [submitting, setSubmitting] = React.useState(false);
  const [communityRank, setCommunityRank] = React.useState([]);
  const [view, setView] = React.useState('feed');
  const [expandedPost, setExpandedPost] = React.useState(null);
  const [commentDraft, setCommentDraft] = React.useState({});
  const [commentSubmitting, setCommentSubmitting] = React.useState(false);

  // ‚îÄ‚îÄ Storage helper (localStorage fallback for file://) ‚îÄ‚îÄ
  const store = {
    set: (k, v, s) => window.storage ? window.storage.set(k, v, s) : (localStorage.setItem(k, v), Promise.resolve({
      key: k,
      value: v
    })),
    get: (k, s) => window.storage ? window.storage.get(k, s) : (() => {
      const v = localStorage.getItem(k);
      if (v === null) return Promise.reject(new Error('nf'));
      return Promise.resolve({
        key: k,
        value: v
      });
    })(),
    list: (p, s) => window.storage ? window.storage.list(p, s) : Promise.resolve({
      keys: Object.keys(localStorage).filter(k => k.startsWith(p))
    })
  };

  // helpers
  const myLevel = LEVELS.reduce((acc, l) => (user.xp || 0) >= l.xp ? l.level : acc, 1);
  const isVerified = myLevel >= MIN_LEVEL_VERIFIED;
  const canPostDicas = (traderWinRate || 0) >= MIN_WINRATE_DICAS;
  const storageKey = t => `helmcomm${t}`;
  const commentKey = postId => `helmcomments${postId}`;
  const rankKey = uid => `helmcommrank${uid}`;
  const todayKey = () => new Date().toISOString().split('T')[0].replace(/-/g, '');

  // posts already liked/reported by this user (local)
  const myActionsKey = `helmCommunityActions_${user.id}`;
  const getMyActions = () => {
    try {
      return JSON.parse(localStorage.getItem(myActionsKey) || '{}');
    } catch {
      return {};
    }
  };
  const saveMyActions = a => localStorage.setItem(myActionsKey, JSON.stringify(a));
  const postsToday = () => {
    const actions = getMyActions();
    const key = `posts_${todayKey()}`;
    return actions[key] || 0;
  };
  const timeAgo = ts => {
    const diff = Date.now() - ts;
    if (diff < 60000) return 'now';
    if (diff < 3600000) return `${Math.floor(diff / 60000)}min`;
    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h`;
    return `${Math.floor(diff / 86400000)}d`;
  };
  const expiryLeft = post => {
    const cfg = COMMUNITY_TOPICS.find(t => t.id === post.topic);
    if (!cfg?.expiry) return null;
    const remaining = cfg.expiry * 3600000 - (Date.now() - post.createdAt);
    if (remaining <= 0) return 0;
    return Math.ceil(remaining / 3600000);
  };

  // ‚îÄ‚îÄ FETCH POSTS ‚îÄ‚îÄ
  const fetchPosts = async () => {
    setPostsLoading(true);
    try {
      const result = await store.list(storageKey(topic), true);
      const keys = result?.keys || [];
      const loaded = [];
      for (const key of keys) {
        try {
          const r = await store.get(key, true);
          if (r?.value) {
            const p = JSON.parse(r.value);
            const cfg = COMMUNITY_TOPICS.find(t => t.id === p.topic);
            if (cfg?.expiry && Date.now() - p.createdAt > cfg.expiry * 3600000) continue;
            if ((p.reports || 0) >= 5) continue;
            loaded.push(p);
          }
        } catch {}
      }
      loaded.sort((a, b) => {
        if ((b.likes || 0) >= 5 && (a.likes || 0) < 5) return 1;
        if ((a.likes || 0) >= 5 && (b.likes || 0) < 5) return -1;
        return b.createdAt - a.createdAt;
      });
      setPosts(loaded);
    } catch {} finally {
      setPostsLoading(false);
    }
  };

  // ‚îÄ‚îÄ FETCH RANK ‚îÄ‚îÄ
  const fetchCommunityRank = async () => {
    try {
      const result = await store.list('helmcommrank', true);
      const keys = result?.keys || [];
      const entries = [];
      for (const key of keys) {
        try {
          const r = await store.get(key, true);
          if (r?.value) entries.push(JSON.parse(r.value));
        } catch {}
      }
      entries.sort((a, b) => (b.totalLikes || 0) - (a.totalLikes || 0));
      setCommunityRank(entries);
    } catch {}
  };
  React.useEffect(() => {
    fetchPosts();
  }, [topic]);
  React.useEffect(() => {
    if (view === 'rank') fetchCommunityRank();
  }, [view]);

  // ‚îÄ‚îÄ COMMENTS ‚îÄ‚îÄ
  const fetchComments = async postId => {
    try {
      const r = await store.get(commentKey(postId), true).catch(() => null);
      return r ? JSON.parse(r.value) : [];
    } catch {
      return [];
    }
  };
  const submitComment = async post => {
    const text = (commentDraft[post.id] || '').trim();
    if (!text) return;
    setCommentSubmitting(true);
    try {
      const existing = await fetchComments(post.id);
      const comment = {
        id: `${user.id}c${Date.now()}`,
        authorId: user.id,
        authorName: user.username || 'Anon',
        authorLevel: myLevel,
        isVerified,
        text,
        reports: 0,
        createdAt: Date.now()
      };
      existing.push(comment);
      await store.set(commentKey(post.id), JSON.stringify(existing), true);
      setCommentDraft(d => ({
        ...d,
        [post.id]: ''
      }));
      setPosts(prev => prev.map(p => p.id === post.id ? {
        ...p,
        _comments: existing
      } : p));
    } catch {} finally {
      setCommentSubmitting(false);
    }
  };
  const reportComment = async (post, comment) => {
    const actions = getMyActions();
    const k = `comment_${comment.id}`;
    if (actions[k]?.reported) return;
    if (!confirm('Report this comment?')) return;
    try {
      const existing = await fetchComments(post.id);
      const updated = existing.map(c => c.id === comment.id ? {
        ...c,
        reports: (c.reports || 0) + 1
      } : c);
      await store.set(commentKey(post.id), JSON.stringify(updated), true);
      setPosts(prev => prev.map(p => p.id === post.id ? {
        ...p,
        _comments: updated
      } : p));
      actions[k] = {
        reported: true
      };
      saveMyActions(actions);
    } catch {}
  };
  const loadComments = async post => {
    const comments = await fetchComments(post.id);
    setPosts(prev => prev.map(p => p.id === post.id ? {
      ...p,
      _comments: comments
    } : p));
    setExpandedPost(expandedPost === post.id ? null : post.id);
  };

  // ‚îÄ‚îÄ SUBMIT POST ‚îÄ‚îÄ
  const handleSubmit = async () => {
    if (!draft.trim()) return;
    if (topic === 'dicas' && !canPostDicas) {
      alert(`üí° Tips/Tutorials is exclusive to traders with win rate ‚â• ${MIN_WINRATE_DICAS}%. Your win rate: ${(traderWinRate || 0).toFixed(0)}%.`);
      return;
    }
    if (postsToday() >= MAX_POSTS_PER_DAY) {
      alert(`Daily limit of ${MAX_POSTS_PER_DAY} posts reached.`);
      return;
    }
    setSubmitting(true);
    try {
      const post = {
        id: `${user.id}t${Date.now()}`,
        topic,
        authorId: user.id,
        authorName: user.username || 'Anon',
        authorLevel: myLevel,
        isVerified,
        text: draft.trim(),
        likes: 0,
        reports: 0,
        createdAt: Date.now()
      };
      const key = `${storageKey(topic)}${post.id}`;
      await store.set(key, JSON.stringify(post), true);

      // update rank
      const rKey = rankKey(user.id);
      let rankEntry = {
        id: user.id,
        username: user.username || 'Anon',
        posts: 0,
        totalLikes: 0
      };
      try {
        const r = await store.get(rKey, true);
        if (r) rankEntry = JSON.parse(r.value);
      } catch {}
      rankEntry.posts = (rankEntry.posts || 0) + 1;
      await store.set(rKey, JSON.stringify(rankEntry), true);

      // daily count
      const actions = getMyActions();
      const dayKey = `posts_${todayKey()}`;
      actions[dayKey] = (actions[dayKey] || 0) + 1;
      saveMyActions(actions);
      onXPChange && onXPChange(20, 'üìù Post published');
      setDraft('');
      setComposing(false);
      await fetchPosts();
    } catch {
      alert('Failed to publish. Please try again.');
    } finally {
      setSubmitting(false);
    }
  };

  // ‚îÄ‚îÄ LIKE ‚îÄ‚îÄ
  const handleLike = async post => {
    const actions = getMyActions();
    if (actions[post.id]?.liked) return;
    try {
      const r = await store.get(`${storageKey(post.topic)}${post.id}`, true);
      if (!r) return;
      const updated = {
        ...JSON.parse(r.value),
        likes: (JSON.parse(r.value).likes || 0) + 1
      };
      await store.set(`${storageKey(post.topic)}${post.id}`, JSON.stringify(updated), true);

      // update rank
      const rKey = rankKey(post.authorId);
      let rankEntry = {
        id: post.authorId,
        username: post.authorName || 'Anon',
        posts: 0,
        totalLikes: 0
      };
      try {
        const rr = await store.get(rKey, true);
        if (rr) rankEntry = JSON.parse(rr.value);
      } catch {}
      rankEntry.totalLikes = (rankEntry.totalLikes || 0) + 1;
      await store.set(rKey, JSON.stringify(rankEntry), true);
      actions[post.id] = {
        ...(actions[post.id] || {}),
        liked: true
      };
      saveMyActions(actions);
      onXPChange && onXPChange(XP_PER_LIKE, 'üëç Post liked');
      setPosts(prev => prev.map(p => p.id === post.id ? {
        ...p,
        likes: (p.likes || 0) + 1
      } : p));
    } catch {}
  };

  // ‚îÄ‚îÄ REPORT ‚îÄ‚îÄ
  const handleReport = async post => {
    const actions = getMyActions();
    if (actions[post.id]?.reported) return;
    if (!confirm('Report this post?')) return;
    try {
      const r = await store.get(`${storageKey(post.topic)}${post.id}`, true);
      if (!r) return;
      const updated = {
        ...JSON.parse(r.value),
        reports: (JSON.parse(r.value).reports || 0) + 1
      };
      await store.set(`${storageKey(post.topic)}${post.id}`, JSON.stringify(updated), true);
      actions[post.id] = {
        ...(actions[post.id] || {}),
        reported: true
      };
      saveMyActions(actions);
      setPosts(prev => prev.map(p => p.id === post.id ? {
        ...p,
        reports: (p.reports || 0) + 1
      } : p));
    } catch {}
  };
  const topicCfg = COMMUNITY_TOPICS.find(t => t.id === topic);
  const remaining = MAX_POSTS_PER_DAY - postsToday();
  const actions = getMyActions();
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '16px',
      flexWrap: 'wrap',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("h2", {
    style: {
      margin: 0
    }
  }, "\uD83D\uDCAC Community"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => setView(view === 'feed' ? 'rank' : 'feed'),
    style: {
      margin: 0,
      padding: '8px 14px',
      fontSize: '0.82rem'
    }
  }, view === 'feed' ? 'üèÖ Ranking' : 'üì∞ Feed'), view === 'feed' && /*#__PURE__*/React.createElement("button", {
    onClick: () => setComposing(!composing),
    className: "success",
    style: {
      margin: 0,
      padding: '8px 14px',
      fontSize: '0.82rem'
    }
  }, "\u270F\uFE0F New post"))), view === 'rank' && /*#__PURE__*/React.createElement("div", {
    className: "card",
    style: {
      padding: '0',
      overflow: 'hidden'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '14px 18px',
      borderBottom: '1px solid var(--border)',
      fontWeight: 'bold',
      fontSize: '0.95rem'
    }
  }, "\uD83C\uDFC5 Top Contributors"), communityRank.length === 0 ? /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '40px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, "No contributors yet.") : communityRank.map((r, i) => {
    const isMe = r.id === user.id;
    const MEDALS = ['ü•á', 'ü•à', 'ü•â'];
    return /*#__PURE__*/React.createElement("div", {
      key: r.id,
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '12px',
        padding: '13px 18px',
        borderBottom: '1px solid var(--border)',
        background: isMe ? 'rgba(59,130,246,0.06)' : 'transparent'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        width: '28px',
        textAlign: 'center',
        fontWeight: 'bold',
        fontSize: i < 3 ? '1.3rem' : '0.95rem',
        color: 'var(--text-secondary)'
      }
    }, i < 3 ? MEDALS[i] : `#${i + 1}`), /*#__PURE__*/React.createElement("div", {
      style: {
        flex: 1
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        color: isMe ? 'var(--accent)' : 'var(--text-primary)',
        fontSize: '0.9rem'
      }
    }, r.username, " ", isMe && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.7rem'
      }
    }, "\u2190 you")), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, r.posts || 0, " posts published")), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        color: 'var(--success)',
        fontSize: '0.95rem'
      }
    }, "\uD83D\uDC4D ", r.totalLikes || 0), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.72rem',
        color: 'var(--text-secondary)'
      }
    }, "likes received")));
  })), view === 'feed' && /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '6px',
      flexWrap: 'wrap',
      marginBottom: '14px'
    }
  }, COMMUNITY_TOPICS.map(t => {
    const locked = t.lucrativos && !canPostDicas;
    return /*#__PURE__*/React.createElement("div", {
      key: t.id,
      onClick: () => setTopic(t.id),
      style: {
        padding: '6px 12px',
        borderRadius: '20px',
        cursor: 'pointer',
        fontSize: '0.8rem',
        fontWeight: 'bold',
        transition: 'all 0.15s',
        background: topic === t.id ? t.color + '33' : 'var(--bg-card)',
        border: `1px solid ${topic === t.id ? t.color : 'var(--border)'}`,
        color: topic === t.id ? t.color : 'var(--text-secondary)',
        opacity: locked ? 0.7 : 1
      }
    }, t.label, locked ? ' üîí' : '');
  })), composing && /*#__PURE__*/React.createElement("div", {
    className: "card",
    style: {
      marginBottom: '14px',
      padding: '16px'
    }
  }, topicCfg?.lucrativos && !canPostDicas ? /*#__PURE__*/React.createElement("div", {
    style: {
      textAlign: 'center',
      padding: '20px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '1.8rem',
      marginBottom: '8px'
    }
  }, "\uD83D\uDD12"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      marginBottom: '6px'
    }
  }, "Restricted access"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem',
      color: 'var(--text-secondary)',
      lineHeight: 1.5
    }
  }, "Tips/Tutorials is exclusive to traders with ", /*#__PURE__*/React.createElement("strong", null, "win rate \u2265 ", MIN_WINRATE_DICAS, "%"), ".", /*#__PURE__*/React.createElement("br", null), "Your current win rate: ", /*#__PURE__*/React.createElement("strong", {
    style: {
      color: (traderWinRate || 0) >= MIN_WINRATE_DICAS ? 'var(--success)' : 'var(--danger)'
    }
  }, (traderWinRate || 0).toFixed(0), "%")), /*#__PURE__*/React.createElement("button", {
    onClick: () => setComposing(false),
    style: {
      marginTop: '12px'
    }
  }, "Close")) : /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '8px',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontWeight: 'bold',
      color: topicCfg?.color
    }
  }, topicCfg?.label), topicCfg?.expiry && /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.75rem',
      color: 'var(--text-secondary)'
    }
  }, "\xB7 expires in ", topicCfg.expiry, "h"), isVerified && /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.72rem',
      background: 'rgba(59,130,246,0.15)',
      color: 'var(--accent)',
      padding: '2px 8px',
      borderRadius: '10px',
      border: '1px solid rgba(59,130,246,0.3)'
    }
  }, "\u2705 Verified"), /*#__PURE__*/React.createElement("span", {
    style: {
      marginLeft: 'auto',
      fontSize: '0.75rem',
      color: remaining <= 1 ? 'var(--danger)' : 'var(--text-secondary)'
    }
  }, remaining, "/", MAX_POSTS_PER_DAY, " posts today")), /*#__PURE__*/React.createElement("textarea", {
    value: draft,
    onChange: e => setDraft(e.target.value),
    placeholder: `Share something about ${topicCfg?.label}...`,
    maxLength: 500,
    style: {
      width: '100%',
      minHeight: '90px',
      background: 'var(--bg-primary)',
      border: '1px solid var(--border)',
      borderRadius: '8px',
      padding: '10px',
      color: 'var(--text-primary)',
      fontSize: '0.9rem',
      resize: 'vertical',
      fontFamily: 'inherit',
      boxSizing: 'border-box'
    }
  }), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginTop: '10px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.75rem',
      color: 'var(--text-secondary)'
    }
  }, draft.length, "/500"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      setComposing(false);
      setDraft('');
    },
    style: {
      margin: 0,
      padding: '8px 14px',
      fontSize: '0.82rem'
    }
  }, "Cancel"), /*#__PURE__*/React.createElement("button", {
    onClick: handleSubmit,
    disabled: !draft.trim() || submitting,
    className: "success",
    style: {
      margin: 0,
      padding: '8px 16px',
      fontSize: '0.82rem',
      opacity: draft.trim() ? 1 : 0.5
    }
  }, submitting ? '...' : 'üì§ Publish'))))), postsLoading ? /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '40px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, "\u23F3 Loading posts...") : posts.length === 0 ? /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '40px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2rem',
      marginBottom: '8px'
    }
  }, "\uD83D\uDCAC"), "No posts yet. Be the first!") : posts.map(post => {
    const isPinned = (post.likes || 0) >= 5;
    const myLiked = actions[post.id]?.liked;
    const myReported = actions[post.id]?.reported;
    const expLeft = expiryLeft(post);
    return /*#__PURE__*/React.createElement("div", {
      key: post.id,
      className: "card",
      style: {
        marginBottom: '10px',
        padding: '16px',
        border: isPinned ? '1px solid rgba(251,191,36,0.4)' : '1px solid var(--border)',
        background: isPinned ? 'rgba(251,191,36,0.04)' : 'var(--bg-card)'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '8px',
        marginBottom: '10px',
        flexWrap: 'wrap'
      }
    }, isPinned && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.72rem',
        background: 'rgba(251,191,36,0.15)',
        color: 'var(--gold)',
        padding: '2px 6px',
        borderRadius: '8px'
      }
    }, "\uD83D\uDCCC Pinned"), /*#__PURE__*/React.createElement("span", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.9rem'
      }
    }, post.authorName), post.isVerified && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.68rem',
        background: 'rgba(59,130,246,0.15)',
        color: 'var(--accent)',
        padding: '1px 5px',
        borderRadius: '8px'
      }
    }, "\u2705"), /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)',
        marginLeft: 'auto'
      }
    }, timeAgo(post.createdAt)), expLeft !== null && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.68rem',
        color: expLeft < 4 ? 'var(--danger)' : 'var(--text-secondary)'
      }
    }, "\u23F1 ", expLeft, "h")), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.9rem',
        color: 'var(--text-primary)',
        lineHeight: 1.6,
        marginBottom: '12px',
        whiteSpace: 'pre-wrap'
      }
    }, post.text), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        gap: '8px',
        alignItems: 'center',
        flexWrap: 'wrap'
      }
    }, /*#__PURE__*/React.createElement("button", {
      onClick: () => handleLike(post),
      disabled: !!myLiked,
      style: {
        margin: 0,
        padding: '6px 12px',
        fontSize: '0.82rem',
        background: myLiked ? 'rgba(16,185,129,0.15)' : 'var(--bg-primary)',
        border: `1px solid ${myLiked ? 'var(--success)' : 'var(--border)'}`,
        color: myLiked ? 'var(--success)' : 'var(--text-secondary)',
        borderRadius: '8px',
        cursor: myLiked ? 'default' : 'pointer'
      }
    }, "\uD83D\uDC4D ", post.likes || 0, " ", !myLiked && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.72rem'
      }
    }, "(+", XP_PER_LIKE, "xp)")), !myReported && post.authorId !== user.id && /*#__PURE__*/React.createElement("button", {
      onClick: () => handleReport(post),
      style: {
        margin: 0,
        padding: '6px 10px',
        fontSize: '0.78rem',
        background: 'transparent',
        border: '1px solid transparent',
        color: 'var(--text-secondary)',
        borderRadius: '8px',
        cursor: 'pointer',
        opacity: 0.6
      }
    }, "\uD83D\uDEA9 ", post.reports || 0), myReported && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, "\uD83D\uDEA9 Reported"), post.reports >= 3 && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.72rem',
        color: 'var(--danger)',
        marginLeft: 'auto'
      }
    }, "\u26A0\uFE0F Flagged content"), /*#__PURE__*/React.createElement("button", {
      onClick: () => loadComments(post),
      style: {
        margin: 0,
        marginLeft: 'auto',
        padding: '6px 10px',
        fontSize: '0.78rem',
        background: 'transparent',
        border: '1px solid var(--border)',
        color: 'var(--text-secondary)',
        borderRadius: '8px',
        cursor: 'pointer'
      }
    }, "\uD83D\uDCAC ", post._comments?.length || 0)), expandedPost === post.id && /*#__PURE__*/React.createElement("div", {
      style: {
        marginTop: '12px',
        paddingTop: '12px',
        borderTop: '1px solid var(--border)'
      }
    }, (post._comments || []).length === 0 && /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.82rem',
        color: 'var(--text-secondary)',
        marginBottom: '10px'
      }
    }, "No comments yet."), (post._comments || []).map(c => {
      const myRepC = getMyActions()[`comment_${c.id}`]?.reported;
      return /*#__PURE__*/React.createElement("div", {
        key: c.id,
        style: {
          padding: '8px 10px',
          background: 'var(--bg-primary)',
          borderRadius: '8px',
          marginBottom: '6px',
          fontSize: '0.83rem'
        }
      }, /*#__PURE__*/React.createElement("div", {
        style: {
          display: 'flex',
          alignItems: 'center',
          gap: '6px',
          marginBottom: '4px'
        }
      }, /*#__PURE__*/React.createElement("span", {
        style: {
          fontWeight: 'bold'
        }
      }, c.authorName), c.isVerified && /*#__PURE__*/React.createElement("span", {
        style: {
          fontSize: '0.68rem',
          background: 'rgba(59,130,246,0.15)',
          color: 'var(--accent)',
          padding: '1px 5px',
          borderRadius: '8px'
        }
      }, "\u2705"), /*#__PURE__*/React.createElement("span", {
        style: {
          fontSize: '0.68rem',
          color: 'var(--text-secondary)',
          marginLeft: 'auto'
        }
      }, timeAgo(c.createdAt)), !myRepC && c.authorId !== user.id && /*#__PURE__*/React.createElement("button", {
        onClick: () => reportComment(post, c),
        style: {
          margin: 0,
          padding: '2px 6px',
          fontSize: '0.7rem',
          background: 'transparent',
          border: 'none',
          color: 'var(--text-secondary)',
          cursor: 'pointer',
          opacity: 0.5
        }
      }, "\uD83D\uDEA9")), /*#__PURE__*/React.createElement("div", {
        style: {
          color: 'var(--text-primary)',
          lineHeight: 1.4
        }
      }, c.text), c.reports >= 3 && /*#__PURE__*/React.createElement("div", {
        style: {
          fontSize: '0.7rem',
          color: 'var(--danger)',
          marginTop: '4px'
        }
      }, "\u26A0\uFE0F Flagged comment"));
    }), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        gap: '8px',
        marginTop: '8px'
      }
    }, /*#__PURE__*/React.createElement("input", {
      value: commentDraft[post.id] || '',
      onChange: e => setCommentDraft(d => ({
        ...d,
        [post.id]: e.target.value
      })),
      placeholder: "Write a comment...",
      maxLength: 200,
      style: {
        flex: 1,
        fontSize: '0.85rem',
        padding: '8px 10px'
      }
    }), /*#__PURE__*/React.createElement("button", {
      onClick: () => submitComment(post),
      disabled: !commentDraft[post.id]?.trim() || commentSubmitting,
      className: "success",
      style: {
        margin: 0,
        padding: '8px 14px',
        fontSize: '0.82rem',
        opacity: commentDraft[post.id]?.trim() ? 1 : 0.5
      }
    }, "Send"))));
  })));
}
function XPTableModal({
  onClose
}) {
  const gainRows = [{
    action: 'üèÜ Win trade ‚â• 5 SOL profit',
    xp: '+500'
  }, {
    action: 'ü•á Win trade ‚â• 2 SOL profit',
    xp: '+300'
  }, {
    action: 'ü•à Win trade ‚â• 1 SOL profit',
    xp: '+150'
  }, {
    action: 'ü•â Win trade ‚â• 0.5 SOL profit',
    xp: '+75'
  }, {
    action: '‚úÖ Win trade ‚â• 0.1 SOL profit',
    xp: '+25'
  }, {
    action: '‚úÖ Any win trade',
    xp: '+10'
  }, {
    action: 'üî• 3 wins in a row',
    xp: '+200'
  }, {
    action: 'üî•üî• 5 wins in a row',
    xp: '+500'
  }, {
    action: 'üî•üî•üî• 10 wins in a row',
    xp: '+1000'
  }, {
    action: 'üìù Post published',
    xp: '+20'
  }, {
    action: 'üëç Post liked',
    xp: '+10'
  }];
  const lossRows = [{
    action: '‚ùå Loss trade ‚â• 0.1 SOL',
    xp: '-25'
  }, {
    action: '‚ùå Loss trade ‚â• 0.5 SOL',
    xp: '-75'
  }, {
    action: '‚ùå Loss trade ‚â• 1 SOL',
    xp: '-150'
  }, {
    action: '‚ùå Loss trade ‚â• 2 SOL',
    xp: '-300'
  }, {
    action: '‚ùå Loss trade ‚â• 5 SOL',
    xp: '-500'
  }];
  const levels = [{
    level: 1,
    name: 'üå± Normie',
    xp: '0'
  }, {
    level: 2,
    name: 'üëÄ Observer',
    xp: '500'
  }, {
    level: 3,
    name: 'üê∏ Ape',
    xp: '1.500'
  }, {
    level: 4,
    name: 'üé∞ Degen',
    xp: '3.500'
  }, {
    level: 5,
    name: 'üî• True Degen',
    xp: '7.000'
  }, {
    level: 6,
    name: 'üíé Diamond Hands',
    xp: '12.000'
  }, {
    level: 7,
    name: 'üß† Master Degen',
    xp: '20.000'
  }, {
    level: 8,
    name: 'üêã Whale',
    xp: '35.000'
  }, {
    level: 9,
    name: 'üëë Alpha Caller',
    xp: '60.000'
  }, {
    level: 10,
    name: 'üè¥‚Äç‚ò†Ô∏è Insider',
    xp: '100.000'
  }];
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.85)',
      zIndex: 1001,
      display: 'flex',
      alignItems: 'flex-start',
      justifyContent: 'center',
      padding: '16px',
      overflowY: 'auto'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      maxWidth: '460px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
      marginTop: '20px',
      marginBottom: '20px'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '18px 22px',
      borderBottom: '1px solid var(--border)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'space-between'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '1.05rem'
    }
  }, "\uD83D\uDCCB XP Table"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      margin: 0,
      padding: '5px 10px',
      fontSize: '0.82rem',
      background: 'transparent',
      border: '1px solid var(--border)'
    }
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '18px 22px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '20px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      fontWeight: 'bold',
      color: 'var(--success)',
      textTransform: 'uppercase',
      letterSpacing: '0.8px',
      marginBottom: '10px'
    }
  }, "\u2705 XP Gains"), gainRows.map(r => /*#__PURE__*/React.createElement("div", {
    key: r.action,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      padding: '7px 0',
      borderBottom: '1px solid var(--border)',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-primary)'
    }
  }, r.action), /*#__PURE__*/React.createElement("span", {
    style: {
      fontWeight: 'bold',
      color: 'var(--success)',
      minWidth: '50px',
      textAlign: 'right'
    }
  }, r.xp)))), /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '20px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      fontWeight: 'bold',
      color: 'var(--danger)',
      textTransform: 'uppercase',
      letterSpacing: '0.8px',
      marginBottom: '10px'
    }
  }, "\u274C XP Losses"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      color: 'var(--text-secondary)',
      marginBottom: '8px'
    }
  }, "\u26A0\uFE0F XP never goes below 0"), lossRows.map(r => /*#__PURE__*/React.createElement("div", {
    key: r.action,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      padding: '7px 0',
      borderBottom: '1px solid var(--border)',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-primary)'
    }
  }, r.action), /*#__PURE__*/React.createElement("span", {
    style: {
      fontWeight: 'bold',
      color: 'var(--danger)',
      minWidth: '50px',
      textAlign: 'right'
    }
  }, r.xp)))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      fontWeight: 'bold',
      color: 'var(--accent)',
      textTransform: 'uppercase',
      letterSpacing: '0.8px',
      marginBottom: '10px'
    }
  }, "\uD83C\uDFC5 Levels"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '6px'
    }
  }, levels.map(l => /*#__PURE__*/React.createElement("div", {
    key: l.level,
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '8px',
      padding: '8px 10px',
      background: 'var(--bg-primary)',
      borderRadius: '8px',
      fontSize: '0.82rem'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      minWidth: '22px',
      fontWeight: 'bold',
      color: 'var(--text-secondary)',
      fontSize: '0.72rem'
    }
  }, "Lv", l.level), /*#__PURE__*/React.createElement("span", {
    style: {
      flex: 1
    }
  }, l.name), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--accent)',
      fontSize: '0.72rem',
      fontWeight: 'bold'
    }
  }, l.xp))))))));
}
function WeeklyReportModal({
  user,
  traderProfile,
  onClose
}) {
  const now = Date.now();
  const weekMs = 7 * 86400000;
  const closed = user?.trades?.filter(t => t.status === 'closed') || [];

  // Trades this week
  const weekTrades = closed.filter(t => t.closedAt && now - new Date(t.closedAt) < weekMs);
  const weekWins = weekTrades.filter(t => (t.totalPnl || 0) > 0);
  const weekLosses = weekTrades.filter(t => (t.totalPnl || 0) < 0);
  const weekPnl = weekTrades.reduce((s, t) => s + (t.totalPnl || 0), 0);
  const weekWR = weekTrades.length > 0 ? weekWins.length / weekTrades.length * 100 : 0;
  const weekAvgWin = weekWins.length > 0 ? weekWins.reduce((s, t) => s + (t.totalPnl || 0), 0) / weekWins.length : 0;
  const weekAvgLoss = weekLosses.length > 0 ? Math.abs(weekLosses.reduce((s, t) => s + (t.totalPnl || 0), 0) / weekLosses.length) : 0;
  const weekRR = weekAvgLoss > 0 ? weekAvgWin / weekAvgLoss : 0;

  // Best / worst of the week
  const weekBest = weekTrades.length > 0 ? weekTrades.reduce((a, b) => (b.totalPnl || 0) > (a.totalPnl || 0) ? b : a) : null;
  const weekWorst = weekTrades.length > 0 ? weekTrades.reduce((a, b) => (b.totalPnl || 0) < (a.totalPnl || 0) ? b : a) : null;

  // Tokens most traded
  const tokenFreq = {};
  weekTrades.forEach(t => {
    const key = t.tokenSymbol || t.tokenName || t.tokenAddress?.slice(0, 8) || '?';
    tokenFreq[key] = (tokenFreq[key] || 0) + 1;
  });
  const topTokens = Object.entries(tokenFreq).sort((a, b) => b[1] - a[1]).slice(0, 3);

  // Buy reasons this week
  const reasonFreq = {};
  weekTrades.forEach(t => {
    if (t.buyReason) reasonFreq[t.buyReason] = (reasonFreq[t.buyReason] || 0) + 1;
  });
  const topReasons = Object.entries(reasonFreq).sort((a, b) => b[1] - a[1]).slice(0, 3);

  // Week date range label
  const weekStart = new Date(now - weekMs);
  const label = `${weekStart.toLocaleDateString('en-US')} ‚Üí ${new Date().toLocaleDateString('en-US')}`;

  // Grade
  const grade = () => {
    if (weekTrades.length === 0) return {
      letter: '‚Äî',
      color: 'var(--text-secondary)',
      msg: 'No trades this week.'
    };
    let score = 0;
    if (weekWR >= 60) score += 3;else if (weekWR >= 50) score += 2;else if (weekWR >= 40) score += 1;
    if (weekRR >= 1.5) score += 3;else if (weekRR >= 1) score += 2;else if (weekRR >= 0.7) score += 1;
    if (weekPnl > 0) score += 2;else if (weekPnl < 0) score -= 1;
    if (traderProfile?.isOvertrading) score -= 1;
    if (score >= 7) return {
      letter: 'S',
      color: '#fbbf24',
      msg: 'Exceptional week! Elite-level consistency.'
    };
    if (score >= 5) return {
      letter: 'A',
      color: 'var(--success)',
      msg: 'Good week. Keep maintaining discipline.'
    };
    if (score >= 3) return {
      letter: 'B',
      color: 'var(--accent)',
      msg: 'Decent week. Room to improve.'
    };
    if (score >= 1) return {
      letter: 'C',
      color: 'var(--warning)',
      msg: 'Tough week. Review your entries and exits.'
    };
    return {
      letter: 'D',
      color: 'var(--danger)',
      msg: 'Bad week. Pause and analyze your patterns.'
    };
  };
  const g = grade();
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.85)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'flex-start',
      justifyContent: 'center',
      padding: '16px',
      overflowY: 'auto'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      maxWidth: '480px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
      marginTop: '20px',
      marginBottom: '20px'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '20px 24px',
      borderBottom: '1px solid var(--border)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'space-between'
    }
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '1.1rem'
    }
  }, "\uD83D\uDCCA Weekly Report"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      color: 'var(--text-secondary)',
      marginTop: '2px'
    }
  }, label)), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      margin: 0,
      padding: '6px 12px',
      fontSize: '0.82rem',
      background: 'transparent',
      border: '1px solid var(--border)'
    }
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '20px 24px'
    }
  }, weekTrades.length === 0 ? /*#__PURE__*/React.createElement("div", {
    style: {
      textAlign: 'center',
      padding: '40px 0',
      color: 'var(--text-secondary)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2.5rem',
      marginBottom: '12px'
    }
  }, "\uD83D\uDCED"), /*#__PURE__*/React.createElement("div", null, "No closed trades this week.")) : /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '16px',
      padding: '16px',
      background: 'var(--bg-primary)',
      borderRadius: '12px',
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '3rem',
      fontWeight: '900',
      color: g.color,
      lineHeight: 1,
      minWidth: '50px',
      textAlign: 'center'
    }
  }, g.letter), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      marginBottom: '4px'
    }
  }, "Weekly Grade"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem',
      color: 'var(--text-secondary)',
      lineHeight: 1.4
    }
  }, g.msg))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '8px',
      marginBottom: '16px'
    }
  }, [{
    label: 'Weekly P&L',
    val: `${weekPnl >= 0 ? '+' : ''}${weekPnl.toFixed(4)} SOL`,
    color: weekPnl >= 0 ? 'var(--success)' : 'var(--danger)'
  }, {
    label: 'Closed trades',
    val: weekTrades.length
  }, {
    label: 'Win Rate',
    val: `${weekWR.toFixed(0)}%`,
    color: weekWR >= 50 ? 'var(--success)' : 'var(--danger)'
  }, {
    label: 'Risk/Reward',
    val: `${weekRR.toFixed(2)}√ó`,
    color: weekRR >= 1 ? 'var(--success)' : 'var(--warning)'
  }, {
    label: 'Wins / Losses',
    val: `${weekWins.length} / ${weekLosses.length}`,
    color: 'var(--text-primary)'
  }, {
    label: 'Avg Win',
    val: `+${weekAvgWin.toFixed(4)}`,
    color: 'var(--success)'
  }].map(s => /*#__PURE__*/React.createElement("div", {
    key: s.label,
    style: {
      background: 'var(--bg-primary)',
      borderRadius: '10px',
      padding: '12px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.72rem',
      color: 'var(--text-secondary)',
      marginBottom: '4px'
    }
  }, s.label), /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      color: s.color || 'var(--text-primary)'
    }
  }, s.val)))), (weekBest || weekWorst) && /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.82rem',
      fontWeight: 'bold',
      color: 'var(--text-secondary)',
      marginBottom: '8px',
      textTransform: 'uppercase',
      letterSpacing: '0.5px'
    }
  }, "Highlights"), weekBest && /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '8px 12px',
      background: 'rgba(16,185,129,0.07)',
      border: '1px solid rgba(16,185,129,0.2)',
      borderRadius: '8px',
      marginBottom: '6px',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", null, "\uD83D\uDFE2 Best \u2014 ", /*#__PURE__*/React.createElement("strong", null, weekBest.tokenSymbol || weekBest.tokenName || 'Token')), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--success)',
      fontWeight: 'bold'
    }
  }, (weekBest.totalPnl || 0) >= 0 ? '+' : '', (weekBest.totalPnl || 0).toFixed(4), " SOL")), weekWorst && weekWorst.id !== weekBest?.id && /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '8px 12px',
      background: 'rgba(239,68,68,0.07)',
      border: '1px solid rgba(239,68,68,0.2)',
      borderRadius: '8px',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", null, "\uD83D\uDD34 Worst \u2014 ", /*#__PURE__*/React.createElement("strong", null, weekWorst.tokenSymbol || weekWorst.tokenName || 'Token')), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--danger)',
      fontWeight: 'bold'
    }
  }, (weekWorst.totalPnl || 0).toFixed(4), " SOL"))), topTokens.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.82rem',
      fontWeight: 'bold',
      color: 'var(--text-secondary)',
      marginBottom: '8px',
      textTransform: 'uppercase',
      letterSpacing: '0.5px'
    }
  }, "Top tokens traded"), topTokens.map(([sym, count]) => /*#__PURE__*/React.createElement("div", {
    key: sym,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '6px 0',
      borderBottom: '1px solid var(--border)',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontWeight: 'bold'
    }
  }, sym), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)'
    }
  }, count, " trade", count > 1 ? 's' : '')))), topReasons.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.82rem',
      fontWeight: 'bold',
      color: 'var(--text-secondary)',
      marginBottom: '8px',
      textTransform: 'uppercase',
      letterSpacing: '0.5px'
    }
  }, "Top entry reasons"), topReasons.map(([r, c]) => /*#__PURE__*/React.createElement("div", {
    key: r,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '6px 0',
      borderBottom: '1px solid var(--border)',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", null, r), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)'
    }
  }, c, "\xD7")))), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '12px',
      background: 'rgba(59,130,246,0.07)',
      borderRadius: '10px',
      border: '1px solid rgba(59,130,246,0.2)',
      fontSize: '0.82rem',
      color: 'var(--text-secondary)',
      lineHeight: 1.5
    }
  }, "\uD83D\uDCA1 ", weekWR >= 60 ? 'Excellent win rate! Keep being selective with entries.' : weekWR >= 50 ? 'Positive win rate. Focus on improving R/R to maximize gains.' : weekPnl > 0 ? 'Positive P&L despite low win rate ‚Äî your R/R is saving you. Try being more selective.' : 'Negative week. Analyze your losses: ignored stops? FOMO? Illiquid tokens?')))));
}

function TutorialOverlay({
  step,
  onNext,
  onSkip
}) {
  const STEPS = [{
    target: null,
    title: '‚ò∏ Welcome to HELM!',
    body: `HELM is your paper trading simulator for Solana memecoins ‚Äî practice without risking real SOL. You start with 5 SOL to trade. Let's take a quick tour!`,
    pos: 'center'
  }, {
    target: 'helm-analysis-tab',
    title: 'üîç Analysis Tab',
    body: `Paste any Solana token contract address here. HELM fetches live data from DexScreener and runs a full risk analysis ‚Äî red flags, green flags, holders, volume, and more.`,
    pos: 'bottom'
  }, {
    target: 'helm-analysis-tab',
    title: 'üöÄ APE Button',
    body: `After analyzing a token, hit the APE button to open a paper position. Choose your entry size and a buy reason ‚Äî this helps you track your decision-making over time.`,
    pos: 'bottom'
  }, {
    target: 'helm-analysis-tab',
    title: 'üìâ Slippage Simulation',
    body: `HELM automatically simulates real slippage based on the token's 24h volume. Low liquidity = higher slippage. Your P&L reflects this cost just like real trading.`,
    pos: 'bottom'
  }, {
    target: 'helm-portfolio-tab',
    title: 'üìä Portfolio Tab',
    body: `All your active positions live here. Watch your P&L update in real-time, add DCA entries, take partial profits, or close your full position with a sell reason.`,
    pos: 'bottom'
  }, {
    target: 'helm-missions',
    title: 'üìã Missions & Rewards',
    body: `Complete missions to earn SOL rewards ‚Äî post in the community, build win streaks, and more. Running low on balance? Missions help you refuel.`,
    pos: 'bottom'
  }, {
    target: 'helm-ranking',
    title: 'ü•á Global Rankings',
    body: `Compete with other traders worldwide. Rankings are updated by XP, total P&L, and win rate. Your performance gets published automatically after each trade.`,
    pos: 'bottom'
  }, {
    target: 'helm-community',
    title: 'üí¨ Community Tab',
    body: `Share tips, post alpha, discuss strategies. Traders with good win rates can post in the Tips section. Engage with the community and earn XP for participating.`,
    pos: 'bottom'
  }];
  const s = STEPS[step];
  if (!s) return null;

  // Get target element position (computed fresh each render ‚Äî no useState needed)
  const [rect, setRect] = React.useState(null);
  React.useEffect(() => {
    if (!s.target) {
      setRect(null);
      return;
    }
    const doGet = () => {
      const el = document.getElementById(s.target);
      if (el) {
        setRect(el.getBoundingClientRect());
        el.scrollIntoView({
          behavior: 'smooth',
          block: 'center'
        });
      }
    };
    // Small delay so DOM is ready
    const t = setTimeout(doGet, 80);
    return () => clearTimeout(t);
  }, [step, s.target]);
  const PAD = 10;
  const tooltipW = 320;

  // Compute tooltip position
  let tooltipStyle = {};
  if (!rect || s.pos === 'center') {
    tooltipStyle = {
      position: 'fixed',
      top: '50%',
      left: '50%',
      transform: 'translate(-50%, -50%)',
      zIndex: 10001
    };
  } else {
    const left = Math.max(12, Math.min(window.innerWidth - tooltipW - 12, rect.left + rect.width / 2 - tooltipW / 2));
    const top = rect.bottom + PAD + 8;
    tooltipStyle = {
      position: 'fixed',
      top: `${top}px`,
      left: `${left}px`,
      width: `${tooltipW}px`,
      zIndex: 10001
    };
  }
  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      zIndex: 9999,
      background: 'rgba(0,0,0,0.72)',
      pointerEvents: rect ? 'none' : 'auto'
    }
  }), rect && /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      top: rect.top - PAD,
      left: rect.left - PAD,
      width: rect.width + PAD * 2,
      height: rect.height + PAD * 2,
      borderRadius: '10px',
      boxShadow: '0 0 0 9999px rgba(0,0,0,0.72)',
      border: '2px solid rgba(59,130,246,0.8)',
      zIndex: 10000,
      pointerEvents: 'none',
      transition: 'all 0.3s ease'
    }
  }), /*#__PURE__*/React.createElement("div", {
    style: {
      ...tooltipStyle,
      background: 'var(--bg-card)',
      border: '1px solid rgba(59,130,246,0.5)',
      borderRadius: '16px',
      padding: '22px',
      boxShadow: '0 12px 48px rgba(0,0,0,0.6)',
      pointerEvents: 'auto',
      maxWidth: '340px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '5px'
    }
  }, STEPS.map((_, i) => /*#__PURE__*/React.createElement("div", {
    key: i,
    style: {
      width: i === step ? '18px' : '6px',
      height: '6px',
      borderRadius: '3px',
      transition: 'width 0.3s',
      background: i === step ? 'var(--accent)' : i < step ? 'rgba(59,130,246,0.4)' : 'var(--border)'
    }
  }))), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.72rem',
      color: 'var(--text-secondary)'
    }
  }, step + 1, " / ", STEPS.length)), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '1.1rem',
      fontWeight: 'bold',
      marginBottom: '8px'
    }
  }, s.title), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.88rem',
      color: 'var(--text-secondary)',
      lineHeight: '1.5',
      marginBottom: '18px'
    }
  }, s.body), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      justifyContent: 'space-between',
      alignItems: 'center'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onSkip,
    style: {
      margin: 0,
      padding: '7px 14px',
      fontSize: '0.8rem',
      background: 'transparent',
      border: '1px solid var(--border)',
      color: 'var(--text-secondary)',
      borderRadius: '8px',
      cursor: 'pointer'
    }
  }, "Skip tour"), /*#__PURE__*/React.createElement("button", {
    onClick: onNext,
    style: {
      margin: 0,
      padding: '8px 22px',
      fontSize: '0.88rem',
      fontWeight: 'bold',
      background: 'linear-gradient(135deg,var(--accent),#8b5cf6)',
      border: 'none',
      color: 'white',
      borderRadius: '8px',
      cursor: 'pointer'
    }
  }, step === STEPS.length - 1 ? 'üöÄ Start Trading!' : 'Next ‚Üí'))));
}
// SECTION 4: MAIN APPLICATION

function HelmApp() {
  const [user, setUser] = useState(null);
  const [activeTab, setActiveTab] = useState('profile');
  const [tokenAddress, setTokenAddress] = useState('');
  const [analysis, setAnalysis] = useState(null);
  const [loading, setLoading] = useState(false);
  const [theme, setTheme] = useState('default');
  const [toast, setToast] = useState(null);
  const [xpPopup, setXPPopup] = useState(null);
  const [buyModal, setBuyModal] = useState(null);
  const [closeModal, setCloseModal] = useState(null);
  const [portfolioModal, setPortfolioModal] = useState(null);
  const [chartTrade, setChartTrade] = useState(null);
  const [showWeeklyReport, setShowWeeklyReport] = useState(false);
  const [showXPTable, setShowXPTable] = useState(false);
  const [editingUsername, setEditingUsername] = useState(false);
  const [usernameDraft, setUsernameDraft] = useState('');
  const [showBankrupt, setShowBankrupt] = useState(false);
  const [showMissions, setShowMissions] = useState(false);
  const [expandedTrades, setExpandedTrades] = useState({});
  const [adWatching, setAdWatching] = useState(false);
  const [adTimer, setAdTimer] = useState(0);
  const [ranking, setRanking] = useState([]);
  const [rankingLoading, setRankingLoading] = useState(false);
  const [solPrice, setSolPrice] = useState(150);
  const [settingsOpen, setSettingsOpen] = useState(false);
  const [tutorialStep, setTutorialStep] = useState(-1); // -1 = inactive
  const [starterFlow, setStarterFlow] = useState(-1); // -1 = inactive, 0-4 = steps
  const STARTER_TOKEN = 'pumpCmXqMfrsAkQ5r49WcJnRayYRqmXz6ae8H7H9Dfn'; // PUMP

  // StarterFlow: auto-advance based on state changes
  useEffect(() => {
    if (starterFlow === 1) {
      // Pre-fill token but don't auto-analyze
      setActiveTab('analysis');
      setTokenAddress(STARTER_TOKEN);
    }
  }, [starterFlow]);

  // StarterFlow: dedicated analyze function (bypasses stale state)
  const starterAnalyze = () => {
    setActiveTab('analysis');
    analyzeToken(STARTER_TOKEN);
  };

  // StarterFlow: detect analysis loaded ‚Üí advance to step 2
  useEffect(() => {
    if (starterFlow === 1 && analysis) {
      setTimeout(() => setStarterFlow(2), 600);
    }
  }, [analysis, starterFlow]);

  // StarterFlow: detect first trade made ‚Üí advance to step 4 (congrats)
  useEffect(() => {
    if ((starterFlow === 2 || starterFlow === 3) && user?.trades?.filter(t => t.status === 'active').length > 0) {
      setActiveTab('portfolio');
      setTimeout(() => setStarterFlow(4), 600);
    }
  }, [user?.trades?.length, starterFlow]);
  const [userLoading, setUserLoading] = useState(true);
  const [glossTip, setGlossTip] = useState(null); // {term, def, x, y}
  const [glossSearch, setGlossSearch] = useState('');
  const [glossCat, setGlossCat] = useState('all');

  // ‚îÄ‚îÄ GLOSSARY DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const GLOSSARY = [
    // Trading Basics
    {t:'MC (Market Cap)',d:'Total value of all tokens. MC = price √ó total supply. Low MC ($10k-$100k) = more room to grow but higher risk. High MC ($10M+) = safer but less upside.',ex:'"This token has a $50k MC ‚Äî perfect entry zone."',cat:'trading'},
    {t:'Liquidity',d:'Real money in the trading pool. If liquidity is $5k and you buy $2k worth, price spikes. On sell, it crashes. Low liq = you can\'t exit without destroying the price.',ex:'"Liq is only $8k ‚Äî if I ape $1k, slippage will eat me alive."',cat:'trading'},
    {t:'Slippage',d:'Difference between the price you see and what you actually pay. Low volume tokens have high slippage. You enter already losing money. HELM simulates this.',ex:'"2% slippage on a $0.50 SOL buy means I paid $0.51."',cat:'trading'},
    {t:'Volume',d:'How much money flowed through the token in 24h. High volume = active interest. But fake volume (wash trading) exists ‚Äî check the vol/MC ratio.',ex:'"$500k volume on a $50k MC token? That\'s 10x ‚Äî probably wash trading."',cat:'trading'},
    {t:'MC/Liq Ratio',d:'Market Cap divided by Liquidity. When MC is $1M but liquidity is $5k, one whale selling $5k can crash the price to zero. Ratio >1000√ó = extremely dangerous.',ex:'"MC/Liq ratio of 2000x ‚Äî one sell order and this thing is dead."',cat:'trading'},
    {t:'Buy/Sell Ratio',d:'Compares buy orders vs sell orders in 24h. More buys = demand. But a ratio of 10:1 or higher is suspicious ‚Äî could be bots or wash trading.',ex:'"500 buys and 20 sells? Either everyone loves it or bots are farming."',cat:'trading'},
    {t:'PnL',d:'Profit and Loss ‚Äî your result on a trade. Green PnL = you made money. Red PnL = you lost. Track your PnL religiously.',ex:'"My PnL on $WIF: +2.3 SOL. Best trade this week."',cat:'trading'},
    {t:'DCA (Dollar Cost Average)',d:'Buying more when price drops to lower your average entry price. Smart DCA = small additions at key support levels. Dumb DCA = throwing money at a dead token.',ex:'"Token dipped 40% but fundamentals unchanged ‚Äî DCA\'d 0.2 SOL."',cat:'trading'},
    {t:'Entry / Exit',d:'Entry = price or moment you bought. Exit = price or moment you sold. Good traders plan both BEFORE clicking buy.',ex:'"My entry was $0.002 and I\'m targeting exit at $0.01 ‚Äî that\'s 5x."',cat:'trading'},
    {t:'Position Size',d:'How much of your balance you put in one trade. >10% on a memecoin = reckless. 2-5% = smart. Pros risk 1-2% max per trade.',ex:'"I only ape 0.1 SOL per trade ‚Äî that\'s 2% of my bag."',cat:'trading'},
    {t:'Take Profit / Partial Sell',d:'Selling a portion of your position when price rises to lock in gains. Don\'t wait for 100x ‚Äî take profits at 2x, 5x. Let a small moonbag ride.',ex:'"Sold 50% at 3x, another 25% at 5x. Riding 25% moonbag."',cat:'trading'},
    {t:'Stop Loss',d:'Pre-decided price where you accept the loss and sell. Memecoins don\'t have auto stop-loss. It\'s YOUR discipline. -30% to -50% is common threshold.',ex:'"My rule: if it drops 40% from my entry with declining volume, I\'m out."',cat:'trading'},

    // On-Chain
    {t:'Holders',d:'Number of unique wallets holding the token. 50 holders = 3 people control everything. 500+ with good distribution = healthier. But bots can fake holder counts.',ex:'"Only 80 holders ‚Äî this is basically a group chat token."',cat:'onchain'},
    {t:'Top Holder %',d:'Percentage of total supply held by the biggest wallet. If one wallet holds 10%+, they can crash the price in one sell. Safe threshold: <2.5%.',ex:'"Top holder has 15% ‚Äî that\'s a ticking time bomb."',cat:'onchain'},
    {t:'Avg Bag',d:'Average value held per wallet (MC / holders). Many holders with $2 bags = bots. Few holders with $50k bags = whales. Healthy: $50-$500 avg.',ex:'"5000 holders but avg bag is $3 ‚Äî those are all airdrop bots."',cat:'onchain'},
    {t:'Snipers',d:'Bots that buy in the very first second of a token launch. They get the cheapest price and dump on real buyers later. If snipers hold 20%+ supply, you already lost.',ex:'"4 sniper wallets hold 25% of supply ‚Äî this was dead on arrival."',cat:'onchain'},
    {t:'Bonding Curve',d:'Pump.fun mechanism: price rises automatically as more people buy. Token "graduates" to Raydium after hitting $90k MC. Early buyers get the best price by design.',ex:'"Still on bonding curve at $40k MC ‚Äî if it graduates, early buyers 2x minimum."',cat:'onchain'},
    {t:'Wash Trading',d:'Fake volume created by bots trading with themselves to make a token look active. Check vol/MC ratio ‚Äî if volume is 5x+ the market cap, it\'s likely fake.',ex:'"$2M volume on a $100k MC token? Nobody real is trading that much."',cat:'onchain'},
    {t:'Rug Pull',d:'Developer abandons project and sells all their tokens or removes liquidity. Your token goes to $0 instantly. Classic rug: liquidity not locked + anonymous dev.',ex:'"Dev removed liquidity at 3am ‚Äî classic rug. Token went from $0.01 to $0."',cat:'onchain'},
    {t:'Soft Rug',d:'Dev doesn\'t disappear but slowly stops working. Updates stop, socials go quiet, price bleeds out over weeks instead of crashing instantly.',ex:'"Last tweet was 2 weeks ago, TG admin hasn\'t posted in days ‚Äî soft rug in progress."',cat:'onchain'},

    // CT Culture
    {t:'APE',d:'Buying aggressively, usually without much analysis. "I aped" = I bought fast. Can be smart (early conviction play) or dumb (FOMO buy at the top).',ex:'"I saw the narrative forming and aped 1 SOL before CT caught on."',cat:'culture'},
    {t:'FOMO',d:'Fear Of Missing Out. You see a token at +500% and buy the top because "it might go higher." FOMO is the #1 reason degens lose money.',ex:'"Bought at $0.10 because of FOMO. It went to $0.02 the next day."',cat:'culture'},
    {t:'Jeet',d:'Someone who sells at the first sign of profit, usually for minimal gains. Opposite of diamond hands. In memecoin culture, jeeting at 2x is sometimes the smart play.',ex:'"He jeeted his entire bag at 1.5x ‚Äî missed the 20x pump."',cat:'culture'},
    {t:'Diamond Hands',d:'Holding through massive volatility. In stocks this is heroic. In memecoins it\'s often just holding a bag to zero. Know when diamond hands becomes stupidity.',ex:'"Diamond handed through a -60% dip and it came back to 10x. Lucky."',cat:'culture'},
    {t:'Paper Hands',d:'Selling at the first sign of a dip. Sometimes smart (cutting losses early), sometimes you sell the bottom right before a pump.',ex:'"Paper handed at -20% and it pumped 5x the next hour. Classic."',cat:'culture'},
    {t:'Moonbag',d:'A small position you keep after taking profits, just in case the token "goes to the moon." Usually 10-25% of your original position. Free lottery ticket.',ex:'"Took 75% profits at 5x. Riding the moonbag ‚Äî if it goes to 50x, I\'m rich."',cat:'culture'},
    {t:'Degen',d:'A trader who takes extremely high risks knowingly. Not an insult in crypto ‚Äî it\'s a lifestyle. Smart degens manage risk. Dumb degens go broke.',ex:'"Full degen mode: aped 50% of my bag into a 2-hour-old token."',cat:'culture'},
    {t:'CT (Crypto Twitter)',d:'The X/Twitter crypto community. Where narratives are born, alpha is shared (and faked), and fortunes are made and lost. Your main source of memecoin intel.',ex:'"CT was all over this AI meta before it pumped 20x."',cat:'culture'},
    {t:'Alpha',d:'Valuable information that gives you an edge before others have it. Real alpha is rare. Most "alpha" on CT is someone shilling their bags.',ex:'"Got alpha from a dev chat ‚Äî they\'re listing on a major CEX next week."',cat:'culture'},
    {t:'NFA',d:'Not Financial Advice. Everyone says it, nobody means it. Legal disclaimer that people add after telling you exactly what to buy.',ex:'"You should definitely ape this. NFA." (It is absolutely financial advice.)',cat:'culture'},
    {t:'DYOR',d:'Do Your Own Research. The most important rule that nobody follows. Check the chart, holders, socials, dev wallet ‚Äî before you ape.',ex:'"Someone called $XYZ on CT. DYOR before aping ‚Äî check holders on BubbleMaps."',cat:'culture'},
    {t:'Bag',d:'Your position in a token. "Heavy bag" = losing money on a big position. "Light bag" = small position. "Holding bags" = stuck with tokens nobody wants.',ex:'"My $BONK bag is up 300% ‚Äî should I take profits?"',cat:'culture'},
    {t:'KOL',d:'Key Opinion Leader ‚Äî crypto influencer. When a KOL calls a token, it pumps (because followers buy). Then it dumps (because the KOL already bought cheaper).',ex:'"3 big KOLs shilled this token today ‚Äî price already 5x from their entry."',cat:'culture'},
    {t:'Shill',d:'Promoting a token publicly, usually because you already hold it. "He\'s shilling his bags." Not always bad ‚Äî but always question the motivation.',ex:'"He\'s been shilling $ABC nonstop. Check if his wallet bought it yesterday."',cat:'culture'},
    {t:'Call',d:'A public recommendation to buy a specific token. Good calls are early and well-researched. Bad calls are late and paid for. Track KOL win rates.',ex:'"He called $WIF at $0.001. That turned into a 1000x."',cat:'culture'},
    {t:'Narrative / Meta',d:'The "story" driving a group of tokens. AI tokens, dog coins, political coins, celebrity tokens. Token without a narrative dies. Narratives rotate fast.',ex:'"Dog meta is dead, AI meta is pumping. Rotate or get left behind."',cat:'culture'},
    {t:'Rotation',d:'When money moves from one narrative to another. Dog coins pump ‚Üí profits flow into AI coins ‚Üí AI pumps. Spotting rotation early = alpha.',ex:'"Money rotating from memes to AI agents. Follow the flow."',cat:'culture'},
    {t:'Pump / Dump',d:'Pump = sharp price rise. Dump = sharp price fall. Often coordinated: insiders pump a token with hype, then dump their bags on retail buyers.',ex:'"Classic pump and dump ‚Äî up 500% in 2 hours, then -90% in 10 minutes."',cat:'culture'},

    // Risk Management
    {t:'Risk/Reward',d:'How much you risk vs potential gain. Risking 1 SOL to make 0.5 SOL = bad trade. Risking 0.1 SOL to potentially make 1 SOL = good setup.',ex:'"Entry at $50k MC with potential to 500k MC = 10x R/R. Worth the risk."',cat:'risk'},
    {t:'Survival Mode',d:'When your balance is low and you need to be extremely careful. Small position sizes, high-conviction trades only. The goal is to survive, not to get rich quick.',ex:'"Down to 0.3 SOL ‚Äî survival mode. Only aping tokens with locked liq and strong narrative."',cat:'risk'},
    {t:'Overexposure',d:'Having too much of your capital in one token or one narrative. If that narrative dies, you lose everything. Diversify across 3-5 tokens minimum.',ex:'"80% of my bag in one token. If it dumps, I\'m done."',cat:'risk'},
  ];

  // Map terms for quick tooltip lookup
  const GLOSS_MAP = {};
  GLOSSARY.forEach(g => {
    const key = g.t.split('(')[0].trim().toLowerCase();
    GLOSS_MAP[key] = g;
    // Also map abbreviations
    const abbr = g.t.match(/\(([^)]+)\)/);
    if (abbr) GLOSS_MAP[abbr[1].toLowerCase()] = g;
  });

  // Terms to detect in flag text for tooltips
  const TOOLTIP_TERMS = [
    ['MC','mc (market cap)'],['market cap','mc (market cap)'],['liquidity','liquidity'],['slippage','slippage'],
    ['volume','volume'],['holders','holders'],['holder','holders'],['avg bag','avg bag'],
    ['wash trading','wash trading'],['sniper','snipers'],['buy/sell','buy/sell ratio'],
    ['bonding curve','bonding curve'],['rug','rug pull'],['MC/Liq','mc/liq ratio'],
    ['volatility','mc (market cap)'],['DEX','mc (market cap)'],['boost','mc (market cap)'],
  ];

  // Render flag text with tappable terms
  const renderFlagWithTips = (text) => {
    if (!text || typeof text !== 'string') return text;
    const parts = [];
    let remaining = text;
    let key = 0;
    
    // Simple approach: scan for known terms
    const termsInText = [];
    TOOLTIP_TERMS.forEach(([pattern, glossKey]) => {
      const idx = remaining.toLowerCase().indexOf(pattern.toLowerCase());
      if (idx !== -1) {
        termsInText.push({ idx, len: pattern.length, glossKey });
      }
    });
    
    // Sort by position, take first 2 max
    termsInText.sort((a,b) => a.idx - b.idx);
    const used = termsInText.slice(0, 2);
    
    if (used.length === 0) return text;
    
    let pos = 0;
    used.forEach(({idx, len, glossKey}) => {
      if (idx < pos) return;
      if (idx > pos) parts.push(remaining.substring(pos, idx));
      const matched = remaining.substring(idx, idx + len);
      const entry = GLOSS_MAP[glossKey.toLowerCase()];
      if (entry) {
        parts.push(React.createElement("span", {
          key: key++,
          className: "flag-term",
          onClick: (e) => {
            e.stopPropagation();
            const rect = e.target.getBoundingClientRect();
            setGlossTip({
              term: entry.t,
              def: entry.d,
              x: Math.min(rect.left, window.innerWidth - 310),
              y: rect.bottom + 8
            });
          }
        }, matched));
      } else {
        parts.push(matched);
      }
      pos = idx + len;
    });
    if (pos < remaining.length) parts.push(remaining.substring(pos));
    return React.createElement(React.Fragment, null, ...parts);
  }; // ‚¨ÖÔ∏è loading enquanto busca usu√°rio
  
  // Helper: migrar trades antigos para nova estrutura
  const migrateTrades = (trades) => {
    if (!Array.isArray(trades)) return [];
    return trades.map(t => {
      if (!t.entries) {
        const price = t.entryPrice || t.avgEntryPrice || 0;
        const sol = t.amountSOL || t.totalInvested || 0;
        return {
          ...t,
          tokenAddress: t.tokenAddress || '',
          entries: [{ price, amountSOL: sol, timestamp: t.openedAt || new Date().toISOString() }],
          totalInvested: sol,
          avgEntryPrice: price,
          partialExits: t.partialExits || [],
          totalPnl: t.totalPnl || t.pnl || 0
        };
      }
      return { ...t, partialExits: t.partialExits || [] };
    });
  };

  // ‚ö° CARREGAR/CRIAR USU√ÅRIO AUTOMATICAMENTE (com verifica√ß√£o Supabase)
  useEffect(() => {
    const loadOrCreateUser = async () => {
      try {
      // 1) Verificar autentica√ß√£o primeiro
      const authUser = window.authService?.getUser();

      // 2) Tentar carregar do localStorage (cache r√°pido) ‚Äî MAS validar auth_id
      const stored = localStorage.getItem('helmUser');
      if (stored) {
        try {
          const userData = JSON.parse(stored);
          
          // ‚ö†Ô∏è CRITICAL: Verify cache belongs to current auth user
          const cachedAuthId = userData.auth_id;
          const currentAuthId = authUser?.id;
          
          if (cachedAuthId && currentAuthId && cachedAuthId !== currentAuthId) {
            // Cache belongs to a DIFFERENT user ‚Äî clear it
            localStorage.removeItem('helmUser');
            localStorage.removeItem('helmUserKey');
            localStorage.removeItem('helmAuthKey');
            // Fall through to Supabase lookup below
          } else {
            userData.xp = userData.xp || 0;
            userData.badges = userData.badges || [];
            userData.currentStreak = userData.currentStreak || 0;
            userData.analysisCount = userData.analysisCount || 0;
            userData.trades = migrateTrades(userData.trades);
            setUser(userData);
            localStorage.setItem('helmUser', JSON.stringify(userData));

            // Em background, verificar se Supabase tem dados mais frescos
            const key = localStorage.getItem('helmUserKey') || ('helmuser_' + (userData.username||'').toLowerCase());
            const bgAuthKey = localStorage.getItem('helmAuthKey');
            
            // Buscar pela chave principal e authKey, pegar o mais recente
            const fetchFresh = async () => {
              let freshData = null;
              // Tentar pela key principal
              try {
                const r = await helmStorage.get(key, true);
                if (r && r.value) freshData = JSON.parse(r.value);
              } catch(e) {}
              // Tentar pela authKey se for diferente
              if (bgAuthKey && bgAuthKey !== key) {
                try {
                  const r2 = await helmStorage.get(bgAuthKey, true);
                  if (r2 && r2.value) {
                    const authData = JSON.parse(r2.value);
                    // Usar o que tiver mais trades (mais atualizado)
                    if (!freshData || (authData.trades?.length || 0) > (freshData.trades?.length || 0)) {
                      freshData = authData;
                    }
                  }
                } catch(e) {}
              }
              if (freshData && freshData.createdAt && 
                  (!userData.createdAt || (freshData.trades?.length || 0) >= (userData.trades?.length || 0))) {
                // Skip if user already interacted (made trades, etc.)
                if (userSaveCountRef.current > 1) return;
                freshData.xp = freshData.xp || 0;
                freshData.badges = freshData.badges || [];
                freshData.currentStreak = freshData.currentStreak || 0;
                freshData.analysisCount = freshData.analysisCount || 0;
                freshData.trades = migrateTrades(freshData.trades);
                setUser(freshData);
                localStorage.setItem('helmUser', JSON.stringify(freshData));
              }
            };
            fetchFresh().catch(() => {});

            setUserLoading(false);
            return;
          }
        } catch (e) {
          console.warn('helmUser corrupted in localStorage, ignoring...');
          localStorage.removeItem('helmUser');
        }
      }

      // 3) Se n√£o tem cache v√°lido, verificar se est√° autenticado
      if (!authUser) {
        setUserLoading(false);
        return;
      }

      // 3) BUSCAR no Supabase pelo auth_id (chave √∫nica por conta)
      const authKey = 'helmuser_auth_' + authUser.id;
      let userData = null;

      try {
        const r = await helmStorage.get(authKey, true);
        if (r && r.value) {
          userData = JSON.parse(r.value);
          userData.xp = userData.xp || 0;
          userData.badges = userData.badges || [];
          userData.currentStreak = userData.currentStreak || 0;
          userData.analysisCount = userData.analysisCount || 0;
          userData.trades = Array.isArray(userData.trades) ? userData.trades.map(t => ({
            ...t,
            entries: t.entries || [{price: t.avgEntryPrice||0, amountSOL: t.totalInvested||0, timestamp: t.openedAt||new Date().toISOString()}],
            partialExits: t.partialExits || [],
          })) : [];
        }
      } catch (e) {
      }

      // 4) Se n√£o existe no Supabase, tentar buscar pela chave antiga (helmuser_<username>)
      if (!userData) {
        const email = authUser.email || '';
        const usernameFromEmail = email.split('@')[0] || '';
        if (usernameFromEmail) {
          try {
            const oldKey = 'helmuser_' + usernameFromEmail.toLowerCase();
            const r = await helmStorage.get(oldKey, true);
            if (r && r.value) {
              userData = JSON.parse(r.value);
              userData.xp = userData.xp || 0;
              userData.badges = userData.badges || [];
              userData.currentStreak = userData.currentStreak || 0;
              userData.analysisCount = userData.analysisCount || 0;
              userData.trades = Array.isArray(userData.trades) ? userData.trades : [];
              try { await helmStorage.set(authKey, JSON.stringify(userData), true); } catch(e2) {}
            }
          } catch (e) {}
        }
      }

      // 5) Se encontrou usu√°rio existente, carregar direto
      if (userData) {
        const usernameKey = 'helmuser_' + (userData.username||'').toLowerCase();
        localStorage.setItem('helmUser', JSON.stringify(userData));
        localStorage.setItem('helmUserKey', usernameKey);
        localStorage.setItem('helmAuthKey', authKey);
        setUser(userData);
        showToast('Welcome back, ' + userData.username + '! üëã', 'success');
        setUserLoading(false);
        return;
      }

      // 6) Se √© novo, mostrar tela de username
      setUserLoading(false);

      } catch (err) {
        // Fallback: nunca travar em loading infinito
        console.error('‚ùå Erro inesperado ao carregar usu√°rio:', err);
        setUserLoading(false);
      }
    };

    loadOrCreateUser();
  }, []);
  // Slippage simulation: based on 24h volume (lower volume = higher slippage)
  // ‚Üí services/slippage.js
  const calcSlippage = volumeUsd => {
    if (!volumeUsd || volumeUsd <= 0) return 0.03; // 3% default if no data
    if (volumeUsd >= 5_000_000) return 0.002; // $5M+  ‚Üí 0.2%
    if (volumeUsd >= 1_000_000) return 0.005; // $1M+  ‚Üí 0.5%
    if (volumeUsd >= 500_000) return 0.008; // $500k ‚Üí 0.8%
    if (volumeUsd >= 100_000) return 0.012; // $100k ‚Üí 1.2%
    if (volumeUsd >= 50_000) return 0.018; // $50k  ‚Üí 1.8%
    if (volumeUsd >= 10_000) return 0.025; // $10k  ‚Üí 2.5%
    return 0.04; // <$10k ‚Üí 4%
  };
  // ‚Üí utils/format.js
  const toUSD = sol => {
    const usd = (sol || 0) * solPrice;
    if (usd >= 1000) return '$' + (usd / 1000).toFixed(1) + 'k';
    if (usd >= 1) return '$' + usd.toFixed(0);
    return '$' + usd.toFixed(2);
  };

  // Fetch SOL/USD price every 60s
  useEffect(() => {
    const fetchPrice = async () => {
      try {
        const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd');
        const d = await r.json();
        if (d?.solana?.usd) setSolPrice(d.solana.usd);
      } catch (e) {}
    };
    fetchPrice();
    const t = setInterval(fetchPrice, 60000);
    return () => clearInterval(t);
  }, []);
  // Auto-publish score whenever user data changes
  useEffect(() => {
    if (!user?.id) return;
    const closedTrades = (user.trades || []).filter(t => t.status === 'closed');
    const wins = closedTrades.filter(t => (t.totalPnl || 0) > 0).length;
    const totalPnl = closedTrades.reduce((s, t) => s + (t.totalPnl || 0), 0);
    const winRate = closedTrades.length > 0 ? Math.round(wins / closedTrades.length * 100) : 0;
    const lvlIdx = LEVELS.reduce((acc, l, i) => (user.xp || 0) >= l.xp ? i : acc, 0);
    const entry = {
      id: user.id,
      username: user.username || 'Anon',
      xp: user.xp || 0,
      level: lvlIdx + 1,
      totalPnl: parseFloat(totalPnl.toFixed(4)),
      winRate,
      trades: closedTrades.length,
      updatedAt: Date.now()
    };
    // Use gstore for proper localStorage fallback
    const gs = {
      set: (k, v, s) => window.storage ? window.storage.set(k, v, s) : (localStorage.setItem(k, v), Promise.resolve())
    };
    gs.set(`helmrank${user.id}`, JSON.stringify(entry), true).catch(() => {});
  }, [user?.id, user?.xp, user?.trades]);

  // Fetch ranking when tab opens
  useEffect(() => {
    if (activeTab === 'ranking') fetchRanking();
  }, [activeTab]);
  // ‚Üí utils/date.js
  const getWeekKey = () => {
    const d = new Date();
    const day = d.getDay() === 0 ? 6 : d.getDay() - 1; // Monday=0
    const monday = new Date(d);
    monday.setDate(d.getDate() - day);
    monday.setHours(0, 0, 0, 0);
    return monday.toISOString().split('T')[0];
  };
  const NARR_BASE = [{
    id: 'n_ai',
    title: 'AI Agents',
    emoji: 'ü§ñ',
    votes: 0
  }, {
    id: 'n_cap',
    title: 'Capybaras',
    emoji: 'ü¶´',
    votes: 0
  }, {
    id: 'n_elon',
    title: 'Elon',
    emoji: 'üê¶',
    votes: 0
  }, {
    id: 'n_cat',
    title: 'Cats',
    emoji: 'üê±',
    votes: 0
  }, {
    id: 'n_pol',
    title: 'Politics',
    emoji: 'üèõÔ∏è',
    votes: 0
  }, {
    id: 'n_dog',
    title: 'Dogs',
    emoji: 'üêï',
    votes: 0
  }, {
    id: 'n_frog',
    title: 'Frogs',
    emoji: 'üê∏',
    votes: 0
  }, {
    id: 'n_dino',
    title: 'Dinosaurs',
    emoji: 'ü¶ñ',
    votes: 0
  }, {
    id: 'n_retro',
    title: 'OG Memes',
    emoji: 'üëæ',
    votes: 0
  }, {
    id: 'n_anime',
    title: 'Anime',
    emoji: '‚õ©Ô∏è',
    votes: 0
  }, {
    id: 'n_pen',
    title: 'Penguins',
    emoji: 'üêß',
    votes: 0
  }, {
    id: 'n_space',
    title: 'Space',
    emoji: 'üöÄ',
    votes: 0
  }, {
    id: 'n_sport',
    title: 'Sports',
    emoji: '‚öΩ',
    votes: 0
  }, {
    id: 'n_kol',
    title: 'KOL / Creators',
    emoji: 'üì¢',
    votes: 0
  }, {
    id: 'n_food',
    title: 'Monkeys',
    emoji: 'üêí',
    votes: 0
  }, {
    id: 'n_celeb',
    title: 'Celebrities',
    emoji: '‚≠ê',
    votes: 0
  }];
  const [narratives, setNarratives] = useState(NARR_BASE);
  const [narrativesLoading, setNarrativesLoading] = useState(false);
  const NARR_KEY = `helmNarrVotes_${getWeekKey()}`;

  // Load shared narrative votes on mount
  useEffect(() => {
    const loadNarratives = async () => {
      setNarrativesLoading(true);
      try {
        // Try shared storage first
        if (window.storage) {
          const r = await window.storage.get(NARR_KEY, true).catch(() => null);
          if (r?.value) {
            const shared = JSON.parse(r.value);
            // Merge base + shared vote counts
            setNarratives(NARR_BASE.map(n => ({
              ...n,
              votes: shared[n.id] ?? n.votes
            })));
            setNarrativesLoading(false);
            return;
          }
        }
        // Fallback: localStorage
        const wk = getWeekKey();
        const saved = localStorage.getItem('helmNarratives');
        const savedWk = localStorage.getItem('helmNarrWk');
        if (saved && savedWk === wk) {
          const p = JSON.parse(saved);
          if (Array.isArray(p) && p[0]?.emoji) {
            setNarratives(p);
            setNarrativesLoading(false);
            return;
          }
        }
        localStorage.setItem('helmNarrWk', wk);
      } catch (e) {}
      setNarratives(NARR_BASE);
      setNarrativesLoading(false);
    };
    loadNarratives();
  }, []);
  const [userVotes, setUserVotes] = useState(() => {
    try {
      const wk = getWeekKey();
      if (localStorage.getItem('helmVotesWk') !== wk) {
        localStorage.removeItem('helmUserVotes');
        localStorage.setItem('helmVotesWk', wk);
        return {};
      }
      const s = localStorage.getItem('helmUserVotes');
      return s ? JSON.parse(s) : {};
    } catch (e) {
      return {};
    }
  });
  const pnlChartRef = useRef(null);
  const winRateChartRef = useRef(null);
  const userSaveCountRef = useRef(0); // Counts [user] effect fires; >1 means user has been actively modified
  const showToast = (message, type = 'success') => {
    setToast({
      message,
      type
    });
  };
  const showXPGain = (xp, reason) => {
    setXPPopup({
      xp,
      reason
    });
  };
  const addXP = (typeOrAmount, reason) => {
    const xpAmount = typeof typeOrAmount === 'number' ? typeOrAmount : XP_TYPES[typeOrAmount] || 0;
    setUser(prev => {
      if (!prev) return prev;
      const oldLevel = getCurrentLevel(prev.xp || 0);
      const newXP = Math.max(0, (prev.xp || 0) + xpAmount); // never negative
      const newLevel = getCurrentLevel(newXP);
      if (newLevel > oldLevel) {
        setTimeout(() => {
          showToast(`üéâ Level Up! Now ${LEVELS[newLevel - 1].name} (Lvl ${newLevel})`, 'success');
        }, 2100);
      } else if (newLevel < oldLevel) {
        setTimeout(() => {
          showToast(`üìâ Level Down... Now ${LEVELS[newLevel - 1].name} (Lvl ${newLevel})`, 'warning');
        }, 2100);
      }
      return {
        ...prev,
        xp: newXP
      };
    });
    showXPGain(xpAmount, reason);
  };
  const getCurrentLevel = xp => {
    for (let i = LEVELS.length - 1; i >= 0; i--) {
      if (xp >= LEVELS[i].xp) {
        return LEVELS[i].level;
      }
    }
    return 1;
  };
  const getNextLevelXP = currentXP => {
    const currentLevel = getCurrentLevel(currentXP);
    if (currentLevel >= LEVELS.length) return LEVELS[LEVELS.length - 1].xp;
    return LEVELS[currentLevel].xp;
  };
  const checkBadges = newUser => {
    const badges = new Set(newUser.badges || []);
    const trades = newUser.trades || [];
    const closedTrades = trades.filter(t => t.status === 'closed');
    const wins = closedTrades.filter(t => (t.totalPnl || t.pnl || 0) > 0);

    // First trade
    if (trades.length >= 1 && !badges.has('first_trade')) {
      badges.add('first_trade');
      setTimeout(() => showToast('üéØ Badge Unlocked: First Trade!', 'success'), 500);
    }

    // First profit
    if (wins.length >= 1 && !badges.has('first_profit')) {
      badges.add('first_profit');
      setTimeout(() => showToast('üí∞ Badge Unlocked: First Win!', 'success'), 500);
    }

    // Streaks
    const currentStreak = newUser.currentStreak || 0;
    if (currentStreak >= 3 && !badges.has('hot_streak_3')) badges.add('hot_streak_3');
    if (currentStreak >= 5 && !badges.has('hot_streak_5')) badges.add('hot_streak_5');
    if (currentStreak >= 10 && !badges.has('hot_streak_10')) badges.add('hot_streak_10');

    // Win rate
    if (closedTrades.length >= 10) {
      const winRate = wins.length / closedTrades.length * 100;
      if (winRate >= 50 && !badges.has('win_rate_50')) badges.add('win_rate_50');
      if (winRate >= 60 && !badges.has('win_rate_60')) badges.add('win_rate_60');
      if (winRate >= 70 && !badges.has('win_rate_70')) badges.add('win_rate_70');
      if (winRate >= 80 && !badges.has('win_rate_80')) badges.add('win_rate_80');
    }

    // Analyst
    if ((newUser.analysisCount || 0) >= 10 && !badges.has('analyst')) {
      badges.add('analyst');
    }

    // Trade count
    if (trades.length >= 10 && !badges.has('trader_10')) badges.add('trader_10');
    if (trades.length >= 50 && !badges.has('trader_50')) badges.add('trader_50');
    if (trades.length >= 100 && !badges.has('trader_100')) badges.add('trader_100');
    return Array.from(badges);
  };
  useEffect(() => {
    // Apenas carregar tema - o carregamento do user √© feito no loadOrCreateUser
    const savedTheme = localStorage.getItem('helmTheme') || 'default';
    setTheme(savedTheme);
    applyTheme(savedTheme);
  }, []);
  useEffect(() => {
    if (user) {
      userSaveCountRef.current += 1;
      localStorage.setItem('helmUser', JSON.stringify(user));
      // Sync to Supabase com ambas as chaves
      const key = localStorage.getItem('helmUserKey') || ('helmuser_' + (user.username||'').toLowerCase());
      helmStorage.set(key, JSON.stringify(user), true).catch(() => {});
      // Tamb√©m salvar com chave auth_id (evita duplica√ß√£o)
      const authKey = localStorage.getItem('helmAuthKey');
      if (authKey && authKey !== key) {
        helmStorage.set(authKey, JSON.stringify(user), true).catch(() => {});
      }
    }
  }, [user]);
  const applyTheme = themeName => {
    document.body.className = '';
    if (themeName === 'light') document.body.classList.add('light-theme');
    if (themeName === 'neon') document.body.classList.add('neon-theme');
    setTheme(themeName);
    localStorage.setItem('helmTheme', themeName);
  };

  // Charts (same as V3)
  useEffect(() => {
    if (!user || !user.trades || activeTab !== 'profile') return;
    const closedTrades = user.trades.filter(t => t.status === 'closed');
    if (closedTrades.length === 0) return;
    const last7Days = [];
    for (let i = 6; i >= 0; i--) {
      const date = new Date();
      date.setDate(date.getDate() - i);
      const dateStr = date.toLocaleDateString('en-US', {
        weekday: 'short'
      });
      const dayTrades = closedTrades.filter(t => {
        const tradeDate = new Date(t.closedAt);
        return tradeDate.toDateString() === date.toDateString();
      });
      const dayPnl = dayTrades.reduce((sum, t) => sum + (t.totalPnl || t.pnl || 0), 0);
      last7Days.push({
        date: dateStr,
        pnl: dayPnl
      });
    }
    if (pnlChartRef.current) {
      const ctx = pnlChartRef.current.getContext('2d');
      if (window.pnlChart) window.pnlChart.destroy();
      window.pnlChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: last7Days.map(d => d.date),
          datasets: [{
            label: 'P&L (SOL)',
            data: last7Days.map(d => d.pnl),
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              grid: {
                color: 'rgba(255,255,255,0.1)'
              },
              ticks: {
                color: '#94a3b8'
              }
            },
            x: {
              grid: {
                color: 'rgba(255,255,255,0.1)'
              },
              ticks: {
                color: '#94a3b8'
              }
            }
          }
        }
      });
    }
  }, [user, activeTab]);
  useEffect(() => {
    if (!user || !user.trades || activeTab !== 'profile') return;
    const closedTrades = user.trades.filter(t => t.status === 'closed');
    if (closedTrades.length === 0) return;
    const wins = closedTrades.filter(t => (t.totalPnl || t.pnl || 0) > 0).length;
    const losses = closedTrades.length - wins;
    if (winRateChartRef.current) {
      const ctx = winRateChartRef.current.getContext('2d');
      if (window.winRateChart) window.winRateChart.destroy();
      window.winRateChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Wins', 'Losses'],
          datasets: [{
            data: [wins, losses],
            backgroundColor: ['#10b981', '#ef4444'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: '#94a3b8'
              }
            }
          }
        }
      });
    }
  }, [user, activeTab]);

  // ‚îÄ‚îÄ RANKING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // ‚îÄ‚îÄ GLOBAL STORAGE HELPER (same pattern as CommunityTab) ‚îÄ‚îÄ
  const gstore = {
    set: (k, v, s) => window.storage ? window.storage.set(k, v, s) : (localStorage.setItem(k, v), Promise.resolve({
      key: k,
      value: v
    })),
    get: (k, s) => window.storage ? window.storage.get(k, s) : (() => {
      const v = localStorage.getItem(k);
      if (v === null) return Promise.reject(new Error('nf'));
      return Promise.resolve({
        key: k,
        value: v
      });
    })(),
    list: (p, s) => window.storage ? window.storage.list(p, s) : Promise.resolve({
      keys: Object.keys(localStorage).filter(k => k.startsWith(p))
    })
  };
  const publishRanking = async u => {
    if (!u?.id) return;
    try {
      const closedTrades = (u.trades || []).filter(t => t.status === 'closed');
      const wins = closedTrades.filter(t => (t.totalPnl || 0) > 0).length;
      const totalPnl = closedTrades.reduce((s, t) => s + (t.totalPnl || 0), 0);
      const winRate = closedTrades.length > 0 ? Math.round(wins / closedTrades.length * 100) : 0;
      const lvlIdx = LEVELS.reduce((acc, l, i) => (u.xp || 0) >= l.xp ? i : acc, 0);
      const entry = {
        id: u.id,
        username: u.username || 'Anon',
        xp: u.xp || 0,
        level: lvlIdx + 1,
        totalPnl: parseFloat(totalPnl.toFixed(4)),
        winRate,
        trades: closedTrades.length,
        updatedAt: Date.now()
      };
      await gstore.set(`helmrank${u.id}`, JSON.stringify(entry), true);
    } catch (e) {}
  };
  const fetchRanking = async () => {
    setRankingLoading(true);
    try {
      const result = await gstore.list('helmrank', true);
      const keys = (result?.keys || []).filter(k => !k.startsWith('helmcommrank'));
      const entries = await Promise.all(keys.map(async k => {
        try {
          const r = await gstore.get(k, true);
          return r ? JSON.parse(r.value) : null;
        } catch {
          return null;
        }
      }));
      setRanking(entries.filter(Boolean).sort((a, b) => b.xp - a.xp));
    } catch (e) {
      setRanking([]);
    } finally {
      setRankingLoading(false);
    }
  };

  // ‚îÄ‚îÄ MISSIONS & BANKRUPT SYSTEM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const REWARD_SOL = 0.2;  // Recompensa padr√£o por miss√£o
  const MAX_ADS_PER_DAY = 3;
  const MISSIONS = [{
    id: 'post_community',
    icon: '‚úçÔ∏è',
    label: 'Post in Community (3x/week)',
    desc: 'Create topics in the community (max 3 per week)',
    reward: REWARD_SOL  // 0.2 SOL
  }, {
    id: 'login_streak',
    icon: 'üî•',
    label: '3-Day Login Streak',
    desc: 'Log in 3 days in a row',
    reward: 0.5  // ESPECIAL
  }, {
    id: 'invite_friend',
    icon: 'üë•',
    label: 'Invite a Friend',
    desc: 'Share your referral link',
    reward: 0.5  // ESPECIAL
  }];
  const todayStr = () => new Date().toISOString().split('T')[0];
  const weekStr = () => getWeekKey();
  const getMissionsData = () => {
    try {
      return JSON.parse(localStorage.getItem('helmMissions') || '{}');
    } catch {
      return {};
    }
  };
  const saveMissionsData = d => localStorage.setItem('helmMissions', JSON.stringify(d));
  const getAdsToday = () => {
    try {
      const d = JSON.parse(localStorage.getItem('helmAds') || '{}');
      return d[todayStr()] || 0;
    } catch {
      return 0;
    }
  };
  const bumpAdsToday = () => {
    try {
      const d = JSON.parse(localStorage.getItem('helmAds') || '{}');
      d[todayStr()] = (d[todayStr()] || 0) + 1;
      localStorage.setItem('helmAds', JSON.stringify(d));
    } catch {}
  };
  const isMissionDone = id => {
    const d = getMissionsData();
    if (id === 'login_streak') return d['login_streak_week'] === weekStr();
    if (id === 'vote_narrative') return d['vote_narrative_week'] === weekStr();
    if (id === 'invite_friend') return d['invite_friend_week'] === weekStr();
    return d[`${id}_${todayStr()}`] === true;
  };
  const completeMission = id => {
    const d = getMissionsData();
    if (id === 'login_streak') d['login_streak_week'] = weekStr();else if (id === 'vote_narrative') d['vote_narrative_week'] = weekStr();else if (id === 'invite_friend') d['invite_friend_week'] = weekStr();else d[`${id}_${todayStr()}`] = true;
    saveMissionsData(d);
    const mission = MISSIONS.find(m => m.id === id);
    if (!mission) return;
    setUser(prev => ({
      ...prev,
      balance: (prev.balance || 0) + mission.reward
    }));
    showToast(`+${mission.reward} SOL ‚Äî ${mission.label} ‚úÖ`, 'success');
    addXP(50, `‚úÖ Mission: ${mission.label}`);
    setShowMissions(false);
    setShowBankrupt(false);
  };

  // Check bankrupt after every balance change
  useEffect(() => {
    if (!user) return;
    const openSol = (user.trades || []).filter(t => t.status === 'active').reduce((s, t) => s + (t.totalInvested || 0), 0);
    const effective = (user.balance || 0) + openSol;
    if (effective < 0.05 && !showMissions) setShowBankrupt(false)  /* DESABILITADO - survival mode */;else if (effective >= 0.05) setShowBankrupt(false);
  }, [user?.balance, user?.trades?.length]);

  // Watch Ad flow
  const startWatchAd = () => {
    if (getAdsToday() >= MAX_ADS_PER_DAY) {
      showToast(`Max ${MAX_ADS_PER_DAY} ads per day reached`, 'warning');
      return;
    }
    setAdWatching(true);
    setAdTimer(15);
    const interval = setInterval(() => {
      setAdTimer(prev => {
        if (prev <= 1) {
          clearInterval(interval);
          setAdWatching(false);
          bumpAdsToday();
          setUser(p => ({
            ...p,
            balance: (p.balance || 0) + REWARD_SOL
          }));
          showToast(`+${REWARD_SOL} SOL ‚Äî Ad reward! üéâ`, 'success');
          addXP(20, 'üì∫ Watched ad');
          setShowBankrupt(false);
          setShowMissions(false);
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
  };

  // Auto-complete vote_narrative mission when user votes
  const handleVoteWithMission = async id => {
    await handleVote(id);
    if (!isMissionDone('vote_narrative')) {
      completeMission('vote_narrative');
    }
  };

  // Auto-complete post_community when user posts (MAX 3 por semana)
  const checkPostMission = () => {
    const weekKey = getWeekKey();
    const data = getMissionsData();
    
    // Inicializar contador de posts da semana
    if (!data.posts_this_week || data.posts_this_week_key !== weekKey) {
      data.posts_this_week = 0;
      data.posts_this_week_key = weekKey;
    }
    
    // Verificar se j√° postou 3x esta semana
    if (data.posts_this_week >= 3) {
      showToast('‚ö†Ô∏è Post limit reached! (3 per week)', 'warning');
      return false;  // Bloqueado
    }
    
    // Incrementar contador e dar recompensa
    data.posts_this_week += 1;
    saveMissionsData(data);
    
    // Dar 0.2 SOL
    setUser(prev => ({...prev, balance: (prev.balance || 0) + 0.2}));
    showToast(`‚úÖ Post reward: +0.2 SOL (${data.posts_this_week}/3 this week)`, 'success');
    
    return true;
  };

  // Close trade n√£o d√° mais recompensa

  const handleLogin = async (username) => {
    const key = 'helmuser_' + username.toLowerCase();
    const authUser = window.authService?.getUser();
    const authKey = authUser ? 'helmuser_auth_' + authUser.id : null;
    let userData = null;
    let isNew = false;

    // 1) Tentar carregar pelo auth_id primeiro (mais confi√°vel)
    if (authKey) {
      try {
        const r = await helmStorage.get(authKey, true);
        if (r && r.value) {
          userData = JSON.parse(r.value);
          // Se o username mudou, atualizar
          if (userData.username !== username) {
            userData.username = username;
          }
        }
      } catch(e) {}
    }

    // 2) Se n√£o encontrou por auth_id, buscar pelo username (compatibilidade)
    if (!userData) {
      try {
        const r = await helmStorage.get(key, true);
        if (r && r.value) {
          const existingData = JSON.parse(r.value);
          
          // ‚ö†Ô∏è CRITICAL: Check if this username belongs to a DIFFERENT authenticated user
          if (existingData.auth_id && authUser && existingData.auth_id !== authUser.id) {
            // Username is TAKEN by another account
            showToast('‚ö†Ô∏è Username "' + username + '" is already taken. Choose another.', 'error');
            return;
          }
          
          userData = existingData;
          // Migrar campos antigos
          userData.xp = userData.xp || 0;
          userData.badges = userData.badges || [];
          userData.currentStreak = userData.currentStreak || 0;
          userData.analysisCount = userData.analysisCount || 0;
          userData.trades = Array.isArray(userData.trades) ? userData.trades.map(t => ({
            ...t,
            entries: t.entries || [{price: t.avgEntryPrice||0, amountSOL: t.totalInvested||0, timestamp: t.openedAt||new Date().toISOString()}],
            partialExits: t.partialExits || [],
          })) : [];
          // Vincular auth_id se dispon√≠vel (migration de conta antiga sem auth)
          if (authUser && !userData.auth_id) {
            userData.auth_id = authUser.id;
          }
        }
      } catch(e) {
        isNew = true;
      }
    }

    // 3) Se n√£o existe, criar novo
    if (!userData) {
      isNew = true;
      userData = {
        id: 'u_' + (authUser ? authUser.id : username.toLowerCase() + '_' + Date.now()),
        auth_id: authUser ? authUser.id : null,
        username: username,
        balance: 5.0,
        trades: [],
        xp: 0,
        badges: [],
        currentStreak: 0,
        analysisCount: 0,
        createdAt: new Date().toISOString(),
      };
    }

    // 4) Salvar no Supabase (nas duas chaves para compatibilidade)
    try {
      await helmStorage.set(key, JSON.stringify(userData), true);
      if (authKey) {
        await helmStorage.set(authKey, JSON.stringify(userData), true);
      }
    } catch(e) {
      console.warn('Could not save user to Supabase, using local only:', e);
    }

    // 5) Cache local
    localStorage.setItem('helmUser', JSON.stringify(userData));
    localStorage.setItem('helmUserKey', key);
    if (authKey) localStorage.setItem('helmAuthKey', authKey);

    setUser(userData);
    showToast(isNew ? 'Welcome to HELM! üéâ' : 'Welcome back, ' + username + '! üëã', 'success');
    if (isNew && !localStorage.getItem('helmStarterDone')) setTimeout(() => setStarterFlow(0), 800);
  };
  const analyzeToken = async (overrideAddress) => {
    const addr = (typeof overrideAddress === 'string' && overrideAddress) ? overrideAddress : tokenAddress;
    if (!addr) {
      showToast('Please enter a token address', 'warning');
      return;
    }
    if (typeof overrideAddress === 'string' && overrideAddress) setTokenAddress(overrideAddress);
    setLoading(true);
    try {
      const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${addr}`);
      const data = await res.json();
      if (data.pairs && data.pairs.length > 0) {
        const pair = data.pairs[0];
        const tokenData = {
          address: addr,
          name: pair.baseToken?.name || 'Unknown',
          symbol: pair.baseToken?.symbol || '???',
          price: parseFloat(pair.priceUsd) || 0,
          liquidity: pair.liquidity?.usd || 0,
          volume24h: pair.volume?.h24 || 0,
          priceChange24h: pair.priceChange?.h24 || 0,
          txns24h: pair.txns?.h24 || {},
          marketCap: pair.fdv || pair.marketCap || 0,
          pairAddress: pair.pairAddress,
          dexId: pair.dexId,
          url: pair.url,
          pairCreatedAt: pair.pairCreatedAt,
          boosts: pair.boosts || {},
          priceChange1h: pair.priceChange?.h1 || 0,
          priceChange6h: pair.priceChange?.h6 || 0,
          holders: pair.holders || null,
          // may not be present
          // Social links
          links: {
            telegram: pair.info?.socials?.find(s => s.type === 'telegram')?.url || null,
            twitter: pair.info?.socials?.find(s => s.type === 'twitter')?.url || null,
            website: pair.info?.websites?.[0]?.url || null
          },
          // DEX paid profile
          hasDexPaid: !!(pair.info?.imageUrl || pair.info?.header || pair.info?.socials?.length > 0)
        };
        let riskScore = 100;
        const redFlags = [],
          greenFlags = [];
        if (tokenData.marketCap > 0) {
          if (tokenData.marketCap < 10000) { riskScore -= 20; redFlags.push('üö® MC < $10k ‚Äî too small, extremely risky'); }
          else if (tokenData.marketCap <= 100000) { greenFlags.push('‚úÖ MC $' + (tokenData.marketCap/1000).toFixed(0) + 'k ‚Äî sweet spot ($10k-$100k entry zone)'); }
          else if (tokenData.marketCap > 1000000) { riskScore -= 10; redFlags.push('‚ö†Ô∏è MC $' + (tokenData.marketCap/1000000).toFixed(1) + 'M ‚Äî may already be at top'); }
        }
        if (tokenData.liquidity < 10000) { riskScore -= 25; redFlags.push('üö® Very low liquidity (< $10k) ‚Äî easy to manipulate'); }
        else if (tokenData.liquidity < 50000) { riskScore -= 12; redFlags.push('‚ö†Ô∏è Low liquidity (< $50k)'); }
        else if (tokenData.liquidity > 100000) greenFlags.push('‚úÖ Good liquidity (> $100k)');
        if (tokenData.volume24h < 5000) { riskScore -= 20; redFlags.push('üö® Very low volume (< $5k/24h) ‚Äî no real activity'); }
        else if (tokenData.volume24h > 50000) greenFlags.push('‚úÖ Healthy volume (> $50k/24h)');
        if (tokenData.marketCap > 0 && tokenData.volume24h > 0) {
          const volMcRatio = tokenData.volume24h / tokenData.marketCap;
          if (volMcRatio > 5) { riskScore -= 20; redFlags.push('üö® Vol/MC ratio ' + volMcRatio.toFixed(1) + 'x ‚Äî possible wash trading'); }
          else if (volMcRatio > 2) { riskScore -= 10; redFlags.push('‚ö†Ô∏è Vol/MC ratio ' + volMcRatio.toFixed(1) + 'x ‚Äî suspicious'); }
        }
        if (tokenData.pairCreatedAt) {
          const ageDays = (Date.now() - tokenData.pairCreatedAt) / 86400000;
          if (ageDays < 1)      { riskScore -= 35; redFlags.push('üö® Token < 1 day old ‚Äî extreme rug risk'); }
          else if (ageDays < 3) { riskScore -= 25; redFlags.push('üö® Token < 3 days old ‚Äî very risky'); }
          else if (ageDays < 7) { riskScore -= 15; redFlags.push('‚ö†Ô∏è Very new token (< 1 week)'); }
          else if (ageDays > 30) greenFlags.push('‚úÖ Established token (> 30 days)');
        }
        if (tokenData.topHolderPct > 0) {
          if (tokenData.topHolderPct > 10) { riskScore -= 25; redFlags.push('üö® Top holder owns ' + tokenData.topHolderPct.toFixed(1) + '% ‚Äî likely insider/sniper'); }
          else if (tokenData.topHolderPct > 3) { riskScore -= 12; redFlags.push('‚ö†Ô∏è Top holder ' + tokenData.topHolderPct.toFixed(1) + '% ‚Äî above 2.5-3% safe threshold'); }
          else if (tokenData.topHolderPct <= 2.5) greenFlags.push('‚úÖ Top holder ' + tokenData.topHolderPct.toFixed(1) + '% ‚Äî within safe insider threshold (<=2.5%)');
        }
        if (tokenData.holders > 0 && tokenData.marketCap > 0) {
          const avgBag = tokenData.marketCap / tokenData.holders;
          tokenData.avgBagUsd = avgBag;
          if (avgBag > tokenData.holders) { riskScore -= 15; redFlags.push('üö® Avg bag $' + avgBag.toFixed(0) + ' > ' + tokenData.holders + ' holders ‚Äî suspicious concentration'); }
          if (tokenData.holders > 1000 && avgBag < 50) { riskScore -= 12; redFlags.push('‚ö†Ô∏è ' + tokenData.holders.toLocaleString() + ' holders but avg bag only $' + avgBag.toFixed(0) + ' ‚Äî possible bots'); }
          if (tokenData.holders >= 500 && avgBag >= 50 && avgBag <= tokenData.holders) greenFlags.push('‚úÖ Healthy distribution: ' + tokenData.holders.toLocaleString() + ' holders, avg bag $' + avgBag.toFixed(0));
          if (tokenData.holders < 100) { riskScore -= 15; redFlags.push('üö® Only ' + tokenData.holders + ' holders ‚Äî very early'); }
          else if (tokenData.holders < 300) { riskScore -= 8; redFlags.push('‚ö†Ô∏è Only ' + tokenData.holders + ' holders ‚Äî low distribution'); }
          else if (tokenData.holders > 2000) greenFlags.push('‚úÖ Strong holder base: ' + tokenData.holders.toLocaleString() + ' holders');
        }
        const buys = tokenData.txns24h && tokenData.txns24h.buys || 0;
        const sells = tokenData.txns24h && tokenData.txns24h.sells || 0;
        const totalTxns = buys + sells;
        if (totalTxns < 10) { riskScore -= 15; redFlags.push('üö® Very few transactions (< 10 in 24h)'); }
        else if (totalTxns > 100) greenFlags.push('‚úÖ Active trading (> 100 txns/24h)');
        if (sells > 0 && buys/sells < 0.5) { riskScore -= 12; redFlags.push('üö® Strong sell pressure ‚Äî whales dumping?'); }
        else if (buys > sells * 1.5) greenFlags.push('‚úÖ Strong buy pressure');
        if (totalTxns > 20 && sells > 0 && buys/sells > 10) { riskScore -= 18; redFlags.push('üö® Suspicious buy/sell ratio (' + buys + '/' + sells + ') ‚Äî possible wash trading'); }
        const pc1h = tokenData.priceChange1h||0, pc6h = tokenData.priceChange6h||0, pc24h = tokenData.priceChange24h||0;
        if (pc1h>30 && pc6h>30 && pc24h>50) { riskScore -= 15; redFlags.push('üö® Continuous pump (+' + pc1h.toFixed(0) + '%/1h) ‚Äî wait for dip'); }
        if (Math.abs(pc24h) > 100) { riskScore -= 15; redFlags.push('üö® Extreme 24h volatility'); }
        if (tokenData.marketCap > 0 && tokenData.liquidity > 0) {
          const ratio = tokenData.marketCap / tokenData.liquidity;
          if (ratio > 1000) { riskScore -= 15; redFlags.push('üö® MC/Liq ratio ' + (ratio/1000).toFixed(1) + 'k√ó ‚Äî very easy to dump'); }
          else if (ratio < 50) greenFlags.push('‚úÖ Healthy MC/Liq ratio');
        }
        const knownDexes = ['raydium','pumpswap','pump.fun','orca','meteora'];
        if (tokenData.dexId === 'raydium') greenFlags.push("‚úÖ Pair on Raydium ‚Äî Solana's main DEX");
        else if (tokenData.dexId==='pumpswap'||tokenData.dexId==='pump.fun') greenFlags.push('‚úÖ Pair on ' + tokenData.dexId + ' ‚Äî legitimate platform');
        else if (tokenData.dexId && !knownDexes.includes(tokenData.dexId)) { riskScore -= 8; redFlags.push('‚ö†Ô∏è Pair on unknown DEX (' + tokenData.dexId + ')'); }
        const boostAmt = tokenData.boosts && tokenData.boosts.active || 0;
        const hasAds = !!(pair.info && pair.info.header);
        if (boostAmt > 400) { riskScore -= 25; redFlags.push('üö® Excessive boost (' + boostAmt + 'x) ‚Äî farm/dump signal'); if (hasAds) { riskScore -= 10; redFlags.push('üö® High boost + paid banner = suspicious'); } }
        else if (boostAmt > 0) greenFlags.push('üöÄ ' + boostAmt + 'x DEX Boost active');
        const isDexPaid = !!(pair.info && (pair.info.imageUrl || pair.info.header || pair.info.socials && pair.info.socials.length > 0));
        if (isDexPaid && boostAmt <= 400) { riskScore += 10; greenFlags.push('üí≥ Paid DEX profile ‚Äî project invested in visibility'); }
        if (tokenData.links.telegram) greenFlags.push('üì£ Verified Telegram on DEX');
        if (tokenData.links.twitter)  greenFlags.push('üê¶ Verified Twitter/X on DEX');
        if (tokenData.links.website)  greenFlags.push('üåê Verified website on DEX');
        if (!tokenData.links.telegram && !tokenData.links.twitter && !tokenData.links.website) { riskScore -= 10; redFlags.push('‚ö†Ô∏è No social links on DEX ‚Äî anonymous project'); }
        else if (tokenData.links.telegram && tokenData.links.twitter) greenFlags.push('‚úÖ Multiple social channels verified');
        tokenData.holders = tokenData.holders || null;
        tokenData.riskScore = Math.max(0, Math.min(100, riskScore));
        tokenData.redFlags = redFlags;
        tokenData.greenFlags = greenFlags;
        tokenData.riskLevel = riskScore >= 70 ? 'low' : riskScore >= 50 ? 'medium' : riskScore >= 30 ? 'high' : 'extreme';
        setAnalysis(tokenData);
        showToast('Token analyzed!', 'success');
      } else {
        showToast('Token not found', 'error');
      }
    } catch (error) {
      showToast('Error: ' + error.message, 'error');
    } finally {
      setLoading(false);
    }
  };
  const registerTrade = () => {
    // Open custom buy modal instead of prompt
    setBuyModal({
      type: 'ape'
    });
  };
  const confirmApe = (amount, reason) => {
    if (!analysis || !analysis.price || analysis.price <= 0) {
      showToast('Cannot trade ‚Äî token price is $0', 'error');
      return;
    }
    const slipPct = calcSlippage(analysis.volume24h);
    const slipCost = amount * slipPct;
    const effectiveAmount = amount + slipCost;
    if (isNaN(amount) || amount <= 0 || effectiveAmount > user.balance) {
      showToast('Insufficient balance (including slippage)!', 'error');
      return;
    }
    const slippedPrice = analysis.price * (1 + slipPct); // entry price is worse
    const newTrade = {
      id: Date.now().toString(),
      tokenAddress: analysis.address,
      tokenName: analysis.name,
      tokenSymbol: analysis.symbol,
      status: 'active',
      openedAt: new Date().toISOString(),
      buyReason: reason,
      entries: [{
        price: slippedPrice,
        amountSOL: amount,
        timestamp: new Date().toISOString()
      }],
      totalInvested: amount,
      avgEntryPrice: slippedPrice,
      slippagePct: slipPct,
      slippageCost: slipCost,
      partialExits: []
    };
    const updatedUser = {
      ...user,
      balance: user.balance - effectiveAmount,
      trades: [...(user.trades || []), newTrade]
    };
    updatedUser.badges = checkBadges(updatedUser);
    setUser(updatedUser);
    setBuyModal(null);
    showToast(`üöÄ APE! ${amount.toFixed(2)} SOL ¬∑ slippage ${(slipPct * 100).toFixed(1)}% (-${slipCost.toFixed(3)} SOL)`, 'success');
    if (updatedUser.trades.length === 1) setTimeout(() => showToast('üéØ First trade!', 'success'), 800);
    setAnalysis(null);
    setActiveTab('portfolio');
  };

  // ADVANCED TRADING FUNCTIONS
  const handleDCA = trade => {
    setBuyModal({
      type: 'dca',
      trade
    });
  };
  const confirmDCA = async (amount, trade) => {
    // Pre-validate with conservative 5% slippage estimate
    if (isNaN(amount) || amount <= 0 || (amount * 1.05) > user.balance) {
      showToast('Insufficient balance (including slippage)!', 'error');
      return;
    }
    setBuyModal(null);
    try {
      const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${trade.tokenAddress}`);
      const data = await res.json();
      const pair = data.pairs?.[0];
      const currentPrice = pair ? parseFloat(pair.priceUsd) : trade.avgEntryPrice;
      // Use actual volume from fetched data for correct slippage
      const actualVolume = pair ? (pair.volume?.h24 || 0) : 0;
      const dcaSlipPct = calcSlippage(actualVolume);
      const dcaSlipCost = amount * dcaSlipPct;
      // Re-validate with real slippage
      if ((amount + dcaSlipCost) > user.balance) {
        showToast('Insufficient balance (including slippage)!', 'error');
        return;
      }
      const newEntry = {
        price: currentPrice,
        amountSOL: amount,
        timestamp: new Date().toISOString()
      };
      const updatedEntries = [...(trade.entries||[]), newEntry];
      const totalInvested = trade.totalInvested + amount;
      const avgEntryPrice = updatedEntries.reduce((sum, e) => sum + e.price * e.amountSOL, 0) / totalInvested;
      const updatedUser = {
        ...user,
        balance: user.balance - amount - dcaSlipCost,
        trades: user.trades.map(t => t.id === trade.id ? {
          ...t,
          entries: updatedEntries,
          totalInvested,
          avgEntryPrice
        } : t)
      };
      updatedUser.badges = checkBadges(updatedUser);
      setUser(updatedUser);
      showToast(`üìâ DCA added! +${amount.toFixed(2)} SOL`, 'success');
    } catch (error) {
      showToast('Error fetching price', 'error');
    }
  };
  const handlePartialSell = trade => {
    setBuyModal({
      type: 'partial',
      trade
    });
  };
  const confirmPartialSell = async (percentage, trade, sellReason) => {
    if (isNaN(percentage) || percentage <= 0 || percentage > 100) {
      showToast('Invalid percentage!', 'error');
      return;
    }
    setBuyModal(null);
    try {
      const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${trade.tokenAddress}`);
      const data = await res.json();
      const currentPrice = data.pairs?.[0] ? parseFloat(data.pairs[0].priceUsd) : trade.avgEntryPrice;
      const sellAmount = trade.totalInvested * (percentage / 100);
      const priceChange = trade.avgEntryPrice ? (currentPrice - trade.avgEntryPrice) / trade.avgEntryPrice * 100 : 0;
      const partialVol = data.pairs?.[0] ? parseFloat(data.pairs[0].volume?.h24 || 0) : 0;
      const partialSlipPct = calcSlippage(partialVol || 0);
      const partialSlipCost = (sellAmount + sellAmount * (priceChange / 100)) * partialSlipPct;
      const pnl = sellAmount * (priceChange / 100) - partialSlipCost;
      const returned = Math.max(0, sellAmount + pnl);
      const remainingInvested = trade.totalInvested - sellAmount;
      if (remainingInvested < 0.01) {
        return handleCloseTrade(trade.id);
      }
      const updatedUser = {
        ...user,
        balance: user.balance + returned,
        trades: user.trades.map(t => t.id === trade.id ? {
          ...t,
          totalInvested: remainingInvested,
          partialExits: [...(t.partialExits || []), {
            percentage,
            soldSOL: sellAmount,
            price: currentPrice,
            pnl,
            sellReason: sellReason || '‚Äî',
            timestamp: new Date().toISOString()
          }]
        } : t)
      };
      setUser(updatedUser);
      showToast(`Sold ${percentage}%! P&L: ${pnl >= 0 ? '+' : ''}${pnl.toFixed(3)} SOL`, pnl >= 0 ? 'success' : 'warning');
    } catch (error) {
      showToast('Error fetching price', 'error');
    }
  };
  const handleCloseTrade = tradeId => {
    const trade = user.trades.find(t => t.id === tradeId);
    if (trade) setCloseModal(trade);
  };
  const confirmCloseTrade = async (tradeId, sellReason) => {
    setCloseModal(null);
    const trade = user.trades.find(t => t.id === tradeId);
    if (!trade || trade.status === 'closed') return;
    try {
      const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${trade.tokenAddress}`);
      const data = await res.json();
      const currentPrice = data.pairs?.[0] ? parseFloat(data.pairs[0].priceUsd) : trade.avgEntryPrice;
      const priceChange = trade.avgEntryPrice ? (currentPrice - trade.avgEntryPrice) / trade.avgEntryPrice * 100 : 0;
      const partialPnl = (trade.partialExits || []).reduce((sum, exit) => sum + exit.pnl, 0);
      const remainingPnl = trade.totalInvested * (priceChange / 100);
      // Slippage on exit: use volume from live data or trade's recorded slippage tier
      const exitVol = data.pairs?.[0] ? parseFloat(data.pairs[0].volume?.h24 || 0) : 0;
      const exitSlipPct = calcSlippage(exitVol || (trade.slippagePct ? trade.slippagePct * 150000 : 0));
      const exitSlipCost = (trade.totalInvested + remainingPnl) * exitSlipPct;
      const totalPnl = partialPnl + remainingPnl - exitSlipCost;
      const returned = Math.max(0, trade.totalInvested + remainingPnl - exitSlipCost);
      const totalSlippage = (trade.slippageCost || 0) + exitSlipCost;
      const updatedUser = {
        ...user,
        balance: user.balance + returned,
        trades: user.trades.map(t => t.id === tradeId ? {
          ...t,
          status: 'closed',
          exitPrice: currentPrice,
          totalPnl,
          sellReason,
          closedAt: new Date().toISOString(),
          exitSlipPct,
          exitSlipCost,
          totalSlippage
        } : t)
      };
      if (totalPnl > 0) {
        updatedUser.currentStreak = (updatedUser.currentStreak || 0) + 1;
        if (updatedUser.currentStreak === 3) setTimeout(() => addXP('HOT_STREAK_3', '3 Win Streak!'), 1000);
        if (updatedUser.currentStreak === 5) setTimeout(() => addXP('HOT_STREAK_5', '5 Win Streak!'), 1000);
        if (updatedUser.currentStreak === 10) setTimeout(() => addXP('HOT_STREAK_10', '10 Win Streak!!!'), 1000);
      } else {
        updatedUser.currentStreak = 0;
      }
      updatedUser.badges = checkBadges(updatedUser);
      setUser(updatedUser);
      showToast(`Position closed! P&L: ${totalPnl >= 0 ? '+' : ''}${totalPnl.toFixed(3)} SOL (slip: -${totalSlippage.toFixed(3)})`, totalPnl >= 0 ? 'success' : 'warning');

        // Post-trade educational tip (#4)
        const _holdDays = trade.openedAt ? (Date.now() - new Date(trade.openedAt)) / 86400000 : 0;
        const _pnlPct   = (totalPnl / (trade.totalInvested||1)) * 100;
        const _priceChg = trade.avgEntryPrice > 0 ? ((currentPrice - trade.avgEntryPrice) / trade.avgEntryPrice * 100) : 0;
        let _tip = null;
        if (totalPnl < 0 && sellReason === 'BAD_ENTRY')       _tip = "Bad Entry detected: Next time wait for the first dip before buying. Never chase a pump. (Rule 1)";
        else if (totalPnl < 0 && _priceChg < -50)             _tip = "Heavy loss (-50%+): When volume dries up and whales dump, exit early. Rule 5: take profits before others take them from you.";
        else if (totalPnl < 0 && _holdDays > 3)               _tip = "Held too long at a loss: If volume decreases and whales are dumping, exit. Do not fall in love with a bag. (Rule 5)";
        else if (totalPnl < 0 && sellReason === 'NARRATIVE')  _tip = "Narrative changed: Always verify if CT is genuinely excited or just paid shills. Follow the meta, not the noise. (Rule 3)";
        else if (totalPnl < 0 && sellReason === 'RUG')        _tip = "Rug detected: Before entering, always check BubbleMaps for clusters > 4%. If insiders dump early, exit immediately. (Rule 2)";
        else if (totalPnl > 0 && _pnlPct < 20)                _tip = "Small gain: Consider DCA exits at 2x, 5x, 10x instead of closing the full position too early. Leave a moonbag. (Rule 4)";
        else if (totalPnl > 0 && _pnlPct >= 100)              _tip = "Great trade! Always take some profits on the way up. Your next target after 2x should already be pre-planned. (Rule 4)";
        else if (totalPnl > 0 && sellReason === 'TAKE_PROFIT') _tip = "Disciplined exit! Taking profits at your target separates good traders from bag holders. (Rule 4)";
        if (_tip) setTimeout(() => showToast('üìö ' + _tip, 'info'), 2000);
      // XP only on profit or first trade ever
      const closedCount = (updatedUser.trades || []).filter(t => t.status === 'closed').length;
      const isFirstTrade = closedCount === 1;
      if (totalPnl > 0 || isFirstTrade) {
        const xpGain = isFirstTrade && totalPnl <= 0 ? 10 : calcXPFromPnL(totalPnl);
        setTimeout(() => addXP(xpGain, `${totalPnl >= 0 ? '+' : ''}${totalPnl.toFixed(3)} SOL`), 500);
      }
      // Publish updated ranking data after close
      setTimeout(() => publishRanking(updatedUser), 800);
      setTimeout(() => checkCloseMission(), 1200);
    } catch (error) {
      showToast('Error fetching price', 'error');
    }
  };
  const updateTradePrice = async trade => {
    try {
      const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${trade.tokenAddress}`);
      const data = await res.json();
      if (data.pairs?.[0]) {
        const currentPrice = parseFloat(data.pairs[0].priceUsd);
        const priceChange = trade.avgEntryPrice ? (currentPrice - trade.avgEntryPrice) / trade.avgEntryPrice * 100 : 0;
        showToast(`${trade.tokenSymbol}: $${currentPrice.toFixed(8)} (${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(1)}%)`, priceChange >= 0 ? 'success' : 'warning');
        const updatedUser = {
          ...user,
          trades: user.trades.map(t => t.id === trade.id ? {
            ...t,
            currentPrice,
            lastUpdate: Date.now()
          } : t)
        };
        setUser(updatedUser);
      }
    } catch (error) {
      showToast('Error updating price', 'error');
    }
  };
  const handleVote = async id => {
    // 1 vote per week per user ‚Äî can move it but not vote multiple at same time
    const wk = getWeekKey();
    const alreadyVotedId = Object.keys(userVotes).find(k => userVotes[k]);
    const already = userVotes[id];
    if (alreadyVotedId && !already) {
      showToast('1 vote per week ‚Äî remove your current vote first', 'warning');
      return;
    }
    const newVotes = {
      ...userVotes
    };
    if (already) {
      delete newVotes[id];
    } else {
      newVotes[id] = true;
    }
    const updated = narratives.map(n => n.id !== id ? n : {
      ...n,
      votes: already ? Math.max(0, n.votes - 1) : n.votes + 1
    });
    setNarratives(updated);
    setUserVotes(newVotes);
    localStorage.setItem('helmUserVotes', JSON.stringify(newVotes));
    localStorage.setItem('helmNarratives', JSON.stringify(updated));

    // Persist shared vote counts
    try {
      const voteCounts = {};
      updated.forEach(n => {
        voteCounts[n.id] = n.votes;
      });
      if (window.storage) {
        await window.storage.set(NARR_KEY, JSON.stringify(voteCounts), true).catch(() => {});
      }
    } catch (e) {}
  };
  const currentLevel = getCurrentLevel(user?.xp || 0);
  const currentLevelData = LEVELS[Math.max(0, currentLevel - 1)];
  const nextLevelXP = getNextLevelXP(user?.xp || 0);
  const currentLevelXP = currentLevel > 1 ? LEVELS[currentLevel - 2].xp : 0;
  const xpProgress = user ? (user.xp - currentLevelXP) / (nextLevelXP - currentLevelXP) * 100 : 0;

  // ‚îÄ‚îÄ TRADER PROFILE COMPUTATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const traderProfile = (() => {
    if (!user) return {
      closed: [],
      active: [],
      wins: [],
      losses: [],
      totalPnl: 0,
      winRate: 0,
      avgWin: 0,
      avgLoss: 0,
      rr: 0,
      topBuyReason: null,
      sellReasons: {},
      buyReasons: {},
      avgHold: 0,
      curLossStreak: 0,
      trades24h: 0,
      isOvertrading: false,
      archetype: 'üå± Beginner',
      archetypeDesc: ''
    };
    const all = user.trades || [];
    const closed = all.filter(t => t.status === 'closed');
    const active = all.filter(t => t.status === 'active');
    const wins = closed.filter(t => (t.totalPnl || 0) > 0);
    const losses = closed.filter(t => (t.totalPnl || 0) < 0);
    const totalPnl = closed.reduce((s, t) => s + (t.totalPnl || 0), 0);
    const winRate = closed.length > 0 ? wins.length / closed.length * 100 : 0;
    const avgWin = wins.length > 0 ? wins.reduce((s, t) => s + (t.totalPnl || 0), 0) / wins.length : 0;
    const avgLoss = losses.length > 0 ? Math.abs(losses.reduce((s, t) => s + (t.totalPnl || 0), 0) / losses.length) : 0;
    const rr = avgLoss > 0 ? avgWin / avgLoss : 0;

    // buy reasons breakdown
    const buyReasons = {};
    all.forEach(t => {
      if (t.buyReason) buyReasons[t.buyReason] = (buyReasons[t.buyReason] || 0) + 1;
    });
    const topBuyReason = Object.entries(buyReasons).sort((a, b) => b[1] - a[1])[0]?.[0] || null;

    // sell reasons breakdown
    const sellReasons = {};
    closed.forEach(t => {
      if (t.sellReason) sellReasons[t.sellReason] = (sellReasons[t.sellReason] || 0) + 1;
    });

    // timing: avg hold time in hours
    const holdTimes = closed.filter(t => t.closedAt && t.openedAt).map(t => (new Date(t.closedAt) - new Date(t.openedAt)) / 3600000);
    const avgHold = holdTimes.length > 0 ? holdTimes.reduce((s, v) => s + v, 0) / holdTimes.length : 0;

    // consecutive losses streak
    let curLossStreak = 0;
    for (let i = closed.length - 1; i >= 0; i--) {
      if ((closed[i].totalPnl || 0) < 0) curLossStreak++;else break;
    }

    // overtrading: >5 trades opened in last 24h
    const now = Date.now();
    const trades24h = all.filter(t => now - new Date(t.createdAt) < 86400000).length;
    const isOvertrading = trades24h >= 5;

    // archetype
    let archetype = 'üå± Beginner';
    let archetypeDesc = 'Still building trade history.';
    if (closed.length >= 5) {
      if (winRate >= 60 && rr >= 1.5) {
        archetype = 'üéØ Sniper';
        archetypeDesc = 'High precision and great R/R. You trade selectively and hit when you do.';
      } else if (winRate >= 60 && avgHold < 2) {
        archetype = '‚ö° Scalper';
        archetypeDesc = 'You trade fast with good accuracy. Watch fees and slippage.';
      } else if (winRate >= 50 && rr >= 1) {
        archetype = 'üìä Consistent';
        archetypeDesc = 'Good balance between wins and losses. You are on the right track.';
      } else if (wins.length > 0 && losses.length > wins.length * 2) {
        archetype = 'üé∞ Gambler';
        archetypeDesc = 'Too many losses vs gains. Consider being more selective.';
      } else if (isOvertrading || trades24h >= 4) {
        archetype = 'üîÅ Overtrader';
        archetypeDesc = 'Trading too frequently. More trades does not mean more profit.';
      } else if (topBuyReason === 'üî• FOMO') {
        archetype = 'üò± FOMO Trader';
        archetypeDesc = 'Most entries driven by FOMO. Work on having clearer criteria.';
      } else if (avgHold > 24) {
        archetype = 'üíé Holder';
        archetypeDesc = 'You hold positions a long time. Useful in trends, risky in memecoins.';
      } else {
        archetype = 'üîÑ Developing';
        archetypeDesc = 'Pattern still forming. Keep trading and analyzing your results.';
      }
    }
    return {
      closed,
      active,
      wins,
      losses,
      totalPnl,
      winRate,
      avgWin,
      avgLoss,
      rr,
      topBuyReason,
      sellReasons,
      buyReasons,
      avgHold,
      curLossStreak,
      trades24h,
      isOvertrading,
      archetype,
      archetypeDesc
    };
  })();

  // ‚îÄ‚îÄ LOSS STREAK ALERT ‚îÄ‚îÄ
  const LOSS_TIPS = ['üßò Breathe. Every loss is a lesson, not a failure. Review your entry before the next trade.', 'üìâ Losing streak? Reduce position size. Preserve capital first.', 'üîç Rugs? FOMO? Entered too early? Diagnosis is worth more than profit.', '‚è∏Ô∏è Consider a break. Trading emotionally increases mistakes.', 'üìä Only enter tokens that pass your full checklist.', 'üí° Consecutive losses show a pattern. Write down every entry reason.', 'üéØ Fewer trades, higher quality. You don\'t need to always be in the market.'];
  useEffect(() => {
    if (traderProfile.curLossStreak >= 2 && traderProfile.curLossStreak % 2 === 0) {
      const tip = LOSS_TIPS[(traderProfile.curLossStreak / 2 - 1) % LOSS_TIPS.length];
      setTimeout(() => showToast(`üíî ${traderProfile.curLossStreak} losses in a row`, 'warning'), 300);
      setTimeout(() => showToast(tip, 'warning'), 3800);
    }
  }, [traderProfile.curLossStreak]);

  // ‚îÄ‚îÄ OVERTRADING ALERT ‚îÄ‚îÄ
  useEffect(() => {
    if (traderProfile.isOvertrading) {
      setTimeout(() => showToast('‚ö†Ô∏è OVERTRADING ‚Äî 5+ trades in 24h. Take a breath!', 'warning'), 500);
    }
  }, [traderProfile.trades24h]);
                                                                                                 // ‚Üí components/LoginScreen.jsx
// Analysis tab, Portfolio tab, Ranking tab, Profile tab

  return /*#__PURE__*/React.createElement("div", null, userLoading && /*#__PURE__*/React.createElement("div", {
    style: {
      minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center',
      background: 'var(--bg-primary, #0d1117)', color: 'var(--text-primary, white)', fontSize: '1.2rem'
    }
  }, 'üîÑ Loading your profile...'), !user && !userLoading && /*#__PURE__*/React.createElement(function LoginScreen() {
    const [uname, setUname] = React.useState('');
    const [loading, setLoading] = React.useState(false);
    const [error, setError] = React.useState('');

    const doLogin = async () => {
      const name = uname.trim();
      if (!name || name.length < 3) { setError('Username must be at least 3 characters'); return; }
      if (name.length > 20) { setError('Username must be 20 characters or less'); return; }
      if (!/^[a-zA-Z0-9_]+$/.test(name)) { setError('Only letters, numbers and underscores allowed'); return; }
      setLoading(true);
      setError('');
      try {
        await handleLogin(name);
      } catch(e) {
        setError(e.message || 'Login failed');
        setLoading(false);
      }
    };

    return React.createElement("div", null,
      React.createElement("div", {className:"header"},
        // Logout button
        React.createElement("button", {
          onClick: async () => {
            if (confirm("Log out?")) {
              try {
                await window.authService.signOut();
              } catch(e) {
                // Force cleanup even if signOut fails
                localStorage.removeItem('helmUser');
                localStorage.removeItem('helmUserKey');
                localStorage.removeItem('helmAuthKey');
                localStorage.removeItem('helmMissions');
                localStorage.removeItem('helmAds');
                localStorage.removeItem('helmStarterDone');
              }
              window.location.reload();
            }
          },
          style: {
            position: 'absolute',
            top: '10px',
            right: '10px',
            padding: '8px 16px',
            background: 'rgba(239, 68, 68, 0.2)',
            border: '1px solid rgba(239, 68, 68, 0.5)',
            borderRadius: '8px',
            color: '#fca5a5',
            fontSize: '14px',
            cursor: 'pointer',
            fontWeight: '500',
            zIndex: 1000
          }
        }, "üö™ Logout"),
        React.createElement("div", {className:'logo u-flex u-items-center u-gap8'},
    React.createElement("img", {src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSIyMiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjYiLz4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI4IiBmaWxsPSIjM2I4MmY2Ii8+CiAgPGxpbmUgeDE9IjUwIiB5MT0iMTAiIHgyPSI1MCIgeTI9IjI4IiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjUwIiB5MT0iNzIiIHgyPSI1MCIgeTI9IjkwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjEwIiB5MT0iNTAiIHgyPSIyOCIgeTI9IjUwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjcyIiB5MT0iNTAiIHgyPSI5MCIgeTI9IjUwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjIxLjciIHkxPSIyMS43IiB4Mj0iMzQuMyIgeTI9IjM0LjMiIHN0cm9rZT0iIzNiODJmNiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8bGluZSB4MT0iNjUuNyIgeTE9IjY1LjciIHgyPSI3OC4zIiB5Mj0iNzguMyIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogIDxsaW5lIHgxPSI3OC4zIiB5MT0iMjEuNyIgeDI9IjY1LjciIHkyPSIzNC4zIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjM0LjMiIHkxPSI2NS43IiB4Mj0iMjEuNyIgeTI9Ijc4LjMiIHN0cm9rZT0iIzNiODJmNiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cg==", alt:"HELM", style:{width:'32px', height:'32px'}}),
    "HELM"
  )
      ),
      React.createElement("div", {className:"container"},
        React.createElement("div", {className:"card", style:{textAlign:'center', maxWidth:'380px', margin:'60px auto'}},
          React.createElement("img", {src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSIyMiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjYiLz4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI4IiBmaWxsPSIjM2I4MmY2Ii8+CiAgPGxpbmUgeDE9IjUwIiB5MT0iMTAiIHgyPSI1MCIgeTI9IjI4IiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjUwIiB5MT0iNzIiIHgyPSI1MCIgeTI9IjkwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjEwIiB5MT0iNTAiIHgyPSIyOCIgeTI9IjUwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjcyIiB5MT0iNTAiIHgyPSI5MCIgeTI9IjUwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjIxLjciIHkxPSIyMS43IiB4Mj0iMzQuMyIgeTI9IjM0LjMiIHN0cm9rZT0iIzNiODJmNiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8bGluZSB4MT0iNjUuNyIgeTE9IjY1LjciIHgyPSI3OC4zIiB5Mj0iNzguMyIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogIDxsaW5lIHgxPSI3OC4zIiB5MT0iMjEuNyIgeDI9IjY1LjciIHkyPSIzNC4zIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjM0LjMiIHkxPSI2NS43IiB4Mj0iMjEuNyIgeTI9Ijc4LjMiIHN0cm9rZT0iIzNiODJmNiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cg==", alt:"HELM Logo", style:{width:'120px', height:'120px', marginBottom:'16px'}} ),
          React.createElement("h2", {style:{marginBottom:'4px'}}, "Take the Helm"),
          React.createElement("p", {style:{color:'var(--text-secondary)', marginBottom:'6px', fontSize:'0.9rem'}},
            "Paper trade Solana memecoins. No real SOL needed."
          ),
          React.createElement("p", {style:{
            color:'var(--text-primary)', marginBottom:'28px', fontSize:'1.05rem',
            fontWeight:'600', letterSpacing:'-0.01em', opacity:0.85
          }},
            "Navigate memecoin chaos without losing real money."
          ),
          React.createElement("div", {style:{textAlign:'left', marginBottom:'6px'}},
            React.createElement("label", {style:{fontSize:'0.85rem', fontWeight:'bold', display:'block', marginBottom:'6px'}}, "Choose your username"),
            React.createElement("input", {
              type: 'text',
              placeholder: 'e.g. degen_macedo',
              value: uname,
              maxLength: 20,
              onChange: e => { setUname(e.target.value); setError(''); },
              onKeyDown: e => e.key === 'Enter' && doLogin(),
              style: {
                width:'100%', padding:'12px 14px', fontSize:'1rem',
                background:'var(--bg-primary)', border:'1px solid var(--border)',
                borderRadius:'10px', color:'var(--text-primary)', boxSizing:'border-box',
                outline:'none',
              }
            })
          ),
          error && React.createElement("div", {style:{
            fontSize:'0.8rem', color:'var(--danger)', marginBottom:'10px', textAlign:'left', padding:'6px 10px',
            background:'rgba(239,68,68,0.08)', borderRadius:'6px', border:'1px solid rgba(239,68,68,0.2)'
          }}, '‚ö†Ô∏è ' + error),
          React.createElement("p", {style:{fontSize:'0.72rem', color:'var(--text-secondary)', marginBottom:'14px', textAlign:'left'}},
            "Your username is your identity on the global leaderboard. Pick something memorable."
          ),
          React.createElement("button", {
            onClick: doLogin,
            disabled: loading || uname.trim().length < 3,
            style:{width:'100%', opacity: (loading || uname.trim().length < 3) ? 0.5 : 1}
          }, loading ? '‚è≥ Loading...' : 'Enter HELM'),
          React.createElement("p", {style:{fontSize:'0.72rem', color:'var(--text-secondary)', marginTop:'16px'}},
            "This will be your name on the global leaderboard."
          )
        )
      )
    );
  }, null), !userLoading && user && /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "header"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      gap: '8px',
      flexWrap: 'nowrap',
      minWidth: 0,
    }
  }, /*#__PURE__*/React.createElement("div", {style:{display:'flex',flexDirection:'column',gap:'1px',minWidth:0,flexShrink:1}},
    React.createElement("div", {className:'logo u-flex u-items-center u-gap8'},
    React.createElement("img", {src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSIyMiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjYiLz4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI4IiBmaWxsPSIjM2I4MmY2Ii8+CiAgPGxpbmUgeDE9IjUwIiB5MT0iMTAiIHgyPSI1MCIgeTI9IjI4IiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjUwIiB5MT0iNzIiIHgyPSI1MCIgeTI9IjkwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjEwIiB5MT0iNTAiIHgyPSIyOCIgeTI9IjUwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjcyIiB5MT0iNTAiIHgyPSI5MCIgeTI9IjUwIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjIxLjciIHkxPSIyMS43IiB4Mj0iMzQuMyIgeTI9IjM0LjMiIHN0cm9rZT0iIzNiODJmNiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICA8bGluZSB4MT0iNjUuNyIgeTE9IjY1LjciIHgyPSI3OC4zIiB5Mj0iNzguMyIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogIDxsaW5lIHgxPSI3OC4zIiB5MT0iMjEuNyIgeDI9IjY1LjciIHkyPSIzNC4zIiBzdHJva2U9IiMzYjgyZjYiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGxpbmUgeDE9IjM0LjMiIHkxPSI2NS43IiB4Mj0iMjEuNyIgeTI9Ijc4LjMiIHN0cm9rZT0iIzNiODJmNiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cg==", alt:"HELM", style:{width:'28px', height:'28px'}}),
    "HELM"
  ),
    React.createElement("div", {style:{fontSize:'0.7rem',color:'var(--text-secondary)',fontWeight:'400',letterSpacing:'0.01em',opacity:0.7,marginTop:'-2px'}},
      "Navigate memecoin chaos without losing real money."
    )
  ), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      alignItems: 'center'
    }
  }, /*#__PURE__*/React.createElement("div", {
    className: "level-badge",
    style: {
      whiteSpace: 'nowrap'
    }
  }, currentLevelData.icon, " Lv", currentLevel), /*#__PURE__*/React.createElement("div", {
    onClick: () => {
      if (user.balance < 0.5) setShowBankrupt(false)  /* DESABILITADO - survival mode */;
    },
    style: {
      padding: '5px 11px',
      background: 'var(--bg-card)',
      borderRadius: '8px',
      border: `1px solid ${user.balance < 0.5 ? 'var(--danger)' : 'var(--border)'}`,
      cursor: user.balance < 0.5 ? 'pointer' : 'default',
      textAlign: 'center',
      minWidth: '82px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.57rem',
      color: 'var(--text-secondary)',
      textTransform: 'uppercase',
      letterSpacing: '0.04em'
    }
  }, "Free", user.balance < 0.5 ? ' ‚ö†Ô∏è' : ''), /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '0.86rem',
      color: user.balance < 0.5 ? 'var(--danger)' : 'inherit'
    }
  }, user.balance.toFixed(2), " SOL"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.67rem',
      color: 'rgba(255,255,255,0.4)'
    }
  }, toUSD(user.balance))), (() => {
    const openVal = (user.trades || []).filter(t => t.status === 'active').reduce((s, t) => s + (t.totalInvested || 0), 0);
    const tw = user.balance + openVal;
    return /*#__PURE__*/React.createElement("div", {
      style: {
        padding: '5px 11px',
        background: 'rgba(59,130,246,0.08)',
        border: '1px solid rgba(59,130,246,0.22)',
        borderRadius: '8px',
        textAlign: 'center',
        minWidth: '82px'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.57rem',
        color: 'var(--text-secondary)',
        textTransform: 'uppercase',
        letterSpacing: '0.04em'
      }
    }, "Total"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.86rem'
      }
    }, tw.toFixed(2), " SOL"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.67rem',
        color: 'rgba(255,255,255,0.4)'
      }
    }, toUSD(tw)));
  })(), /*#__PURE__*/React.createElement("button", {
    id: "helm-missions",
    onClick: () => setShowMissions(true),
    style: {
      margin: 0,
      padding: '7px 13px',
      fontSize: '0.82rem',
      fontWeight: 'bold',
      background: 'linear-gradient(135deg,rgba(59,130,246,0.15),rgba(139,92,246,0.15))',
      border: '1px solid rgba(139,92,246,0.4)',
      color: '#a78bfa',
      borderRadius: '8px',
      cursor: 'pointer',
      whiteSpace: 'nowrap'
    }
  }, React.createElement("span", { className: "hide-mobile" }, "\uD83D\uDCCB Missions"), React.createElement("span", { className: "show-mobile" }, "\uD83D\uDCCB")), /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'relative'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => setSettingsOpen(o => !o),
    style: {
      margin: 0,
      padding: '7px 10px',
      fontSize: '1rem',
      background: settingsOpen ? 'rgba(255,255,255,0.08)' : 'var(--bg-card)',
      border: '1px solid var(--border)',
      borderRadius: '8px',
      cursor: 'pointer',
      color: 'var(--text-secondary)'
    }
  }, "\u2699\uFE0F"), settingsOpen && /*#__PURE__*/React.createElement("div", {
    onClick: () => setSettingsOpen(false),
    style: {
      position: 'fixed',
      inset: 0,
      zIndex: 1199
    }
  }), settingsOpen && /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      right: '12px',
      top: '70px',
      zIndex: 1200,
      background: 'var(--bg-card)',
      border: '1px solid var(--border)',
      borderRadius: '14px',
      padding: '16px',
      minWidth: '200px',
      boxShadow: '0 10px 40px rgba(0,0,0,0.5)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      textAlign: 'center',
      padding: '8px',
      background: 'rgba(255,255,255,0.04)',
      borderRadius: '8px',
      marginBottom: '12px',
      fontFamily: 'monospace'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.7rem',
      color: 'var(--text-secondary)'
    }
  }, "SOL price "), /*#__PURE__*/React.createElement("strong", {
    style: {
      color: 'var(--text-primary)',
      fontSize: '0.9rem'
    }
  }, "$", solPrice.toFixed(2))), /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '12px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.7rem',
      color: 'var(--text-secondary)',
      marginBottom: '5px'
    }
  }, "Theme"), /*#__PURE__*/React.createElement("select", {
    className: "theme-selector",
    value: theme,
    onChange: e => applyTheme(e.target.value),
    style: {
      width: '100%',
      margin: 0
    }
  }, /*#__PURE__*/React.createElement("option", {
    value: "default"
  }, "\uD83C\uDF0A Navy"), /*#__PURE__*/React.createElement("option", {
    value: "light"
  }, "\u2600\uFE0F Light"), /*#__PURE__*/React.createElement("option", {
    value: "neon"
  }, "\u26A1 Neon"))), /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      setTutorialStep(0);
      setSettingsOpen(false);
    },
    style: {
      width: '100%',
      margin: '0 0 8px',
      padding: '9px',
      fontSize: '0.85rem',
      background: 'rgba(59,130,246,0.08)',
      border: '1px solid rgba(59,130,246,0.25)',
      color: 'var(--accent)',
      borderRadius: '8px',
      cursor: 'pointer'
    }
  }, "\uD83D\uDDFA\uFE0F Restart Tutorial"), /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      localStorage.removeItem('helmStarterDone');
      setStarterFlow(0);
      setAnalysis(null);
      setTokenAddress('');
      setSettingsOpen(false);
    },
    style: {
      width: '100%',
      margin: '0 0 8px',
      padding: '9px',
      fontSize: '0.85rem',
      background: 'rgba(139,92,246,0.08)',
      border: '1px solid rgba(139,92,246,0.25)',
      color: '#a78bfa',
      borderRadius: '8px',
      cursor: 'pointer'
    }
  }, "\uD83C\uDF31 Restart Starter Flow"), /*#__PURE__*/React.createElement("button", {
    onClick: async () => {
      if (confirm('Log out?')) {
        try {
          await window.authService.signOut();
        } catch(e) {
          localStorage.removeItem('helmUser');
          localStorage.removeItem('helmUserKey');
          localStorage.removeItem('helmAuthKey');
          localStorage.removeItem('helmMissions');
          localStorage.removeItem('helmAds');
          localStorage.removeItem('helmStarterDone');
        }
        window.location.reload();
      }
    },
    className: "logout-btn",
    style: {
      width: '100%',
      margin: 0,
      padding: '9px',
      fontSize: '0.85rem',
      background: 'var(--danger)',
      color: 'white'
    }
  }, "\uD83D\uDEAA Log Out")))))), (() => {
    const top3 = [...narratives].sort((a, b) => b.votes - a.votes).slice(0, 3);
    return /*#__PURE__*/React.createElement("div", {
      style: {
        background: 'var(--bg-card)',
        borderBottom: '1px solid var(--border)',
        padding: '7px 0'
      }
    }, /*#__PURE__*/React.createElement("div", {
      className: "container",
      style: {
        display: 'none',  /* üö´ TRENDING OCULTO */
        alignItems: 'center',
        gap: '10px',
        flexWrap: 'wrap'
      }
    }, /*#__PURE__*/React.createElement("span", {
      style: {
        color: 'var(--accent)',
        fontSize: '0.73rem',
        fontWeight: 'bold',
        letterSpacing: '1px',
        whiteSpace: 'nowrap'
      }
    }, "\uD83D\uDD25 TRENDING"), top3.map((n, i) => /*#__PURE__*/React.createElement("div", {
      key: n.id,
      onClick: () => setActiveTab('narratives'),
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '5px',
        cursor: 'pointer',
        padding: '3px 10px',
        borderRadius: '20px',
        fontSize: '0.78rem',
        background: 'var(--bg-primary)',
        border: `1px solid ${i === 0 ? '#fbbf24' : i === 1 ? '#94a3b8' : '#cd7f32'}`
      }
    }, /*#__PURE__*/React.createElement("span", null, ['ü•á', 'ü•à', 'ü•â'][i]), /*#__PURE__*/React.createElement("span", {
      style: {
        fontWeight: 'bold'
      }
    }, n.emoji, " ", n.title), /*#__PURE__*/React.createElement("span", {
      style: {
        color: 'var(--text-secondary)'
      }
    }, "\xB7 ", n.votes)))));
  })(), /*#__PURE__*/React.createElement("div", {
    className: "container"
  }, /*#__PURE__*/React.createElement("div", {
    className: "tabs",
    id: "helm-tabs"
  }, /*#__PURE__*/React.createElement("div", {
    className: `tab ${activeTab === 'profile' ? 'active' : ''}`,
    onClick: () => setActiveTab('profile')
  }, "\uD83D\uDC64 Profile"), /*#__PURE__*/React.createElement("div", {
    id: "helm-analysis-tab",
    className: `tab ${activeTab === 'analysis' ? 'active' : ''}`,
    onClick: () => setActiveTab('analysis')
  }, "\uD83D\uDD0D Analysis"), /*#__PURE__*/React.createElement("div", {
    id: "helm-portfolio-tab",
    className: `tab ${activeTab === 'portfolio' ? 'active' : ''}`,
    onClick: () => setActiveTab('portfolio')
  }, "\uD83D\uDCCA Portfolio"), /*#__PURE__*/React.createElement("div", {
    className: `tab ${activeTab === 'badges' ? 'active' : ''}`,
    onClick: () => setActiveTab('badges')
  }, "\uD83C\uDFC6 Badges"), /*#__PURE__*/React.createElement("div", {
    id: "helm-ranking",
    className: `tab ${activeTab === 'ranking' ? 'active' : ''}`,
    onClick: () => setActiveTab('ranking')
  }, "\uD83E\uDD47 Ranking"), /*#__PURE__*/React.createElement("div", {
    id: "helm-community",
    className: `tab ${activeTab === 'community' ? 'active' : ''}`,
    onClick: () => setActiveTab('community')
  }, "\uD83D\uDCAC Community"), /*#__PURE__*/React.createElement("div", {
    className: `tab ${activeTab === 'learn' ? 'active' : ''}`,
    onClick: () => setActiveTab('learn'),
    style: {background: activeTab === 'learn' ? 'rgba(139,92,246,0.2)' : ''}
  }, "\uD83D\uDCDA Learn")), activeTab === 'profile' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'flex-end',
      marginBottom: '14px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => setShowWeeklyReport(true),
    style: {
      margin: 0,
      padding: '9px 16px',
      fontSize: '0.85rem',
      fontWeight: 'bold',
      background: 'linear-gradient(135deg,rgba(59,130,246,0.15),rgba(139,92,246,0.15))',
      border: '1px solid rgba(139,92,246,0.4)',
      color: 'var(--accent)',
      borderRadius: '10px'
    }
  }, "\uD83D\uDCCA Weekly Report")), traderProfile.isOvertrading && /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '14px 18px',
      borderRadius: '12px',
      marginBottom: '14px',
      background: 'rgba(245,158,11,0.1)',
      border: '2px solid var(--warning)',
      display: 'flex',
      gap: '12px',
      alignItems: 'flex-start'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '1.6rem'
    }
  }, "\u26A0\uFE0F"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      color: 'var(--warning)',
      marginBottom: '4px'
    }
  }, "OVERTRADING DETECTADO"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem',
      color: 'var(--text-secondary)',
      lineHeight: 1.5
    }
  }, "You opened ", /*#__PURE__*/React.createElement("strong", {
    style: {
      color: 'var(--warning)'
    }
  }, traderProfile.trades24h, " trades in the last 24h"), ". More trades \u2260 more profit. Be selective."))), traderProfile.curLossStreak >= 3 && /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '14px 18px',
      borderRadius: '12px',
      marginBottom: '14px',
      background: 'rgba(239,68,68,0.08)',
      border: '1px solid var(--danger)',
      display: 'flex',
      gap: '12px',
      alignItems: 'flex-start'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '1.6rem'
    }
  }, "\uD83D\uDC94"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      color: 'var(--danger)',
      marginBottom: '4px'
    }
  }, traderProfile.curLossStreak, " CONSECUTIVE LOSSES"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem',
      color: 'var(--text-secondary)',
      lineHeight: 1.5
    }
  }, traderProfile.curLossStreak >= 5 ? 'Severe streak. Pause now and analyze your patterns.' : 'Reduce position size and review your entry criteria.'))), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '20px',
      borderRadius: '14px',
      marginBottom: '14px',
      background: 'linear-gradient(135deg,rgba(59,130,246,0.1),rgba(139,92,246,0.1))',
      border: '1px solid rgba(139,92,246,0.3)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '14px',
      marginBottom: '12px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2.8rem',
      lineHeight: 1
    }
  }, traderProfile.archetype.split(' ')[0]), /*#__PURE__*/React.createElement("div", {
    style: {
      flex: 1
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.75rem',
      color: 'var(--text-secondary)',
      textTransform: 'uppercase',
      letterSpacing: '1px',
      marginBottom: '4px'
    }
  }, "Trader Profile"), editingUsername ? /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '6px',
      marginBottom: '4px'
    }
  }, /*#__PURE__*/React.createElement("input", {
    autoFocus: true,
    value: usernameDraft,
    onChange: e => setUsernameDraft(e.target.value.slice(0, 20)),
    onKeyDown: e => {
      if (e.key === 'Enter') {
        const name = usernameDraft.trim() || 'Anon';
        const updated = {
          ...user,
          username: name
        };
        setUser(updated);
        publishRanking(updated);
        setEditingUsername(false);
      }
      if (e.key === 'Escape') setEditingUsername(false);
    },
    maxLength: 20,
    style: {
      fontSize: '1.1rem',
      fontWeight: 'bold',
      background: 'var(--bg-primary)',
      border: '1px solid var(--accent)',
      borderRadius: '6px',
      padding: '4px 8px',
      color: 'var(--text-primary)',
      width: '150px'
    }
  }), /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      const name = usernameDraft.trim() || 'Anon';
      const updated = {
        ...user,
        username: name,
        lastUsernameChange: new Date().toISOString()  // Registrar mudan√ßa
      };
      setUser(updated);
      publishRanking(updated);
      setEditingUsername(false);
      showToast('‚úÖ Username changed! (Can change again in 30 days)', 'success');
    },
    style: {
      margin: 0,
      padding: '4px 10px',
      fontSize: '0.78rem',
      background: 'var(--accent)',
      border: 'none',
      color: 'white',
      borderRadius: '6px'
    }
  }, "\u2713"), /*#__PURE__*/React.createElement("button", {
    onClick: () => setEditingUsername(false),
    style: {
      margin: 0,
      padding: '4px 8px',
      fontSize: '0.78rem',
      background: 'transparent',
      border: '1px solid var(--border)',
      borderRadius: '6px'
    }
  }, "\u2715")) : /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '8px',
      marginBottom: '4px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '1.3rem',
      fontWeight: 'bold',
      color: 'var(--text-primary)'
    }
  }, user?.username || 'Anon'), /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      // Verificar se pode mudar (1x por m√™s)
      const lastChange = user?.lastUsernameChange;
      if (lastChange) {
        const daysSinceChange = (Date.now() - new Date(lastChange)) / (1000 * 60 * 60 * 24);
        if (daysSinceChange < 30) {
          const daysLeft = Math.ceil(30 - daysSinceChange);
          showToast(`‚è∞ You can change username again in ${daysLeft} days`, 'warning');
          return;
        }
      }
      setUsernameDraft(user?.username || '');
      setEditingUsername(true);
    },
    style: {
      margin: 0,
      padding: '3px 8px',
      fontSize: '0.72rem',
      background: 'transparent',
      border: '1px solid var(--border)',
      borderRadius: '6px',
      color: 'var(--text-secondary)',
      cursor: 'pointer'
    }
  }, "\u270F\uFE0F Edit")), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem',
      color: 'var(--text-secondary)',
      marginTop: '2px'
    }
  }, traderProfile.archetype.replace(/^\S+\s/, '')), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.82rem',
      color: 'var(--text-secondary)',
      marginTop: '4px',
      lineHeight: 1.5
    }
  }, traderProfile.archetypeDesc))), traderProfile.closed.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'inline-flex',
      alignItems: 'center',
      gap: '6px',
      padding: '6px 12px',
      borderRadius: '20px',
      background: 'rgba(255,255,255,0.06)',
      border: '1px solid rgba(255,255,255,0.12)',
      marginBottom: '14px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '1rem'
    }
  }, "\u23F1\uFE0F"), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.82rem',
      color: 'var(--text-secondary)'
    }
  }, "Avg Hold:"), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.88rem',
      fontWeight: 'bold',
      color: 'var(--text-primary)'
    }
  }, traderProfile.avgHold < 1 ? `${Math.round(traderProfile.avgHold * 60)}min` : traderProfile.avgHold < 24 ? `${traderProfile.avgHold.toFixed(1)}h` : `${(traderProfile.avgHold / 24).toFixed(1)}d`), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.72rem',
      color: 'var(--text-secondary)',
      marginLeft: '2px'
    }
  }, traderProfile.avgHold < 1 ? '‚ö° Scalper' : traderProfile.avgHold < 4 ? 'üéØ Day' : traderProfile.avgHold < 24 ? 'üìä Swing' : 'üíé Holder')), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      flexWrap: 'wrap'
    }
  }, [['üìà DexScreener', 'https://dexscreener.com', 'rgba(16,185,129,0.12)', 'rgba(16,185,129,0.35)', 'var(--success)'], ['üê¶ Twitter/X', 'https://x.com', 'rgba(255,255,255,0.06)', 'rgba(255,255,255,0.2)', 'var(--text-primary)'], ['üì£ Telegram', 'https://t.me', 'rgba(0,136,204,0.12)', 'rgba(0,136,204,0.4)', '#29b6f6']].map(([label, href, bg, border, color]) => /*#__PURE__*/React.createElement("a", {
    key: label,
    href: href,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '6px',
      padding: '8px 14px',
      borderRadius: '8px',
      textDecoration: 'none',
      fontWeight: 'bold',
      fontSize: '0.82rem',
      background: bg,
      border: `1px solid ${border}`,
      color
    }
  }, label)))), /*#__PURE__*/React.createElement("div", {
    className: "card",
    style: {
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '1.6rem'
    }
  }, currentLevelData.icon), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold'
    }
  }, currentLevelData.name), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      color: 'var(--text-secondary)'
    }
  }, "Level ", currentLevel))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => setShowXPTable(true),
    style: {
      margin: 0,
      padding: '5px 10px',
      fontSize: '0.72rem',
      fontWeight: 'bold',
      background: 'rgba(59,130,246,0.1)',
      border: '1px solid rgba(59,130,246,0.3)',
      color: 'var(--accent)',
      borderRadius: '8px'
    }
  }, "\uD83D\uDCCB XP Table"), /*#__PURE__*/React.createElement("div", {
    style: {
      textAlign: 'right'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      color: 'var(--accent)'
    }
  }, (user.xp || 0).toLocaleString(), " XP"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      color: 'var(--text-secondary)'
    }
  }, "\u2192 ", nextLevelXP.toLocaleString(), " XP")))), /*#__PURE__*/React.createElement("div", {
    className: "xp-bar-container"
  }, /*#__PURE__*/React.createElement("div", {
    className: "xp-bar",
    style: {
      width: `${Math.min(xpProgress, 100)}%`
    }
  }, xpProgress > 15 && `${Math.floor(xpProgress)}%`))), /*#__PURE__*/React.createElement("div", {
    className: "stat-grid",
    style: {
      marginBottom: '10px'
    }
  }, [{
    val: `${(user.balance || 0).toFixed(2)} SOL`,
    label: 'Balance'
  }, {
    val: `${traderProfile.totalPnl >= 0 ? '+' : ''}${traderProfile.totalPnl.toFixed(3)}`,
    label: 'P&L Total',
    color: traderProfile.totalPnl >= 0 ? 'var(--success)' : 'var(--danger)'
  }, {
    val: `${traderProfile.winRate.toFixed(0)}%`,
    label: 'Win Rate',
    color: traderProfile.winRate >= 50 ? 'var(--success)' : 'var(--danger)'
  }, {
    val: `${traderProfile.rr.toFixed(2)}√ó`,
    label: 'Risk/Reward',
    color: traderProfile.rr >= 1 ? 'var(--success)' : 'var(--warning)'
  }, {
    val: traderProfile.closed.length,
    label: 'Closed'
  }, {
    val: traderProfile.active.length,
    label: 'Open'
  }, {
    val: traderProfile.wins.length,
    label: 'Wins',
    color: 'var(--success)'
  }, {
    val: traderProfile.losses.length,
    label: 'Losses',
    color: 'var(--danger)'
  }].map(s => /*#__PURE__*/React.createElement("div", {
    key: s.label,
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      color: s.color || 'var(--text-primary)'
    }
  }, s.val), s.subval && /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.68rem',
      color: 'rgba(255,255,255,0.38)',
      marginTop: '1px'
    }
  }, s.subval), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, s.label)))), traderProfile.closed.length >= 1 && (() => {
    // ‚îÄ‚îÄ Compute period P&L ‚îÄ‚îÄ
    const now = Date.now();
    const periodPnl = ms => traderProfile.closed.filter(t => t.closedAt && now - new Date(t.closedAt) < ms).reduce((s, t) => s + (t.totalPnl || 0), 0);
    const pnlDay = periodPnl(86400000);
    const pnlWeek = periodPnl(604800000);
    const pnlMonth = periodPnl(2592000000);

    // ‚îÄ‚îÄ Best / worst trade ‚îÄ‚îÄ
    const best = traderProfile.closed.reduce((a, b) => (b.totalPnl || 0) > (a.totalPnl || 0) ? b : a, traderProfile.closed[0]);
    const worst = traderProfile.closed.reduce((a, b) => (b.totalPnl || 0) < (a.totalPnl || 0) ? b : a, traderProfile.closed[0]);

    // ‚îÄ‚îÄ Hourly heatmap ‚îÄ‚îÄ
    const hourMap = Array(24).fill(0);
    traderProfile.closed.filter(t => t.createdAt).forEach(t => {
      const h = new Date(t.createdAt).getHours();
      hourMap[h]++;
    });
    const maxH = Math.max(...hourMap, 1);
    const peakHour = hourMap.indexOf(maxH);

    // ‚îÄ‚îÄ Goals ‚îÄ‚îÄ
    const goals = [{
      label: 'Close 10 trades',
      target: 10,
      current: traderProfile.closed.length,
      icon: 'üéØ'
    }, {
      label: 'Win rate > 50%',
      target: 100,
      current: traderProfile.winRate >= 50 ? 100 : traderProfile.winRate,
      icon: 'üèÜ',
      pct: true
    }, {
      label: 'R/R above 1',
      target: 100,
      current: Math.min(traderProfile.rr / 1 * 100, 100),
      icon: '‚öñÔ∏è',
      alreadyDone: traderProfile.rr >= 1
    }, {
      label: '5 wins in a row +',
      target: 5,
      current: Math.min(user.currentStreak || 0, 5),
      icon: 'üî•'
    }];
    return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '14px',
        fontSize: '0.95rem'
      }
    }, "\uD83D\uDCC5 P&L by Period"), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'grid',
        gridTemplateColumns: 'repeat(3,1fr)',
        gap: '10px'
      }
    }, [['Hoje', pnlDay], ['7 dias', pnlWeek], ['30 dias', pnlMonth]].map(([label, val]) => /*#__PURE__*/React.createElement("div", {
      key: label,
      style: {
        background: 'var(--bg-primary)',
        borderRadius: '10px',
        padding: '12px',
        textAlign: 'center'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)',
        marginBottom: '6px'
      }
    }, label), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '1.1rem',
        fontWeight: 'bold',
        color: val >= 0 ? 'var(--success)' : 'var(--danger)'
      }
    }, val >= 0 ? '+' : '', val.toFixed(3), " ", /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.7rem'
      }
    }, "SOL")))))), /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '14px',
        fontSize: '0.95rem'
      }
    }, "\uD83C\uDFC5 Best & Worst Trade"), [['üü¢ Melhor', best, 'var(--success)'], ['üî¥ Pior', worst, 'var(--danger)']].map(([label, t, color]) => /*#__PURE__*/React.createElement("div", {
      key: label,
      style: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        padding: '10px',
        background: 'var(--bg-primary)',
        borderRadius: '8px',
        marginBottom: '8px'
      }
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.78rem',
        color: 'var(--text-secondary)',
        marginBottom: '2px'
      }
    }, label), /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.9rem'
      }
    }, t.tokenSymbol || t.tokenName || 'Token'), t.createdAt && /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.72rem',
        color: 'var(--text-secondary)'
      }
    }, new Date(t.createdAt).toLocaleDateString('en-US'))), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '1.1rem',
        color
      }
    }, (t.totalPnl || 0) >= 0 ? '+' : '', (t.totalPnl || 0).toFixed(4), " SOL"), t.buyReason && /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.72rem',
        color: 'var(--text-secondary)'
      }
    }, t.buyReason))))), traderProfile.closed.length >= 2 && /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '14px',
        fontSize: '0.95rem'
      }
    }, "\uD83D\uDCD0 Detailed Metrics"), [{
      label: 'Avg Win',
      val: `+${traderProfile.avgWin.toFixed(4)} SOL`,
      color: 'var(--success)'
    }, {
      label: 'Avg Loss',
      val: `-${traderProfile.avgLoss.toFixed(4)} SOL`,
      color: 'var(--danger)'
    }, {
      label: 'Avg Hold Time',
      val: traderProfile.avgHold < 1 ? `${Math.round(traderProfile.avgHold * 60)}min` : `${traderProfile.avgHold.toFixed(1)}h`
    }, {
      label: 'Trades last 24h',
      val: traderProfile.trades24h,
      color: traderProfile.isOvertrading ? 'var(--warning)' : undefined
    }, {
      label: 'Current loss streak',
      val: traderProfile.curLossStreak,
      color: traderProfile.curLossStreak >= 3 ? 'var(--danger)' : undefined
    }].map(s => /*#__PURE__*/React.createElement("div", {
      key: s.label,
      style: {
        display: 'flex',
        justifyContent: 'space-between',
        padding: '8px 0',
        borderBottom: '1px solid var(--border)',
        fontSize: '0.88rem'
      }
    }, /*#__PURE__*/React.createElement("span", {
      style: {
        color: 'var(--text-secondary)'
      }
    }, s.label), /*#__PURE__*/React.createElement("span", {
      style: {
        fontWeight: 'bold',
        color: s.color || 'var(--text-primary)'
      }
    }, s.val)))), /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '6px',
        fontSize: '0.95rem'
      }
    }, "\uD83D\uDD50 Most active hours"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.8rem',
        color: 'var(--text-secondary)',
        marginBottom: '12px'
      }
    }, "Pico: ", peakHour, "h\u2013", peakHour + 1, "h (", hourMap[peakHour], " trades)"), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        gap: '3px',
        alignItems: 'flex-end',
        height: '50px'
      }
    }, hourMap.map((count, h) => /*#__PURE__*/React.createElement("div", {
      key: h,
      title: `${h}h: ${count} trades`,
      style: {
        flex: 1,
        minWidth: 0,
        borderRadius: '3px 3px 0 0',
        background: count === 0 ? 'var(--bg-primary)' : count === maxH ? 'var(--accent)' : 'rgba(59,130,246,0.4)',
        height: `${Math.max(count / maxH * 100, count > 0 ? 15 : 4)}%`,
        transition: 'height 0.3s'
      }
    }))), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        justifyContent: 'space-between',
        marginTop: '4px',
        fontSize: '0.68rem',
        color: 'var(--text-secondary)'
      }
    }, /*#__PURE__*/React.createElement("span", null, "0h"), /*#__PURE__*/React.createElement("span", null, "6h"), /*#__PURE__*/React.createElement("span", null, "12h"), /*#__PURE__*/React.createElement("span", null, "18h"), /*#__PURE__*/React.createElement("span", null, "23h"))), /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '14px',
        fontSize: '0.95rem'
      }
    }, "\uD83C\uDFAF Goals"), goals.map(g => {
      const pct = g.alreadyDone ? 100 : Math.min(Math.round(g.current / g.target * 100), 100);
      const done = pct >= 100;
      return /*#__PURE__*/React.createElement("div", {
        key: g.label,
        style: {
          marginBottom: '12px'
        }
      }, /*#__PURE__*/React.createElement("div", {
        style: {
          display: 'flex',
          justifyContent: 'space-between',
          marginBottom: '5px',
          fontSize: '0.85rem'
        }
      }, /*#__PURE__*/React.createElement("span", {
        style: {
          display: 'flex',
          gap: '6px',
          alignItems: 'center'
        }
      }, /*#__PURE__*/React.createElement("span", null, g.icon), /*#__PURE__*/React.createElement("span", {
        style: {
          color: done ? 'var(--success)' : 'var(--text-primary)'
        }
      }, g.label), done && /*#__PURE__*/React.createElement("span", {
        style: {
          fontSize: '0.7rem',
          background: 'rgba(16,185,129,0.15)',
          color: 'var(--success)',
          padding: '1px 6px',
          borderRadius: '10px'
        }
      }, "\u2713 Done")), /*#__PURE__*/React.createElement("span", {
        style: {
          color: 'var(--text-secondary)',
          fontWeight: 'bold'
        }
      }, pct, "%")), /*#__PURE__*/React.createElement("div", {
        style: {
          height: '7px',
          background: 'var(--bg-primary)',
          borderRadius: '4px',
          overflow: 'hidden'
        }
      }, /*#__PURE__*/React.createElement("div", {
        style: {
          height: '100%',
          width: `${pct}%`,
          borderRadius: '4px',
          transition: 'width 0.6s',
          background: done ? 'var(--success)' : 'linear-gradient(90deg,var(--accent),rgba(139,92,246,0.8))'
        }
      })));
    })), Object.keys(traderProfile.buyReasons).length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '12px',
        fontSize: '0.95rem'
      }
    }, "\uD83E\uDDE0 Why do you enter?"), Object.entries(traderProfile.buyReasons).sort((a, b) => b[1] - a[1]).map(([reason, count]) => {
      const pct = Math.round(count / (user.trades || []).length * 100);
      return /*#__PURE__*/React.createElement("div", {
        key: reason,
        style: {
          marginBottom: '8px'
        }
      }, /*#__PURE__*/React.createElement("div", {
        style: {
          display: 'flex',
          justifyContent: 'space-between',
          marginBottom: '3px',
          fontSize: '0.85rem'
        }
      }, /*#__PURE__*/React.createElement("span", null, reason), /*#__PURE__*/React.createElement("span", {
        style: {
          color: 'var(--text-secondary)'
        }
      }, count, "\xD7 (", pct, "%)")), /*#__PURE__*/React.createElement("div", {
        style: {
          height: '6px',
          background: 'var(--bg-primary)',
          borderRadius: '3px',
          overflow: 'hidden'
        }
      }, /*#__PURE__*/React.createElement("div", {
        style: {
          height: '100%',
          width: `${pct}%`,
          background: 'var(--accent)',
          borderRadius: '3px',
          transition: 'width 0.5s'
        }
      })));
    }), traderProfile.topBuyReason === 'üî• FOMO' && /*#__PURE__*/React.createElement("div", {
      style: {
        marginTop: '10px',
        fontSize: '0.8rem',
        color: 'var(--warning)',
        padding: '8px',
        background: 'rgba(245,158,11,0.08)',
        borderRadius: '8px'
      }
    }, "\u26A0\uFE0F FOMO is your main entry reason. This usually means buying tops.")));
  })(), traderProfile.closed.length === 0 && /*#__PURE__*/React.createElement("div", {
    className: "card",
    style: {
      textAlign: 'center',
      padding: '40px 20px',
      color: 'var(--text-secondary)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2.5rem',
      marginBottom: '12px'
    }
  }, "\uD83C\uDF31"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      marginBottom: '6px'
    }
  }, "No history yet"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem'
    }
  }, "Make your first trade to start building your profile."))), activeTab === 'analysis' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("h2", null, "\uD83D\uDD0D Token Analysis"), /*#__PURE__*/React.createElement("div", {
    className: "card"
  }, /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '10px',
      fontWeight: 'bold'
    }
  }, "Token Address (Solana)"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("input", {
    value: tokenAddress,
    onChange: e => setTokenAddress(e.target.value),
    placeholder: "Paste token address...",
    style: {
      flex: 1
    }
  })), /*#__PURE__*/React.createElement("button", {
    onClick: analyzeToken,
    disabled: loading,
    className: "success"
  }, loading ? '‚è≥ Analyzing...' : 'üîç Analyze')), analysis && /*#__PURE__*/React.createElement("div", {
    className: "card"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'flex-start',
      flexWrap: 'wrap',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    style: {
      fontSize: '1.2rem'
    }
  }, analysis.name, " ", /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)'
    }
  }, "(", analysis.symbol, ")")), /*#__PURE__*/React.createElement("p", {
    style: {
      fontSize: '0.8rem',
      color: 'var(--text-secondary)',
      marginTop: '2px',
      wordBreak: 'break-all'
    }
  }, analysis.address)), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '8px 16px',
      borderRadius: '10px',
      fontWeight: 'bold',
      fontSize: '1rem',
      whiteSpace: 'nowrap',
      background: analysis.riskLevel === 'low' ? 'rgba(16,185,129,0.15)' : analysis.riskLevel === 'medium' ? 'rgba(245,158,11,0.15)' : 'rgba(239,68,68,0.15)',
      border: `1px solid ${analysis.riskLevel === 'low' ? 'var(--success)' : analysis.riskLevel === 'medium' ? 'var(--warning)' : 'var(--danger)'}`,
      color: analysis.riskLevel === 'low' ? 'var(--success)' : analysis.riskLevel === 'medium' ? 'var(--warning)' : 'var(--danger)'
    }
  }, analysis.riskLevel === 'low' && '‚úÖ LOW RISK', analysis.riskLevel === 'medium' && '‚ö° MEDIUM RISK', analysis.riskLevel === 'high' && 'üö® HIGH RISK', analysis.riskLevel === 'extreme' && '‚ò†Ô∏è EXTREME', ' ', "\xB7 ", analysis.riskScore, "/100")), /*#__PURE__*/React.createElement("div", {
    className: "stat-grid",
    style: {
      marginTop: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, "$", analysis.price.toFixed(8)), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "Price")), /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, "$", (analysis.liquidity / 1000).toFixed(1), "k"), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "Liquidity")), /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, "$", (analysis.volume24h / 1000).toFixed(1), "k"), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "Volume 24h")), analysis.marketCap > 0 && /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, "$", (analysis.marketCap / 1000).toFixed(0), "k"), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "FDV/MC")), analysis.holders && /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, analysis.holders.toLocaleString()), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "Holders")), analysis.avgBagUsd && /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, "$", analysis.avgBagUsd.toFixed(0)), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "Avg Bag"))), analysis.redFlags.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'rgba(239,68,68,0.08)',

      padding: '14px',
      borderRadius: '10px',
      marginTop: '14px',
      border: '1px solid rgba(239,68,68,0.2)'
    }
  }, /*#__PURE__*/React.createElement("h4", {
    style: {
      color: 'var(--danger)',
      marginBottom: '8px',
      fontSize: '0.9rem'
    }
  }, "\uD83D\uDEA9 RED FLAGS (", analysis.redFlags.length, ")"), analysis.redFlags.map((flag, i) => /*#__PURE__*/React.createElement("div", {
    key: i,
    style: {
      fontSize: '0.86rem',
      marginBottom: '5px',
      lineHeight: 1.4
    }
  }, renderFlagWithTips(flag)))), analysis.greenFlags?.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'rgba(16,185,129,0.08)',
      padding: '14px',
      borderRadius: '10px',
      marginTop: '10px',
      border: '1px solid rgba(16,185,129,0.2)'
    }
  }, /*#__PURE__*/React.createElement("h4", {
    style: {
      color: 'var(--success)',
      marginBottom: '8px',
      fontSize: '0.9rem'
    }
  }, "\u2705 GREEN FLAGS (", analysis.greenFlags.length, ")"), analysis.greenFlags.map((flag, i) => /*#__PURE__*/React.createElement("div", {
    key: i,
    style: {
      fontSize: '0.86rem',
      marginBottom: '5px',
      lineHeight: 1.4
    }
  }, renderFlagWithTips(flag)))), /*#__PURE__*/React.createElement("div", {
    style: {
      marginTop: '18px',
      padding: '14px',
      background: 'var(--bg-primary)',
      borderRadius: '10px',
      border: '1px solid var(--border)'
    }
  }, /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.78rem',
      fontWeight: 'bold',
      letterSpacing: '1px',
      marginBottom: '10px',
      textTransform: 'uppercase'
    }
  }, "\uD83D\uDD2C Verify manually"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      flexWrap: 'wrap'
    }
  }, /*#__PURE__*/React.createElement("a", {
    href: `https://app.bubblemaps.io/sol/token/${analysis.address}`,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '8px 14px',
      borderRadius: '8px',
      textDecoration: 'none',
      background: 'rgba(139,92,246,0.12)',
      border: '1px solid rgba(139,92,246,0.4)',
      color: '#a78bfa',
      fontSize: '0.82rem',
      fontWeight: 'bold'
    }
  }, "\uD83E\uDEE7 Bubblemaps"), /*#__PURE__*/React.createElement("a", {
    href: `https://solscan.io/token/${analysis.address}#holders`,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '8px 14px',
      borderRadius: '8px',
      textDecoration: 'none',
      background: 'rgba(59,130,246,0.1)',
      border: '1px solid rgba(59,130,246,0.35)',
      color: 'var(--accent)',
      fontSize: '0.82rem',
      fontWeight: 'bold'
    }
  }, "\uD83D\uDD0D Holders (Solscan)"), /*#__PURE__*/React.createElement("a", {
    href: `https://dexscreener.com/solana/${analysis.address}`,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '8px 14px',
      borderRadius: '8px',
      textDecoration: 'none',
      background: 'rgba(16,185,129,0.1)',
      border: '1px solid rgba(16,185,129,0.3)',
      color: 'var(--success)',
      fontSize: '0.82rem',
      fontWeight: 'bold'
    }
  }, "\uD83D\uDCC8 DexScreener"), /*#__PURE__*/React.createElement("a", {
    href: `https://birdeye.so/token/${analysis.address}?chain=solana`,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '8px 14px',
      borderRadius: '8px',
      textDecoration: 'none',
      background: 'rgba(245,158,11,0.1)',
      border: '1px solid rgba(245,158,11,0.3)',
      color: 'var(--warning)',
      fontSize: '0.82rem',
      fontWeight: 'bold'
    }
  }, "\uD83E\uDD85 Birdeye"))), (analysis.links?.telegram || analysis.links?.twitter || analysis.links?.website) && /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      marginTop: '12px',
      flexWrap: 'wrap'
    }
  }, analysis.links.telegram && /*#__PURE__*/React.createElement("a", {
    href: analysis.links.telegram,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '7px 12px',
      borderRadius: '8px',
      background: 'rgba(0,136,204,0.12)',
      border: '1px solid rgba(0,136,204,0.4)',
      color: '#29b6f6',
      fontSize: '0.82rem',
      fontWeight: 'bold',
      textDecoration: 'none'
    }
  }, "\uD83D\uDCE3 Telegram"), analysis.links.twitter && /*#__PURE__*/React.createElement("a", {
    href: analysis.links.twitter,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '7px 12px',
      borderRadius: '8px',
      background: 'rgba(255,255,255,0.06)',
      border: '1px solid rgba(255,255,255,0.2)',
      color: 'var(--text-primary)',
      fontSize: '0.82rem',
      fontWeight: 'bold',
      textDecoration: 'none'
    }
  }, "\uD83D\uDC26 Twitter/X"), analysis.links.website && /*#__PURE__*/React.createElement("a", {
    href: analysis.links.website,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '7px 12px',
      borderRadius: '8px',
      background: 'rgba(16,185,129,0.1)',
      border: '1px solid rgba(16,185,129,0.3)',
      color: 'var(--success)',
      fontSize: '0.82rem',
      fontWeight: 'bold',
      textDecoration: 'none'
    }
  }, "\uD83C\uDF10 Website")), /*#__PURE__*/React.createElement("button", {
    onClick: registerTrade,
    className: "success",
    style: {
      marginTop: '20px',
      fontSize: '1rem',
      padding: '14px 28px',
      letterSpacing: '1px',
      width: '100%'
    }
  }, "\uD83D\uDE80 APE"))), activeTab === 'portfolio' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      flexWrap: 'wrap',
      gap: '10px',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("h2", null, "\uD83D\uDCCA Portfolio"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px',
      alignItems: 'center'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '8px 16px',
      background: 'var(--bg-card)',
      borderRadius: '8px',
      border: '1px solid var(--border)',
      fontSize: '0.9rem'
    }
  }, "\uD83D\uDCB0 Balance: ", /*#__PURE__*/React.createElement("strong", null, (user.balance || 0).toFixed(2), " SOL")), /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      if (confirm('Clear ALL trades? (cannot undo)')) {
        setUser({
          ...user,
          trades: [],
          balance: 5.0
        });
        showToast('Trades reset!', 'success');
      }
    },
    className: "danger reset-btn",
    style: {
      fontSize: '0.8rem',
      padding: '8px 14px'
    }
  }, "\uD83D\uDDD1\uFE0F Reset Trades"))), /*#__PURE__*/React.createElement("div", {
    className: "card"
  }, /*#__PURE__*/React.createElement("h3", null, "Active Positions (", user.trades?.filter(t => t.status === 'active').length || 0, ")"), user.trades?.filter(t => t.status === 'active').length === 0 ? /*#__PURE__*/React.createElement("p", {
    style: { color: 'var(--text-secondary)', marginTop: '15px' }
  }, "No active trades. Go to Analysis tab to buy tokens!") : user.trades.filter(t => t.status === 'active').map(trade => {
    const currentPrice = trade.currentPrice || trade.avgEntryPrice;
    const priceChange = trade.avgEntryPrice ? (currentPrice - trade.avgEntryPrice) / trade.avgEntryPrice * 100 : 0;
    const partialPnl = (trade.partialExits || []).reduce((sum, exit) => sum + exit.pnl, 0);
    const unrealizedPnl = trade.totalInvested * (priceChange / 100);
    const totalPnl = partialPnl + unrealizedPnl - (trade.slippageCost || 0);
    const isExpanded = expandedTrades[trade.id] || false;
    const sym = (trade.tokenSymbol || 'TKN').slice(0, 3).toUpperCase();
    return /*#__PURE__*/React.createElement("div", {
      key: trade.id,
      className: `pos-card ${totalPnl >= 0 ? 'pos-win' : 'pos-loss'} slide-in`
    },
    /* Summary row - always visible */
    React.createElement("div", {
      className: "pos-summary",
      onClick: () => setExpandedTrades(prev => ({...prev, [trade.id]: !prev[trade.id]}))
    },
      React.createElement("div", { className: "pos-left" },
        React.createElement("div", { className: "token-avatar",
          style: totalPnl >= 0 ? { color: 'var(--success)', borderColor: 'rgba(16,185,129,0.2)' } : {}
        }, sym),
        React.createElement("div", { className: "token-info" },
          React.createElement("div", { className: "token-name-row" },
            trade.tokenSymbol,
            trade.buyReason && React.createElement("span", { className: "token-tag" }, trade.buyReason)
          ),
          React.createElement("div", { className: "token-meta-line" },
            (trade.entries||[]).length, (trade.entries||[]).length === 1 ? ' entry' : ' entries',
            ' \u00B7 ', trade.totalInvested.toFixed(3), ' SOL invested'
          )
        )
      ),
      React.createElement("div", { className: "pos-right" },
        React.createElement("div", { className: `pnl-val ${totalPnl >= 0 ? 'up' : 'down'}` },
          totalPnl >= 0 ? '+' : '', totalPnl.toFixed(3), ' SOL'
        ),
        React.createElement("div", { className: `pnl-pct ${priceChange >= 0 ? 'up' : 'down'}` },
          priceChange >= 0 ? '+' : '', priceChange.toFixed(1), '%',
          React.createElement("span", { className: `expand-arrow ${isExpanded ? 'open' : ''}` }, ' \u25BC')
        )
      )
    ),
    /* Quick actions - always visible */
    React.createElement("div", { className: "pos-quick" },
      React.createElement("button", {
        className: "pos-qbtn qsell",
        onClick: e => { e.stopPropagation(); handleCloseTrade(trade.id); }
      }, "Close Position"),
      React.createElement("button", {
        className: "pos-qbtn qupdate",
        onClick: e => { e.stopPropagation(); updateTradePrice(trade); }
      }, "\uD83D\uDD04 Update")
    ),
    /* Expandable details */
    React.createElement("div", { className: `pos-details ${isExpanded ? 'open' : ''}` },
      React.createElement("div", { className: "pos-details-inner" },
        /* Partial exits badge */
        (trade.partialExits || []).length > 0 && React.createElement("div", { className: "partial-badge-new", style: { marginTop: '12px' } },
          '\u2705 ', trade.partialExits.length, ' partial exit', trade.partialExits.length > 1 ? 's' : '',
          ' \u00B7 +', partialPnl.toFixed(3), ' SOL realized'
        ),
        /* Stats grid */
        React.createElement("div", { className: "pos-stats-grid" },
          React.createElement("div", { className: "pos-stat" },
            React.createElement("div", { className: "ps-label" }, "Invested"),
            React.createElement("div", { className: "ps-value" }, trade.totalInvested.toFixed(3), ' SOL')
          ),
          React.createElement("div", { className: "pos-stat" },
            React.createElement("div", { className: "ps-label" }, "Avg Price"),
            React.createElement("div", { className: "ps-value" }, '$', trade.avgEntryPrice.toFixed(8))
          ),
          React.createElement("div", { className: "pos-stat" },
            React.createElement("div", { className: "ps-label" }, "Current"),
            React.createElement("div", { className: "ps-value" }, '$', currentPrice.toFixed(8))
          )
        ),
        /* Action buttons */
        React.createElement("div", { className: "pos-actions" },
          React.createElement("button", {
            className: "pos-abtn abtn-accent",
            onClick: e => { e.stopPropagation(); handleDCA(trade); }
          }, "\uD83D\uDCC9 DCA"),
          React.createElement("button", {
            className: "pos-abtn",
            onClick: e => { e.stopPropagation(); handlePartialSell(trade); }
          }, "\uD83D\uDCCA Partial Sell"),
          React.createElement("button", {
            className: "pos-abtn",
            onClick: e => { e.stopPropagation(); window.open('https://dexscreener.com/solana/' + trade.tokenAddress, '_blank'); }
          }, "\uD83D\uDCC8 DEX"),
          trade.tokenAddress && React.createElement("button", {
            className: "pos-abtn",
            onClick: e => { e.stopPropagation(); setChartTrade(trade); }
          }, "\uD83D\uDCCA Chart"),
          React.createElement("button", {
            className: "pos-abtn",
            onClick: e => { e.stopPropagation(); setPortfolioModal(trade); }
          }, "\u2139\uFE0F Details")
        )
      )
    )
    );
  })),
  /* ‚îÄ‚îÄ TRADE HISTORY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  /*#__PURE__*/React.createElement("div", {
    className: "card"
  }, /*#__PURE__*/React.createElement("h3", null, "Trade History (", user.trades?.filter(t => t.status === 'closed').length || 0, ")"), user.trades?.filter(t => t.status === 'closed').length === 0 ? /*#__PURE__*/React.createElement("p", {
    style: { color: 'var(--text-secondary)', marginTop: '15px' }
  }, "No closed trades yet") : user.trades.filter(t => t.status === 'closed').slice().reverse().map(trade => {
    const totalPnl = trade.totalPnl || 0;
    const pnlPct = trade.totalInvested ? (totalPnl / trade.totalInvested * 100) : 0;
    const isWin = totalPnl >= 0;
    return React.createElement("div", {
      key: trade.id,
      className: "hist-item"
    },
      React.createElement("div", { className: `hist-bar ${isWin ? 'hw' : 'hl'}` }),
      React.createElement("div", { className: "hist-info" },
        React.createElement("div", { className: "hist-name" }, trade.tokenSymbol),
        React.createElement("div", { className: "hist-meta" },
          trade.entries?.length || 1, ' entr', (trade.entries?.length || 1) === 1 ? 'y' : 'ies',
          React.createElement("span", { className: "hist-dot" }),
          'Avg $', trade.avgEntryPrice.toFixed(8),
          (trade.partialExits || []).length > 0 && React.createElement(React.Fragment, null,
            React.createElement("span", { className: "hist-dot" }),
            trade.partialExits.length, ' partial exit', trade.partialExits.length > 1 ? 's' : ''
          )
        )
      ),
      React.createElement("div", { className: "hist-pnl" },
        React.createElement("div", { className: `hval ${isWin ? 'hw' : 'hl'}` },
          isWin ? '+' : '', totalPnl.toFixed(3), ' SOL'
        ),
        React.createElement("div", { className: `hpct ${isWin ? 'hw' : 'hl'}` },
          '(', pnlPct >= 0 ? '+' : '', pnlPct.toFixed(1), '%)'
        )
      )
    );
  })),
  ), activeTab === 'narratives' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '20px'
    }
  }, /*#__PURE__*/React.createElement("h2", null, "\uD83C\uDF0A Narratives"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      alignItems: 'center'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.76rem',
      padding: '4px 10px',
      borderRadius: '20px',
      background: 'var(--bg-card)',
      border: '1px solid var(--border)'
    }
  }, "\uD83D\uDD04 Resets every Monday"), /*#__PURE__*/React.createElement("button", {
    onClick: async () => {
      setNarrativesLoading(true);
      try {
        if (window.storage) {
          const r = await window.storage.get(NARR_KEY, true).catch(() => null);
          if (r?.value) {
            const shared = JSON.parse(r.value);
            setNarratives(NARR_BASE.map(n => ({
              ...n,
              votes: shared[n.id] ?? n.votes
            })));
          }
        }
      } catch (e) {}
      setNarrativesLoading(false);
    },
    disabled: narrativesLoading,
    style: {
      margin: 0,
      padding: '4px 10px',
      fontSize: '0.75rem',
      background: 'transparent',
      border: '1px solid var(--border)',
      borderRadius: '20px',
      color: 'var(--text-secondary)',
      cursor: 'pointer'
    }
  }, narrativesLoading ? '‚è≥' : '‚Üª'))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: 'repeat(auto-fill, minmax(130px, 1fr))',
      gap: '12px'
    }
  }, [...narratives].sort((a, b) => b.votes - a.votes).map((n, i) => {
    const voted = !!userVotes[n.id];
    const medals = ['ü•á', 'ü•à', 'ü•â'];
    const isTop = i < 3;
    const borderCol = i === 0 ? '#fbbf24' : i === 1 ? '#94a3b8' : i === 2 ? '#cd7f32' : voted ? 'var(--accent)' : 'var(--border)';
    return /*#__PURE__*/React.createElement("div", {
      key: n.id,
      onClick: () => handleVoteWithMission(n.id),
      style: {
        position: 'relative',
        borderRadius: '14px',
        aspectRatio: '1',
        cursor: 'pointer',
        background: 'var(--bg-card)',
        border: `2px solid ${borderCol}`,
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        justifyContent: 'center',
        gap: '8px',
        padding: '12px',
        transition: 'transform 0.15s, box-shadow 0.15s',
        boxShadow: voted ? '0 0 16px rgba(59,130,246,0.35)' : isTop ? `0 0 10px ${i === 0 ? 'rgba(251,191,36,0.25)' : 'rgba(148,163,184,0.15)'}` : 'none',
        userSelect: 'none'
      },
      onMouseEnter: e => e.currentTarget.style.transform = 'scale(1.04)',
      onMouseLeave: e => e.currentTarget.style.transform = 'scale(1)'
    }, isTop && /*#__PURE__*/React.createElement("div", {
      style: {
        position: 'absolute',
        top: '8px',
        left: '8px',
        fontSize: '1rem',
        lineHeight: 1
      }
    }, medals[i]), /*#__PURE__*/React.createElement("div", {
      style: {
        position: 'absolute',
        top: '8px',
        right: '8px',
        background: voted ? 'var(--accent)' : 'var(--bg-primary)',
        color: voted ? 'white' : 'var(--text-secondary)',
        borderRadius: '20px',
        padding: '2px 7px',
        fontSize: '0.72rem',
        fontWeight: 'bold'
      }
    }, n.votes), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '2.8rem',
        lineHeight: 1,
        filter: voted ? 'none' : 'grayscale(20%)'
      }
    }, voted ? 'üî•' : n.emoji), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.82rem',
        fontWeight: 'bold',
        textAlign: 'center',
        color: 'var(--text-primary)',
        lineHeight: 1.2
      }
    }, n.title));
  })), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.76rem',
      textAlign: 'center',
      marginTop: '16px'
    }
  }, "Tap to vote \xB7 Tap again to remove \xB7 1 vote per narrative")), activeTab === 'badges' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("h2", null, "\uD83C\uDFC6 Badges"), /*#__PURE__*/React.createElement("div", {
    className: "card"
  }, /*#__PURE__*/React.createElement("h3", {
    style: {
      marginBottom: '20px'
    }
  }, "Unlocked: ", user.badges?.length || 0, " / ", Object.keys(ALL_BADGES).length), /*#__PURE__*/React.createElement("div", {
    className: "badge-grid"
  }, Object.entries(ALL_BADGES).map(([id, badge]) => {
    const isUnlocked = user.badges?.includes(id);
    return /*#__PURE__*/React.createElement("div", {
      key: id,
      className: `badge-item ${isUnlocked ? 'unlocked' : 'locked'}`,
      title: badge.desc
    }, /*#__PURE__*/React.createElement("div", {
      className: "badge-icon"
    }, badge.icon), /*#__PURE__*/React.createElement("div", {
      className: "badge-name"
    }, badge.name), /*#__PURE__*/React.createElement("div", {
      className: "badge-desc"
    }, badge.desc));
  })))), activeTab === 'ranking' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("h2", null, "\uD83E\uDD47 Global Ranking"), /*#__PURE__*/React.createElement("button", {
    onClick: fetchRanking,
    style: {
      padding: '8px 16px',
      fontSize: '0.82rem',
      margin: 0
    },
    disabled: rankingLoading
  }, rankingLoading ? '‚è≥' : 'üîÑ Update')), (() => {
    const sorted = [...ranking].sort((a, b) => b.xp - a.xp);
    const myPos = sorted.findIndex(r => r.id === user.id);
    if (myPos < 0) return null;
    const me = sorted[myPos];
    return /*#__PURE__*/React.createElement("div", {
      style: {
        padding: '14px 18px',
        borderRadius: '12px',
        marginBottom: '16px',
        background: 'linear-gradient(135deg, rgba(59,130,246,0.12), rgba(139,92,246,0.12))',
        border: '1px solid rgba(59,130,246,0.35)'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center'
      }
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      style: {
        color: 'var(--text-secondary)',
        fontSize: '0.78rem'
      }
    }, "Your position"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '1.4rem',
        fontWeight: 'bold',
        color: 'var(--accent)'
      }
    }, "#", myPos + 1, " ", /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.95rem',
        color: 'var(--text-primary)'
      }
    }, me.username))), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '1.1rem',
        fontWeight: 'bold',
        color: 'var(--accent)'
      }
    }, me.xp.toLocaleString(), " XP"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.8rem',
        color: 'var(--text-secondary)'
      }
    }, "of ", sorted.length, " traders"))));
  })(), /*#__PURE__*/React.createElement(RankingTable, {
    ranking: ranking,
    rankingLoading: rankingLoading,
    userId: user.id,
    user: user
  })), activeTab === 'community' && /*#__PURE__*/React.createElement(CommunityTab, {
    user: user,
    onXPChange: addXP,
    traderWinRate: traderProfile.winRate
  })), activeTab === 'learn' && React.createElement("div", {className:"container",style:{paddingTop:"20px",paddingBottom:"40px"}},
    React.createElement("div",{style:{textAlign:"center",marginBottom:"28px"}},
      React.createElement("div",{style:{fontSize:"2.5rem",marginBottom:"8px"}},"üìö"),
      React.createElement("h2",{style:{marginBottom:"4px"}},"Memecoin Trading Guide"),
      React.createElement("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"}},"Knowledge from real traders ‚Äî learn before you ape")
    ),
    React.createElement("div", {
        key: "1", style: {background:"rgba(59,130,246,0.15)", border:"1px solid rgba(59,130,246,0.3)", borderRadius:"14px", padding:"20px", marginBottom:"16px"}
      },
      React.createElement("div", {className:"u-flex u-items-center u-gap12 u-mb14"},
        React.createElement("div", {className:"u-fs-xl"}, "üéØ"),
        React.createElement("div", null,
          React.createElement("div", {className:"u-fs-xs u-text-sec u-upper"}, "Rule 1"),
          React.createElement("div", {className:"u-bold u-fs-lg"}, "Find a Good Entry")
        )
      ),
      React.createElement("div", {className:"u-flex-col u-gap7"},
        React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Look for tokens with MC $10k‚Äì$100k with locked liquidity')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Use GMGN, Photon or Pump.fun to scan new launches')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Never buy the top ‚Äî wait for the first dip or consolidation')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Incomplete holder distribution = red flag before entering'))
      )
    ),
React.createElement("div", {
        key: "2", style: {background:"rgba(139,92,246,0.15)", border:"1px solid rgba(139,92,246,0.3)", borderRadius:"14px", padding:"20px", marginBottom:"16px"}
      },
      React.createElement("div", {className:"u-flex u-items-center u-gap12 u-mb14"},
        React.createElement("div", {className:"u-fs-xl"}, "üêã"),
        React.createElement("div", null,
          React.createElement("div", {className:"u-fs-xs u-text-sec u-upper"}, "Rule 2"),
          React.createElement("div", {className:"u-bold u-fs-lg"}, "Follow Smart Money")
        )
      ),
      React.createElement("div", {className:"u-flex-col u-gap7"},
        React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Track whale wallets on SolScan ‚Äî if big wallets accumulate, good sign')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Check BubbleMaps for connected wallets to avoid developer dumps')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'If insiders start dumping early, exit immediately ‚Äî do not be liquidity')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Any BubbleMaps cluster above 4% should be treated as a red flag'))
      )
    ),
React.createElement("div", {
        key: "3", style: {background:"rgba(16,185,129,0.15)", border:"1px solid rgba(16,185,129,0.3)", borderRadius:"14px", padding:"20px", marginBottom:"16px"}
      },
      React.createElement("div", {className:"u-flex u-items-center u-gap12 u-mb14"},
        React.createElement("div", {className:"u-fs-xl"}, "üì£"),
        React.createElement("div", null,
          React.createElement("div", {className:"u-fs-xs u-text-sec u-upper"}, "Rule 3"),
          React.createElement("div", {className:"u-bold u-fs-lg"}, "Read the Hype & Narrative")
        )
      ),
      React.createElement("div", {className:"u-flex-col u-gap7"},
        React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Is Crypto Twitter genuinely excited or are they all paid shills?')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Telegram chat growing? Check for real engagement vs bots')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Follow trending narratives ‚Äî track the meta on X')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'When influencers start shilling hard, begin selling ‚Äî not buying'))
      )
    ),
React.createElement("div", {
        key: "4", style: {background:"rgba(251,146,60,0.15)", border:"1px solid rgba(251,146,60,0.3)", borderRadius:"14px", padding:"20px", marginBottom:"16px"}
      },
      React.createElement("div", {className:"u-flex u-items-center u-gap12 u-mb14"},
        React.createElement("div", {className:"u-fs-xl"}, "üö™"),
        React.createElement("div", null,
          React.createElement("div", {className:"u-fs-xs u-text-sec u-upper"}, "Rule 4"),
          React.createElement("div", {className:"u-bold u-fs-lg"}, "Have an Exit Plan Before Entering")
        )
      ),
      React.createElement("div", {className:"u-flex-col u-gap7"},
        React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'DCA your exit: take profits at 2x, 5x, 10x instead of waiting for 100x')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'When CT influencers start shilling, begin selling ‚Äî not buying')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Always leave a moonbag, but be careful ‚Äî memecoins die fast')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Define your stop-loss before entering. -50% drop: dip or rug?'))
      )
    ),
React.createElement("div", {
        key: "5", style: {background:"rgba(239,68,68,0.15)", border:"1px solid rgba(239,68,68,0.3)", borderRadius:"14px", padding:"20px", marginBottom:"16px"}
      },
      React.createElement("div", {className:"u-flex u-items-center u-gap12 u-mb14"},
        React.createElement("div", {className:"u-fs-xl"}, "üõë"),
        React.createElement("div", null,
          React.createElement("div", {className:"u-fs-xs u-text-sec u-upper"}, "Rule 5"),
          React.createElement("div", {className:"u-bold u-fs-lg"}, "Do Not Hold Bags")
        )
      ),
      React.createElement("div", {className:"u-flex-col u-gap7"},
        React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'If volume drops, whales dump, or liquidity decreases ‚Äî exit')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Price drops -70% in minutes? That is not just a dip')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Rule #1: Take profits before someone else takes them from you')),React.createElement("div",{className:"u-flex u-gap8 u-fs-base u-text-sec u-lh"},React.createElement("span",{className:"u-dim"},"‚ñ∏"),React.createElement("span",null,'Memecoins move in cycles: hype, pump, dump, dead. Know where you are'))
      )
    ),
    React.createElement("div",{style:{background:"rgba(255,255,255,0.03)",border:"1px solid var(--border)",borderRadius:"14px",padding:"20px",marginTop:"8px"}},
      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"}},
        React.createElement("span",{style:{fontSize:"1.6rem"}},"ü´ß"),
        React.createElement("div",null,
          React.createElement("div",{className:"u-fs-xs u-text-sec u-upper"},"Advanced Analysis"),
          React.createElement("div",{className:"u-bold u-fs-lg"},"BubbleMaps CEX Cluster Guide")
        )
      ),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:"10px"}},
        React.createElement("div",{key:"CEX Main Cluster",className:"u-card-inner"},
      React.createElement("div",{className:"u-bold u-fs-md u-mb8"},'CEX Main Cluster'),
      React.createElement("div",{className:"u-flex-col u-gap4"},
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-ok"},"‚úÖ OK"),React.createElement("span",{className:"u-text-sec"}," 50%‚Äì55%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-warn"},"‚ö†Ô∏è Watch"),React.createElement("span",{className:"u-text-sec"}," >60% or <45%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-bad"},"üö® Flag"),React.createElement("span",{className:"u-text-sec"}," >65% or <40%"))
      )
    ),
React.createElement("div",{key:"Binance fd",className:"u-card-inner"},
      React.createElement("div",{className:"u-bold u-fs-md u-mb8"},'Binance fd'),
      React.createElement("div",{className:"u-flex-col u-gap4"},
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-ok"},"‚úÖ OK"),React.createElement("span",{className:"u-text-sec"}," 15%‚Äì25%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-warn"},"‚ö†Ô∏è Watch"),React.createElement("span",{className:"u-text-sec"}," 25%‚Äì30%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-bad"},"üö® Flag"),React.createElement("span",{className:"u-text-sec"}," >30% or <10%"))
      )
    ),
React.createElement("div",{key:"Coinbase fd",className:"u-card-inner"},
      React.createElement("div",{className:"u-bold u-fs-md u-mb8"},'Coinbase fd'),
      React.createElement("div",{className:"u-flex-col u-gap4"},
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-ok"},"‚úÖ OK"),React.createElement("span",{className:"u-text-sec"}," 15%‚Äì25%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-warn"},"‚ö†Ô∏è Watch"),React.createElement("span",{className:"u-text-sec"}," 25%‚Äì30%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-bad"},"üö® Flag"),React.createElement("span",{className:"u-text-sec"}," >30% or <10%"))
      )
    ),
React.createElement("div",{key:"ChangeNow fd",className:"u-card-inner"},
      React.createElement("div",{className:"u-bold u-fs-md u-mb8"},'ChangeNow fd'),
      React.createElement("div",{className:"u-flex-col u-gap4"},
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-ok"},"‚úÖ OK"),React.createElement("span",{className:"u-text-sec"}," < 3%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-warn"},"‚ö†Ô∏è Watch"),React.createElement("span",{className:"u-text-sec"}," 3%‚Äì10%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-bad"},"üö® Flag"),React.createElement("span",{className:"u-text-sec"}," > 10%"))
      )
    ),
React.createElement("div",{key:"MEXC fd",className:"u-card-inner"},
      React.createElement("div",{className:"u-bold u-fs-md u-mb8"},'MEXC fd'),
      React.createElement("div",{className:"u-flex-col u-gap4"},
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-ok"},"‚úÖ OK"),React.createElement("span",{className:"u-text-sec"}," < 5%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-warn"},"‚ö†Ô∏è Watch"),React.createElement("span",{className:"u-text-sec"}," 5%‚Äì10%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-bad"},"üö® Flag"),React.createElement("span",{className:"u-text-sec"}," > 10%"))
      )
    ),
React.createElement("div",{key:"KuCoin fd",className:"u-card-inner"},
      React.createElement("div",{className:"u-bold u-fs-md u-mb8"},'KuCoin fd'),
      React.createElement("div",{className:"u-flex-col u-gap4"},
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-ok"},"‚úÖ OK"),React.createElement("span",{className:"u-text-sec"}," 5%‚Äì7%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-warn"},"‚ö†Ô∏è Watch"),React.createElement("span",{className:"u-text-sec"}," 7%‚Äì10%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-bad"},"üö® Flag"),React.createElement("span",{className:"u-text-sec"}," > 10%"))
      )
    ),
React.createElement("div",{key:"Crypto.com fd",className:"u-card-inner"},
      React.createElement("div",{className:"u-bold u-fs-md u-mb8"},'Crypto.com fd'),
      React.createElement("div",{className:"u-flex-col u-gap4"},
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-ok"},"‚úÖ OK"),React.createElement("span",{className:"u-text-sec"}," < 5%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-warn"},"‚ö†Ô∏è Watch"),React.createElement("span",{className:"u-text-sec"}," 5%‚Äì8%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-bad"},"üö® Flag"),React.createElement("span",{className:"u-text-sec"}," > 8%"))
      )
    ),
React.createElement("div",{key:"HTX / OKX fd",className:"u-card-inner"},
      React.createElement("div",{className:"u-bold u-fs-md u-mb8"},'HTX / OKX fd'),
      React.createElement("div",{className:"u-flex-col u-gap4"},
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-ok"},"‚úÖ OK"),React.createElement("span",{className:"u-text-sec"}," < 5%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-warn"},"‚ö†Ô∏è Watch"),React.createElement("span",{className:"u-text-sec"}," 5%‚Äì8%")),
        React.createElement("div",{className:"u-flex-between u-fs-sm"},React.createElement("span",{className:"u-text-bad"},"üö® Flag"),React.createElement("span",{className:"u-text-sec"}," > 8%"))
      )
    )
      )
    )
  ,

  /* ‚îÄ‚îÄ DEGEN GLOSSARY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  React.createElement("div", { style: { marginTop: '28px' } },
    React.createElement("div", { style: { textAlign: 'center', marginBottom: '20px' } },
      React.createElement("div", { style: { fontSize: '2.2rem', marginBottom: '6px' } }, "üìñ"),
      React.createElement("h2", { style: { marginBottom: '4px' } }, "Degen Glossary"),
      React.createElement("p", { style: { color: 'var(--text-secondary)', fontSize: '0.85rem' } }, "Every term you'll see on CT, in HELM, and in Telegram groups. Tap any term to learn.")
    ),
    /* Search */
    React.createElement("div", { className: "gloss-search-wrap" },
      React.createElement("span", { className: "gloss-search-icon" }, "üîç"),
      React.createElement("input", {
        className: "gloss-search",
        type: "text",
        placeholder: "Search terms... (e.g. rug, FOMO, liquidity)",
        value: glossSearch,
        onChange: e => setGlossSearch(e.target.value)
      })
    ),
    /* Category filters */
    React.createElement("div", { className: "gloss-cats" },
      [['all','üìö All'],['trading','üìä Trading'],['onchain','‚õìÔ∏è On-Chain'],['culture','üê∏ CT Culture'],['risk','üõ°Ô∏è Risk']].map(([id, label]) =>
        React.createElement("button", {
          key: id,
          className: `gloss-cat ${glossCat === id ? 'active' : ''}`,
          onClick: () => setGlossCat(id)
        }, label)
      )
    ),
    /* Term count */
    React.createElement("div", { style: { fontSize: '0.75rem', color: 'var(--text-secondary)', marginBottom: '10px' } },
      (() => {
        const filtered = GLOSSARY.filter(g => 
          (glossCat === 'all' || g.cat === glossCat) &&
          (glossSearch === '' || g.t.toLowerCase().includes(glossSearch.toLowerCase()) || g.d.toLowerCase().includes(glossSearch.toLowerCase()))
        );
        return filtered.length + ' term' + (filtered.length !== 1 ? 's' : '');
      })()
    ),
    /* Terms list */
    GLOSSARY.filter(g => 
      (glossCat === 'all' || g.cat === glossCat) &&
      (glossSearch === '' || g.t.toLowerCase().includes(glossSearch.toLowerCase()) || g.d.toLowerCase().includes(glossSearch.toLowerCase()))
    ).map((g, i) =>
      React.createElement("div", {
        key: g.t,
        className: `gloss-item ${glossTip && glossTip.term === g.t ? 'open' : ''}`,
        onClick: () => setGlossTip(glossTip && glossTip.term === g.t ? null : { term: g.t, def: g.d, inline: true })
      },
        React.createElement("div", { className: "gloss-term" },
          React.createElement("span", { className: "gloss-word" }, g.t),
          React.createElement("span", { className: "gloss-tag" },
            g.cat === 'trading' ? 'üìä' : g.cat === 'onchain' ? '‚õìÔ∏è' : g.cat === 'culture' ? 'üê∏' : 'üõ°Ô∏è'
          )
        ),
        React.createElement("div", { className: "gloss-def" },
          React.createElement("div", null, g.d),
          g.ex && React.createElement("div", { className: "gloss-example" }, g.ex)
        )
      )
    ),
    /* No results */
    GLOSSARY.filter(g => 
      (glossCat === 'all' || g.cat === glossCat) &&
      (glossSearch === '' || g.t.toLowerCase().includes(glossSearch.toLowerCase()) || g.d.toLowerCase().includes(glossSearch.toLowerCase()))
    ).length === 0 && React.createElement("div", { style: { textAlign: 'center', padding: '30px', color: 'var(--text-secondary)' } },
      "No terms found. Try a different search."
    )
  )

  ), toast && /*#__PURE__*/React.createElement(Toast, {
    message: toast.message,
    type: toast.type,
    onClose: () => setToast(null)
  }), xpPopup && /*#__PURE__*/React.createElement(XPGainPopup, {
    xp: xpPopup.xp,
    reason: xpPopup.reason,
    onClose: () => setXPPopup(null)
  }), showWeeklyReport && /*#__PURE__*/React.createElement(WeeklyReportModal, {
    user: user,
    traderProfile: traderProfile,
    onClose: () => setShowWeeklyReport(false)
  }), showXPTable && /*#__PURE__*/React.createElement(XPTableModal, {
    onClose: () => setShowXPTable(false)
  }), tutorialStep >= 0 && /*#__PURE__*/React.createElement(TutorialOverlay, {
    step: tutorialStep,
    onNext: () => setTutorialStep(s => s >= 7 ? -1 : s + 1),
    onSkip: () => setTutorialStep(-1)
  }),
  /* ‚îÄ‚îÄ GLOSSARY TOOLTIP (floating ‚Äî from flag clicks only) ‚îÄ‚îÄ */
  glossTip && !glossTip.inline && React.createElement(React.Fragment, null,
    React.createElement("div", {
      style: { position: 'fixed', inset: 0, zIndex: 2499 },
      onClick: () => setGlossTip(null)
    }),
    React.createElement("div", {
      className: "term-tooltip",
      style: { left: glossTip.x + 'px', top: Math.min(glossTip.y || 200, window.innerHeight - 150) + 'px' }
    },
      React.createElement("button", { className: "tt-close", onClick: () => setGlossTip(null) }, "‚úï"),
      React.createElement("div", { className: "tt-word" }, glossTip.term),
      React.createElement("div", { className: "tt-def" }, glossTip.def)
    )
  ),
  /* ‚îÄ‚îÄ STARTER FLOW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  starterFlow >= 0 && (() => {
    const skipAll = () => { setStarterFlow(-1); localStorage.setItem('helmStarterDone', '1'); };
    const dots = (current, total) => React.createElement("div", { className: "sf-steps" },
      Array.from({ length: total }, (_, i) => React.createElement("div", {
        key: i,
        className: `sf-dot ${i === current ? 'active' : i < current ? 'done' : ''}`
      }))
    );

    // Step 0: Welcome
    if (starterFlow === 0) {
      return React.createElement("div", { className: "sf-overlay" },
        React.createElement("div", { className: "sf-backdrop" }),
        React.createElement("div", { className: "sf-card" },
          React.createElement("div", { className: "sf-icon" }, "‚ò∏Ô∏è"),
          React.createElement("div", { className: "sf-title" }, "Welcome to HELM!"),
          React.createElement("div", { className: "sf-desc" },
            "You have ", React.createElement("strong", null, "5 SOL"), " of paper money to trade Solana memecoins. ",
            "Let's make your first trade together ‚Äî I'll walk you through it step by step."
          ),
          React.createElement("div", { className: "sf-highlight-box" },
            React.createElement("div", { className: "sf-flag sf-flag-green" }, "‚úÖ Analyze tokens with live data from DexScreener"),
            React.createElement("div", { className: "sf-flag sf-flag-green" }, "‚úÖ Practice entries, DCA, and partial exits"),
            React.createElement("div", { className: "sf-flag sf-flag-green" }, "‚úÖ Track your P&L, XP, and global ranking"),
            React.createElement("div", { className: "sf-flag sf-flag-green" }, "‚úÖ No real money at risk ‚Äî ever")
          ),
          dots(0, 4),
          React.createElement("button", {
            className: "sf-btn sf-btn-primary",
            onClick: () => setStarterFlow(1)
          }, "üöÄ Let's Go!"),
          React.createElement("button", {
            className: "sf-btn-skip",
            onClick: skipAll
          }, "I know what I'm doing ‚Äî skip")
        )
      );
    }

    // Step 1: Analyze prompt (token is pre-filled)
    if (starterFlow === 1 && !analysis) {
      return React.createElement("div", { className: "sf-overlay" },
        React.createElement("div", { className: "sf-backdrop" }),
        React.createElement("div", { className: "sf-card", style: { maxWidth: '380px' } },
          dots(1, 4),
          React.createElement("div", { className: "sf-icon", style: { fontSize: '2rem' } }, "üîç"),
          React.createElement("div", { className: "sf-title", style: { fontSize: '1.1rem' } }, "Your First Analysis"),
          React.createElement("div", { className: "sf-desc" },
            "I've loaded ", React.createElement("span", { className: "sf-token-pill" }, "üöÄ PUMP"),
            " for you ‚Äî the native token of pump.fun, Solana's biggest memecoin launchpad."
          ),
          React.createElement("div", { className: "sf-desc", style: { fontSize: '0.8rem' } },
            "HELM will fetch live data from DexScreener, analyze red/green flags, holders, volume, and more."
          ),
          React.createElement("button", {
            className: "sf-btn sf-btn-primary",
            disabled: loading,
            onClick: starterAnalyze
          }, loading ? "‚è≥ Analyzing..." : "üîç Analyze PUMP"),
          React.createElement("button", {
            className: "sf-btn-skip",
            onClick: skipAll
          }, "Skip tutorial")
        )
      );
    }

    // Step 2: Analysis loaded ‚Äî explain flags + prompt APE
    if (starterFlow === 2) {
      const greens = analysis?.greenFlags?.length || 0;
      const reds = analysis?.redFlags?.length || 0;
      return React.createElement("div", { className: "sf-overlay", style: { alignItems: 'flex-end', paddingBottom: '100px', pointerEvents: 'none' } },
        React.createElement("div", { className: "sf-backdrop", style: { background: 'rgba(0,0,0,0.45)', pointerEvents: 'none' } }),
        React.createElement("div", { className: "sf-card", style: { maxWidth: '380px', pointerEvents: 'auto' } },
          dots(2, 4),
          React.createElement("div", { className: "sf-icon", style: { fontSize: '2rem' } }, "üìä"),
          React.createElement("div", { className: "sf-title", style: { fontSize: '1.1rem' } }, "Read the Analysis"),
          React.createElement("div", { className: "sf-desc" },
            "HELM found ",
            React.createElement("strong", { style: { color: 'var(--success)' } }, greens, " green flag", greens !== 1 ? 's' : ''),
            " and ",
            React.createElement("strong", { style: { color: 'var(--danger)' } }, reds, " red flag", reds !== 1 ? 's' : ''),
            ". Green flags = bullish signals. Red flags = warnings."
          ),
          React.createElement("div", { className: "sf-highlight-box", style: { fontSize: '0.82rem' } },
            React.createElement("div", null, "üü¢ ", React.createElement("strong", null, "Green:"), " High volume, strong holders, growing community"),
            React.createElement("div", { style: { marginTop: '4px' } }, "üî¥ ", React.createElement("strong", null, "Red:"), " Low liquidity, whale concentration, snipers")
          ),
          React.createElement("div", { className: "sf-desc", style: { fontWeight: '600', color: 'var(--text-primary)', marginBottom: '12px' } },
            "Scroll down and hit ", React.createElement("span", { style: { color: 'var(--success)' } }, "üöÄ APE"),
            " to enter your first position with 0.1 SOL!"
          ),
          React.createElement("button", {
            className: "sf-btn sf-btn-primary",
            onClick: () => setStarterFlow(3),
            style: { fontSize: '0.85rem', padding: '11px' }
          }, "Got it! üëç"),
          React.createElement("button", {
            className: "sf-btn-skip",
            onClick: skipAll
          }, "Skip tutorial")
        )
      );
    }

    // Step 3: Waiting for user to APE (subtle reminder)
    if (starterFlow === 3) {
      return React.createElement("div", {
        style: {
          position: 'fixed', bottom: '80px', left: '50%', transform: 'translateX(-50%)',
          zIndex: 2001, background: 'var(--bg-card)', border: '1px solid var(--accent)',
          borderRadius: '12px', padding: '12px 20px', boxShadow: '0 8px 30px rgba(0,0,0,0.4)',
          display: 'flex', alignItems: 'center', gap: '10px', animation: 'sfSlideUp 0.3s ease',
          maxWidth: '340px'
        }
      },
        React.createElement("span", { style: { fontSize: '1.3rem' } }, "üëá"),
        React.createElement("span", { style: { fontSize: '0.82rem', color: 'var(--text-secondary)' } },
          "Scroll down and tap ",
          React.createElement("strong", { style: { color: 'var(--success)' } }, "üöÄ APE"),
          " to buy!"
        ),
        React.createElement("button", {
          onClick: skipAll,
          style: { background: 'none', border: 'none', color: 'var(--text-secondary)', cursor: 'pointer', fontSize: '1rem', padding: '0 0 0 8px' }
        }, "‚úï")
      );
    }

    // Step 4: Congrats!
    if (starterFlow === 4) {
      return React.createElement("div", { className: "sf-overlay" },
        React.createElement("div", { className: "sf-backdrop" }),
        React.createElement("div", { className: "sf-card" },
          React.createElement("div", { className: "sf-icon" }, "üéâ"),
          React.createElement("div", { className: "sf-title" }, "First Trade Done!"),
          React.createElement("div", { className: "sf-desc" },
            "You just opened your first paper position! Here's what you can do next:"
          ),
          React.createElement("div", { className: "sf-highlight-box", style: { textAlign: 'left' } },
            React.createElement("div", { className: "sf-flag" }, "üìà ", React.createElement("span", null, "Update price to see live P&L")),
            React.createElement("div", { className: "sf-flag" }, "üìâ ", React.createElement("span", null, "DCA if the price drops ‚Äî average down")),
            React.createElement("div", { className: "sf-flag" }, "üí∞ ", React.createElement("span", null, "Partial Sell to take some profits")),
            React.createElement("div", { className: "sf-flag" }, "üéØ ", React.createElement("span", null, "Close Position when ready ‚Äî pick a sell reason")),
            React.createElement("div", { className: "sf-flag" }, "üèÜ ", React.createElement("span", null, "Check Rankings to compete with other traders"))
          ),
          dots(3, 4),
          React.createElement("button", {
            className: "sf-btn sf-btn-primary",
            onClick: skipAll
          }, "Let's Trade! üöÄ"),
          React.createElement("div", {
            style: { marginTop: '12px', fontSize: '0.75rem', color: 'var(--text-secondary)' }
          }, "Tip: You can restart the tutorial anytime from ‚öôÔ∏è Settings")
        )
      );
    }

    return null;
  })(), buyModal?.type === 'ape' && /*#__PURE__*/React.createElement(ApeModal, {
    analysis: analysis,
    balance: user?.balance || 0,
    onConfirm: confirmApe,
    onClose: () => setBuyModal(null)
  }), buyModal?.type === 'dca' && /*#__PURE__*/React.createElement(DCAModal, {
    trade: buyModal.trade,
    balance: user?.balance || 0,
    onConfirm: confirmDCA,
    onClose: () => setBuyModal(null)
  }), buyModal?.type === 'partial' && /*#__PURE__*/React.createElement(PartialModal, {
    trade: buyModal.trade,
    onConfirm: confirmPartialSell,
    onClose: () => setBuyModal(null)
  }), closeModal && /*#__PURE__*/React.createElement(CloseModal, {
    trade: closeModal,
    onConfirm: confirmCloseTrade,
    onClose: () => setCloseModal(null)
  }), portfolioModal && /*#__PURE__*/React.createElement(TradeInfoModal, {
    trade: portfolioModal,
    onClose: () => setPortfolioModal(null)
  }), showBankrupt && !showMissions && /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.92)',
      zIndex: 1100,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '20px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '20px',
      maxWidth: '400px',
      width: '100%',
      border: '1px solid var(--danger)',
      boxShadow: '0 0 40px rgba(239,68,68,0.3)',
      padding: '32px',
      textAlign: 'center'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '4rem',
      marginBottom: '12px'
    }
  }, "\uD83D\uDCB8"), /*#__PURE__*/React.createElement("h2", {
    style: {
      color: 'var(--danger)',
      marginBottom: '8px',
      fontSize: '1.5rem'
    }
  }, "Bankrupt!"), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.9rem',
      marginBottom: '28px',
      lineHeight: 1.6
    }
  }, "You ran out of SOL.", /*#__PURE__*/React.createElement("br", null), "Earn ", /*#__PURE__*/React.createElement("strong", {
    style: {
      color: 'var(--success)'
    }
  }, "+", REWARD_SOL, " SOL"), " to keep trading."), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      flexDirection: 'column',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: startWatchAd,
    disabled: adWatching || getAdsToday() >= MAX_ADS_PER_DAY,
    style: {
      padding: '14px',
      fontSize: '1rem',
      fontWeight: 'bold',
      background: 'linear-gradient(135deg,#f59e0b,#d97706)',
      border: 'none',
      borderRadius: '12px',
      color: 'white',
      cursor: 'pointer',
      opacity: adWatching || getAdsToday() >= MAX_ADS_PER_DAY ? 0.5 : 1
    }
  }, adWatching ? `üì∫ Watching ad... ${adTimer}s` : getAdsToday() >= MAX_ADS_PER_DAY ? `üì∫ Ads limit reached (${MAX_ADS_PER_DAY}/day)` : `üì∫ Watch Ad  ‚Üí  +${REWARD_SOL} SOL`), /*#__PURE__*/React.createElement("button", {
    onClick: () => setShowMissions(true),
    style: {
      padding: '14px',
      fontSize: '1rem',
      fontWeight: 'bold',
      background: 'linear-gradient(135deg,#3b82f6,#8b5cf6)',
      border: 'none',
      borderRadius: '12px',
      color: 'white',
      cursor: 'pointer'
    }
  }, "\uD83D\uDCCB Complete a Mission  \u2192  +", REWARD_SOL, " SOL")), getAdsToday() > 0 && /*#__PURE__*/React.createElement("p", {
    style: {
      marginTop: '16px',
      fontSize: '0.75rem',
      color: 'var(--text-secondary)'
    }
  }, getAdsToday(), "/", MAX_ADS_PER_DAY, " ads watched today"))), showMissions && /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.92)',
      zIndex: 1100,
      display: 'flex',
      alignItems: 'flex-start',
      justifyContent: 'center',
      padding: '16px',
      overflowY: 'auto'
    },
    onClick: () => setShowMissions(false)
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '20px',
      maxWidth: '460px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
      marginTop: '20px'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '18px 22px',
      borderBottom: '1px solid var(--border)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'space-between'
    }
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '1.05rem'
    }
  }, "\uD83D\uDCCB Daily Missions"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.75rem',
      color: 'var(--text-secondary)',
      marginTop: '2px'
    }
  }, "Complete missions to earn SOL")), /*#__PURE__*/React.createElement("button", {
    onClick: () => setShowMissions(false),
    style: {
      margin: 0,
      padding: '5px 10px',
      fontSize: '0.82rem',
      background: 'transparent',
      border: '1px solid var(--border)'
    }
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '14px',
      borderRadius: '12px',
      marginBottom: '10px',
      background: 'rgba(245,158,11,0.08)',
      border: `1px solid ${getAdsToday() >= MAX_ADS_PER_DAY ? 'var(--border)' : 'rgba(245,158,11,0.4)'}`
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '12px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '1.6rem'
    }
  }, "\uD83D\uDCFA"), /*#__PURE__*/React.createElement("div", {
    style: {
      flex: 1
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Watch an Ad"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      color: 'var(--text-secondary)'
    }
  }, "Support the platform \xB7 15 seconds"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.72rem',
      color: 'var(--text-secondary)',
      marginTop: '2px'
    }
  }, getAdsToday(), "/", MAX_ADS_PER_DAY, " today")), /*#__PURE__*/React.createElement("button", {
    onClick: startWatchAd,
    disabled: adWatching || getAdsToday() >= MAX_ADS_PER_DAY,
    style: {
      margin: 0,
      padding: '8px 14px',
      fontSize: '0.82rem',
      fontWeight: 'bold',
      background: getAdsToday() >= MAX_ADS_PER_DAY ? 'var(--bg-secondary)' : '#f59e0b',
      border: 'none',
      borderRadius: '8px',
      color: getAdsToday() >= MAX_ADS_PER_DAY ? 'var(--text-secondary)' : '#000',
      cursor: 'pointer',
      whiteSpace: 'nowrap',
      opacity: adWatching ? 0.6 : 1
    }
  }, adWatching ? `${adTimer}s...` : getAdsToday() >= MAX_ADS_PER_DAY ? 'Limit' : '‚ñ∂ Watch'))), MISSIONS.map(m => {
    const done = isMissionDone(m.id);
    return /*#__PURE__*/React.createElement("div", {
      key: m.id,
      style: {
        padding: '14px',
        borderRadius: '12px',
        marginBottom: '8px',
        background: done ? 'rgba(16,185,129,0.06)' : 'var(--bg-primary)',
        border: `1px solid ${done ? 'rgba(16,185,129,0.3)' : 'var(--border)'}`
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '12px'
      }
    }, /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '1.5rem',
        opacity: done ? 0.5 : 1
      }
    }, m.icon), /*#__PURE__*/React.createElement("div", {
      style: {
        flex: 1
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.88rem',
        color: done ? 'var(--text-secondary)' : 'var(--text-primary)',
        textDecoration: done ? 'line-through' : 'none'
      }
    }, m.label), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, m.desc)), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right',
        flexShrink: 0
      }
    }, done ? /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.82rem',
        color: 'var(--success)',
        fontWeight: 'bold'
      }
    }, "\u2713 Done") : /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.82rem',
        color: 'var(--success)',
        fontWeight: 'bold'
      }
    }, "+", m.reward, " SOL"))));
  })), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '12px 22px',
      borderTop: '1px solid var(--border)',
      textAlign: 'center'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => setShowMissions(false),
    style: {
      margin: 0,
      padding: '10px 28px',
      fontSize: '0.9rem',
      background: 'var(--bg-secondary)',
      border: '1px solid var(--border)',
      borderRadius: '10px'
    }
  }, "Close")))), chartTrade && /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.9)',
      zIndex: 1001,
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: () => setChartTrade(null)
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      width: '100%',
      maxWidth: '900px',
      background: 'var(--bg-card)',
      borderRadius: '16px',
      border: '1px solid var(--border)',
      overflow: 'hidden',
      display: 'flex',
      flexDirection: 'column'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'space-between',
      padding: '14px 18px',
      borderBottom: '1px solid var(--border)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontWeight: 'bold',
      fontSize: '1rem'
    }
  }, "\uD83D\uDCCA ", chartTrade.tokenSymbol), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.75rem',
      color: 'var(--text-secondary)',
      fontFamily: 'monospace'
    }
  }, chartTrade.tokenAddress?.slice(0, 8), "...", chartTrade.tokenAddress?.slice(-6))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      alignItems: 'center'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => window.open(`https://dexscreener.com/solana/${chartTrade.tokenAddress}`, '_blank'),
    style: {
      margin: 0,
      padding: '5px 10px',
      fontSize: '0.75rem',
      background: 'rgba(16,185,129,0.15)',
      border: '1px solid var(--success)',
      color: 'var(--success)',
      borderRadius: '6px'
    }
  }, "\u2197 DexScreener"), /*#__PURE__*/React.createElement("button", {
    onClick: () => setChartTrade(null),
    style: {
      margin: 0,
      padding: '5px 10px',
      fontSize: '0.82rem',
      background: 'transparent',
      border: '1px solid var(--border)'
    }
  }, "\u2715"))), /*#__PURE__*/React.createElement("iframe", {
    src: `https://dexscreener.com/solana/${chartTrade.tokenAddress}?embed=1&theme=dark&trades=1&info=0`,
    style: {
      width: '100%',
      height: '500px',
      border: 'none',
      display: 'block'
    },
    title: "DexScreener Chart",
    allow: "clipboard-write"
  })), /*#__PURE__*/React.createElement("div", {
    style: {
      marginTop: '10px',
      fontSize: '0.75rem',
      color: 'rgba(255,255,255,0.3)'
    }
  }, "Click outside to close"))));
}
ReactDOM.render(
  /*#__PURE__*/React.createElement(AuthWrapper, null,
    /*#__PURE__*/React.createElement(HelmApp, null)
  ),
  document.getElementById('root')
);

</script>
</body>
</html>
