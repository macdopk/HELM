<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öì HELM - Navigate memecoin chaos</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --accent: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --purple: #a855f7;
            --gold: #fbbf24;
            --border: rgba(148, 163, 184, 0.2);
        }
        
        body.light-theme {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-hover: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border: rgba(0,0,0,0.1);
        }
        
        body.neon-theme {
            --bg-primary: #0a0014;
            --bg-secondary: #1a0033;
            --bg-card: #2d1b4e;
            --bg-hover: #3d2b5e;
            --text-primary: #ffffff;
            --text-secondary: #e9d5ff;
            --accent: #ff00ff;
            --success: #00ff88;
            --danger: #ff0066;
            --warning: #ffcc00;
            --border: rgba(255,0,255,0.3);
        }

        body {
            font-family: -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes levelUp {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes badgeUnlock {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .fade-in { animation: fadeIn 0.3s ease; }
        .slide-in { animation: slideIn 0.3s ease; }
        .level-up { animation: levelUp 0.5s ease; }
        .badge-unlock { animation: badgeUnlock 0.6s ease; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header {
            padding: 20px;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--accent);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .logo { 
            font-size: 2rem; 
            font-weight: bold;
            background: linear-gradient(135deg, var(--accent), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .tagline { color: var(--text-secondary); font-size: 0.9rem; }
        
        .card {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin: 20px 0;
            transition: all 0.3s ease;
            animation: fadeIn 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        button {
            padding: 12px 24px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin: 5px;
            transition: all 0.2s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        button.success { background: var(--success); }
        button.danger { background: var(--danger); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
        
        .loading { animation: pulse 1.5s ease-in-out infinite; }
        .spinner { display: inline-block; animation: spin 1s linear infinite; }

        input, textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            margin: 10px 0;
            transition: all 0.2s ease;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }
        
        .tab:hover { background: var(--bg-hover); transform: translateY(-2px); }
        .tab.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .stat-value { font-size: 2rem; font-weight: bold; color: var(--accent); margin-bottom: 5px; }
        .stat-label { color: var(--text-secondary); font-size: 0.9rem; }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 16px 24px;
            border-radius: 8px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            min-width: 300px;
        }
        
        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }
        
        /* GAMIFICATION STYLES */
        .xp-bar-container {
            width: 100%;
            height: 20px;
            background: var(--bg-primary);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--border);
            margin: 10px 0;
        }
        
        .xp-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--purple));
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .level-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--purple), var(--accent));
            border-radius: 20px;
            font-weight: bold;
            font-size: 1rem;
        }
        
        .badge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .badge-item {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .badge-item.unlocked {
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }
        
        .badge-item.locked {
            opacity: 0.4;
            filter: grayscale(1);
        }
        
        .badge-item:hover {
            transform: scale(1.05);
        }
        
        .badge-icon {
            font-size: 3rem;
            margin-bottom: 8px;
        }
        
        .badge-name {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
        
        .badge-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .streak-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .xp-gain-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid var(--gold);
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.5);
            z-index: 10001;
            animation: levelUp 0.5s ease;
            text-align: center;
        }
        
        .theme-selector {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .theme-selector:hover { background: var(--bg-hover); }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           MOBILE RESPONSIVE ‚Äî 768px and below
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        @media (max-width: 768px) {
          .header { padding: 10px 14px; margin-bottom: 10px; }
          .header .logo { font-size: 1.2rem; }
          .tabs {
            gap: 5px; margin: 10px 0;
            overflow-x: auto; flex-wrap: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; padding-bottom: 2px;
          }
          .tabs::-webkit-scrollbar { display: none; }
          .tab { padding: 8px 12px; font-size: 0.78rem; white-space: nowrap; flex-shrink: 0; }
          .container { padding: 10px 12px; }
          .card { padding: 14px; margin: 10px 0; }
          input[type="text"], input[type="number"] { font-size: 16px !important; }
          .toast { left: 10px !important; right: 10px !important; max-width: calc(100% - 20px) !important; }
        }
        @media (max-width: 390px) {
          .header .logo { font-size: 1.05rem; }
          .tab { padding: 7px 9px; font-size: 0.72rem; }
          .card { padding: 11px; }
        }
    
    </style>
</head>
<body>
    <div id="root"></div>

    <script>

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELM SUPABASE STORAGE ADAPTER
// Replace SUPABASE_URL and SUPABASE_ANON_KEY with your project values
// Get them from: https://supabase.com/dashboard ‚Üí your project ‚Üí Settings ‚Üí API
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SUPABASE_URL = 'YOUR_SUPABASE_URL'; // e.g. https://xxxx.supabase.co
const SUPABASE_KEY = 'YOUR_SUPABASE_ANON_KEY'; // public anon key

const hasSupabaseConfig = () => {
  const hasUrl = SUPABASE_URL && SUPABASE_URL !== 'YOUR_SUPABASE_URL';
  const hasKey = SUPABASE_KEY && SUPABASE_KEY !== 'YOUR_SUPABASE_ANON_KEY';
  return hasUrl && hasKey;
};

const supabaseHeaders = (extra = {}) => ({
  apikey: SUPABASE_KEY,
  Authorization: 'Bearer ' + SUPABASE_KEY,
  ...extra
});

const supabaseRequest = async (path, options = {}) => {
  const response = await fetch(`${SUPABASE_URL}/rest/v1/${path}`, {
    ...options,
    headers: supabaseHeaders(options.headers || {})
  });

  if (!response.ok) {
    throw new Error(`Supabase request failed (${response.status})`);
  }

  return response;
};

const helmStorage = {
  // SET key/value ‚Äî shared=true goes to Supabase, false goes to localStorage
  set: async (key, value, shared = false) => {
    const v = typeof value === 'string' ? value : JSON.stringify(value);

    if (shared && hasSupabaseConfig()) {
      await supabaseRequest('helm_storage', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Prefer: 'resolution=merge-duplicates'
        },
        body: JSON.stringify({ key, value: v, updated_at: new Date().toISOString() })
      });
    } else {
      localStorage.setItem(key, v);
    }

    return { key, value: v };
  },

  // GET key ‚Äî shared=true reads from Supabase, false from localStorage
  get: async (key, shared = false) => {
    if (shared && hasSupabaseConfig()) {
      const response = await supabaseRequest(
        `helm_storage?key=eq.${encodeURIComponent(key)}&select=key,value`
      );
      const rows = await response.json();

      if (!rows.length) {
        throw new Error('Key not found: ' + key);
      }

      return { key, value: rows[0].value };
    }

    const v = localStorage.getItem(key);

    if (v === null) {
      throw new Error('Key not found: ' + key);
    }

    return { key, value: v };
  },

  // LIST keys by prefix ‚Äî shared=true reads from Supabase
  list: async (prefix = '', shared = false) => {
    if (shared && hasSupabaseConfig()) {
      const response = await supabaseRequest(
        `helm_storage?key=like.${encodeURIComponent(prefix + '%')}&select=key&order=updated_at.desc&limit=200`
      );
      const rows = await response.json();
      return { keys: rows.map(r => r.key), prefix };
    }

    return { keys: Object.keys(localStorage).filter(k => k.startsWith(prefix)), prefix };
  },

  // DELETE key
  delete: async (key, shared = false) => {
    if (shared && hasSupabaseConfig()) {
      await supabaseRequest(`helm_storage?key=eq.${encodeURIComponent(key)}`, {
        method: 'DELETE'
      });
    } else {
      localStorage.removeItem(key);
    }

    return { key, deleted: true };
  }
};

// Expose as window.storage so the rest of the app uses it transparently
window.storage = helmStorage;
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const {
  useState,
  useEffect,
  useRef
} = React;

// GAMIFICATION CONSTANTS
const XP_TYPES = {
  HOT_STREAK_3: 200,
  HOT_STREAK_5: 500,
  HOT_STREAK_10: 1000
};

// XP based on P&L ‚Äî bigger profit = more XP; losses reduce XP
const calcXPFromPnL = pnlSOL => {
  if (pnlSOL > 0) {
    if (pnlSOL >= 5.0) return 500;
    if (pnlSOL >= 2.0) return 300;
    if (pnlSOL >= 1.0) return 150;
    if (pnlSOL >= 0.5) return 75;
    if (pnlSOL >= 0.1) return 25;
    return 10;
  } else if (pnlSOL < 0) {
    const loss = Math.abs(pnlSOL);
    if (loss >= 5.0) return -500;
    if (loss >= 2.0) return -300;
    if (loss >= 1.0) return -150;
    if (loss >= 0.5) return -75;
    if (loss >= 0.1) return -25;
    return -10;
  }
  return 0;
};
const ALL_BADGES = {
  first_trade: {
    icon: 'üéØ',
    name: 'First Trade',
    desc: 'Made first trade'
  },
  first_profit: {
    icon: 'üí∞',
    name: 'First Win',
    desc: 'First profitable trade'
  },
  hot_streak_3: {
    icon: 'üî•',
    name: 'Hat Trick',
    desc: '3 wins in a row'
  },
  hot_streak_5: {
    icon: 'üî•üî•',
    name: 'On Fire',
    desc: '5 wins in a row'
  },
  hot_streak_10: {
    icon: 'üî•üî•üî•',
    name: 'Unstoppable',
    desc: '10 wins in a row!'
  },
  win_rate_50: {
    icon: 'ü•â',
    name: 'Bronze',
    desc: '50% win rate (10+ trades)'
  },
  win_rate_60: {
    icon: 'ü•à',
    name: 'Silver',
    desc: '60% win rate (10+ trades)'
  },
  win_rate_70: {
    icon: 'ü•á',
    name: 'Gold',
    desc: '70% win rate (10+ trades)'
  },
  win_rate_80: {
    icon: 'üíé',
    name: 'Diamond',
    desc: '80% win rate (10+ trades)'
  },
  analyst: {
    icon: 'üîç',
    name: 'Analyst',
    desc: '10+ tokens analyzed'
  },
  trader_10: {
    icon: 'üìä',
    name: 'Active',
    desc: '10 total trades'
  },
  trader_50: {
    icon: 'üìà',
    name: 'Experienced',
    desc: '50 total trades'
  },
  trader_100: {
    icon: 'üöÄ',
    name: 'Pro',
    desc: '100 total trades'
  }
};
const LEVELS = [{
  level: 1,
  xp: 0,
  name: 'Newbie',
  icon: 'üå±'
}, {
  level: 2,
  xp: 100,
  name: 'Beginner',
  icon: 'üìö'
}, {
  level: 3,
  xp: 300,
  name: 'Learning',
  icon: 'üéØ'
}, {
  level: 4,
  xp: 600,
  name: 'Trader',
  icon: 'üìä'
}, {
  level: 5,
  xp: 1000,
  name: 'Skilled',
  icon: 'üí™'
}, {
  level: 6,
  xp: 1500,
  name: 'Advanced',
  icon: 'üî•'
}, {
  level: 7,
  xp: 2200,
  name: 'Expert',
  icon: '‚ö°'
}, {
  level: 8,
  xp: 3000,
  name: 'Pro',
  icon: 'üíé'
}, {
  level: 9,
  xp: 4000,
  name: 'Master',
  icon: 'üëë'
}, {
  level: 10,
  xp: 5500,
  name: 'Legend',
  icon: 'üèÜ'
}];

// Toast Component
function Toast({
  message,
  type = 'success',
  onClose
}) {
  const duration = type === 'info' ? 7000 : 3000;
  useEffect(() => {
    const timer = setTimeout(onClose, duration);
    return () => clearTimeout(timer);
  }, []);
  return /*#__PURE__*/React.createElement("div", {
    className: `toast ${type}`,
    onClick: onClose,
    style: type === 'info' ? {
      maxWidth: '360px', lineHeight: '1.5', fontSize: '0.82rem',
      background: 'linear-gradient(135deg,rgba(59,130,246,0.25),rgba(139,92,246,0.25))',
      border: '1px solid rgba(139,92,246,0.5)', cursor: 'pointer', padding: '14px 16px'
    } : {}
  },
    type === 'success' && '‚úÖ ',
    type === 'error' && '‚ùå ',
    type === 'warning' && '‚ö†Ô∏è ',
    message,
    type === 'info' && /*#__PURE__*/React.createElement("div", {style:{fontSize:'0.72rem',opacity:0.6,marginTop:'4px'}}, "Tap to dismiss")
  );
}

function XPGainPopup({
  xp,
  reason,
  onClose
}) {
  useEffect(() => {
    const timer = setTimeout(onClose, 2000);
    return () => clearTimeout(timer);
  }, []);
  const isLoss = xp < 0;
  return /*#__PURE__*/React.createElement("div", {
    className: "xp-gain-popup",
    style: {
      borderColor: isLoss ? 'var(--danger)' : 'var(--gold)',
      boxShadow: isLoss ? '0 0 40px rgba(239,68,68,0.4)' : '0 0 40px rgba(251,191,36,0.5)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '3rem',
      marginBottom: '10px'
    }
  }, isLoss ? 'üíî' : '‚ú®'), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2rem',
      fontWeight: 'bold',
      color: isLoss ? 'var(--danger)' : 'var(--gold)',
      marginBottom: '5px'
    }
  }, isLoss ? '' : '+', xp, " XP"), /*#__PURE__*/React.createElement("div", {
    style: {
      color: 'var(--text-secondary)'
    }
  }, reason));
}
function ApeModal({
  analysis,
  balance,
  onConfirm,
  onClose
}) {
  const [amt, setAmt] = React.useState('0.1');
  const [reason, setReason] = React.useState('');
  const [tab, setTab] = React.useState('ape'); // 'ape' | 'chart'
  const REASONS = [{
    id: 'FOMO',
    label: 'üî• FOMO'
  }, {
    id: 'KOL',
    label: 'üì¢ KOL CALL'
  }, {
    id: 'DEV',
    label: 'üõ†Ô∏è TRUSTED DEV'
  }, {
    id: 'COMMUNITY',
    label: 'üí™ STRONG COMMUNITY'
  }, {
    id: 'TECHNICAL',
    label: 'üìä TECHNICAL'
  }, {
    id: 'FUNDAMENTAL',
    label: 'üî¨ FUNDAMENTALS'
  }];
  const chartUrl = analysis?.address ? `https://dexscreener.com/solana/${analysis.address}?embed=1&theme=dark&trades=0&info=0` : null;
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.8)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      maxWidth: '520px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
      overflow: 'hidden'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      borderBottom: '1px solid var(--border)'
    }
  }, [['ape', 'üöÄ APE'], ['chart', 'üìä Chart']].map(([id, label]) => /*#__PURE__*/React.createElement("div", {
    key: id,
    onClick: () => setTab(id),
    style: {
      flex: 1,
      padding: '14px',
      textAlign: 'center',
      fontWeight: 'bold',
      fontSize: '0.9rem',
      cursor: 'pointer',
      transition: 'all 0.15s',
      background: tab === id ? 'rgba(59,130,246,0.1)' : 'transparent',
      color: tab === id ? 'var(--accent)' : 'var(--text-secondary)',
      borderBottom: tab === id ? '2px solid var(--accent)' : '2px solid transparent'
    }
  }, label))), tab === 'ape' && /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '28px'
    }
  }, /*#__PURE__*/React.createElement("h3", {
    style: {
      marginBottom: '4px'
    }
  }, "\uD83D\uDE80 APE em ", analysis?.symbol), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem',
      marginBottom: '20px'
    }
  }, "Available balance: ", /*#__PURE__*/React.createElement("strong", null, balance.toFixed(2), " SOL")), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '6px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Quantidade (SOL)"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      marginBottom: '12px'
    }
  }, ['0.05', '0.1', '0.25', '0.5'].map(v => /*#__PURE__*/React.createElement("button", {
    key: v,
    onClick: () => setAmt(v),
    style: {
      flex: 1,
      margin: 0,
      padding: '8px 4px',
      fontSize: '0.82rem',
      background: amt === v ? 'var(--accent)' : 'var(--bg-primary)',
      border: `1px solid ${amt === v ? 'var(--accent)' : 'var(--border)'}`,
      color: amt === v ? 'white' : 'var(--text-secondary)',
      borderRadius: '6px',
      cursor: 'pointer'
    }
  }, v))), /*#__PURE__*/React.createElement("input", {
    value: amt,
    onChange: e => setAmt(e.target.value),
    type: "number",
    step: "0.01",
    min: "0.01",
    style: {
      marginBottom: '20px'
    }
  }), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '10px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Why are you buying?"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '8px',
      marginBottom: '20px'
    }
  }, REASONS.map(r => /*#__PURE__*/React.createElement("div", {
    key: r.id,
    onClick: () => setReason(r.id),
    style: {
      padding: '10px',
      borderRadius: '10px',
      cursor: 'pointer',
      transition: 'all 0.15s',
      textAlign: 'center',
      fontWeight: 'bold',
      fontSize: '0.85rem',
      border: `2px solid ${reason === r.id ? 'var(--accent)' : 'var(--border)'}`,
      background: reason === r.id ? 'rgba(59,130,246,0.15)' : 'var(--bg-primary)',
      color: reason === r.id ? 'var(--accent)' : 'var(--text-primary)'
    }
  }, r.label))), (() => {
    const vol = analysis?.volume24h || 0;
    const slipPct = vol >= 5000000 ? 0.002 : vol >= 1000000 ? 0.005 : vol >= 500000 ? 0.008 : vol >= 100000 ? 0.012 : vol >= 50000 ? 0.018 : vol >= 10000 ? 0.025 : 0.04;
    const slipSOL = parseFloat(amt || 0) * slipPct;
    const tier = vol >= 5000000 ? 'High liq' : vol >= 100000 ? 'Medium liq' : vol >= 10000 ? 'Low liq' : 'Very low liq';
    const tc = vol >= 5000000 ? 'var(--success)' : vol >= 100000 ? 'var(--warning)' : 'var(--danger)';
    return /*#__PURE__*/React.createElement("div", {
      style: {
        background: 'rgba(239,68,68,0.08)',
        border: '1px solid rgba(239,68,68,0.2)',
        borderRadius: '10px',
        padding: '10px 14px',
        marginBottom: '12px',
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center'
      }
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.72rem',
        color: 'var(--text-secondary)',
        marginBottom: '2px'
      }
    }, "Est. slippage (buy)"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        color: 'var(--danger)',
        fontSize: '0.9rem'
      }
    }, "-", slipSOL.toFixed(4), " SOL ", /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.75rem',
        opacity: 0.7
      }
    }, "(", (slipPct * 100).toFixed(1), "%)"))), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.72rem',
        color: tc,
        fontWeight: 'bold'
      }
    }, tier), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.7rem',
        color: 'var(--text-secondary)'
      }
    }, "Vol: $", vol >= 1000000 ? (vol / 1e6).toFixed(1) + 'M' : vol >= 1000 ? (vol / 1000).toFixed(0) + 'k' : '<1k')));
  })(), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Cancel"), /*#__PURE__*/React.createElement("button", {
    onClick: () => reason && onConfirm(parseFloat(amt), reason),
    className: "success",
    style: {
      flex: 2,
      margin: 0,
      fontSize: '1rem',
      letterSpacing: '1px',
      opacity: reason ? 1 : 0.5,
      cursor: reason ? 'pointer' : 'not-allowed'
    }
  }, "\uD83D\uDE80 APE")), !reason && /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--warning)',
      fontSize: '0.78rem',
      textAlign: 'center',
      marginTop: '8px'
    }
  }, "Select a reason to continue")), tab === 'chart' && /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      flexDirection: 'column'
    }
  }, chartUrl ? /*#__PURE__*/React.createElement("iframe", {
    src: chartUrl,
    style: {
      width: '100%',
      height: '420px',
      border: 'none'
    },
    title: "DexScreener Chart"
  }) : /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '60px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, "No chart available"), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '16px',
      display: 'flex',
      gap: '10px',
      borderTop: '1px solid var(--border)'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Close"), /*#__PURE__*/React.createElement("button", {
    onClick: () => setTab('ape'),
    className: "success",
    style: {
      flex: 2,
      margin: 0
    }
  }, "\uD83D\uDE80 Go APE")))));
}
function DCAModal({
  trade,
  balance,
  onConfirm,
  onClose
}) {
  const [amt, setAmt] = React.useState('0.1');
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.8)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      padding: '28px',
      maxWidth: '380px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("h3", {
    style: {
      marginBottom: '6px'
    }
  }, "\uD83D\uDCC9 DCA \u2014 ", trade.tokenSymbol), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem',
      marginBottom: '4px'
    }
  }, "Avg price: ", /*#__PURE__*/React.createElement("strong", null, "$", trade.avgEntryPrice.toFixed(8))), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem',
      marginBottom: '20px'
    }
  }, "Balance: ", /*#__PURE__*/React.createElement("strong", null, balance.toFixed(2), " SOL")), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '8px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Add (SOL)"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      marginBottom: '12px'
    }
  }, ['0.05', '0.1', '0.25', '0.5'].map(v => /*#__PURE__*/React.createElement("button", {
    key: v,
    onClick: () => setAmt(v),
    style: {
      flex: 1,
      margin: 0,
      padding: '8px 4px',
      fontSize: '0.82rem',
      background: amt === v ? 'var(--accent)' : 'var(--bg-primary)',
      border: `1px solid ${amt === v ? 'var(--accent)' : 'var(--border)'}`,
      color: amt === v ? 'white' : 'var(--text-secondary)',
      borderRadius: '6px',
      cursor: 'pointer'
    }
  }, v))), /*#__PURE__*/React.createElement("input", {
    value: amt,
    onChange: e => setAmt(e.target.value),
    type: "number",
    step: "0.01",
    min: "0.01",
    style: {
      marginBottom: '20px'
    }
  }), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Cancel"), /*#__PURE__*/React.createElement("button", {
    onClick: () => onConfirm(parseFloat(amt), trade),
    className: "success",
    style: {
      flex: 2,
      margin: 0
    }
  }, "\uD83D\uDCC9 Confirm DCA"))));
}
function PartialModal({
  trade,
  onConfirm,
  onClose
}) {
  const [pct, setPct] = React.useState('50');
  const [sellReason, setSellReason] = React.useState('');
  const solAmt = (trade.totalInvested * (parseFloat(pct) || 0) / 100).toFixed(3);
  const SELL_REASONS = [{
    id: 'TARGET',
    label: 'üéØ PROFIT TARGET HIT'
  }, {
    id: 'STOPLOSS',
    label: 'üõë STOP LOSS'
  }];
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.8)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      padding: '28px',
      maxWidth: '380px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("h3", {
    style: {
      marginBottom: '6px'
    }
  }, "\uD83D\uDCCA Partial Sell \u2014 ", trade.tokenSymbol), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem',
      marginBottom: '20px'
    }
  }, "Position: ", /*#__PURE__*/React.createElement("strong", null, trade.totalInvested.toFixed(3), " SOL")), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '8px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "How much to sell?"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      marginBottom: '12px',
      flexWrap: 'wrap'
    }
  }, ['25', '50', '75', '100'].map(v => /*#__PURE__*/React.createElement("button", {
    key: v,
    onClick: () => setPct(v),
    style: {
      flex: 1,
      minWidth: '50px',
      margin: 0,
      padding: '10px 4px',
      fontSize: '0.9rem',
      fontWeight: 'bold',
      background: pct === v ? 'var(--warning)' : 'var(--bg-primary)',
      border: `1px solid ${pct === v ? 'var(--warning)' : 'var(--border)'}`,
      color: pct === v ? '#0f172a' : 'var(--text-secondary)',
      borderRadius: '6px',
      cursor: 'pointer'
    }
  }, v, "%"))), /*#__PURE__*/React.createElement("input", {
    value: pct,
    onChange: e => setPct(e.target.value),
    type: "number",
    step: "1",
    min: "1",
    max: "100",
    style: {
      marginBottom: '8px'
    }
  }), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.82rem',
      marginBottom: '20px'
    }
  }, "= ", /*#__PURE__*/React.createElement("strong", null, solAmt, " SOL"), " of position"), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '10px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Why are you selling?"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '8px',
      marginBottom: '20px'
    }
  }, SELL_REASONS.map(r => /*#__PURE__*/React.createElement("div", {
    key: r.id,
    onClick: () => setSellReason(r.id),
    style: {
      padding: '12px',
      borderRadius: '10px',
      cursor: 'pointer',
      transition: 'all 0.15s',
      textAlign: 'center',
      fontWeight: 'bold',
      fontSize: '0.85rem',
      border: `2px solid ${sellReason === r.id ? 'var(--warning)' : 'var(--border)'}`,
      background: sellReason === r.id ? 'rgba(245,158,11,0.15)' : 'var(--bg-primary)',
      color: sellReason === r.id ? 'var(--warning)' : 'var(--text-primary)'
    }
  }, r.label))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Cancel"), /*#__PURE__*/React.createElement("button", {
    onClick: () => sellReason && onConfirm(parseFloat(pct), trade, sellReason),
    className: "warning",
    style: {
      flex: 2,
      margin: 0,
      opacity: sellReason ? 1 : 0.5,
      cursor: sellReason ? 'pointer' : 'not-allowed'
    }
  }, "\uD83D\uDCCA Confirm Sell")), !sellReason && /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--warning)',
      fontSize: '0.78rem',
      textAlign: 'center',
      marginTop: '8px'
    }
  }, "Selecione o motivo para continuar")));
}
function CloseModal({
  trade,
  onConfirm,
  onClose
}) {
  const [sellReason, setSellReason] = React.useState('');

  // Determine if trade is currently in profit or loss based on currentPrice
  const cp = trade.currentPrice || trade.avgEntryPrice;
  const isProfit = cp >= trade.avgEntryPrice;

  // Reason categories: profit=true means only valid when in profit, profit=false only valid in loss, profit=null = always valid
  const SELL_REASONS = [{
    id: 'TAKE_PROFIT',
    label: 'üéØ Take Profit',
    profit: true,
    desc: 'Only available when in profit'
  }, {
    id: 'STOP_LOSS',
    label: 'üõë Stop Loss',
    profit: false,
    desc: 'Only available when in loss'
  }, {
    id: 'RUG',
    label: '‚ò†Ô∏è Rug / Scam',
    profit: null,
    desc: null
  }, {
    id: 'BAD_ENTRY',
    label: '‚ùå Bad Entry',
    profit: null,
    desc: null
  }, {
    id: 'NARRATIVE',
    label: 'üîÑ Narrative Changed',
    profit: null,
    desc: null
  }, {
    id: 'LIQUIDITY',
    label: 'üí∏ Need Liquidity',
    profit: null,
    desc: null
  }];
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.8)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      padding: '28px',
      maxWidth: '380px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("h3", {
    style: {
      marginBottom: '4px'
    }
  }, "\uD83D\uDCB0 Close Position \u2014 ", trade.tokenSymbol), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '10px',
      marginBottom: '20px'
    }
  }, /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem',
      margin: 0
    }
  }, "Full position: ", /*#__PURE__*/React.createElement("strong", null, trade.totalInvested.toFixed(3), " SOL")), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.75rem',
      padding: '2px 9px',
      borderRadius: '20px',
      fontWeight: 'bold',
      background: isProfit ? 'rgba(16,185,129,0.15)' : 'rgba(239,68,68,0.15)',
      color: isProfit ? 'var(--success)' : 'var(--danger)',
      border: `1px solid ${isProfit ? 'rgba(16,185,129,0.3)' : 'rgba(239,68,68,0.3)'}`
    }
  }, isProfit ? '‚ñ≤ Profit' : '‚ñº Loss')), /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '10px',
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Why are you exiting?"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '8px',
      marginBottom: '24px'
    }
  }, SELL_REASONS.map(r => {
    const disabled = r.profit === true ? !isProfit : r.profit === false ? isProfit : false;
    const selected = sellReason === r.id;
    return /*#__PURE__*/React.createElement("div", {
      key: r.id,
      onClick: () => !disabled && setSellReason(r.id),
      title: disabled ? r.desc : '',
      style: {
        padding: '12px 8px',
        borderRadius: '10px',
        cursor: disabled ? 'not-allowed' : 'pointer',
        transition: 'all 0.15s',
        textAlign: 'center',
        fontWeight: 'bold',
        fontSize: '0.85rem',
        opacity: disabled ? 0.35 : 1,
        border: `2px solid ${selected ? 'var(--accent)' : 'var(--border)'}`,
        background: selected ? 'rgba(59,130,246,0.15)' : 'var(--bg-primary)',
        color: selected ? 'var(--accent)' : disabled ? 'var(--text-secondary)' : 'var(--text-primary)',
        userSelect: 'none'
      }
    }, r.label);
  })), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Cancel"), /*#__PURE__*/React.createElement("button", {
    onClick: () => sellReason && onConfirm(trade.id, sellReason),
    className: "danger",
    style: {
      flex: 2,
      margin: 0,
      opacity: sellReason ? 1 : 0.5,
      cursor: sellReason ? 'pointer' : 'not-allowed'
    }
  }, "\uD83D\uDCB0 Close Position")), !sellReason && /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--warning)',
      fontSize: '0.78rem',
      textAlign: 'center',
      marginTop: '8px'
    }
  }, "Select a reason to continue")));
}
function TradeInfoModal({
  trade,
  onClose
}) {
  const cp = trade.currentPrice || trade.avgEntryPrice;
  const pc = (cp - trade.avgEntryPrice) / trade.avgEntryPrice * 100;
  const pPnl = (trade.partialExits || []).reduce((s, e) => s + e.pnl, 0);
  const uPnl = trade.totalInvested * (pc / 100);
  const tPnl = pPnl + uPnl;
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.8)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      padding: '24px',
      maxWidth: '440px',
      width: '100%',
      border: '1px solid var(--border)',
      maxHeight: '85vh',
      overflowY: 'auto',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'flex-start',
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    style: {
      fontSize: '1.3rem'
    }
  }, trade.tokenSymbol), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.85rem'
    }
  }, trade.tokenName)), /*#__PURE__*/React.createElement("div", {
    style: {
      textAlign: 'right'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '1.4rem',
      fontWeight: 'bold',
      color: tPnl >= 0 ? 'var(--success)' : 'var(--danger)'
    }
  }, tPnl >= 0 ? '+' : '', tPnl.toFixed(4), " SOL"), /*#__PURE__*/React.createElement("small", {
    style: {
      color: pc >= 0 ? 'var(--success)' : 'var(--danger)'
    }
  }, pc >= 0 ? '+' : '', pc.toFixed(2), "%"))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '10px',
      marginBottom: '16px'
    }
  }, [{
    label: 'Invested',
    val: `${trade.totalInvested.toFixed(4)} SOL`
  }, {
    label: 'Slippage',
    val: trade.slippageCost ? `-${((trade.slippageCost || 0) + (trade.exitSlipCost || 0)).toFixed(4)} SOL` : '‚Äî',
    color: 'var(--danger)'
  }, {
    label: 'Avg Price',
    val: `$${trade.avgEntryPrice.toFixed(8)}`
  }, {
    label: 'Current Price',
    val: `$${cp.toFixed(8)}`
  }, {
    label: 'Realizado',
    val: `${pPnl >= 0 ? '+' : ''}${pPnl.toFixed(4)} SOL`,
    color: pPnl >= 0 ? 'var(--success)' : 'var(--danger)'
  }].map(s => /*#__PURE__*/React.createElement("div", {
    key: s.label,
    style: {
      background: 'var(--bg-primary)',
      padding: '10px',
      borderRadius: '8px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.75rem',
      marginBottom: '3px'
    }
  }, s.label), /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '0.9rem',
      color: s.color || 'var(--text-primary)'
    }
  }, s.val)))), trade.buyReason && trade.buyReason !== '‚Äî' && /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'rgba(59,130,246,0.1)',
      border: '1px solid rgba(59,130,246,0.3)',
      borderRadius: '8px',
      padding: '10px',
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.78rem'
    }
  }, "Motivo da compra: "), /*#__PURE__*/React.createElement("strong", {
    style: {
      color: 'var(--accent)'
    }
  }, trade.buyReason)), trade.entries?.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '14px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.75rem',
      fontWeight: 'bold',
      marginBottom: '6px',
      textTransform: 'uppercase',
      letterSpacing: '1px'
    }
  }, "Entries"), trade.entries.map((e, i) => /*#__PURE__*/React.createElement("div", {
    key: i,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '7px 10px',
      background: 'var(--bg-primary)',
      borderRadius: '6px',
      marginBottom: '4px',
      fontSize: '0.82rem'
    }
  }, /*#__PURE__*/React.createElement("span", null, "#", i + 1, " \u2014 ", e.amountSOL.toFixed(3), " SOL"), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)'
    }
  }, "$", e.price.toFixed(8))))), (trade.partialExits || []).length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '14px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.75rem',
      fontWeight: 'bold',
      marginBottom: '6px',
      textTransform: 'uppercase',
      letterSpacing: '1px'
    }
  }, "Partial Exits"), trade.partialExits.map((e, i) => /*#__PURE__*/React.createElement("div", {
    key: i,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '7px 10px',
      background: 'var(--bg-primary)',
      borderRadius: '6px',
      marginBottom: '4px',
      fontSize: '0.82rem'
    }
  }, /*#__PURE__*/React.createElement("span", null, e.percentage, "% \u2014 ", e.soldSOL?.toFixed(3), " SOL"), /*#__PURE__*/React.createElement("span", {
    style: {
      color: e.pnl >= 0 ? 'var(--success)' : 'var(--danger)'
    }
  }, e.pnl >= 0 ? '+' : '', e.pnl.toFixed(4), " SOL")))), /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-primary)',
      borderRadius: '8px',
      padding: '10px',
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.72rem',
      marginBottom: '3px'
    }
  }, "Contract"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.73rem',
      wordBreak: 'break-all',
      color: 'var(--text-primary)'
    }
  }, trade.tokenAddress || '‚Äî')), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => window.open(`https://dexscreener.com/solana/${trade.tokenAddress}`, '_blank'),
    style: {
      flex: 1,
      margin: 0,
      background: 'rgba(16,185,129,0.15)',
      border: '1px solid var(--success)',
      color: 'var(--success)'
    }
  }, "\uD83D\uDCC8 DexScreener"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      flex: 1,
      margin: 0
    }
  }, "Close"))));
}
function RankingTable({
  ranking,
  rankingLoading,
  userId,
  user
}) {
  const [sortBy, setSortBy] = React.useState('xp');
  const SORT_OPTS = [{
    id: 'xp',
    label: '‚≠ê XP'
  }, {
    id: 'totalPnl',
    label: 'üí∞ P&L'
  }, {
    id: 'winRate',
    label: 'üéØ Win Rate'
  }];
  const sorted = [...ranking].sort((a, b) => {
    if (sortBy === 'winRate') return b.winRate - a.winRate;
    if (sortBy === 'totalPnl') return b.totalPnl - a.totalPnl;
    return b.xp - a.xp;
  });
  const MEDALS = ['ü•á', 'ü•à', 'ü•â'];
  return /*#__PURE__*/React.createElement("div", {
    className: "card",
    style: {
      padding: '0',
      overflow: 'hidden'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      borderBottom: '1px solid var(--border)'
    }
  }, SORT_OPTS.map(o => /*#__PURE__*/React.createElement("div", {
    key: o.id,
    onClick: () => setSortBy(o.id),
    style: {
      flex: 1,
      padding: '12px',
      textAlign: 'center',
      cursor: 'pointer',
      fontSize: '0.85rem',
      fontWeight: 'bold',
      borderBottom: sortBy === o.id ? '2px solid var(--accent)' : '2px solid transparent',
      color: sortBy === o.id ? 'var(--accent)' : 'var(--text-secondary)',
      background: sortBy === o.id ? 'rgba(59,130,246,0.06)' : 'transparent',
      transition: 'all 0.15s'
    }
  }, o.label))), rankingLoading ? /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '40px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, "\u23F3 Loading ranking...") : sorted.length === 0 ? /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '40px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2rem',
      marginBottom: '10px'
    }
  }, "\uD83C\uDFDC\uFE0F"), "No traders in the ranking yet.", /*#__PURE__*/React.createElement("br", null), /*#__PURE__*/React.createElement("small", null, "Close a trade to see it here!")) : sorted.map((r, i) => {
    const isMe = r.id === userId;
    const levelIdx = Math.max(0, Math.min(LEVELS.length - 1, (r.level || 1) - 1));
    const lvl = LEVELS[levelIdx] || LEVELS[0];
    return /*#__PURE__*/React.createElement("div", {
      key: r.id,
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '12px',
        padding: '14px 18px',
        borderBottom: '1px solid var(--border)',
        background: isMe ? 'rgba(59,130,246,0.06)' : 'transparent'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        width: '32px',
        textAlign: 'center',
        flexShrink: 0,
        fontSize: i < 3 ? '1.4rem' : '1rem',
        fontWeight: 'bold',
        color: i < 3 ? 'inherit' : 'var(--text-secondary)'
      }
    }, i < 3 ? MEDALS[i] : `#${i + 1}`), /*#__PURE__*/React.createElement("div", {
      style: {
        width: '38px',
        height: '38px',
        borderRadius: '50%',
        flexShrink: 0,
        background: 'var(--bg-primary)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        fontSize: '1.2rem',
        border: isMe ? '2px solid var(--accent)' : '1px solid var(--border)'
      }
    }, lvl.icon), /*#__PURE__*/React.createElement("div", {
      style: {
        flex: 1,
        minWidth: 0
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.92rem',
        color: isMe ? 'var(--accent)' : 'var(--text-primary)',
        overflow: 'hidden',
        textOverflow: 'ellipsis',
        whiteSpace: 'nowrap'
      }
    }, r.username, " ", isMe && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.7rem',
        color: 'var(--accent)'
      }
    }, "\u2190 you")), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, lvl.name, " \xB7 ", r.trades, " trades")), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right',
        flexShrink: 0
      }
    }, sortBy === 'xp' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        color: 'var(--accent)',
        fontSize: '0.95rem'
      }
    }, r.xp.toLocaleString(), " XP"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: r.totalPnl >= 0 ? 'var(--success)' : 'var(--danger)'
      }
    }, r.totalPnl >= 0 ? '+' : '', r.totalPnl.toFixed(2), " SOL")), sortBy === 'totalPnl' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.95rem',
        color: r.totalPnl >= 0 ? 'var(--success)' : 'var(--danger)'
      }
    }, r.totalPnl >= 0 ? '+' : '', r.totalPnl.toFixed(2), " SOL"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, r.xp.toLocaleString(), " XP")), sortBy === 'winRate' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.95rem',
        color: r.winRate >= 50 ? 'var(--success)' : 'var(--warning)'
      }
    }, r.winRate, "% wins"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, r.xp.toLocaleString(), " XP"))));
  }));
}

// ‚îÄ‚îÄ COMMUNITY CONSTANTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const COMMUNITY_TOPICS = [{
  id: 'dicas',
  label: 'üí° Tips/Tutorials',
  color: '#3b82f6',
  expiry: null,
  lucrativos: true
}, {
  id: 'alertas',
  label: 'üö® Rug/Alerts',
  color: '#ef4444',
  expiry: 48
}, {
  id: 'kols',
  label: 'üì¢ KOLs',
  color: '#8b5cf6',
  expiry: null
}, {
  id: 'noticias',
  label: 'üì∞ News',
  color: '#06b6d4',
  expiry: 72
}, {
  id: 'calls',
  label: 'üî• Calls',
  color: '#f59e0b',
  expiry: 24
}, {
  id: 'baleias',
  label: 'üê≥ Whales',
  color: '#10b981',
  expiry: 24
}, {
  id: 'geral',
  label: 'ü§ù General',
  color: '#94a3b8',
  expiry: null
}];
const MAX_POSTS_PER_DAY = 3; // max 3 posts per day
const MIN_WINRATE_DICAS = 50; // min win rate for Tips/Tutorials
const XP_PER_LIKE = 10;
const XP_PER_REPORT = -20;
const MIN_LEVEL_VERIFIED = 5;
function CommunityTab({
  user,
  onXPChange,
  traderWinRate
}) {
  const [topic, setTopic] = React.useState('dicas');
  const [posts, setPosts] = React.useState([]);
  const [postsLoading, setPostsLoading] = React.useState(false);
  const [composing, setComposing] = React.useState(false);
  const [draft, setDraft] = React.useState('');
  const [submitting, setSubmitting] = React.useState(false);
  const [communityRank, setCommunityRank] = React.useState([]);
  const [view, setView] = React.useState('feed');
  const [expandedPost, setExpandedPost] = React.useState(null);
  const [commentDraft, setCommentDraft] = React.useState({});
  const [commentSubmitting, setCommentSubmitting] = React.useState(false);

  // ‚îÄ‚îÄ Storage helper (localStorage fallback for file://) ‚îÄ‚îÄ
  const store = {
    set: (k, v, s) => window.storage ? window.storage.set(k, v, s) : (localStorage.setItem(k, v), Promise.resolve({
      key: k,
      value: v
    })),
    get: (k, s) => window.storage ? window.storage.get(k, s) : (() => {
      const v = localStorage.getItem(k);
      if (v === null) return Promise.reject(new Error('nf'));
      return Promise.resolve({
        key: k,
        value: v
      });
    })(),
    list: (p, s) => window.storage ? window.storage.list(p, s) : Promise.resolve({
      keys: Object.keys(localStorage).filter(k => k.startsWith(p))
    })
  };

  // helpers
  const myLevel = LEVELS.reduce((acc, l) => (user.xp || 0) >= l.xp ? l.level : acc, 1);
  const isVerified = myLevel >= MIN_LEVEL_VERIFIED;
  const canPostDicas = (traderWinRate || 0) >= MIN_WINRATE_DICAS;
  const storageKey = t => `helmcomm${t}`;
  const commentKey = postId => `helmcomments${postId}`;
  const rankKey = uid => `helmcommrank${uid}`;
  const todayKey = () => new Date().toISOString().split('T')[0].replace(/-/g, '');

  // posts already liked/reported by this user (local)
  const myActionsKey = `helmCommunityActions_${user.id}`;
  const getMyActions = () => {
    try {
      return JSON.parse(localStorage.getItem(myActionsKey) || '{}');
    } catch {
      return {};
    }
  };
  const saveMyActions = a => localStorage.setItem(myActionsKey, JSON.stringify(a));
  const postsToday = () => {
    const actions = getMyActions();
    const key = `posts_${todayKey()}`;
    return actions[key] || 0;
  };
  const timeAgo = ts => {
    const diff = Date.now() - ts;
    if (diff < 60000) return 'now';
    if (diff < 3600000) return `${Math.floor(diff / 60000)}min`;
    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h`;
    return `${Math.floor(diff / 86400000)}d`;
  };
  const expiryLeft = post => {
    const cfg = COMMUNITY_TOPICS.find(t => t.id === post.topic);
    if (!cfg?.expiry) return null;
    const remaining = cfg.expiry * 3600000 - (Date.now() - post.createdAt);
    if (remaining <= 0) return 0;
    return Math.ceil(remaining / 3600000);
  };

  // ‚îÄ‚îÄ FETCH POSTS ‚îÄ‚îÄ
  const fetchPosts = async () => {
    setPostsLoading(true);
    try {
      const result = await store.list(storageKey(topic), true);
      const keys = result?.keys || [];
      const loaded = [];
      for (const key of keys) {
        try {
          const r = await store.get(key, true);
          if (r?.value) {
            const p = JSON.parse(r.value);
            const cfg = COMMUNITY_TOPICS.find(t => t.id === p.topic);
            if (cfg?.expiry && Date.now() - p.createdAt > cfg.expiry * 3600000) continue;
            if ((p.reports || 0) >= 5) continue;
            loaded.push(p);
          }
        } catch {}
      }
      loaded.sort((a, b) => {
        if ((b.likes || 0) >= 5 && (a.likes || 0) < 5) return 1;
        if ((a.likes || 0) >= 5 && (b.likes || 0) < 5) return -1;
        return b.createdAt - a.createdAt;
      });
      setPosts(loaded);
    } catch {} finally {
      setPostsLoading(false);
    }
  };

  // ‚îÄ‚îÄ FETCH RANK ‚îÄ‚îÄ
  const fetchCommunityRank = async () => {
    try {
      const result = await store.list('helmcommrank', true);
      const keys = result?.keys || [];
      const entries = [];
      for (const key of keys) {
        try {
          const r = await store.get(key, true);
          if (r?.value) entries.push(JSON.parse(r.value));
        } catch {}
      }
      entries.sort((a, b) => (b.totalLikes || 0) - (a.totalLikes || 0));
      setCommunityRank(entries);
    } catch {}
  };
  React.useEffect(() => {
    fetchPosts();
  }, [topic]);
  React.useEffect(() => {
    if (view === 'rank') fetchCommunityRank();
  }, [view]);

  // ‚îÄ‚îÄ COMMENTS ‚îÄ‚îÄ
  const fetchComments = async postId => {
    try {
      const r = await store.get(commentKey(postId), true).catch(() => null);
      return r ? JSON.parse(r.value) : [];
    } catch {
      return [];
    }
  };
  const submitComment = async post => {
    const text = (commentDraft[post.id] || '').trim();
    if (!text) return;
    setCommentSubmitting(true);
    try {
      const existing = await fetchComments(post.id);
      const comment = {
        id: `${user.id}c${Date.now()}`,
        authorId: user.id,
        authorName: user.username || 'Anon',
        authorLevel: myLevel,
        isVerified,
        text,
        reports: 0,
        createdAt: Date.now()
      };
      existing.push(comment);
      await store.set(commentKey(post.id), JSON.stringify(existing), true);
      setCommentDraft(d => ({
        ...d,
        [post.id]: ''
      }));
      setPosts(prev => prev.map(p => p.id === post.id ? {
        ...p,
        _comments: existing
      } : p));
    } catch {} finally {
      setCommentSubmitting(false);
    }
  };
  const reportComment = async (post, comment) => {
    const actions = getMyActions();
    const k = `comment_${comment.id}`;
    if (actions[k]?.reported) return;
    if (!confirm('Report this comment?')) return;
    try {
      const existing = await fetchComments(post.id);
      const updated = existing.map(c => c.id === comment.id ? {
        ...c,
        reports: (c.reports || 0) + 1
      } : c);
      await store.set(commentKey(post.id), JSON.stringify(updated), true);
      setPosts(prev => prev.map(p => p.id === post.id ? {
        ...p,
        _comments: updated
      } : p));
      actions[k] = {
        reported: true
      };
      saveMyActions(actions);
    } catch {}
  };
  const loadComments = async post => {
    const comments = await fetchComments(post.id);
    setPosts(prev => prev.map(p => p.id === post.id ? {
      ...p,
      _comments: comments
    } : p));
    setExpandedPost(expandedPost === post.id ? null : post.id);
  };

  // ‚îÄ‚îÄ SUBMIT POST ‚îÄ‚îÄ
  const handleSubmit = async () => {
    if (!draft.trim()) return;
    if (topic === 'dicas' && !canPostDicas) {
      alert(`üí° Tips/Tutorials is exclusive to traders with win rate ‚â• ${MIN_WINRATE_DICAS}%. Your win rate: ${(traderWinRate || 0).toFixed(0)}%.`);
      return;
    }
    if (postsToday() >= MAX_POSTS_PER_DAY) {
      alert(`Daily limit of ${MAX_POSTS_PER_DAY} posts reached.`);
      return;
    }
    setSubmitting(true);
    try {
      const post = {
        id: `${user.id}t${Date.now()}`,
        topic,
        authorId: user.id,
        authorName: user.username || 'Anon',
        authorLevel: myLevel,
        isVerified,
        text: draft.trim(),
        likes: 0,
        reports: 0,
        createdAt: Date.now()
      };
      const key = `${storageKey(topic)}${post.id}`;
      await store.set(key, JSON.stringify(post), true);

      // update rank
      const rKey = rankKey(user.id);
      let rankEntry = {
        id: user.id,
        username: user.username || 'Anon',
        posts: 0,
        totalLikes: 0
      };
      try {
        const r = await store.get(rKey, true);
        if (r) rankEntry = JSON.parse(r.value);
      } catch {}
      rankEntry.posts = (rankEntry.posts || 0) + 1;
      await store.set(rKey, JSON.stringify(rankEntry), true);

      // daily count
      const actions = getMyActions();
      const dayKey = `posts_${todayKey()}`;
      actions[dayKey] = (actions[dayKey] || 0) + 1;
      saveMyActions(actions);
      onXPChange && onXPChange(20, 'üìù Post published');
      setDraft('');
      setComposing(false);
      await fetchPosts();
    } catch {
      alert('Failed to publish. Please try again.');
    } finally {
      setSubmitting(false);
    }
  };

  // ‚îÄ‚îÄ LIKE ‚îÄ‚îÄ
  const handleLike = async post => {
    const actions = getMyActions();
    if (actions[post.id]?.liked) return;
    try {
      const r = await store.get(`${storageKey(post.topic)}${post.id}`, true);
      if (!r) return;
      const updated = {
        ...JSON.parse(r.value),
        likes: (JSON.parse(r.value).likes || 0) + 1
      };
      await store.set(`${storageKey(post.topic)}${post.id}`, JSON.stringify(updated), true);

      // update rank
      const rKey = rankKey(post.authorId);
      let rankEntry = {
        id: post.authorId,
        username: post.authorName || 'Anon',
        posts: 0,
        totalLikes: 0
      };
      try {
        const rr = await store.get(rKey, true);
        if (rr) rankEntry = JSON.parse(rr.value);
      } catch {}
      rankEntry.totalLikes = (rankEntry.totalLikes || 0) + 1;
      await store.set(rKey, JSON.stringify(rankEntry), true);
      actions[post.id] = {
        ...(actions[post.id] || {}),
        liked: true
      };
      saveMyActions(actions);
      onXPChange && onXPChange(XP_PER_LIKE, 'üëç Post liked');
      setPosts(prev => prev.map(p => p.id === post.id ? {
        ...p,
        likes: (p.likes || 0) + 1
      } : p));
    } catch {}
  };

  // ‚îÄ‚îÄ REPORT ‚îÄ‚îÄ
  const handleReport = async post => {
    const actions = getMyActions();
    if (actions[post.id]?.reported) return;
    if (!confirm('Report this post?')) return;
    try {
      const r = await store.get(`${storageKey(post.topic)}${post.id}`, true);
      if (!r) return;
      const updated = {
        ...JSON.parse(r.value),
        reports: (JSON.parse(r.value).reports || 0) + 1
      };
      await store.set(`${storageKey(post.topic)}${post.id}`, JSON.stringify(updated), true);
      actions[post.id] = {
        ...(actions[post.id] || {}),
        reported: true
      };
      saveMyActions(actions);
      setPosts(prev => prev.map(p => p.id === post.id ? {
        ...p,
        reports: (p.reports || 0) + 1
      } : p));
    } catch {}
  };
  const topicCfg = COMMUNITY_TOPICS.find(t => t.id === topic);
  const remaining = MAX_POSTS_PER_DAY - postsToday();
  const actions = getMyActions();
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '16px',
      flexWrap: 'wrap',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("h2", {
    style: {
      margin: 0
    }
  }, "\uD83D\uDCAC Community"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => setView(view === 'feed' ? 'rank' : 'feed'),
    style: {
      margin: 0,
      padding: '8px 14px',
      fontSize: '0.82rem'
    }
  }, view === 'feed' ? 'üèÖ Ranking' : 'üì∞ Feed'), view === 'feed' && /*#__PURE__*/React.createElement("button", {
    onClick: () => setComposing(!composing),
    className: "success",
    style: {
      margin: 0,
      padding: '8px 14px',
      fontSize: '0.82rem'
    }
  }, "\u270F\uFE0F New post"))), view === 'rank' && /*#__PURE__*/React.createElement("div", {
    className: "card",
    style: {
      padding: '0',
      overflow: 'hidden'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '14px 18px',
      borderBottom: '1px solid var(--border)',
      fontWeight: 'bold',
      fontSize: '0.95rem'
    }
  }, "\uD83C\uDFC5 Top Contributors"), communityRank.length === 0 ? /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '40px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, "No contributors yet.") : communityRank.map((r, i) => {
    const isMe = r.id === user.id;
    const MEDALS = ['ü•á', 'ü•à', 'ü•â'];
    return /*#__PURE__*/React.createElement("div", {
      key: r.id,
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '12px',
        padding: '13px 18px',
        borderBottom: '1px solid var(--border)',
        background: isMe ? 'rgba(59,130,246,0.06)' : 'transparent'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        width: '28px',
        textAlign: 'center',
        fontWeight: 'bold',
        fontSize: i < 3 ? '1.3rem' : '0.95rem',
        color: 'var(--text-secondary)'
      }
    }, i < 3 ? MEDALS[i] : `#${i + 1}`), /*#__PURE__*/React.createElement("div", {
      style: {
        flex: 1
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        color: isMe ? 'var(--accent)' : 'var(--text-primary)',
        fontSize: '0.9rem'
      }
    }, r.username, " ", isMe && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.7rem'
      }
    }, "\u2190 you")), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, r.posts || 0, " posts published")), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        color: 'var(--success)',
        fontSize: '0.95rem'
      }
    }, "\uD83D\uDC4D ", r.totalLikes || 0), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.72rem',
        color: 'var(--text-secondary)'
      }
    }, "likes received")));
  })), view === 'feed' && /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '6px',
      flexWrap: 'wrap',
      marginBottom: '14px'
    }
  }, COMMUNITY_TOPICS.map(t => {
    const locked = t.lucrativos && !canPostDicas;
    return /*#__PURE__*/React.createElement("div", {
      key: t.id,
      onClick: () => setTopic(t.id),
      style: {
        padding: '6px 12px',
        borderRadius: '20px',
        cursor: 'pointer',
        fontSize: '0.8rem',
        fontWeight: 'bold',
        transition: 'all 0.15s',
        background: topic === t.id ? t.color + '33' : 'var(--bg-card)',
        border: `1px solid ${topic === t.id ? t.color : 'var(--border)'}`,
        color: topic === t.id ? t.color : 'var(--text-secondary)',
        opacity: locked ? 0.7 : 1
      }
    }, t.label, locked ? ' üîí' : '');
  })), composing && /*#__PURE__*/React.createElement("div", {
    className: "card",
    style: {
      marginBottom: '14px',
      padding: '16px'
    }
  }, topicCfg?.lucrativos && !canPostDicas ? /*#__PURE__*/React.createElement("div", {
    style: {
      textAlign: 'center',
      padding: '20px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '1.8rem',
      marginBottom: '8px'
    }
  }, "\uD83D\uDD12"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      marginBottom: '6px'
    }
  }, "Restricted access"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem',
      color: 'var(--text-secondary)',
      lineHeight: 1.5
    }
  }, "Tips/Tutorials is exclusive to traders with ", /*#__PURE__*/React.createElement("strong", null, "win rate \u2265 ", MIN_WINRATE_DICAS, "%"), ".", /*#__PURE__*/React.createElement("br", null), "Your current win rate: ", /*#__PURE__*/React.createElement("strong", {
    style: {
      color: (traderWinRate || 0) >= MIN_WINRATE_DICAS ? 'var(--success)' : 'var(--danger)'
    }
  }, (traderWinRate || 0).toFixed(0), "%")), /*#__PURE__*/React.createElement("button", {
    onClick: () => setComposing(false),
    style: {
      marginTop: '12px'
    }
  }, "Close")) : /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '8px',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontWeight: 'bold',
      color: topicCfg?.color
    }
  }, topicCfg?.label), topicCfg?.expiry && /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.75rem',
      color: 'var(--text-secondary)'
    }
  }, "\xB7 expires in ", topicCfg.expiry, "h"), isVerified && /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.72rem',
      background: 'rgba(59,130,246,0.15)',
      color: 'var(--accent)',
      padding: '2px 8px',
      borderRadius: '10px',
      border: '1px solid rgba(59,130,246,0.3)'
    }
  }, "\u2705 Verified"), /*#__PURE__*/React.createElement("span", {
    style: {
      marginLeft: 'auto',
      fontSize: '0.75rem',
      color: remaining <= 1 ? 'var(--danger)' : 'var(--text-secondary)'
    }
  }, remaining, "/", MAX_POSTS_PER_DAY, " posts today")), /*#__PURE__*/React.createElement("textarea", {
    value: draft,
    onChange: e => setDraft(e.target.value),
    placeholder: `Share something about ${topicCfg?.label}...`,
    maxLength: 500,
    style: {
      width: '100%',
      minHeight: '90px',
      background: 'var(--bg-primary)',
      border: '1px solid var(--border)',
      borderRadius: '8px',
      padding: '10px',
      color: 'var(--text-primary)',
      fontSize: '0.9rem',
      resize: 'vertical',
      fontFamily: 'inherit',
      boxSizing: 'border-box'
    }
  }), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginTop: '10px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.75rem',
      color: 'var(--text-secondary)'
    }
  }, draft.length, "/500"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      setComposing(false);
      setDraft('');
    },
    style: {
      margin: 0,
      padding: '8px 14px',
      fontSize: '0.82rem'
    }
  }, "Cancel"), /*#__PURE__*/React.createElement("button", {
    onClick: handleSubmit,
    disabled: !draft.trim() || submitting,
    className: "success",
    style: {
      margin: 0,
      padding: '8px 16px',
      fontSize: '0.82rem',
      opacity: draft.trim() ? 1 : 0.5
    }
  }, submitting ? '...' : 'üì§ Publish'))))), postsLoading ? /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '40px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, "\u23F3 Loading posts...") : posts.length === 0 ? /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '40px',
      textAlign: 'center',
      color: 'var(--text-secondary)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2rem',
      marginBottom: '8px'
    }
  }, "\uD83D\uDCAC"), "No posts yet. Be the first!") : posts.map(post => {
    const isPinned = (post.likes || 0) >= 5;
    const myLiked = actions[post.id]?.liked;
    const myReported = actions[post.id]?.reported;
    const expLeft = expiryLeft(post);
    return /*#__PURE__*/React.createElement("div", {
      key: post.id,
      className: "card",
      style: {
        marginBottom: '10px',
        padding: '16px',
        border: isPinned ? '1px solid rgba(251,191,36,0.4)' : '1px solid var(--border)',
        background: isPinned ? 'rgba(251,191,36,0.04)' : 'var(--bg-card)'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '8px',
        marginBottom: '10px',
        flexWrap: 'wrap'
      }
    }, isPinned && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.72rem',
        background: 'rgba(251,191,36,0.15)',
        color: 'var(--gold)',
        padding: '2px 6px',
        borderRadius: '8px'
      }
    }, "\uD83D\uDCCC Pinned"), /*#__PURE__*/React.createElement("span", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.9rem'
      }
    }, post.authorName), post.isVerified && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.68rem',
        background: 'rgba(59,130,246,0.15)',
        color: 'var(--accent)',
        padding: '1px 5px',
        borderRadius: '8px'
      }
    }, "\u2705"), /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)',
        marginLeft: 'auto'
      }
    }, timeAgo(post.createdAt)), expLeft !== null && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.68rem',
        color: expLeft < 4 ? 'var(--danger)' : 'var(--text-secondary)'
      }
    }, "\u23F1 ", expLeft, "h")), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.9rem',
        color: 'var(--text-primary)',
        lineHeight: 1.6,
        marginBottom: '12px',
        whiteSpace: 'pre-wrap'
      }
    }, post.text), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        gap: '8px',
        alignItems: 'center',
        flexWrap: 'wrap'
      }
    }, /*#__PURE__*/React.createElement("button", {
      onClick: () => handleLike(post),
      disabled: !!myLiked,
      style: {
        margin: 0,
        padding: '6px 12px',
        fontSize: '0.82rem',
        background: myLiked ? 'rgba(16,185,129,0.15)' : 'var(--bg-primary)',
        border: `1px solid ${myLiked ? 'var(--success)' : 'var(--border)'}`,
        color: myLiked ? 'var(--success)' : 'var(--text-secondary)',
        borderRadius: '8px',
        cursor: myLiked ? 'default' : 'pointer'
      }
    }, "\uD83D\uDC4D ", post.likes || 0, " ", !myLiked && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.72rem'
      }
    }, "(+", XP_PER_LIKE, "xp)")), !myReported && post.authorId !== user.id && /*#__PURE__*/React.createElement("button", {
      onClick: () => handleReport(post),
      style: {
        margin: 0,
        padding: '6px 10px',
        fontSize: '0.78rem',
        background: 'transparent',
        border: '1px solid transparent',
        color: 'var(--text-secondary)',
        borderRadius: '8px',
        cursor: 'pointer',
        opacity: 0.6
      }
    }, "\uD83D\uDEA9 ", post.reports || 0), myReported && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, "\uD83D\uDEA9 Reported"), post.reports >= 3 && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.72rem',
        color: 'var(--danger)',
        marginLeft: 'auto'
      }
    }, "\u26A0\uFE0F Flagged content"), /*#__PURE__*/React.createElement("button", {
      onClick: () => loadComments(post),
      style: {
        margin: 0,
        marginLeft: 'auto',
        padding: '6px 10px',
        fontSize: '0.78rem',
        background: 'transparent',
        border: '1px solid var(--border)',
        color: 'var(--text-secondary)',
        borderRadius: '8px',
        cursor: 'pointer'
      }
    }, "\uD83D\uDCAC ", post._comments?.length || 0)), expandedPost === post.id && /*#__PURE__*/React.createElement("div", {
      style: {
        marginTop: '12px',
        paddingTop: '12px',
        borderTop: '1px solid var(--border)'
      }
    }, (post._comments || []).length === 0 && /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.82rem',
        color: 'var(--text-secondary)',
        marginBottom: '10px'
      }
    }, "No comments yet."), (post._comments || []).map(c => {
      const myRepC = getMyActions()[`comment_${c.id}`]?.reported;
      return /*#__PURE__*/React.createElement("div", {
        key: c.id,
        style: {
          padding: '8px 10px',
          background: 'var(--bg-primary)',
          borderRadius: '8px',
          marginBottom: '6px',
          fontSize: '0.83rem'
        }
      }, /*#__PURE__*/React.createElement("div", {
        style: {
          display: 'flex',
          alignItems: 'center',
          gap: '6px',
          marginBottom: '4px'
        }
      }, /*#__PURE__*/React.createElement("span", {
        style: {
          fontWeight: 'bold'
        }
      }, c.authorName), c.isVerified && /*#__PURE__*/React.createElement("span", {
        style: {
          fontSize: '0.68rem',
          background: 'rgba(59,130,246,0.15)',
          color: 'var(--accent)',
          padding: '1px 5px',
          borderRadius: '8px'
        }
      }, "\u2705"), /*#__PURE__*/React.createElement("span", {
        style: {
          fontSize: '0.68rem',
          color: 'var(--text-secondary)',
          marginLeft: 'auto'
        }
      }, timeAgo(c.createdAt)), !myRepC && c.authorId !== user.id && /*#__PURE__*/React.createElement("button", {
        onClick: () => reportComment(post, c),
        style: {
          margin: 0,
          padding: '2px 6px',
          fontSize: '0.7rem',
          background: 'transparent',
          border: 'none',
          color: 'var(--text-secondary)',
          cursor: 'pointer',
          opacity: 0.5
        }
      }, "\uD83D\uDEA9")), /*#__PURE__*/React.createElement("div", {
        style: {
          color: 'var(--text-primary)',
          lineHeight: 1.4
        }
      }, c.text), c.reports >= 3 && /*#__PURE__*/React.createElement("div", {
        style: {
          fontSize: '0.7rem',
          color: 'var(--danger)',
          marginTop: '4px'
        }
      }, "\u26A0\uFE0F Flagged comment"));
    }), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        gap: '8px',
        marginTop: '8px'
      }
    }, /*#__PURE__*/React.createElement("input", {
      value: commentDraft[post.id] || '',
      onChange: e => setCommentDraft(d => ({
        ...d,
        [post.id]: e.target.value
      })),
      placeholder: "Write a comment...",
      maxLength: 200,
      style: {
        flex: 1,
        fontSize: '0.85rem',
        padding: '8px 10px'
      }
    }), /*#__PURE__*/React.createElement("button", {
      onClick: () => submitComment(post),
      disabled: !commentDraft[post.id]?.trim() || commentSubmitting,
      className: "success",
      style: {
        margin: 0,
        padding: '8px 14px',
        fontSize: '0.82rem',
        opacity: commentDraft[post.id]?.trim() ? 1 : 0.5
      }
    }, "Send"))));
  })));
}
function XPTableModal({
  onClose
}) {
  const gainRows = [{
    action: 'üèÜ Win trade ‚â• 5 SOL profit',
    xp: '+500'
  }, {
    action: 'ü•á Win trade ‚â• 2 SOL profit',
    xp: '+300'
  }, {
    action: 'ü•à Win trade ‚â• 1 SOL profit',
    xp: '+150'
  }, {
    action: 'ü•â Win trade ‚â• 0.5 SOL profit',
    xp: '+75'
  }, {
    action: '‚úÖ Win trade ‚â• 0.1 SOL profit',
    xp: '+25'
  }, {
    action: '‚úÖ Any win trade',
    xp: '+10'
  }, {
    action: 'üî• 3 wins in a row',
    xp: '+200'
  }, {
    action: 'üî•üî• 5 wins in a row',
    xp: '+500'
  }, {
    action: 'üî•üî•üî• 10 wins in a row',
    xp: '+1000'
  }, {
    action: 'üìù Post published',
    xp: '+20'
  }, {
    action: 'üëç Post liked',
    xp: '+10'
  }];
  const lossRows = [{
    action: '‚ùå Loss trade ‚â• 0.1 SOL',
    xp: '-25'
  }, {
    action: '‚ùå Loss trade ‚â• 0.5 SOL',
    xp: '-75'
  }, {
    action: '‚ùå Loss trade ‚â• 1 SOL',
    xp: '-150'
  }, {
    action: '‚ùå Loss trade ‚â• 2 SOL',
    xp: '-300'
  }, {
    action: '‚ùå Loss trade ‚â• 5 SOL',
    xp: '-500'
  }];
  const levels = [{
    level: 1,
    name: 'üå± Rookie',
    xp: '0'
  }, {
    level: 2,
    name: '‚öì Sailor',
    xp: '500'
  }, {
    level: 3,
    name: 'üß≠ Navigator',
    xp: '1.500'
  }, {
    level: 4,
    name: '‚öîÔ∏è Corsair',
    xp: '3.500'
  }, {
    level: 5,
    name: 'üõ°Ô∏è Experienced',
    xp: '7.000'
  }, {
    level: 6,
    name: 'üéØ Skilled',
    xp: '12.000'
  }, {
    level: 7,
    name: 'üíé Veteran',
    xp: '20.000'
  }, {
    level: 8,
    name: 'üöÄ Elite',
    xp: '35.000'
  }, {
    level: 9,
    name: 'üëë Legendary',
    xp: '60.000'
  }, {
    level: 10,
    name: '‚≠ê Immortal',
    xp: '100.000'
  }];
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.85)',
      zIndex: 1001,
      display: 'flex',
      alignItems: 'flex-start',
      justifyContent: 'center',
      padding: '16px',
      overflowY: 'auto'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      maxWidth: '460px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
      marginTop: '20px',
      marginBottom: '20px'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '18px 22px',
      borderBottom: '1px solid var(--border)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'space-between'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '1.05rem'
    }
  }, "\uD83D\uDCCB XP Table"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      margin: 0,
      padding: '5px 10px',
      fontSize: '0.82rem',
      background: 'transparent',
      border: '1px solid var(--border)'
    }
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '18px 22px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '20px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      fontWeight: 'bold',
      color: 'var(--success)',
      textTransform: 'uppercase',
      letterSpacing: '0.8px',
      marginBottom: '10px'
    }
  }, "\u2705 XP Gains"), gainRows.map(r => /*#__PURE__*/React.createElement("div", {
    key: r.action,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      padding: '7px 0',
      borderBottom: '1px solid var(--border)',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-primary)'
    }
  }, r.action), /*#__PURE__*/React.createElement("span", {
    style: {
      fontWeight: 'bold',
      color: 'var(--success)',
      minWidth: '50px',
      textAlign: 'right'
    }
  }, r.xp)))), /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '20px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      fontWeight: 'bold',
      color: 'var(--danger)',
      textTransform: 'uppercase',
      letterSpacing: '0.8px',
      marginBottom: '10px'
    }
  }, "\u274C XP Losses"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      color: 'var(--text-secondary)',
      marginBottom: '8px'
    }
  }, "\u26A0\uFE0F XP never goes below 0"), lossRows.map(r => /*#__PURE__*/React.createElement("div", {
    key: r.action,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      padding: '7px 0',
      borderBottom: '1px solid var(--border)',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-primary)'
    }
  }, r.action), /*#__PURE__*/React.createElement("span", {
    style: {
      fontWeight: 'bold',
      color: 'var(--danger)',
      minWidth: '50px',
      textAlign: 'right'
    }
  }, r.xp)))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      fontWeight: 'bold',
      color: 'var(--accent)',
      textTransform: 'uppercase',
      letterSpacing: '0.8px',
      marginBottom: '10px'
    }
  }, "\uD83C\uDFC5 Levels"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '6px'
    }
  }, levels.map(l => /*#__PURE__*/React.createElement("div", {
    key: l.level,
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '8px',
      padding: '8px 10px',
      background: 'var(--bg-primary)',
      borderRadius: '8px',
      fontSize: '0.82rem'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      minWidth: '22px',
      fontWeight: 'bold',
      color: 'var(--text-secondary)',
      fontSize: '0.72rem'
    }
  }, "Lv", l.level), /*#__PURE__*/React.createElement("span", {
    style: {
      flex: 1
    }
  }, l.name), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--accent)',
      fontSize: '0.72rem',
      fontWeight: 'bold'
    }
  }, l.xp))))))));
}
function WeeklyReportModal({
  user,
  traderProfile,
  onClose
}) {
  const now = Date.now();
  const weekMs = 7 * 86400000;
  const closed = user?.trades?.filter(t => t.status === 'closed') || [];

  // Trades this week
  const weekTrades = closed.filter(t => t.closedAt && now - new Date(t.closedAt) < weekMs);
  const weekWins = weekTrades.filter(t => (t.totalPnl || 0) > 0);
  const weekLosses = weekTrades.filter(t => (t.totalPnl || 0) < 0);
  const weekPnl = weekTrades.reduce((s, t) => s + (t.totalPnl || 0), 0);
  const weekWR = weekTrades.length > 0 ? weekWins.length / weekTrades.length * 100 : 0;
  const weekAvgWin = weekWins.length > 0 ? weekWins.reduce((s, t) => s + (t.totalPnl || 0), 0) / weekWins.length : 0;
  const weekAvgLoss = weekLosses.length > 0 ? Math.abs(weekLosses.reduce((s, t) => s + (t.totalPnl || 0), 0) / weekLosses.length) : 0;
  const weekRR = weekAvgLoss > 0 ? weekAvgWin / weekAvgLoss : 0;

  // Best / worst of the week
  const weekBest = weekTrades.length > 0 ? weekTrades.reduce((a, b) => (b.totalPnl || 0) > (a.totalPnl || 0) ? b : a) : null;
  const weekWorst = weekTrades.length > 0 ? weekTrades.reduce((a, b) => (b.totalPnl || 0) < (a.totalPnl || 0) ? b : a) : null;

  // Tokens most traded
  const tokenFreq = {};
  weekTrades.forEach(t => {
    const key = t.tokenSymbol || t.tokenName || t.tokenAddress?.slice(0, 8) || '?';
    tokenFreq[key] = (tokenFreq[key] || 0) + 1;
  });
  const topTokens = Object.entries(tokenFreq).sort((a, b) => b[1] - a[1]).slice(0, 3);

  // Buy reasons this week
  const reasonFreq = {};
  weekTrades.forEach(t => {
    if (t.buyReason) reasonFreq[t.buyReason] = (reasonFreq[t.buyReason] || 0) + 1;
  });
  const topReasons = Object.entries(reasonFreq).sort((a, b) => b[1] - a[1]).slice(0, 3);

  // Week date range label
  const weekStart = new Date(now - weekMs);
  const label = `${weekStart.toLocaleDateString('en-US')} ‚Üí ${new Date().toLocaleDateString('en-US')}`;

  // Grade
  const grade = () => {
    if (weekTrades.length === 0) return {
      letter: '‚Äî',
      color: 'var(--text-secondary)',
      msg: 'No trades this week.'
    };
    let score = 0;
    if (weekWR >= 60) score += 3;else if (weekWR >= 50) score += 2;else if (weekWR >= 40) score += 1;
    if (weekRR >= 1.5) score += 3;else if (weekRR >= 1) score += 2;else if (weekRR >= 0.7) score += 1;
    if (weekPnl > 0) score += 2;else if (weekPnl < 0) score -= 1;
    if (traderProfile?.isOvertrading) score -= 1;
    if (score >= 7) return {
      letter: 'S',
      color: '#fbbf24',
      msg: 'Exceptional week! Elite-level consistency.'
    };
    if (score >= 5) return {
      letter: 'A',
      color: 'var(--success)',
      msg: 'Good week. Keep maintaining discipline.'
    };
    if (score >= 3) return {
      letter: 'B',
      color: 'var(--accent)',
      msg: 'Decent week. Room to improve.'
    };
    if (score >= 1) return {
      letter: 'C',
      color: 'var(--warning)',
      msg: 'Tough week. Review your entries and exits.'
    };
    return {
      letter: 'D',
      color: 'var(--danger)',
      msg: 'Bad week. Pause and analyze your patterns.'
    };
  };
  const g = grade();
  return /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.85)',
      zIndex: 1000,
      display: 'flex',
      alignItems: 'flex-start',
      justifyContent: 'center',
      padding: '16px',
      overflowY: 'auto'
    },
    onClick: onClose
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '16px',
      maxWidth: '480px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
      marginTop: '20px',
      marginBottom: '20px'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '20px 24px',
      borderBottom: '1px solid var(--border)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'space-between'
    }
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '1.1rem'
    }
  }, "\uD83D\uDCCA Weekly Report"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      color: 'var(--text-secondary)',
      marginTop: '2px'
    }
  }, label)), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    style: {
      margin: 0,
      padding: '6px 12px',
      fontSize: '0.82rem',
      background: 'transparent',
      border: '1px solid var(--border)'
    }
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '20px 24px'
    }
  }, weekTrades.length === 0 ? /*#__PURE__*/React.createElement("div", {
    style: {
      textAlign: 'center',
      padding: '40px 0',
      color: 'var(--text-secondary)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2.5rem',
      marginBottom: '12px'
    }
  }, "\uD83D\uDCED"), /*#__PURE__*/React.createElement("div", null, "No closed trades this week.")) : /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '16px',
      padding: '16px',
      background: 'var(--bg-primary)',
      borderRadius: '12px',
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '3rem',
      fontWeight: '900',
      color: g.color,
      lineHeight: 1,
      minWidth: '50px',
      textAlign: 'center'
    }
  }, g.letter), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      marginBottom: '4px'
    }
  }, "Weekly Grade"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem',
      color: 'var(--text-secondary)',
      lineHeight: 1.4
    }
  }, g.msg))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: '1fr 1fr',
      gap: '8px',
      marginBottom: '16px'
    }
  }, [{
    label: 'Weekly P&L',
    val: `${weekPnl >= 0 ? '+' : ''}${weekPnl.toFixed(4)} SOL`,
    color: weekPnl >= 0 ? 'var(--success)' : 'var(--danger)'
  }, {
    label: 'Closed trades',
    val: weekTrades.length
  }, {
    label: 'Win Rate',
    val: `${weekWR.toFixed(0)}%`,
    color: weekWR >= 50 ? 'var(--success)' : 'var(--danger)'
  }, {
    label: 'Risk/Reward',
    val: `${weekRR.toFixed(2)}√ó`,
    color: weekRR >= 1 ? 'var(--success)' : 'var(--warning)'
  }, {
    label: 'Wins / Losses',
    val: `${weekWins.length} / ${weekLosses.length}`,
    color: 'var(--text-primary)'
  }, {
    label: 'Avg Win',
    val: `+${weekAvgWin.toFixed(4)}`,
    color: 'var(--success)'
  }].map(s => /*#__PURE__*/React.createElement("div", {
    key: s.label,
    style: {
      background: 'var(--bg-primary)',
      borderRadius: '10px',
      padding: '12px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.72rem',
      color: 'var(--text-secondary)',
      marginBottom: '4px'
    }
  }, s.label), /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      color: s.color || 'var(--text-primary)'
    }
  }, s.val)))), (weekBest || weekWorst) && /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.82rem',
      fontWeight: 'bold',
      color: 'var(--text-secondary)',
      marginBottom: '8px',
      textTransform: 'uppercase',
      letterSpacing: '0.5px'
    }
  }, "Highlights"), weekBest && /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '8px 12px',
      background: 'rgba(16,185,129,0.07)',
      border: '1px solid rgba(16,185,129,0.2)',
      borderRadius: '8px',
      marginBottom: '6px',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", null, "\uD83D\uDFE2 Best \u2014 ", /*#__PURE__*/React.createElement("strong", null, weekBest.tokenSymbol || weekBest.tokenName || 'Token')), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--success)',
      fontWeight: 'bold'
    }
  }, (weekBest.totalPnl || 0) >= 0 ? '+' : '', (weekBest.totalPnl || 0).toFixed(4), " SOL")), weekWorst && weekWorst.id !== weekBest?.id && /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '8px 12px',
      background: 'rgba(239,68,68,0.07)',
      border: '1px solid rgba(239,68,68,0.2)',
      borderRadius: '8px',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", null, "\uD83D\uDD34 Worst \u2014 ", /*#__PURE__*/React.createElement("strong", null, weekWorst.tokenSymbol || weekWorst.tokenName || 'Token')), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--danger)',
      fontWeight: 'bold'
    }
  }, (weekWorst.totalPnl || 0).toFixed(4), " SOL"))), topTokens.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.82rem',
      fontWeight: 'bold',
      color: 'var(--text-secondary)',
      marginBottom: '8px',
      textTransform: 'uppercase',
      letterSpacing: '0.5px'
    }
  }, "Top tokens traded"), topTokens.map(([sym, count]) => /*#__PURE__*/React.createElement("div", {
    key: sym,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '6px 0',
      borderBottom: '1px solid var(--border)',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontWeight: 'bold'
    }
  }, sym), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)'
    }
  }, count, " trade", count > 1 ? 's' : '')))), topReasons.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.82rem',
      fontWeight: 'bold',
      color: 'var(--text-secondary)',
      marginBottom: '8px',
      textTransform: 'uppercase',
      letterSpacing: '0.5px'
    }
  }, "Top entry reasons"), topReasons.map(([r, c]) => /*#__PURE__*/React.createElement("div", {
    key: r,
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      padding: '6px 0',
      borderBottom: '1px solid var(--border)',
      fontSize: '0.85rem'
    }
  }, /*#__PURE__*/React.createElement("span", null, r), /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)'
    }
  }, c, "\xD7")))), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '12px',
      background: 'rgba(59,130,246,0.07)',
      borderRadius: '10px',
      border: '1px solid rgba(59,130,246,0.2)',
      fontSize: '0.82rem',
      color: 'var(--text-secondary)',
      lineHeight: 1.5
    }
  }, "\uD83D\uDCA1 ", weekWR >= 60 ? 'Excellent win rate! Keep being selective with entries.' : weekWR >= 50 ? 'Positive win rate. Focus on improving R/R to maximize gains.' : weekPnl > 0 ? 'Positive P&L despite low win rate ‚Äî your R/R is saving you. Try being more selective.' : 'Negative week. Analyze your losses: ignored stops? FOMO? Illiquid tokens?')))));
}

// ‚îÄ‚îÄ TUTORIAL OVERLAY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function TutorialOverlay({
  step,
  onNext,
  onSkip
}) {
  const STEPS = [{
    target: null,
    title: '‚öì Welcome to HELM!',
    body: `HELM is your paper trading simulator for Solana memecoins ‚Äî practice without risking real SOL. You start with 5 SOL to trade. Let's take a quick tour!`,
    pos: 'center'
  }, {
    target: 'helm-analysis-tab',
    title: 'üîç Analysis Tab',
    body: `Paste any Solana token contract address here. HELM fetches live data from DexScreener and runs a full risk analysis ‚Äî red flags, green flags, holders, volume, and more.`,
    pos: 'bottom'
  }, {
    target: 'helm-analysis-tab',
    title: 'üöÄ APE Button',
    body: `After analyzing a token, hit the APE button to open a paper position. Choose your entry size and a buy reason ‚Äî this helps you track your decision-making over time.`,
    pos: 'bottom'
  }, {
    target: 'helm-analysis-tab',
    title: 'üìâ Slippage Simulation',
    body: `HELM automatically simulates real slippage based on the token's 24h volume. Low liquidity = higher slippage. Your P&L reflects this cost just like real trading.`,
    pos: 'bottom'
  }, {
    target: 'helm-portfolio-tab',
    title: 'üìä Portfolio Tab',
    body: `All your active positions live here. Watch your P&L update in real-time, add DCA entries, take partial profits, or close your full position with a sell reason.`,
    pos: 'bottom'
  }, {
    target: 'helm-missions',
    title: 'üìã Missions & Rewards',
    body: `Complete missions to earn SOL rewards ‚Äî post in the community, vote on narratives, build win streaks, and more. Running low on balance? Missions help you refuel.`,
    pos: 'bottom'
  }, {
    target: 'helm-ranking',
    title: 'ü•á Global Rankings',
    body: `Compete with other traders worldwide. Rankings are updated by XP, total P&L, and win rate. Your performance gets published automatically after each trade.`,
    pos: 'bottom'
  }, {
    target: 'helm-community',
    title: 'üí¨ Community Tab',
    body: `Share tips, post alpha, discuss narratives. Traders with good win rates can post in the Tips section. Vote on weekly narratives and earn XP for participating.`,
    pos: 'bottom'
  }];
  const s = STEPS[step];
  if (!s) return null;

  // Get target element position (computed fresh each render ‚Äî no useState needed)
  const [rect, setRect] = React.useState(null);
  React.useEffect(() => {
    if (!s.target) {
      setRect(null);
      return;
    }
    const doGet = () => {
      const el = document.getElementById(s.target);
      if (el) {
        setRect(el.getBoundingClientRect());
        el.scrollIntoView({
          behavior: 'smooth',
          block: 'center'
        });
      }
    };
    // Small delay so DOM is ready
    const t = setTimeout(doGet, 80);
    return () => clearTimeout(t);
  }, [step, s.target]);
  const PAD = 10;
  const tooltipW = 320;

  // Compute tooltip position
  let tooltipStyle = {};
  if (!rect || s.pos === 'center') {
    tooltipStyle = {
      position: 'fixed',
      top: '50%',
      left: '50%',
      transform: 'translate(-50%, -50%)',
      zIndex: 10001
    };
  } else {
    const left = Math.max(12, Math.min(window.innerWidth - tooltipW - 12, rect.left + rect.width / 2 - tooltipW / 2));
    const top = rect.bottom + PAD + 8;
    tooltipStyle = {
      position: 'fixed',
      top: `${top}px`,
      left: `${left}px`,
      width: `${tooltipW}px`,
      zIndex: 10001
    };
  }
  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      zIndex: 9999,
      background: 'rgba(0,0,0,0.72)',
      pointerEvents: rect ? 'none' : 'auto'
    }
  }), rect && /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      top: rect.top - PAD,
      left: rect.left - PAD,
      width: rect.width + PAD * 2,
      height: rect.height + PAD * 2,
      borderRadius: '10px',
      boxShadow: '0 0 0 9999px rgba(0,0,0,0.72)',
      border: '2px solid rgba(59,130,246,0.8)',
      zIndex: 10000,
      pointerEvents: 'none',
      transition: 'all 0.3s ease'
    }
  }), /*#__PURE__*/React.createElement("div", {
    style: {
      ...tooltipStyle,
      background: 'var(--bg-card)',
      border: '1px solid rgba(59,130,246,0.5)',
      borderRadius: '16px',
      padding: '22px',
      boxShadow: '0 12px 48px rgba(0,0,0,0.6)',
      pointerEvents: 'auto',
      maxWidth: '340px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '5px'
    }
  }, STEPS.map((_, i) => /*#__PURE__*/React.createElement("div", {
    key: i,
    style: {
      width: i === step ? '18px' : '6px',
      height: '6px',
      borderRadius: '3px',
      transition: 'width 0.3s',
      background: i === step ? 'var(--accent)' : i < step ? 'rgba(59,130,246,0.4)' : 'var(--border)'
    }
  }))), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.72rem',
      color: 'var(--text-secondary)'
    }
  }, step + 1, " / ", STEPS.length)), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '1.1rem',
      fontWeight: 'bold',
      marginBottom: '8px'
    }
  }, s.title), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.88rem',
      color: 'var(--text-secondary)',
      lineHeight: '1.5',
      marginBottom: '18px'
    }
  }, s.body), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      justifyContent: 'space-between',
      alignItems: 'center'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onSkip,
    style: {
      margin: 0,
      padding: '7px 14px',
      fontSize: '0.8rem',
      background: 'transparent',
      border: '1px solid var(--border)',
      color: 'var(--text-secondary)',
      borderRadius: '8px',
      cursor: 'pointer'
    }
  }, "Skip tour"), /*#__PURE__*/React.createElement("button", {
    onClick: onNext,
    style: {
      margin: 0,
      padding: '8px 22px',
      fontSize: '0.88rem',
      fontWeight: 'bold',
      background: 'linear-gradient(135deg,var(--accent),#8b5cf6)',
      border: 'none',
      color: 'white',
      borderRadius: '8px',
      cursor: 'pointer'
    }
  }, step === STEPS.length - 1 ? 'üöÄ Start Trading!' : 'Next ‚Üí'))));
}
// ‚îÄ‚îÄ END TUTORIAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function HelmApp() {
  const [user, setUser] = useState(null);
  const [activeTab, setActiveTab] = useState('profile');
  const [tokenAddress, setTokenAddress] = useState('');
  const [analysis, setAnalysis] = useState(null);
  const [loading, setLoading] = useState(false);
  const [theme, setTheme] = useState('default');
  const [toast, setToast] = useState(null);
  const [xpPopup, setXPPopup] = useState(null);
  const [buyModal, setBuyModal] = useState(null);
  const [closeModal, setCloseModal] = useState(null);
  const [portfolioModal, setPortfolioModal] = useState(null);
  const [chartTrade, setChartTrade] = useState(null);
  const [showWeeklyReport, setShowWeeklyReport] = useState(false);
  const [showXPTable, setShowXPTable] = useState(false);
  const [editingUsername, setEditingUsername] = useState(false);
  const [usernameDraft, setUsernameDraft] = useState('');
  const [showBankrupt, setShowBankrupt] = useState(false);
  const [showMissions, setShowMissions] = useState(false);
  const [adWatching, setAdWatching] = useState(false);
  const [adTimer, setAdTimer] = useState(0);
  const [ranking, setRanking] = useState([]);
  const [rankingLoading, setRankingLoading] = useState(false);
  const [solPrice, setSolPrice] = useState(150);
  const [settingsOpen, setSettingsOpen] = useState(false);
  const [tutorialStep, setTutorialStep] = useState(-1); // -1 = inactive
  // Slippage simulation: based on 24h volume (lower volume = higher slippage)
  const calcSlippage = volumeUsd => {
    if (!volumeUsd || volumeUsd <= 0) return 0.03; // 3% default if no data
    if (volumeUsd >= 5_000_000) return 0.002; // $5M+  ‚Üí 0.2%
    if (volumeUsd >= 1_000_000) return 0.005; // $1M+  ‚Üí 0.5%
    if (volumeUsd >= 500_000) return 0.008; // $500k ‚Üí 0.8%
    if (volumeUsd >= 100_000) return 0.012; // $100k ‚Üí 1.2%
    if (volumeUsd >= 50_000) return 0.018; // $50k  ‚Üí 1.8%
    if (volumeUsd >= 10_000) return 0.025; // $10k  ‚Üí 2.5%
    return 0.04; // <$10k ‚Üí 4%
  };
  const toUSD = sol => {
    const usd = (sol || 0) * solPrice;
    if (usd >= 1000) return '$' + (usd / 1000).toFixed(1) + 'k';
    if (usd >= 1) return '$' + usd.toFixed(0);
    return '$' + usd.toFixed(2);
  };

  // Fetch SOL/USD price every 60s
  useEffect(() => {
    const fetchPrice = async () => {
      try {
        const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd');
        const d = await r.json();
        if (d?.solana?.usd) setSolPrice(d.solana.usd);
      } catch (e) {}
    };
    fetchPrice();
    const t = setInterval(fetchPrice, 60000);
    return () => clearInterval(t);
  }, []);
  // Auto-publish score whenever user data changes
  useEffect(() => {
    if (!user?.id) return;
    const closedTrades = (user.trades || []).filter(t => t.status === 'closed');
    const wins = closedTrades.filter(t => (t.totalPnl || 0) > 0).length;
    const totalPnl = closedTrades.reduce((s, t) => s + (t.totalPnl || 0), 0);
    const winRate = closedTrades.length > 0 ? Math.round(wins / closedTrades.length * 100) : 0;
    const lvlIdx = LEVELS.reduce((acc, l, i) => (user.xp || 0) >= l.xp ? i : acc, 0);
    const entry = {
      id: user.id,
      username: user.username || 'Anon',
      xp: user.xp || 0,
      level: lvlIdx + 1,
      totalPnl: parseFloat(totalPnl.toFixed(4)),
      winRate,
      trades: closedTrades.length,
      updatedAt: Date.now()
    };
    // Use gstore for proper localStorage fallback
    const gs = {
      set: (k, v, s) => window.storage ? window.storage.set(k, v, s) : (localStorage.setItem(k, v), Promise.resolve())
    };
    gs.set(`helmrank${user.id}`, JSON.stringify(entry), true).catch(() => {});
  }, [user?.id, user?.xp, user?.trades]);

  // Fetch ranking when tab opens
  useEffect(() => {
    if (activeTab === 'ranking') fetchRanking();
  }, [activeTab]);
  const getWeekKey = () => {
    const d = new Date();
    const day = d.getDay() === 0 ? 6 : d.getDay() - 1; // Monday=0
    const monday = new Date(d);
    monday.setDate(d.getDate() - day);
    monday.setHours(0, 0, 0, 0);
    return monday.toISOString().split('T')[0];
  };
  const NARR_BASE = [{
    id: 'n_ai',
    title: 'AI Agents',
    emoji: 'ü§ñ',
    votes: 0
  }, {
    id: 'n_cap',
    title: 'Capybaras',
    emoji: 'ü¶´',
    votes: 0
  }, {
    id: 'n_elon',
    title: 'Elon',
    emoji: 'üê¶',
    votes: 0
  }, {
    id: 'n_cat',
    title: 'Cats',
    emoji: 'üê±',
    votes: 0
  }, {
    id: 'n_pol',
    title: 'Politics',
    emoji: 'üèõÔ∏è',
    votes: 0
  }, {
    id: 'n_dog',
    title: 'Dogs',
    emoji: 'üêï',
    votes: 0
  }, {
    id: 'n_frog',
    title: 'Frogs',
    emoji: 'üê∏',
    votes: 0
  }, {
    id: 'n_dino',
    title: 'Dinosaurs',
    emoji: 'ü¶ñ',
    votes: 0
  }, {
    id: 'n_retro',
    title: 'OG Memes',
    emoji: 'üëæ',
    votes: 0
  }, {
    id: 'n_anime',
    title: 'Anime',
    emoji: '‚õ©Ô∏è',
    votes: 0
  }, {
    id: 'n_pen',
    title: 'Penguins',
    emoji: 'üêß',
    votes: 0
  }, {
    id: 'n_space',
    title: 'Space',
    emoji: 'üöÄ',
    votes: 0
  }, {
    id: 'n_sport',
    title: 'Sports',
    emoji: '‚öΩ',
    votes: 0
  }, {
    id: 'n_kol',
    title: 'KOL / Creators',
    emoji: 'üì¢',
    votes: 0
  }, {
    id: 'n_food',
    title: 'Monkeys',
    emoji: 'üêí',
    votes: 0
  }, {
    id: 'n_celeb',
    title: 'Celebrities',
    emoji: '‚≠ê',
    votes: 0
  }];
  const [narratives, setNarratives] = useState(NARR_BASE);
  const [narrativesLoading, setNarrativesLoading] = useState(false);
  const NARR_KEY = `helmNarrVotes_${getWeekKey()}`;

  // Load shared narrative votes on mount
  useEffect(() => {
    const loadNarratives = async () => {
      setNarrativesLoading(true);
      try {
        // Try shared storage first
        if (window.storage) {
          const r = await window.storage.get(NARR_KEY, true).catch(() => null);
          if (r?.value) {
            const shared = JSON.parse(r.value);
            // Merge base + shared vote counts
            setNarratives(NARR_BASE.map(n => ({
              ...n,
              votes: shared[n.id] ?? n.votes
            })));
            setNarrativesLoading(false);
            return;
          }
        }
        // Fallback: localStorage
        const wk = getWeekKey();
        const saved = localStorage.getItem('helmNarratives');
        const savedWk = localStorage.getItem('helmNarrWk');
        if (saved && savedWk === wk) {
          const p = JSON.parse(saved);
          if (Array.isArray(p) && p[0]?.emoji) {
            setNarratives(p);
            setNarrativesLoading(false);
            return;
          }
        }
        localStorage.setItem('helmNarrWk', wk);
      } catch (e) {}
      setNarratives(NARR_BASE);
      setNarrativesLoading(false);
    };
    loadNarratives();
  }, []);
  const [userVotes, setUserVotes] = useState(() => {
    try {
      const wk = getWeekKey();
      if (localStorage.getItem('helmVotesWk') !== wk) {
        localStorage.removeItem('helmUserVotes');
        localStorage.setItem('helmVotesWk', wk);
        return {};
      }
      const s = localStorage.getItem('helmUserVotes');
      return s ? JSON.parse(s) : {};
    } catch (e) {
      return {};
    }
  });
  const pnlChartRef = useRef(null);
  const winRateChartRef = useRef(null);
  const showToast = (message, type = 'success') => {
    setToast({
      message,
      type
    });
  };
  const showXPGain = (xp, reason) => {
    setXPPopup({
      xp,
      reason
    });
  };
  const addXP = (typeOrAmount, reason) => {
    const xpAmount = typeof typeOrAmount === 'number' ? typeOrAmount : XP_TYPES[typeOrAmount] || 0;
    setUser(prev => {
      if (!prev) return prev;
      const oldLevel = getCurrentLevel(prev.xp || 0);
      const newXP = Math.max(0, (prev.xp || 0) + xpAmount); // never negative
      const newLevel = getCurrentLevel(newXP);
      if (newLevel > oldLevel) {
        setTimeout(() => {
          showToast(`üéâ Level Up! Now ${LEVELS[newLevel - 1].name} (Lvl ${newLevel})`, 'success');
        }, 2100);
      } else if (newLevel < oldLevel) {
        setTimeout(() => {
          showToast(`üìâ Level Down... Now ${LEVELS[newLevel - 1].name} (Lvl ${newLevel})`, 'warning');
        }, 2100);
      }
      return {
        ...prev,
        xp: newXP
      };
    });
    showXPGain(xpAmount, reason);
  };
  const getCurrentLevel = xp => {
    for (let i = LEVELS.length - 1; i >= 0; i--) {
      if (xp >= LEVELS[i].xp) {
        return LEVELS[i].level;
      }
    }
    return 1;
  };
  const getNextLevelXP = currentXP => {
    const currentLevel = getCurrentLevel(currentXP);
    if (currentLevel >= LEVELS.length) return LEVELS[LEVELS.length - 1].xp;
    return LEVELS[currentLevel].xp;
  };
  const checkBadges = newUser => {
    const badges = new Set(newUser.badges || []);
    const trades = newUser.trades || [];
    const closedTrades = trades.filter(t => t.status === 'closed');
    const wins = closedTrades.filter(t => (t.totalPnl || t.pnl || 0) > 0);

    // First trade
    if (trades.length >= 1 && !badges.has('first_trade')) {
      badges.add('first_trade');
      setTimeout(() => showToast('üéØ Badge Unlocked: First Trade!', 'success'), 500);
    }

    // First profit
    if (wins.length >= 1 && !badges.has('first_profit')) {
      badges.add('first_profit');
      setTimeout(() => showToast('üí∞ Badge Unlocked: First Win!', 'success'), 500);
    }

    // Streaks
    const currentStreak = newUser.currentStreak || 0;
    if (currentStreak >= 3 && !badges.has('hot_streak_3')) badges.add('hot_streak_3');
    if (currentStreak >= 5 && !badges.has('hot_streak_5')) badges.add('hot_streak_5');
    if (currentStreak >= 10 && !badges.has('hot_streak_10')) badges.add('hot_streak_10');

    // Win rate
    if (closedTrades.length >= 10) {
      const winRate = wins.length / closedTrades.length * 100;
      if (winRate >= 50 && !badges.has('win_rate_50')) badges.add('win_rate_50');
      if (winRate >= 60 && !badges.has('win_rate_60')) badges.add('win_rate_60');
      if (winRate >= 70 && !badges.has('win_rate_70')) badges.add('win_rate_70');
      if (winRate >= 80 && !badges.has('win_rate_80')) badges.add('win_rate_80');
    }

    // Analyst
    if ((newUser.analysisCount || 0) >= 10 && !badges.has('analyst')) {
      badges.add('analyst');
    }

    // Trade count
    if (trades.length >= 10 && !badges.has('trader_10')) badges.add('trader_10');
    if (trades.length >= 50 && !badges.has('trader_50')) badges.add('trader_50');
    if (trades.length >= 100 && !badges.has('trader_100')) badges.add('trader_100');
    return Array.from(badges);
  };
  useEffect(() => {
    const saved = localStorage.getItem('helmUser');
    if (saved) {
      // Load from localStorage immediately (fast)
      const userData = JSON.parse(saved);
      userData.xp = userData.xp || 0;
      userData.badges = userData.badges || [];
      userData.currentStreak = userData.currentStreak || 0;
      userData.analysisCount = userData.analysisCount || 0;
      // Then try to get fresher data from Supabase in background
      const key = localStorage.getItem('helmUserKey') || ('helmuser_' + (userData.username||'').toLowerCase());
      helmStorage.get(key, true).then(r => {
        if (r && r.value) {
          const fresh = JSON.parse(r.value);
          // Only use Supabase data if it's newer
          if (fresh.createdAt && (!userData.createdAt || fresh.trades?.length >= userData.trades?.length)) {
            fresh.xp = fresh.xp || 0;
            fresh.badges = fresh.badges || [];
            fresh.currentStreak = fresh.currentStreak || 0;
            fresh.analysisCount = fresh.analysisCount || 0;
            fresh.trades = Array.isArray(fresh.trades) ? fresh.trades.map(t => ({
              ...t, entries: t.entries||[{price:t.avgEntryPrice||0,amountSOL:t.totalInvested||0,timestamp:t.openedAt||new Date().toISOString()}],
              partialExits: t.partialExits||[]
            })) : [];
            setUser(fresh);
            localStorage.setItem('helmUser', JSON.stringify(fresh));
          }
        }
      }).catch(() => {});

      // MIGRATE old trades to new structure
      if (Array.isArray(userData.trades)) {
        userData.trades = userData.trades.map(t => {
          // If trade has old structure (entryPrice, amountSOL) migrate it
          if (!t.entries) {
            const price = t.entryPrice || t.avgEntryPrice || 0;
            const sol = t.amountSOL || t.totalInvested || 0;
            return {
              ...t,
              tokenAddress: t.tokenAddress || '',
              entries: [{
                price,
                amountSOL: sol,
                timestamp: t.openedAt || new Date().toISOString()
              }],
              totalInvested: sol,
              avgEntryPrice: price,
              partialExits: t.partialExits || [],
              totalPnl: t.totalPnl || t.pnl || 0
            };
          }
          // Ensure partialExits exists
          return {
            ...t,
            partialExits: t.partialExits || []
          };
        });
      } else {
        userData.trades = [];
      }
      setUser(userData);
    }
    const savedTheme = localStorage.getItem('helmTheme') || 'default';
    setTheme(savedTheme);
    applyTheme(savedTheme);
  }, []);
  useEffect(() => {
    if (user) {
      localStorage.setItem('helmUser', JSON.stringify(user));
      // Sync to Supabase (debounced via the useEffect dependency)
      const key = localStorage.getItem('helmUserKey') || ('helmuser_' + (user.username||'').toLowerCase());
      helmStorage.set(key, JSON.stringify(user), true).catch(() => {});
    }
  }, [user]);
  const applyTheme = themeName => {
    document.body.className = '';
    if (themeName === 'light') document.body.classList.add('light-theme');
    if (themeName === 'neon') document.body.classList.add('neon-theme');
    setTheme(themeName);
    localStorage.setItem('helmTheme', themeName);
  };

  // Charts (same as V3)
  useEffect(() => {
    if (!user || !user.trades || activeTab !== 'profile') return;
    const closedTrades = user.trades.filter(t => t.status === 'closed');
    if (closedTrades.length === 0) return;
    const last7Days = [];
    for (let i = 6; i >= 0; i--) {
      const date = new Date();
      date.setDate(date.getDate() - i);
      const dateStr = date.toLocaleDateString('en-US', {
        weekday: 'short'
      });
      const dayTrades = closedTrades.filter(t => {
        const tradeDate = new Date(t.closedAt);
        return tradeDate.toDateString() === date.toDateString();
      });
      const dayPnl = dayTrades.reduce((sum, t) => sum + (t.totalPnl || t.pnl || 0), 0);
      last7Days.push({
        date: dateStr,
        pnl: dayPnl
      });
    }
    if (pnlChartRef.current) {
      const ctx = pnlChartRef.current.getContext('2d');
      if (window.pnlChart) window.pnlChart.destroy();
      window.pnlChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: last7Days.map(d => d.date),
          datasets: [{
            label: 'P&L (SOL)',
            data: last7Days.map(d => d.pnl),
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              grid: {
                color: 'rgba(255,255,255,0.1)'
              },
              ticks: {
                color: '#94a3b8'
              }
            },
            x: {
              grid: {
                color: 'rgba(255,255,255,0.1)'
              },
              ticks: {
                color: '#94a3b8'
              }
            }
          }
        }
      });
    }
  }, [user, activeTab]);
  useEffect(() => {
    if (!user || !user.trades || activeTab !== 'profile') return;
    const closedTrades = user.trades.filter(t => t.status === 'closed');
    if (closedTrades.length === 0) return;
    const wins = closedTrades.filter(t => (t.totalPnl || t.pnl || 0) > 0).length;
    const losses = closedTrades.length - wins;
    if (winRateChartRef.current) {
      const ctx = winRateChartRef.current.getContext('2d');
      if (window.winRateChart) window.winRateChart.destroy();
      window.winRateChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Wins', 'Losses'],
          datasets: [{
            data: [wins, losses],
            backgroundColor: ['#10b981', '#ef4444'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: '#94a3b8'
              }
            }
          }
        }
      });
    }
  }, [user, activeTab]);

  // ‚îÄ‚îÄ RANKING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // ‚îÄ‚îÄ GLOBAL STORAGE HELPER (same pattern as CommunityTab) ‚îÄ‚îÄ
  const gstore = {
    set: (k, v, s) => window.storage ? window.storage.set(k, v, s) : (localStorage.setItem(k, v), Promise.resolve({
      key: k,
      value: v
    })),
    get: (k, s) => window.storage ? window.storage.get(k, s) : (() => {
      const v = localStorage.getItem(k);
      if (v === null) return Promise.reject(new Error('nf'));
      return Promise.resolve({
        key: k,
        value: v
      });
    })(),
    list: (p, s) => window.storage ? window.storage.list(p, s) : Promise.resolve({
      keys: Object.keys(localStorage).filter(k => k.startsWith(p))
    })
  };
  const publishRanking = async u => {
    if (!u?.id) return;
    try {
      const closedTrades = (u.trades || []).filter(t => t.status === 'closed');
      const wins = closedTrades.filter(t => (t.totalPnl || 0) > 0).length;
      const totalPnl = closedTrades.reduce((s, t) => s + (t.totalPnl || 0), 0);
      const winRate = closedTrades.length > 0 ? Math.round(wins / closedTrades.length * 100) : 0;
      const lvlIdx = LEVELS.reduce((acc, l, i) => (u.xp || 0) >= l.xp ? i : acc, 0);
      const entry = {
        id: u.id,
        username: u.username || 'Anon',
        xp: u.xp || 0,
        level: lvlIdx + 1,
        totalPnl: parseFloat(totalPnl.toFixed(4)),
        winRate,
        trades: closedTrades.length,
        updatedAt: Date.now()
      };
      await gstore.set(`helmrank${u.id}`, JSON.stringify(entry), true);
    } catch (e) {}
  };
  const fetchRanking = async () => {
    setRankingLoading(true);
    try {
      const result = await gstore.list('helmrank', true);
      const keys = (result?.keys || []).filter(k => !k.startsWith('helmcommrank'));
      const entries = await Promise.all(keys.map(async k => {
        try {
          const r = await gstore.get(k, true);
          return r ? JSON.parse(r.value) : null;
        } catch {
          return null;
        }
      }));
      setRanking(entries.filter(Boolean).sort((a, b) => b.xp - a.xp));
    } catch (e) {
      setRanking([]);
    } finally {
      setRankingLoading(false);
    }
  };

  // ‚îÄ‚îÄ MISSIONS & BANKRUPT SYSTEM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const REWARD_SOL = 0.2;
  const MAX_ADS_PER_DAY = 3;
  const MISSIONS = [{
    id: 'post_community',
    icon: '‚úçÔ∏è',
    label: 'Post in Community',
    desc: 'Share something with the community',
    reward: REWARD_SOL
  }, {
    id: 'vote_narrative',
    icon: 'üåä',
    label: 'Vote on a Narrative',
    desc: 'Cast your vote on the weekly narrative',
    reward: REWARD_SOL
  }, {
    id: 'login_streak',
    icon: 'üî•',
    label: '3-Day Login Streak',
    desc: 'Log in 3 days in a row',
    reward: REWARD_SOL
  }, {
    id: 'close_trade',
    icon: 'üí∞',
    label: 'Close a Trade',
    desc: 'Open and close any trade position',
    reward: REWARD_SOL
  }, {
    id: 'setup_username',
    icon: '‚úèÔ∏è',
    label: 'Set Your Username',
    desc: 'Personalize your profile name',
    reward: REWARD_SOL
  }, {
    id: 'invite_friend',
    icon: 'üë•',
    label: 'Invite a Friend',
    desc: 'Share your referral link',
    reward: 0.5
  }];
  const todayStr = () => new Date().toISOString().split('T')[0];
  const weekStr = () => getWeekKey();
  const getMissionsData = () => {
    try {
      return JSON.parse(localStorage.getItem('helmMissions') || '{}');
    } catch {
      return {};
    }
  };
  const saveMissionsData = d => localStorage.setItem('helmMissions', JSON.stringify(d));
  const getAdsToday = () => {
    try {
      const d = JSON.parse(localStorage.getItem('helmAds') || '{}');
      return d[todayStr()] || 0;
    } catch {
      return 0;
    }
  };
  const bumpAdsToday = () => {
    try {
      const d = JSON.parse(localStorage.getItem('helmAds') || '{}');
      d[todayStr()] = (d[todayStr()] || 0) + 1;
      localStorage.setItem('helmAds', JSON.stringify(d));
    } catch {}
  };
  const isMissionDone = id => {
    const d = getMissionsData();
    if (id === 'login_streak') return d['login_streak_week'] === weekStr();
    if (id === 'vote_narrative') return d['vote_narrative_week'] === weekStr();
    if (id === 'invite_friend') return d['invite_friend_week'] === weekStr();
    return d[`${id}_${todayStr()}`] === true;
  };
  const completeMission = id => {
    const d = getMissionsData();
    if (id === 'login_streak') d['login_streak_week'] = weekStr();else if (id === 'vote_narrative') d['vote_narrative_week'] = weekStr();else if (id === 'invite_friend') d['invite_friend_week'] = weekStr();else d[`${id}_${todayStr()}`] = true;
    saveMissionsData(d);
    const mission = MISSIONS.find(m => m.id === id);
    if (!mission) return;
    setUser(prev => ({
      ...prev,
      balance: (prev.balance || 0) + mission.reward
    }));
    showToast(`+${mission.reward} SOL ‚Äî ${mission.label} ‚úÖ`, 'success');
    addXP(50, `‚úÖ Mission: ${mission.label}`);
    setShowMissions(false);
    setShowBankrupt(false);
  };

  // Check bankrupt after every balance change
  useEffect(() => {
    if (!user) return;
    const openSol = (user.trades || []).filter(t => t.status === 'active').reduce((s, t) => s + (t.totalInvested || 0), 0);
    const effective = (user.balance || 0) + openSol;
    if (effective < 0.05 && !showMissions) setShowBankrupt(true);else if (effective >= 0.05) setShowBankrupt(false);
  }, [user?.balance, user?.trades?.length]);

  // Watch Ad flow
  const startWatchAd = () => {
    if (getAdsToday() >= MAX_ADS_PER_DAY) {
      showToast(`Max ${MAX_ADS_PER_DAY} ads per day reached`, 'warning');
      return;
    }
    setAdWatching(true);
    setAdTimer(15);
    const interval = setInterval(() => {
      setAdTimer(prev => {
        if (prev <= 1) {
          clearInterval(interval);
          setAdWatching(false);
          bumpAdsToday();
          setUser(p => ({
            ...p,
            balance: (p.balance || 0) + REWARD_SOL
          }));
          showToast(`+${REWARD_SOL} SOL ‚Äî Ad reward! üéâ`, 'success');
          addXP(20, 'üì∫ Watched ad');
          setShowBankrupt(false);
          setShowMissions(false);
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
  };

  // Auto-complete username mission when username is set
  useEffect(() => {
    if (user?.username && user.username !== 'Demo User' && !isMissionDone('setup_username')) {
      completeMission('setup_username');
    }
  }, [user?.username]);

  // Auto-complete vote_narrative mission when user votes
  const handleVoteWithMission = async id => {
    await handleVote(id);
    if (!isMissionDone('vote_narrative')) {
      completeMission('vote_narrative');
    }
  };

  // Auto-complete post_community when user posts (called from addXP check)
  const checkPostMission = () => {
    if (!isMissionDone('post_community')) completeMission('post_community');
  };

  // Auto-complete close_trade mission
  const checkCloseMission = () => {
    if (!isMissionDone('close_trade')) completeMission('close_trade');
  };
  const handleLogin = async (username) => {
    const key = 'helmuser_' + username.toLowerCase();
    let userData = null;
    let isNew = false;

    // Try loading existing user from Supabase (shared)
    try {
      const r = await helmStorage.get(key, true);
      if (r && r.value) {
        userData = JSON.parse(r.value);
        // Migrate old structure if needed
        userData.xp = userData.xp || 0;
        userData.badges = userData.badges || [];
        userData.currentStreak = userData.currentStreak || 0;
        userData.analysisCount = userData.analysisCount || 0;
        userData.trades = Array.isArray(userData.trades) ? userData.trades.map(t => ({
          ...t,
          entries: t.entries || [{price: t.avgEntryPrice||0, amountSOL: t.totalInvested||0, timestamp: t.openedAt||new Date().toISOString()}],
          partialExits: t.partialExits || [],
        })) : [];
      }
    } catch(e) {
      // Key not found = new user
      isNew = true;
    }

    if (!userData) {
      isNew = true;
      userData = {
        id: 'u_' + username.toLowerCase() + '_' + Date.now(),
        username: username,
        balance: 5.0,
        trades: [],
        xp: 0,
        badges: [],
        currentStreak: 0,
        analysisCount: 0,
        createdAt: new Date().toISOString(),
      };
      // Save new user to Supabase
      try {
        await helmStorage.set(key, JSON.stringify(userData), true);
      } catch(e) {
        console.warn('Could not save user to Supabase, using local only:', e);
      }
    }

    // Always cache locally for fast load
    localStorage.setItem('helmUser', JSON.stringify(userData));
    localStorage.setItem('helmUserKey', key);

    setUser(userData);
    showToast(isNew ? 'Welcome to HELM! üéâ' : 'Welcome back, ' + username + '! üëã', 'success');
    if (isNew) setTimeout(() => setTutorialStep(0), 600);
  };
  const analyzeToken = async () => {
    if (!tokenAddress) {
      showToast('Please enter a token address', 'warning');
      return;
    }
    setLoading(true);
    try {
      const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${tokenAddress}`);
      const data = await res.json();
      if (data.pairs && data.pairs.length > 0) {
        const pair = data.pairs[0];
        const tokenData = {
          address: tokenAddress,
          name: pair.baseToken?.name || 'Unknown',
          symbol: pair.baseToken?.symbol || '???',
          price: parseFloat(pair.priceUsd) || 0,
          liquidity: pair.liquidity?.usd || 0,
          volume24h: pair.volume?.h24 || 0,
          priceChange24h: pair.priceChange?.h24 || 0,
          txns24h: pair.txns?.h24 || {},
          marketCap: pair.fdv || pair.marketCap || 0,
          pairAddress: pair.pairAddress,
          dexId: pair.dexId,
          url: pair.url,
          pairCreatedAt: pair.pairCreatedAt,
          boosts: pair.boosts || {},
          priceChange1h: pair.priceChange?.h1 || 0,
          priceChange6h: pair.priceChange?.h6 || 0,
          holders: pair.holders || null,
          // may not be present
          // Social links
          links: {
            telegram: pair.info?.socials?.find(s => s.type === 'telegram')?.url || null,
            twitter: pair.info?.socials?.find(s => s.type === 'twitter')?.url || null,
            website: pair.info?.websites?.[0]?.url || null
          },
          // DEX paid profile
          hasDexPaid: !!(pair.info?.imageUrl || pair.info?.header || pair.info?.socials?.length > 0)
        };
        let riskScore = 100;
        const redFlags = [],
          greenFlags = [];
        if (tokenData.marketCap > 0) {
          if (tokenData.marketCap < 10000) { riskScore -= 20; redFlags.push('üö® MC < $10k ‚Äî too small, extremely risky'); }
          else if (tokenData.marketCap <= 100000) { greenFlags.push('‚úÖ MC $' + (tokenData.marketCap/1000).toFixed(0) + 'k ‚Äî sweet spot ($10k-$100k entry zone)'); }
          else if (tokenData.marketCap > 1000000) { riskScore -= 10; redFlags.push('‚ö†Ô∏è MC $' + (tokenData.marketCap/1000000).toFixed(1) + 'M ‚Äî may already be at top'); }
        }
        if (tokenData.liquidity < 10000) { riskScore -= 25; redFlags.push('üö® Very low liquidity (< $10k) ‚Äî easy to manipulate'); }
        else if (tokenData.liquidity < 50000) { riskScore -= 12; redFlags.push('‚ö†Ô∏è Low liquidity (< $50k)'); }
        else if (tokenData.liquidity > 100000) greenFlags.push('‚úÖ Good liquidity (> $100k)');
        if (tokenData.volume24h < 5000) { riskScore -= 20; redFlags.push('üö® Very low volume (< $5k/24h) ‚Äî no real activity'); }
        else if (tokenData.volume24h > 50000) greenFlags.push('‚úÖ Healthy volume (> $50k/24h)');
        if (tokenData.marketCap > 0 && tokenData.volume24h > 0) {
          const volMcRatio = tokenData.volume24h / tokenData.marketCap;
          if (volMcRatio > 5) { riskScore -= 20; redFlags.push('üö® Vol/MC ratio ' + volMcRatio.toFixed(1) + 'x ‚Äî possible wash trading'); }
          else if (volMcRatio > 2) { riskScore -= 10; redFlags.push('‚ö†Ô∏è Vol/MC ratio ' + volMcRatio.toFixed(1) + 'x ‚Äî suspicious'); }
        }
        if (tokenData.pairCreatedAt) {
          const ageDays = (Date.now() - tokenData.pairCreatedAt) / 86400000;
          if (ageDays < 1)      { riskScore -= 35; redFlags.push('üö® Token < 1 day old ‚Äî extreme rug risk'); }
          else if (ageDays < 3) { riskScore -= 25; redFlags.push('üö® Token < 3 days old ‚Äî very risky'); }
          else if (ageDays < 7) { riskScore -= 15; redFlags.push('‚ö†Ô∏è Very new token (< 1 week)'); }
          else if (ageDays > 30) greenFlags.push('‚úÖ Established token (> 30 days)');
        }
        if (tokenData.topHolderPct > 0) {
          if (tokenData.topHolderPct > 10) { riskScore -= 25; redFlags.push('üö® Top holder owns ' + tokenData.topHolderPct.toFixed(1) + '% ‚Äî likely insider/sniper'); }
          else if (tokenData.topHolderPct > 3) { riskScore -= 12; redFlags.push('‚ö†Ô∏è Top holder ' + tokenData.topHolderPct.toFixed(1) + '% ‚Äî above 2.5-3% safe threshold'); }
          else if (tokenData.topHolderPct <= 2.5) greenFlags.push('‚úÖ Top holder ' + tokenData.topHolderPct.toFixed(1) + '% ‚Äî within safe insider threshold (<=2.5%)');
        }
        if (tokenData.holders > 0 && tokenData.marketCap > 0) {
          const avgBag = tokenData.marketCap / tokenData.holders;
          tokenData.avgBagUsd = avgBag;
          if (avgBag > tokenData.holders) { riskScore -= 15; redFlags.push('üö® Avg bag $' + avgBag.toFixed(0) + ' > ' + tokenData.holders + ' holders ‚Äî suspicious concentration'); }
          if (tokenData.holders > 1000 && avgBag < 50) { riskScore -= 12; redFlags.push('‚ö†Ô∏è ' + tokenData.holders.toLocaleString() + ' holders but avg bag only $' + avgBag.toFixed(0) + ' ‚Äî possible bots'); }
          if (tokenData.holders >= 500 && avgBag >= 50 && avgBag <= tokenData.holders) greenFlags.push('‚úÖ Healthy distribution: ' + tokenData.holders.toLocaleString() + ' holders, avg bag $' + avgBag.toFixed(0));
          if (tokenData.holders < 100) { riskScore -= 15; redFlags.push('üö® Only ' + tokenData.holders + ' holders ‚Äî very early'); }
          else if (tokenData.holders < 300) { riskScore -= 8; redFlags.push('‚ö†Ô∏è Only ' + tokenData.holders + ' holders ‚Äî low distribution'); }
          else if (tokenData.holders > 2000) greenFlags.push('‚úÖ Strong holder base: ' + tokenData.holders.toLocaleString() + ' holders');
        }
        const buys = tokenData.txns24h && tokenData.txns24h.buys || 0;
        const sells = tokenData.txns24h && tokenData.txns24h.sells || 0;
        const totalTxns = buys + sells;
        if (totalTxns < 10) { riskScore -= 15; redFlags.push('üö® Very few transactions (< 10 in 24h)'); }
        else if (totalTxns > 100) greenFlags.push('‚úÖ Active trading (> 100 txns/24h)');
        if (sells > 0 && buys/sells < 0.5) { riskScore -= 12; redFlags.push('üö® Strong sell pressure ‚Äî whales dumping?'); }
        else if (buys > sells * 1.5) greenFlags.push('‚úÖ Strong buy pressure');
        if (totalTxns > 20 && sells > 0 && buys/sells > 10) { riskScore -= 18; redFlags.push('üö® Suspicious buy/sell ratio (' + buys + '/' + sells + ') ‚Äî possible wash trading'); }
        const pc1h = tokenData.priceChange1h||0, pc6h = tokenData.priceChange6h||0, pc24h = tokenData.priceChange24h||0;
        if (pc1h>30 && pc6h>30 && pc24h>50) { riskScore -= 15; redFlags.push('üö® Continuous pump (+' + pc1h.toFixed(0) + '%/1h) ‚Äî wait for dip'); }
        if (Math.abs(pc24h) > 100) { riskScore -= 15; redFlags.push('üö® Extreme 24h volatility'); }
        if (tokenData.marketCap > 0 && tokenData.liquidity > 0) {
          const ratio = tokenData.marketCap / tokenData.liquidity;
          if (ratio > 1000) { riskScore -= 15; redFlags.push('üö® MC/Liq ratio ' + (ratio/1000).toFixed(1) + 'k√ó ‚Äî very easy to dump'); }
          else if (ratio < 50) greenFlags.push('‚úÖ Healthy MC/Liq ratio');
        }
        const knownDexes = ['raydium','pumpswap','pump.fun','orca','meteora'];
        if (tokenData.dexId === 'raydium') greenFlags.push("‚úÖ Pair on Raydium ‚Äî Solana's main DEX");
        else if (tokenData.dexId==='pumpswap'||tokenData.dexId==='pump.fun') greenFlags.push('‚úÖ Pair on ' + tokenData.dexId + ' ‚Äî legitimate platform');
        else if (tokenData.dexId && !knownDexes.includes(tokenData.dexId)) { riskScore -= 8; redFlags.push('‚ö†Ô∏è Pair on unknown DEX (' + tokenData.dexId + ')'); }
        const boostAmt = tokenData.boosts && tokenData.boosts.active || 0;
        const hasAds = !!(pair.info && pair.info.header);
        if (boostAmt > 400) { riskScore -= 25; redFlags.push('üö® Excessive boost (' + boostAmt + 'x) ‚Äî farm/dump signal'); if (hasAds) { riskScore -= 10; redFlags.push('üö® High boost + paid banner = suspicious'); } }
        else if (boostAmt > 0) greenFlags.push('üöÄ ' + boostAmt + 'x DEX Boost active');
        const isDexPaid = !!(pair.info && (pair.info.imageUrl || pair.info.header || pair.info.socials && pair.info.socials.length > 0));
        if (isDexPaid && boostAmt <= 400) { riskScore += 10; greenFlags.push('üí≥ Paid DEX profile ‚Äî project invested in visibility'); }
        if (tokenData.links.telegram) greenFlags.push('üì£ Verified Telegram on DEX');
        if (tokenData.links.twitter)  greenFlags.push('üê¶ Verified Twitter/X on DEX');
        if (tokenData.links.website)  greenFlags.push('üåê Verified website on DEX');
        if (!tokenData.links.telegram && !tokenData.links.twitter && !tokenData.links.website) { riskScore -= 10; redFlags.push('‚ö†Ô∏è No social links on DEX ‚Äî anonymous project'); }
        else if (tokenData.links.telegram && tokenData.links.twitter) greenFlags.push('‚úÖ Multiple social channels verified');
        tokenData.holders = tokenData.holders || null;
        tokenData.riskScore = Math.max(0, Math.min(100, riskScore));
        tokenData.redFlags = redFlags;
        tokenData.greenFlags = greenFlags;
        tokenData.riskLevel = riskScore >= 70 ? 'low' : riskScore >= 50 ? 'medium' : riskScore >= 30 ? 'high' : 'extreme';
        setAnalysis(tokenData);
        showToast('Token analyzed!', 'success');
      } else {
        showToast('Token not found', 'error');
      }
    } catch (error) {
      showToast('Error: ' + error.message, 'error');
    } finally {
      setLoading(false);
    }
  };
  const registerTrade = () => {
    // Open custom buy modal instead of prompt
    setBuyModal({
      type: 'ape'
    });
  };
  const confirmApe = (amount, reason) => {
    if (isNaN(amount) || amount <= 0 || amount > user.balance) {
      showToast('Insufficient balance!', 'error');
      return;
    }
    const slipPct = calcSlippage(analysis.volume24h);
    const slipCost = amount * slipPct; // SOL lost to slippage on buy
    const effectiveAmount = amount + slipCost; // total deducted from balance
    const slippedPrice = analysis.price * (1 + slipPct); // entry price is worse
    const newTrade = {
      id: Date.now().toString(),
      tokenAddress: analysis.address,
      tokenName: analysis.name,
      tokenSymbol: analysis.symbol,
      status: 'active',
      openedAt: new Date().toISOString(),
      buyReason: reason,
      entries: [{
        price: slippedPrice,
        amountSOL: amount,
        timestamp: new Date().toISOString()
      }],
      totalInvested: amount,
      avgEntryPrice: slippedPrice,
      slippagePct: slipPct,
      slippageCost: slipCost,
      partialExits: []
    };
    const updatedUser = {
      ...user,
      balance: user.balance - effectiveAmount,
      trades: [...(user.trades || []), newTrade]
    };
    updatedUser.badges = checkBadges(updatedUser);
    setUser(updatedUser);
    setBuyModal(null);
    showToast(`üöÄ APE! ${amount.toFixed(2)} SOL ¬∑ slippage ${(slipPct * 100).toFixed(1)}% (-${slipCost.toFixed(3)} SOL)`, 'success');
    if (updatedUser.trades.length === 1) setTimeout(() => showToast('üéØ First trade!', 'success'), 800);
    setAnalysis(null);
    setActiveTab('portfolio');
  };

  // ADVANCED TRADING FUNCTIONS
  const handleDCA = trade => {
    setBuyModal({
      type: 'dca',
      trade
    });
  };
  const confirmDCA = async (amount, trade) => {
    if (isNaN(amount) || amount <= 0 || amount > user.balance) {
      showToast('Insufficient balance!', 'error');
      return;
    }
    setBuyModal(null);
    const dcaSlipPct = calcSlippage(analysis?.volume24h || 0);
    const dcaSlipCost = amount * dcaSlipPct;
    try {
      const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${trade.tokenAddress}`);
      const data = await res.json();
      const currentPrice = data.pairs?.[0] ? parseFloat(data.pairs[0].priceUsd) : trade.avgEntryPrice;
      const newEntry = {
        price: currentPrice,
        amountSOL: amount,
        timestamp: new Date().toISOString()
      };
      const updatedEntries = [...trade.entries, newEntry];
      const totalInvested = trade.totalInvested + amount;
      const avgEntryPrice = updatedEntries.reduce((sum, e) => sum + e.price * e.amountSOL, 0) / totalInvested;
      const updatedUser = {
        ...user,
        balance: user.balance - amount - dcaSlipCost,
        trades: user.trades.map(t => t.id === trade.id ? {
          ...t,
          entries: updatedEntries,
          totalInvested,
          avgEntryPrice
        } : t)
      };
      updatedUser.badges = checkBadges(updatedUser);
      setUser(updatedUser);
      showToast(`üìâ DCA added! +${amount.toFixed(2)} SOL`, 'success');
    } catch (error) {
      showToast('Error fetching price', 'error');
    }
  };
  const handlePartialSell = trade => {
    setBuyModal({
      type: 'partial',
      trade
    });
  };
  const confirmPartialSell = async (percentage, trade, sellReason) => {
    if (isNaN(percentage) || percentage <= 0 || percentage > 100) {
      showToast('Invalid percentage!', 'error');
      return;
    }
    setBuyModal(null);
    try {
      const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${trade.tokenAddress}`);
      const data = await res.json();
      const currentPrice = data.pairs?.[0] ? parseFloat(data.pairs[0].priceUsd) : trade.avgEntryPrice;
      const sellAmount = trade.totalInvested * (percentage / 100);
      const priceChange = (currentPrice - trade.avgEntryPrice) / trade.avgEntryPrice * 100;
      const partialVol = data.pairs?.[0] ? parseFloat(data.pairs[0].volume?.h24 || 0) * currentPrice : 0;
      const partialSlipPct = calcSlippage(partialVol || 0);
      const partialSlipCost = (sellAmount + sellAmount * (priceChange / 100)) * partialSlipPct;
      const pnl = sellAmount * (priceChange / 100) - partialSlipCost;
      const returned = sellAmount + pnl;
      const remainingInvested = trade.totalInvested - sellAmount;
      if (remainingInvested < 0.01) {
        return handleCloseTrade(trade.id);
      }
      const updatedUser = {
        ...user,
        balance: user.balance + returned,
        trades: user.trades.map(t => t.id === trade.id ? {
          ...t,
          totalInvested: remainingInvested,
          partialExits: [...(t.partialExits || []), {
            percentage,
            soldSOL: sellAmount,
            price: currentPrice,
            pnl,
            sellReason: sellReason || '‚Äî',
            timestamp: new Date().toISOString()
          }]
        } : t)
      };
      setUser(updatedUser);
      showToast(`Vendido ${percentage}%! P&L: ${pnl >= 0 ? '+' : ''}${pnl.toFixed(3)} SOL`, pnl >= 0 ? 'success' : 'warning');
    } catch (error) {
      showToast('Error fetching price', 'error');
    }
  };
  const handleCloseTrade = tradeId => {
    const trade = user.trades.find(t => t.id === tradeId);
    if (trade) setCloseModal(trade);
  };
  const confirmCloseTrade = async (tradeId, sellReason) => {
    setCloseModal(null);
    const trade = user.trades.find(t => t.id === tradeId);
    if (!trade) return;
    try {
      const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${trade.tokenAddress}`);
      const data = await res.json();
      const currentPrice = data.pairs?.[0] ? parseFloat(data.pairs[0].priceUsd) : trade.avgEntryPrice;
      const priceChange = (currentPrice - trade.avgEntryPrice) / trade.avgEntryPrice * 100;
      const partialPnl = (trade.partialExits || []).reduce((sum, exit) => sum + exit.pnl, 0);
      const remainingPnl = trade.totalInvested * (priceChange / 100);
      // Slippage on exit: use volume from live data or trade's recorded slippage tier
      const exitVol = data.pairs?.[0] ? parseFloat(data.pairs[0].volume?.h24 || 0) * currentPrice : 0;
      const exitSlipPct = calcSlippage(exitVol || (trade.slippagePct ? trade.slippagePct * 150000 : 0));
      const exitSlipCost = (trade.totalInvested + remainingPnl) * exitSlipPct;
      const totalPnl = partialPnl + remainingPnl - exitSlipCost;
      const returned = trade.totalInvested + remainingPnl - exitSlipCost;
      const totalSlippage = (trade.slippageCost || 0) + exitSlipCost;
      const updatedUser = {
        ...user,
        balance: user.balance + returned,
        trades: user.trades.map(t => t.id === tradeId ? {
          ...t,
          status: 'closed',
          exitPrice: currentPrice,
          totalPnl,
          sellReason,
          closedAt: new Date().toISOString(),
          exitSlipPct,
          exitSlipCost,
          totalSlippage
        } : t)
      };
      if (totalPnl > 0) {
        updatedUser.currentStreak = (updatedUser.currentStreak || 0) + 1;
        if (updatedUser.currentStreak === 3) setTimeout(() => addXP('HOT_STREAK_3', '3 Win Streak!'), 1000);
        if (updatedUser.currentStreak === 5) setTimeout(() => addXP('HOT_STREAK_5', '5 Win Streak!'), 1000);
        if (updatedUser.currentStreak === 10) setTimeout(() => addXP('HOT_STREAK_10', '10 Win Streak!!!'), 1000);
      } else {
        updatedUser.currentStreak = 0;
      }
      updatedUser.badges = checkBadges(updatedUser);
      setUser(updatedUser);
      showToast(`Position closed! P&L: ${totalPnl >= 0 ? '+' : ''}${totalPnl.toFixed(3)} SOL (slip: -${totalSlippage.toFixed(3)})`, totalPnl >= 0 ? 'success' : 'warning');

        // Post-trade educational tip (#4)
        const _holdDays = trade.openedAt ? (Date.now() - new Date(trade.openedAt)) / 86400000 : 0;
        const _pnlPct   = (totalPnl / (trade.totalInvested||1)) * 100;
        const _priceChg = trade.avgEntryPrice > 0 ? ((currentPrice - trade.avgEntryPrice) / trade.avgEntryPrice * 100) : 0;
        let _tip = null;
        if (totalPnl < 0 && sellReason === 'BAD_ENTRY')       _tip = "Bad Entry detected: Next time wait for the first dip before buying. Never chase a pump. (Rule 1)";
        else if (totalPnl < 0 && _priceChg < -50)             _tip = "Heavy loss (-50%+): When volume dries up and whales dump, exit early. Rule 5: take profits before others take them from you.";
        else if (totalPnl < 0 && _holdDays > 3)               _tip = "Held too long at a loss: If volume decreases and whales are dumping, exit. Do not fall in love with a bag. (Rule 5)";
        else if (totalPnl < 0 && sellReason === 'NARRATIVE')  _tip = "Narrative changed: Always verify if CT is genuinely excited or just paid shills. Follow the meta, not the noise. (Rule 3)";
        else if (totalPnl < 0 && sellReason === 'RUG')        _tip = "Rug detected: Before entering, always check BubbleMaps for clusters > 4%. If insiders dump early, exit immediately. (Rule 2)";
        else if (totalPnl > 0 && _pnlPct < 20)                _tip = "Small gain: Consider DCA exits at 2x, 5x, 10x instead of closing the full position too early. Leave a moonbag. (Rule 4)";
        else if (totalPnl > 0 && _pnlPct >= 100)              _tip = "Great trade! Always take some profits on the way up. Your next target after 2x should already be pre-planned. (Rule 4)";
        else if (totalPnl > 0 && sellReason === 'TAKE_PROFIT') _tip = "Disciplined exit! Taking profits at your target separates good traders from bag holders. (Rule 4)";
        if (_tip) setTimeout(() => showToast('üìö ' + _tip, 'info'), 2000);
      // XP only on profit or first trade ever
      const closedCount = (updatedUser.trades || []).filter(t => t.status === 'closed').length;
      const isFirstTrade = closedCount === 1;
      if (totalPnl > 0 || isFirstTrade) {
        const xpGain = isFirstTrade && totalPnl <= 0 ? 10 : calcXPFromPnL(totalPnl);
        setTimeout(() => addXP(xpGain, `${totalPnl >= 0 ? '+' : ''}${totalPnl.toFixed(3)} SOL`), 500);
      }
      // Publish updated ranking data after close
      setTimeout(() => publishRanking(updatedUser), 800);
      setTimeout(() => checkCloseMission(), 1200);
    } catch (error) {
      showToast('Error fetching price', 'error');
    }
  };
  const updateTradePrice = async trade => {
    try {
      const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${trade.tokenAddress}`);
      const data = await res.json();
      if (data.pairs?.[0]) {
        const currentPrice = parseFloat(data.pairs[0].priceUsd);
        const priceChange = (currentPrice - trade.avgEntryPrice) / trade.avgEntryPrice * 100;
        showToast(`${trade.tokenSymbol}: $${currentPrice.toFixed(8)} (${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(1)}%)`, priceChange >= 0 ? 'success' : 'warning');
        const updatedUser = {
          ...user,
          trades: user.trades.map(t => t.id === trade.id ? {
            ...t,
            currentPrice,
            lastUpdate: Date.now()
          } : t)
        };
        setUser(updatedUser);
      }
    } catch (error) {
      showToast('Error updating price', 'error');
    }
  };
  const handleVote = async id => {
    // 1 vote per week per user ‚Äî can move it but not vote multiple at same time
    const wk = getWeekKey();
    const alreadyVotedId = Object.keys(userVotes).find(k => userVotes[k]);
    const already = userVotes[id];
    if (alreadyVotedId && !already) {
      showToast('1 vote per week ‚Äî remove your current vote first', 'warning');
      return;
    }
    const newVotes = {
      ...userVotes
    };
    if (already) {
      delete newVotes[id];
    } else {
      newVotes[id] = true;
    }
    const updated = narratives.map(n => n.id !== id ? n : {
      ...n,
      votes: already ? Math.max(0, n.votes - 1) : n.votes + 1
    });
    setNarratives(updated);
    setUserVotes(newVotes);
    localStorage.setItem('helmUserVotes', JSON.stringify(newVotes));
    localStorage.setItem('helmNarratives', JSON.stringify(updated));

    // Persist shared vote counts
    try {
      const voteCounts = {};
      updated.forEach(n => {
        voteCounts[n.id] = n.votes;
      });
      if (window.storage) {
        await window.storage.set(NARR_KEY, JSON.stringify(voteCounts), true).catch(() => {});
      }
    } catch (e) {}
  };
  const currentLevel = getCurrentLevel(user?.xp || 0);
  const currentLevelData = LEVELS[Math.max(0, currentLevel - 1)];
  const nextLevelXP = getNextLevelXP(user?.xp || 0);
  const currentLevelXP = currentLevel > 1 ? LEVELS[currentLevel - 2].xp : 0;
  const xpProgress = user ? (user.xp - currentLevelXP) / (nextLevelXP - currentLevelXP) * 100 : 0;

  // ‚îÄ‚îÄ TRADER PROFILE COMPUTATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const traderProfile = (() => {
    if (!user) return {
      closed: [],
      active: [],
      wins: [],
      losses: [],
      totalPnl: 0,
      winRate: 0,
      avgWin: 0,
      avgLoss: 0,
      rr: 0,
      topBuyReason: null,
      sellReasons: {},
      buyReasons: {},
      avgHold: 0,
      curLossStreak: 0,
      trades24h: 0,
      isOvertrading: false,
      archetype: 'üå± Beginner',
      archetypeDesc: ''
    };
    const all = user.trades || [];
    const closed = all.filter(t => t.status === 'closed');
    const active = all.filter(t => t.status === 'active');
    const wins = closed.filter(t => (t.totalPnl || 0) > 0);
    const losses = closed.filter(t => (t.totalPnl || 0) < 0);
    const totalPnl = closed.reduce((s, t) => s + (t.totalPnl || 0), 0);
    const winRate = closed.length > 0 ? wins.length / closed.length * 100 : 0;
    const avgWin = wins.length > 0 ? wins.reduce((s, t) => s + (t.totalPnl || 0), 0) / wins.length : 0;
    const avgLoss = losses.length > 0 ? Math.abs(losses.reduce((s, t) => s + (t.totalPnl || 0), 0) / losses.length) : 0;
    const rr = avgLoss > 0 ? avgWin / avgLoss : 0;

    // buy reasons breakdown
    const buyReasons = {};
    all.forEach(t => {
      if (t.buyReason) buyReasons[t.buyReason] = (buyReasons[t.buyReason] || 0) + 1;
    });
    const topBuyReason = Object.entries(buyReasons).sort((a, b) => b[1] - a[1])[0]?.[0] || null;

    // sell reasons breakdown
    const sellReasons = {};
    closed.forEach(t => {
      if (t.sellReason) sellReasons[t.sellReason] = (sellReasons[t.sellReason] || 0) + 1;
    });

    // timing: avg hold time in hours
    const holdTimes = closed.filter(t => t.closedAt && t.openedAt).map(t => (new Date(t.closedAt) - new Date(t.openedAt)) / 3600000);
    const avgHold = holdTimes.length > 0 ? holdTimes.reduce((s, v) => s + v, 0) / holdTimes.length : 0;

    // consecutive losses streak
    let curLossStreak = 0;
    for (let i = closed.length - 1; i >= 0; i--) {
      if ((closed[i].totalPnl || 0) < 0) curLossStreak++;else break;
    }

    // overtrading: >5 trades opened in last 24h
    const now = Date.now();
    const trades24h = all.filter(t => now - new Date(t.createdAt) < 86400000).length;
    const isOvertrading = trades24h >= 5;

    // archetype
    let archetype = 'üå± Beginner';
    let archetypeDesc = 'Still building trade history.';
    if (closed.length >= 5) {
      if (winRate >= 60 && rr >= 1.5) {
        archetype = 'üéØ Sniper';
        archetypeDesc = 'High precision and great R/R. You trade selectively and hit when you do.';
      } else if (winRate >= 60 && avgHold < 2) {
        archetype = '‚ö° Scalper';
        archetypeDesc = 'You trade fast with good accuracy. Watch fees and slippage.';
      } else if (winRate >= 50 && rr >= 1) {
        archetype = 'üìä Consistent';
        archetypeDesc = 'Good balance between wins and losses. You are on the right track.';
      } else if (wins.length > 0 && losses.length > wins.length * 2) {
        archetype = 'üé∞ Gambler';
        archetypeDesc = 'Too many losses vs gains. Consider being more selective.';
      } else if (isOvertrading || trades24h >= 4) {
        archetype = 'üîÅ Overtrader';
        archetypeDesc = 'Trading too frequently. More trades does not mean more profit.';
      } else if (topBuyReason === 'üî• FOMO') {
        archetype = 'üò± FOMO Trader';
        archetypeDesc = 'Most entries driven by FOMO. Work on having clearer criteria.';
      } else if (avgHold > 24) {
        archetype = 'üíé Holder';
        archetypeDesc = 'You hold positions a long time. Useful in trends, risky in memecoins.';
      } else {
        archetype = 'üîÑ Developing';
        archetypeDesc = 'Pattern still forming. Keep trading and analyzing your results.';
      }
    }
    return {
      closed,
      active,
      wins,
      losses,
      totalPnl,
      winRate,
      avgWin,
      avgLoss,
      rr,
      topBuyReason,
      sellReasons,
      buyReasons,
      avgHold,
      curLossStreak,
      trades24h,
      isOvertrading,
      archetype,
      archetypeDesc
    };
  })();

  // ‚îÄ‚îÄ LOSS STREAK ALERT ‚îÄ‚îÄ
  const LOSS_TIPS = ['üßò Breathe. Every loss is a lesson, not a failure. Review your entry before the next trade.', 'üìâ Losing streak? Reduce position size. Preserve capital first.', 'üîç Rugs? FOMO? Entered too early? Diagnosis is worth more than profit.', '‚è∏Ô∏è Consider a break. Trading emotionally increases mistakes.', 'üìä Only enter tokens that pass your full checklist.', 'üí° Consecutive losses show a pattern. Write down every entry reason.', 'üéØ Fewer trades, higher quality. You don\'t need to always be in the market.'];
  useEffect(() => {
    if (traderProfile.curLossStreak >= 2 && traderProfile.curLossStreak % 2 === 0) {
      const tip = LOSS_TIPS[(traderProfile.curLossStreak / 2 - 1) % LOSS_TIPS.length];
      setTimeout(() => showToast(`üíî ${traderProfile.curLossStreak} losses in a row`, 'warning'), 300);
      setTimeout(() => showToast(tip, 'warning'), 3800);
    }
  }, [traderProfile.curLossStreak]);

  // ‚îÄ‚îÄ OVERTRADING ALERT ‚îÄ‚îÄ
  useEffect(() => {
    if (traderProfile.isOvertrading) {
      setTimeout(() => showToast('‚ö†Ô∏è OVERTRADING ‚Äî 5+ trades in 24h. Take a breath!', 'warning'), 500);
    }
  }, [traderProfile.trades24h]);
  return /*#__PURE__*/React.createElement("div", null, !user && /*#__PURE__*/React.createElement(function LoginScreen() {
    const [uname, setUname] = React.useState('');
    const [loading, setLoading] = React.useState(false);
    const [error, setError] = React.useState('');

    const doLogin = async () => {
      const name = uname.trim();
      if (!name || name.length < 3) { setError('Username must be at least 3 characters'); return; }
      if (name.length > 20) { setError('Username must be 20 characters or less'); return; }
      if (!/^[a-zA-Z0-9_]+$/.test(name)) { setError('Only letters, numbers and underscores allowed'); return; }
      setLoading(true);
      setError('');
      try {
        await handleLogin(name);
      } catch(e) {
        setError(e.message || 'Login failed');
        setLoading(false);
      }
    };

    return React.createElement("div", null,
      React.createElement("div", {className:"header"},
        React.createElement("div", {className:"logo"}, "\u2693 HELM")
      ),
      React.createElement("div", {className:"container"},
        React.createElement("div", {className:"card", style:{textAlign:'center', maxWidth:'380px', margin:'60px auto'}},
          React.createElement("div", {style:{fontSize:'4rem', marginBottom:'16px'}}, "\u2693"),
          React.createElement("h2", {style:{marginBottom:'4px'}}, "Take the Helm"),
          React.createElement("p", {style:{color:'var(--text-secondary)', marginBottom:'6px', fontSize:'0.9rem'}},
            "Paper trade Solana memecoins. No real SOL needed."
          ),
          React.createElement("p", {style:{
            color:'var(--text-primary)', marginBottom:'28px', fontSize:'1.05rem',
            fontWeight:'600', letterSpacing:'-0.01em', opacity:0.85
          }},
            "Navigate memecoin chaos without losing real money."
          ),
          React.createElement("div", {style:{textAlign:'left', marginBottom:'6px'}},
            React.createElement("label", {style:{fontSize:'0.85rem', fontWeight:'bold', display:'block', marginBottom:'6px'}}, "Choose your username"),
            React.createElement("input", {
              type: 'text',
              placeholder: 'e.g. degen_macedo',
              value: uname,
              maxLength: 20,
              onChange: e => { setUname(e.target.value); setError(''); },
              onKeyDown: e => e.key === 'Enter' && doLogin(),
              style: {
                width:'100%', padding:'12px 14px', fontSize:'1rem',
                background:'var(--bg-primary)', border:'1px solid var(--border)',
                borderRadius:'10px', color:'var(--text-primary)', boxSizing:'border-box',
                outline:'none',
              }
            })
          ),
          error && React.createElement("div", {style:{
            fontSize:'0.8rem', color:'var(--danger)', marginBottom:'10px', textAlign:'left', padding:'6px 10px',
            background:'rgba(239,68,68,0.08)', borderRadius:'6px', border:'1px solid rgba(239,68,68,0.2)'
          }}, '‚ö†Ô∏è ' + error),
          React.createElement("p", {style:{fontSize:'0.72rem', color:'var(--text-secondary)', marginBottom:'14px', textAlign:'left'}},
            "Your username is your identity on the global leaderboard. Pick something memorable."
          ),
          React.createElement("button", {
            onClick: doLogin,
            disabled: loading || uname.trim().length < 3,
            style:{width:'100%', opacity: (loading || uname.trim().length < 3) ? 0.5 : 1}
          }, loading ? '‚è≥ Loading...' : '\u2693 Enter HELM'),
          React.createElement("p", {style:{fontSize:'0.72rem', color:'var(--text-secondary)', marginTop:'16px'}},
            "No password needed. Your progress is saved to your username."
          )
        )
      )
    );
  }, null), user && /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "header"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      gap: '8px',
      flexWrap: 'nowrap',
      minWidth: 0,
    }
  }, /*#__PURE__*/React.createElement("div", {style:{display:'flex',flexDirection:'column',gap:'1px',minWidth:0,flexShrink:1}},
    React.createElement("div", {className:"logo"}, "\u2693 HELM"),
    React.createElement("div", {style:{fontSize:'0.7rem',color:'var(--text-secondary)',fontWeight:'400',letterSpacing:'0.01em',opacity:0.7,marginTop:'-2px'}},
      "Navigate memecoin chaos without losing real money."
    )
  ), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      alignItems: 'center'
    }
  }, /*#__PURE__*/React.createElement("div", {
    className: "level-badge",
    style: {
      whiteSpace: 'nowrap'
    }
  }, currentLevelData.icon, " Lv", currentLevel), /*#__PURE__*/React.createElement("div", {
    onClick: () => {
      if (user.balance < 0.5) setShowBankrupt(true);
    },
    style: {
      padding: '5px 11px',
      background: 'var(--bg-card)',
      borderRadius: '8px',
      border: `1px solid ${user.balance < 0.5 ? 'var(--danger)' : 'var(--border)'}`,
      cursor: user.balance < 0.5 ? 'pointer' : 'default',
      textAlign: 'center',
      minWidth: '82px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.57rem',
      color: 'var(--text-secondary)',
      textTransform: 'uppercase',
      letterSpacing: '0.04em'
    }
  }, "Free", user.balance < 0.5 ? ' ‚ö†Ô∏è' : ''), /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '0.86rem',
      color: user.balance < 0.5 ? 'var(--danger)' : 'inherit'
    }
  }, user.balance.toFixed(2), " SOL"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.67rem',
      color: 'rgba(255,255,255,0.4)'
    }
  }, toUSD(user.balance))), (() => {
    const openVal = (user.trades || []).filter(t => t.status === 'active').reduce((s, t) => s + (t.totalInvested || 0), 0);
    const tw = user.balance + openVal;
    return /*#__PURE__*/React.createElement("div", {
      style: {
        padding: '5px 11px',
        background: 'rgba(59,130,246,0.08)',
        border: '1px solid rgba(59,130,246,0.22)',
        borderRadius: '8px',
        textAlign: 'center',
        minWidth: '82px'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.57rem',
        color: 'var(--text-secondary)',
        textTransform: 'uppercase',
        letterSpacing: '0.04em'
      }
    }, "Total"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.86rem'
      }
    }, tw.toFixed(2), " SOL"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.67rem',
        color: 'rgba(255,255,255,0.4)'
      }
    }, toUSD(tw)));
  })(), /*#__PURE__*/React.createElement("button", {
    id: "helm-missions",
    onClick: () => setShowMissions(true),
    style: {
      margin: 0,
      padding: '7px 13px',
      fontSize: '0.82rem',
      fontWeight: 'bold',
      background: 'linear-gradient(135deg,rgba(59,130,246,0.15),rgba(139,92,246,0.15))',
      border: '1px solid rgba(139,92,246,0.4)',
      color: '#a78bfa',
      borderRadius: '8px',
      cursor: 'pointer',
      whiteSpace: 'nowrap'
    }
  }, "\uD83D\uDCCB Missions"), /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'relative'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => setSettingsOpen(o => !o),
    style: {
      margin: 0,
      padding: '7px 10px',
      fontSize: '1rem',
      background: settingsOpen ? 'rgba(255,255,255,0.08)' : 'var(--bg-card)',
      border: '1px solid var(--border)',
      borderRadius: '8px',
      cursor: 'pointer',
      color: 'var(--text-secondary)'
    }
  }, "\u2699\uFE0F"), settingsOpen && /*#__PURE__*/React.createElement("div", {
    onClick: () => setSettingsOpen(false),
    style: {
      position: 'fixed',
      inset: 0,
      zIndex: 1199
    }
  }), settingsOpen && /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'absolute',
      right: 0,
      top: 'calc(100% + 8px)',
      zIndex: 1200,
      background: 'var(--bg-card)',
      border: '1px solid var(--border)',
      borderRadius: '14px',
      padding: '16px',
      minWidth: '200px',
      boxShadow: '0 10px 40px rgba(0,0,0,0.5)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      textAlign: 'center',
      padding: '8px',
      background: 'rgba(255,255,255,0.04)',
      borderRadius: '8px',
      marginBottom: '12px',
      fontFamily: 'monospace'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.7rem',
      color: 'var(--text-secondary)'
    }
  }, "SOL price "), /*#__PURE__*/React.createElement("strong", {
    style: {
      color: 'var(--text-primary)',
      fontSize: '0.9rem'
    }
  }, "$", solPrice.toFixed(2))), /*#__PURE__*/React.createElement("div", {
    style: {
      marginBottom: '12px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.7rem',
      color: 'var(--text-secondary)',
      marginBottom: '5px'
    }
  }, "Theme"), /*#__PURE__*/React.createElement("select", {
    className: "theme-selector",
    value: theme,
    onChange: e => applyTheme(e.target.value),
    style: {
      width: '100%',
      margin: 0
    }
  }, /*#__PURE__*/React.createElement("option", {
    value: "default"
  }, "\uD83C\uDF0A Navy"), /*#__PURE__*/React.createElement("option", {
    value: "light"
  }, "\u2600\uFE0F Light"), /*#__PURE__*/React.createElement("option", {
    value: "neon"
  }, "\u26A1 Neon"))), /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      setTutorialStep(0);
      setSettingsOpen(false);
    },
    style: {
      width: '100%',
      margin: '0 0 8px',
      padding: '9px',
      fontSize: '0.85rem',
      background: 'rgba(59,130,246,0.08)',
      border: '1px solid rgba(59,130,246,0.25)',
      color: 'var(--accent)',
      borderRadius: '8px',
      cursor: 'pointer'
    }
  }, "\uD83D\uDDFA\uFE0F Restart Tutorial"), /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      if (confirm('Log out?')) {
        localStorage.removeItem('helmUser');
        localStorage.removeItem('helmUserKey');
        setUser(null);
        showToast('Logged out', 'success');
      }
      setSettingsOpen(false);
    },
    className: "danger",
    style: {
      width: '100%',
      margin: 0,
      padding: '9px',
      fontSize: '0.85rem'
    }
  }, "\uD83D\uDEAA Log Out")))))), (() => {
    const top3 = [...narratives].sort((a, b) => b.votes - a.votes).slice(0, 3);
    return /*#__PURE__*/React.createElement("div", {
      style: {
        background: 'var(--bg-card)',
        borderBottom: '1px solid var(--border)',
        padding: '7px 0'
      }
    }, /*#__PURE__*/React.createElement("div", {
      className: "container",
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '10px',
        flexWrap: 'wrap'
      }
    }, /*#__PURE__*/React.createElement("span", {
      style: {
        color: 'var(--accent)',
        fontSize: '0.73rem',
        fontWeight: 'bold',
        letterSpacing: '1px',
        whiteSpace: 'nowrap'
      }
    }, "\uD83D\uDD25 TRENDING"), top3.map((n, i) => /*#__PURE__*/React.createElement("div", {
      key: n.id,
      onClick: () => setActiveTab('narratives'),
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '5px',
        cursor: 'pointer',
        padding: '3px 10px',
        borderRadius: '20px',
        fontSize: '0.78rem',
        background: 'var(--bg-primary)',
        border: `1px solid ${i === 0 ? '#fbbf24' : i === 1 ? '#94a3b8' : '#cd7f32'}`
      }
    }, /*#__PURE__*/React.createElement("span", null, ['ü•á', 'ü•à', 'ü•â'][i]), /*#__PURE__*/React.createElement("span", {
      style: {
        fontWeight: 'bold'
      }
    }, n.emoji, " ", n.title), /*#__PURE__*/React.createElement("span", {
      style: {
        color: 'var(--text-secondary)'
      }
    }, "\xB7 ", n.votes)))));
  })(), /*#__PURE__*/React.createElement("div", {
    className: "container"
  }, /*#__PURE__*/React.createElement("div", {
    className: "tabs",
    id: "helm-tabs"
  }, /*#__PURE__*/React.createElement("div", {
    className: `tab ${activeTab === 'profile' ? 'active' : ''}`,
    onClick: () => setActiveTab('profile')
  }, "\uD83D\uDC64 Profile"), /*#__PURE__*/React.createElement("div", {
    id: "helm-analysis-tab",
    className: `tab ${activeTab === 'analysis' ? 'active' : ''}`,
    onClick: () => setActiveTab('analysis')
  }, "\uD83D\uDD0D Analysis"), /*#__PURE__*/React.createElement("div", {
    id: "helm-portfolio-tab",
    className: `tab ${activeTab === 'portfolio' ? 'active' : ''}`,
    onClick: () => setActiveTab('portfolio')
  }, "\uD83D\uDCCA Portfolio"), /*#__PURE__*/React.createElement("div", {
    className: `tab ${activeTab === 'narratives' ? 'active' : ''}`,
    onClick: () => setActiveTab('narratives')
  }, "\uD83C\uDF0A Narratives"), /*#__PURE__*/React.createElement("div", {
    className: `tab ${activeTab === 'badges' ? 'active' : ''}`,
    onClick: () => setActiveTab('badges')
  }, "\uD83C\uDFC6 Badges"), /*#__PURE__*/React.createElement("div", {
    id: "helm-ranking",
    className: `tab ${activeTab === 'ranking' ? 'active' : ''}`,
    onClick: () => setActiveTab('ranking')
  }, "\uD83E\uDD47 Ranking"), /*#__PURE__*/React.createElement("div", {
    id: "helm-community",
    className: `tab ${activeTab === 'community' ? 'active' : ''}`,
    onClick: () => setActiveTab('community')
  }, "\uD83D\uDCAC Community"), /*#__PURE__*/React.createElement("div", {
    className: `tab ${activeTab === 'learn' ? 'active' : ''}`,
    onClick: () => setActiveTab('learn'),
    style: {background: activeTab === 'learn' ? 'rgba(139,92,246,0.2)' : ''}
  }, "\uD83D\uDCDA Learn")), activeTab === 'profile' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'flex-end',
      marginBottom: '14px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => setShowWeeklyReport(true),
    style: {
      margin: 0,
      padding: '9px 16px',
      fontSize: '0.85rem',
      fontWeight: 'bold',
      background: 'linear-gradient(135deg,rgba(59,130,246,0.15),rgba(139,92,246,0.15))',
      border: '1px solid rgba(139,92,246,0.4)',
      color: 'var(--accent)',
      borderRadius: '10px'
    }
  }, "\uD83D\uDCCA Weekly Report")), traderProfile.isOvertrading && /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '14px 18px',
      borderRadius: '12px',
      marginBottom: '14px',
      background: 'rgba(245,158,11,0.1)',
      border: '2px solid var(--warning)',
      display: 'flex',
      gap: '12px',
      alignItems: 'flex-start'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '1.6rem'
    }
  }, "\u26A0\uFE0F"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      color: 'var(--warning)',
      marginBottom: '4px'
    }
  }, "OVERTRADING DETECTADO"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem',
      color: 'var(--text-secondary)',
      lineHeight: 1.5
    }
  }, "You opened ", /*#__PURE__*/React.createElement("strong", {
    style: {
      color: 'var(--warning)'
    }
  }, traderProfile.trades24h, " trades in the last 24h"), ". More trades \u2260 more profit. Be selective."))), traderProfile.curLossStreak >= 3 && /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '14px 18px',
      borderRadius: '12px',
      marginBottom: '14px',
      background: 'rgba(239,68,68,0.08)',
      border: '1px solid var(--danger)',
      display: 'flex',
      gap: '12px',
      alignItems: 'flex-start'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '1.6rem'
    }
  }, "\uD83D\uDC94"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      color: 'var(--danger)',
      marginBottom: '4px'
    }
  }, traderProfile.curLossStreak, " CONSECUTIVE LOSSES"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem',
      color: 'var(--text-secondary)',
      lineHeight: 1.5
    }
  }, traderProfile.curLossStreak >= 5 ? 'Severe streak. Pause now and analyze your patterns.' : 'Reduce position size and review your entry criteria.'))), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '20px',
      borderRadius: '14px',
      marginBottom: '14px',
      background: 'linear-gradient(135deg,rgba(59,130,246,0.1),rgba(139,92,246,0.1))',
      border: '1px solid rgba(139,92,246,0.3)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '14px',
      marginBottom: '12px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2.8rem',
      lineHeight: 1
    }
  }, traderProfile.archetype.split(' ')[0]), /*#__PURE__*/React.createElement("div", {
    style: {
      flex: 1
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.75rem',
      color: 'var(--text-secondary)',
      textTransform: 'uppercase',
      letterSpacing: '1px',
      marginBottom: '4px'
    }
  }, "Trader Profile"), editingUsername ? /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '6px',
      marginBottom: '4px'
    }
  }, /*#__PURE__*/React.createElement("input", {
    autoFocus: true,
    value: usernameDraft,
    onChange: e => setUsernameDraft(e.target.value.slice(0, 20)),
    onKeyDown: e => {
      if (e.key === 'Enter') {
        const name = usernameDraft.trim() || 'Anon';
        const updated = {
          ...user,
          username: name
        };
        setUser(updated);
        publishRanking(updated);
        setEditingUsername(false);
      }
      if (e.key === 'Escape') setEditingUsername(false);
    },
    maxLength: 20,
    style: {
      fontSize: '1.1rem',
      fontWeight: 'bold',
      background: 'var(--bg-primary)',
      border: '1px solid var(--accent)',
      borderRadius: '6px',
      padding: '4px 8px',
      color: 'var(--text-primary)',
      width: '150px'
    }
  }), /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      const name = usernameDraft.trim() || 'Anon';
      const updated = {
        ...user,
        username: name
      };
      setUser(updated);
      publishRanking(updated);
      setEditingUsername(false);
    },
    style: {
      margin: 0,
      padding: '4px 10px',
      fontSize: '0.78rem',
      background: 'var(--accent)',
      border: 'none',
      color: 'white',
      borderRadius: '6px'
    }
  }, "\u2713"), /*#__PURE__*/React.createElement("button", {
    onClick: () => setEditingUsername(false),
    style: {
      margin: 0,
      padding: '4px 8px',
      fontSize: '0.78rem',
      background: 'transparent',
      border: '1px solid var(--border)',
      borderRadius: '6px'
    }
  }, "\u2715")) : /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '8px',
      marginBottom: '4px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '1.3rem',
      fontWeight: 'bold',
      color: 'var(--text-primary)'
    }
  }, user?.username || 'Anon'), /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      setUsernameDraft(user?.username || '');
      setEditingUsername(true);
    },
    style: {
      margin: 0,
      padding: '3px 8px',
      fontSize: '0.72rem',
      background: 'transparent',
      border: '1px solid var(--border)',
      borderRadius: '6px',
      color: 'var(--text-secondary)',
      cursor: 'pointer'
    }
  }, "\u270F\uFE0F Edit")), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem',
      color: 'var(--text-secondary)',
      marginTop: '2px'
    }
  }, traderProfile.archetype.replace(/^\S+\s/, '')), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.82rem',
      color: 'var(--text-secondary)',
      marginTop: '4px',
      lineHeight: 1.5
    }
  }, traderProfile.archetypeDesc))), traderProfile.closed.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'inline-flex',
      alignItems: 'center',
      gap: '6px',
      padding: '6px 12px',
      borderRadius: '20px',
      background: 'rgba(255,255,255,0.06)',
      border: '1px solid rgba(255,255,255,0.12)',
      marginBottom: '14px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '1rem'
    }
  }, "\u23F1\uFE0F"), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.82rem',
      color: 'var(--text-secondary)'
    }
  }, "Avg Hold:"), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.88rem',
      fontWeight: 'bold',
      color: 'var(--text-primary)'
    }
  }, traderProfile.avgHold < 1 ? `${Math.round(traderProfile.avgHold * 60)}min` : traderProfile.avgHold < 24 ? `${traderProfile.avgHold.toFixed(1)}h` : `${(traderProfile.avgHold / 24).toFixed(1)}d`), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.72rem',
      color: 'var(--text-secondary)',
      marginLeft: '2px'
    }
  }, traderProfile.avgHold < 1 ? '‚ö° Scalper' : traderProfile.avgHold < 4 ? 'üéØ Day' : traderProfile.avgHold < 24 ? 'üìä Swing' : 'üíé Holder')), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      flexWrap: 'wrap'
    }
  }, [['üìà DexScreener', 'https://dexscreener.com', 'rgba(16,185,129,0.12)', 'rgba(16,185,129,0.35)', 'var(--success)'], ['üê¶ Twitter/X', 'https://x.com', 'rgba(255,255,255,0.06)', 'rgba(255,255,255,0.2)', 'var(--text-primary)'], ['üì£ Telegram', 'https://t.me', 'rgba(0,136,204,0.12)', 'rgba(0,136,204,0.4)', '#29b6f6']].map(([label, href, bg, border, color]) => /*#__PURE__*/React.createElement("a", {
    key: label,
    href: href,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '6px',
      padding: '8px 14px',
      borderRadius: '8px',
      textDecoration: 'none',
      fontWeight: 'bold',
      fontSize: '0.82rem',
      background: bg,
      border: `1px solid ${border}`,
      color
    }
  }, label)))), /*#__PURE__*/React.createElement("div", {
    className: "card",
    style: {
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '1.6rem'
    }
  }, currentLevelData.icon), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold'
    }
  }, currentLevelData.name), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      color: 'var(--text-secondary)'
    }
  }, "Level ", currentLevel))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => setShowXPTable(true),
    style: {
      margin: 0,
      padding: '5px 10px',
      fontSize: '0.72rem',
      fontWeight: 'bold',
      background: 'rgba(59,130,246,0.1)',
      border: '1px solid rgba(59,130,246,0.3)',
      color: 'var(--accent)',
      borderRadius: '8px'
    }
  }, "\uD83D\uDCCB XP Table"), /*#__PURE__*/React.createElement("div", {
    style: {
      textAlign: 'right'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      color: 'var(--accent)'
    }
  }, (user.xp || 0).toLocaleString(), " XP"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      color: 'var(--text-secondary)'
    }
  }, "\u2192 ", nextLevelXP.toLocaleString(), " XP")))), /*#__PURE__*/React.createElement("div", {
    className: "xp-bar-container"
  }, /*#__PURE__*/React.createElement("div", {
    className: "xp-bar",
    style: {
      width: `${Math.min(xpProgress, 100)}%`
    }
  }, xpProgress > 15 && `${Math.floor(xpProgress)}%`))), /*#__PURE__*/React.createElement("div", {
    className: "stat-grid",
    style: {
      marginBottom: '10px'
    }
  }, [{
    val: `${(user.balance || 0).toFixed(2)} SOL`,
    label: 'Balance'
  }, {
    val: `${traderProfile.totalPnl >= 0 ? '+' : ''}${traderProfile.totalPnl.toFixed(3)}`,
    label: 'P&L Total',
    color: traderProfile.totalPnl >= 0 ? 'var(--success)' : 'var(--danger)'
  }, {
    val: `${traderProfile.winRate.toFixed(0)}%`,
    label: 'Win Rate',
    color: traderProfile.winRate >= 50 ? 'var(--success)' : 'var(--danger)'
  }, {
    val: `${traderProfile.rr.toFixed(2)}√ó`,
    label: 'Risk/Reward',
    color: traderProfile.rr >= 1 ? 'var(--success)' : 'var(--warning)'
  }, {
    val: traderProfile.closed.length,
    label: 'Closed'
  }, {
    val: traderProfile.active.length,
    label: 'Open'
  }, {
    val: traderProfile.wins.length,
    label: 'Wins',
    color: 'var(--success)'
  }, {
    val: traderProfile.losses.length,
    label: 'Losses',
    color: 'var(--danger)'
  }].map(s => /*#__PURE__*/React.createElement("div", {
    key: s.label,
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      color: s.color || 'var(--text-primary)'
    }
  }, s.val), s.subval && /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.68rem',
      color: 'rgba(255,255,255,0.38)',
      marginTop: '1px'
    }
  }, s.subval), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, s.label)))), traderProfile.closed.length >= 1 && (() => {
    // ‚îÄ‚îÄ Compute period P&L ‚îÄ‚îÄ
    const now = Date.now();
    const periodPnl = ms => traderProfile.closed.filter(t => t.closedAt && now - new Date(t.closedAt) < ms).reduce((s, t) => s + (t.totalPnl || 0), 0);
    const pnlDay = periodPnl(86400000);
    const pnlWeek = periodPnl(604800000);
    const pnlMonth = periodPnl(2592000000);

    // ‚îÄ‚îÄ Best / worst trade ‚îÄ‚îÄ
    const best = traderProfile.closed.reduce((a, b) => (b.totalPnl || 0) > (a.totalPnl || 0) ? b : a, traderProfile.closed[0]);
    const worst = traderProfile.closed.reduce((a, b) => (b.totalPnl || 0) < (a.totalPnl || 0) ? b : a, traderProfile.closed[0]);

    // ‚îÄ‚îÄ Hourly heatmap ‚îÄ‚îÄ
    const hourMap = Array(24).fill(0);
    traderProfile.closed.filter(t => t.createdAt).forEach(t => {
      const h = new Date(t.createdAt).getHours();
      hourMap[h]++;
    });
    const maxH = Math.max(...hourMap, 1);
    const peakHour = hourMap.indexOf(maxH);

    // ‚îÄ‚îÄ Goals ‚îÄ‚îÄ
    const goals = [{
      label: 'Close 10 trades',
      target: 10,
      current: traderProfile.closed.length,
      icon: 'üéØ'
    }, {
      label: 'Win rate > 50%',
      target: 100,
      current: traderProfile.winRate >= 50 ? 100 : traderProfile.winRate,
      icon: 'üèÜ',
      pct: true
    }, {
      label: 'R/R above 1',
      target: 100,
      current: Math.min(traderProfile.rr / 1 * 100, 100),
      icon: '‚öñÔ∏è',
      alreadyDone: traderProfile.rr >= 1
    }, {
      label: '5 wins in a row +',
      target: 5,
      current: Math.min(user.currentStreak || 0, 5),
      icon: 'üî•'
    }];
    return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '14px',
        fontSize: '0.95rem'
      }
    }, "\uD83D\uDCC5 P&L by Period"), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'grid',
        gridTemplateColumns: 'repeat(3,1fr)',
        gap: '10px'
      }
    }, [['Hoje', pnlDay], ['7 dias', pnlWeek], ['30 dias', pnlMonth]].map(([label, val]) => /*#__PURE__*/React.createElement("div", {
      key: label,
      style: {
        background: 'var(--bg-primary)',
        borderRadius: '10px',
        padding: '12px',
        textAlign: 'center'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)',
        marginBottom: '6px'
      }
    }, label), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '1.1rem',
        fontWeight: 'bold',
        color: val >= 0 ? 'var(--success)' : 'var(--danger)'
      }
    }, val >= 0 ? '+' : '', val.toFixed(3), " ", /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.7rem'
      }
    }, "SOL")))))), /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '14px',
        fontSize: '0.95rem'
      }
    }, "\uD83C\uDFC5 Best & Worst Trade"), [['üü¢ Melhor', best, 'var(--success)'], ['üî¥ Pior', worst, 'var(--danger)']].map(([label, t, color]) => /*#__PURE__*/React.createElement("div", {
      key: label,
      style: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        padding: '10px',
        background: 'var(--bg-primary)',
        borderRadius: '8px',
        marginBottom: '8px'
      }
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.78rem',
        color: 'var(--text-secondary)',
        marginBottom: '2px'
      }
    }, label), /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.9rem'
      }
    }, t.tokenSymbol || t.tokenName || 'Token'), t.createdAt && /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.72rem',
        color: 'var(--text-secondary)'
      }
    }, new Date(t.createdAt).toLocaleDateString('en-US'))), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '1.1rem',
        color
      }
    }, (t.totalPnl || 0) >= 0 ? '+' : '', (t.totalPnl || 0).toFixed(4), " SOL"), t.buyReason && /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.72rem',
        color: 'var(--text-secondary)'
      }
    }, t.buyReason))))), traderProfile.closed.length >= 2 && /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '14px',
        fontSize: '0.95rem'
      }
    }, "\uD83D\uDCD0 Detailed Metrics"), [{
      label: 'Avg Win',
      val: `+${traderProfile.avgWin.toFixed(4)} SOL`,
      color: 'var(--success)'
    }, {
      label: 'Avg Loss',
      val: `-${traderProfile.avgLoss.toFixed(4)} SOL`,
      color: 'var(--danger)'
    }, {
      label: 'Avg Hold Time',
      val: traderProfile.avgHold < 1 ? `${Math.round(traderProfile.avgHold * 60)}min` : `${traderProfile.avgHold.toFixed(1)}h`
    }, {
      label: 'Trades last 24h',
      val: traderProfile.trades24h,
      color: traderProfile.isOvertrading ? 'var(--warning)' : undefined
    }, {
      label: 'Current loss streak',
      val: traderProfile.curLossStreak,
      color: traderProfile.curLossStreak >= 3 ? 'var(--danger)' : undefined
    }].map(s => /*#__PURE__*/React.createElement("div", {
      key: s.label,
      style: {
        display: 'flex',
        justifyContent: 'space-between',
        padding: '8px 0',
        borderBottom: '1px solid var(--border)',
        fontSize: '0.88rem'
      }
    }, /*#__PURE__*/React.createElement("span", {
      style: {
        color: 'var(--text-secondary)'
      }
    }, s.label), /*#__PURE__*/React.createElement("span", {
      style: {
        fontWeight: 'bold',
        color: s.color || 'var(--text-primary)'
      }
    }, s.val)))), /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '6px',
        fontSize: '0.95rem'
      }
    }, "\uD83D\uDD50 Most active hours"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.8rem',
        color: 'var(--text-secondary)',
        marginBottom: '12px'
      }
    }, "Pico: ", peakHour, "h\u2013", peakHour + 1, "h (", hourMap[peakHour], " trades)"), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        gap: '3px',
        alignItems: 'flex-end',
        height: '50px'
      }
    }, hourMap.map((count, h) => /*#__PURE__*/React.createElement("div", {
      key: h,
      title: `${h}h: ${count} trades`,
      style: {
        flex: 1,
        minWidth: 0,
        borderRadius: '3px 3px 0 0',
        background: count === 0 ? 'var(--bg-primary)' : count === maxH ? 'var(--accent)' : 'rgba(59,130,246,0.4)',
        height: `${Math.max(count / maxH * 100, count > 0 ? 15 : 4)}%`,
        transition: 'height 0.3s'
      }
    }))), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        justifyContent: 'space-between',
        marginTop: '4px',
        fontSize: '0.68rem',
        color: 'var(--text-secondary)'
      }
    }, /*#__PURE__*/React.createElement("span", null, "0h"), /*#__PURE__*/React.createElement("span", null, "6h"), /*#__PURE__*/React.createElement("span", null, "12h"), /*#__PURE__*/React.createElement("span", null, "18h"), /*#__PURE__*/React.createElement("span", null, "23h"))), /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '14px',
        fontSize: '0.95rem'
      }
    }, "\uD83C\uDFAF Goals"), goals.map(g => {
      const pct = g.alreadyDone ? 100 : Math.min(Math.round(g.current / g.target * 100), 100);
      const done = pct >= 100;
      return /*#__PURE__*/React.createElement("div", {
        key: g.label,
        style: {
          marginBottom: '12px'
        }
      }, /*#__PURE__*/React.createElement("div", {
        style: {
          display: 'flex',
          justifyContent: 'space-between',
          marginBottom: '5px',
          fontSize: '0.85rem'
        }
      }, /*#__PURE__*/React.createElement("span", {
        style: {
          display: 'flex',
          gap: '6px',
          alignItems: 'center'
        }
      }, /*#__PURE__*/React.createElement("span", null, g.icon), /*#__PURE__*/React.createElement("span", {
        style: {
          color: done ? 'var(--success)' : 'var(--text-primary)'
        }
      }, g.label), done && /*#__PURE__*/React.createElement("span", {
        style: {
          fontSize: '0.7rem',
          background: 'rgba(16,185,129,0.15)',
          color: 'var(--success)',
          padding: '1px 6px',
          borderRadius: '10px'
        }
      }, "\u2713 Done")), /*#__PURE__*/React.createElement("span", {
        style: {
          color: 'var(--text-secondary)',
          fontWeight: 'bold'
        }
      }, pct, "%")), /*#__PURE__*/React.createElement("div", {
        style: {
          height: '7px',
          background: 'var(--bg-primary)',
          borderRadius: '4px',
          overflow: 'hidden'
        }
      }, /*#__PURE__*/React.createElement("div", {
        style: {
          height: '100%',
          width: `${pct}%`,
          borderRadius: '4px',
          transition: 'width 0.6s',
          background: done ? 'var(--success)' : 'linear-gradient(90deg,var(--accent),rgba(139,92,246,0.8))'
        }
      })));
    })), Object.keys(traderProfile.buyReasons).length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "card",
      style: {
        marginBottom: '10px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        marginBottom: '12px',
        fontSize: '0.95rem'
      }
    }, "\uD83E\uDDE0 Why do you enter?"), Object.entries(traderProfile.buyReasons).sort((a, b) => b[1] - a[1]).map(([reason, count]) => {
      const pct = Math.round(count / (user.trades || []).length * 100);
      return /*#__PURE__*/React.createElement("div", {
        key: reason,
        style: {
          marginBottom: '8px'
        }
      }, /*#__PURE__*/React.createElement("div", {
        style: {
          display: 'flex',
          justifyContent: 'space-between',
          marginBottom: '3px',
          fontSize: '0.85rem'
        }
      }, /*#__PURE__*/React.createElement("span", null, reason), /*#__PURE__*/React.createElement("span", {
        style: {
          color: 'var(--text-secondary)'
        }
      }, count, "\xD7 (", pct, "%)")), /*#__PURE__*/React.createElement("div", {
        style: {
          height: '6px',
          background: 'var(--bg-primary)',
          borderRadius: '3px',
          overflow: 'hidden'
        }
      }, /*#__PURE__*/React.createElement("div", {
        style: {
          height: '100%',
          width: `${pct}%`,
          background: 'var(--accent)',
          borderRadius: '3px',
          transition: 'width 0.5s'
        }
      })));
    }), traderProfile.topBuyReason === 'üî• FOMO' && /*#__PURE__*/React.createElement("div", {
      style: {
        marginTop: '10px',
        fontSize: '0.8rem',
        color: 'var(--warning)',
        padding: '8px',
        background: 'rgba(245,158,11,0.08)',
        borderRadius: '8px'
      }
    }, "\u26A0\uFE0F FOMO is your main entry reason. This usually means buying tops.")));
  })(), traderProfile.closed.length === 0 && /*#__PURE__*/React.createElement("div", {
    className: "card",
    style: {
      textAlign: 'center',
      padding: '40px 20px',
      color: 'var(--text-secondary)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '2.5rem',
      marginBottom: '12px'
    }
  }, "\uD83C\uDF31"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      marginBottom: '6px'
    }
  }, "No history yet"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.85rem'
    }
  }, "Make your first trade to start building your profile."))), activeTab === 'analysis' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("h2", null, "\uD83D\uDD0D Token Analysis"), /*#__PURE__*/React.createElement("div", {
    className: "card"
  }, /*#__PURE__*/React.createElement("label", {
    style: {
      display: 'block',
      marginBottom: '10px',
      fontWeight: 'bold'
    }
  }, "Token Address (Solana)"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("input", {
    value: tokenAddress,
    onChange: e => setTokenAddress(e.target.value),
    placeholder: "Paste token address...",
    style: {
      flex: 1
    }
  })), /*#__PURE__*/React.createElement("button", {
    onClick: analyzeToken,
    disabled: loading,
    className: "success"
  }, loading ? '‚è≥ Analyzing...' : 'üîç Analyze')), analysis && /*#__PURE__*/React.createElement("div", {
    className: "card"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'flex-start',
      flexWrap: 'wrap',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    style: {
      fontSize: '1.2rem'
    }
  }, analysis.name, " ", /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)'
    }
  }, "(", analysis.symbol, ")")), /*#__PURE__*/React.createElement("p", {
    style: {
      fontSize: '0.8rem',
      color: 'var(--text-secondary)',
      marginTop: '2px',
      wordBreak: 'break-all'
    }
  }, analysis.address)), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '8px 16px',
      borderRadius: '10px',
      fontWeight: 'bold',
      fontSize: '1rem',
      whiteSpace: 'nowrap',
      background: analysis.riskLevel === 'low' ? 'rgba(16,185,129,0.15)' : analysis.riskLevel === 'medium' ? 'rgba(245,158,11,0.15)' : 'rgba(239,68,68,0.15)',
      border: `1px solid ${analysis.riskLevel === 'low' ? 'var(--success)' : analysis.riskLevel === 'medium' ? 'var(--warning)' : 'var(--danger)'}`,
      color: analysis.riskLevel === 'low' ? 'var(--success)' : analysis.riskLevel === 'medium' ? 'var(--warning)' : 'var(--danger)'
    }
  }, analysis.riskLevel === 'low' && '‚úÖ BAIXO RISCO', analysis.riskLevel === 'medium' && '‚ö° MEDIUM RISK', analysis.riskLevel === 'high' && 'üö® ALTO RISCO', analysis.riskLevel === 'extreme' && '‚ò†Ô∏è EXTREMO', ' ', "\xB7 ", analysis.riskScore, "/100")), /*#__PURE__*/React.createElement("div", {
    className: "stat-grid",
    style: {
      marginTop: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, "$", analysis.price.toFixed(8)), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "Price")), /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, "$", (analysis.liquidity / 1000).toFixed(1), "k"), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "Liquidity")), /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, "$", (analysis.volume24h / 1000).toFixed(1), "k"), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "Volume 24h")), analysis.marketCap > 0 && /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, "$", (analysis.marketCap / 1000).toFixed(0), "k"), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "FDV/MC")), analysis.holders && /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, analysis.holders.toLocaleString()), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "Holders")), analysis.avgBagUsd && /*#__PURE__*/React.createElement("div", {
    className: "stat-card"
  }, /*#__PURE__*/React.createElement("div", {
    className: "stat-value",
    style: {
      fontSize: '0.95rem'
    }
  }, "$", analysis.avgBagUsd.toFixed(0)), /*#__PURE__*/React.createElement("div", {
    className: "stat-label"
  }, "Avg Bag"))), analysis.redFlags.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'rgba(239,68,68,0.08)',
      padding: '14px',
      borderRadius: '10px',
      marginTop: '14px',
      border: '1px solid rgba(239,68,68,0.2)'
    }
  }, /*#__PURE__*/React.createElement("h4", {
    style: {
      color: 'var(--danger)',
      marginBottom: '8px',
      fontSize: '0.9rem'
    }
  }, "\uD83D\uDEA9 RED FLAGS (", analysis.redFlags.length, ")"), analysis.redFlags.map((flag, i) => /*#__PURE__*/React.createElement("div", {
    key: i,
    style: {
      fontSize: '0.86rem',
      marginBottom: '5px',
      lineHeight: 1.4
    }
  }, flag))), analysis.greenFlags?.length > 0 && /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'rgba(16,185,129,0.08)',
      padding: '14px',
      borderRadius: '10px',
      marginTop: '10px',
      border: '1px solid rgba(16,185,129,0.2)'
    }
  }, /*#__PURE__*/React.createElement("h4", {
    style: {
      color: 'var(--success)',
      marginBottom: '8px',
      fontSize: '0.9rem'
    }
  }, "\u2705 GREEN FLAGS (", analysis.greenFlags.length, ")"), analysis.greenFlags.map((flag, i) => /*#__PURE__*/React.createElement("div", {
    key: i,
    style: {
      fontSize: '0.86rem',
      marginBottom: '5px',
      lineHeight: 1.4
    }
  }, flag))), /*#__PURE__*/React.createElement("div", {
    style: {
      marginTop: '18px',
      padding: '14px',
      background: 'var(--bg-primary)',
      borderRadius: '10px',
      border: '1px solid var(--border)'
    }
  }, /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.78rem',
      fontWeight: 'bold',
      letterSpacing: '1px',
      marginBottom: '10px',
      textTransform: 'uppercase'
    }
  }, "\uD83D\uDD2C Verify manually"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      flexWrap: 'wrap'
    }
  }, /*#__PURE__*/React.createElement("a", {
    href: `https://app.bubblemaps.io/sol/token/${analysis.address}`,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '8px 14px',
      borderRadius: '8px',
      textDecoration: 'none',
      background: 'rgba(139,92,246,0.12)',
      border: '1px solid rgba(139,92,246,0.4)',
      color: '#a78bfa',
      fontSize: '0.82rem',
      fontWeight: 'bold'
    }
  }, "\uD83E\uDEE7 Bubblemaps"), /*#__PURE__*/React.createElement("a", {
    href: `https://solscan.io/token/${analysis.address}#holders`,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '8px 14px',
      borderRadius: '8px',
      textDecoration: 'none',
      background: 'rgba(59,130,246,0.1)',
      border: '1px solid rgba(59,130,246,0.35)',
      color: 'var(--accent)',
      fontSize: '0.82rem',
      fontWeight: 'bold'
    }
  }, "\uD83D\uDD0D Holders (Solscan)"), /*#__PURE__*/React.createElement("a", {
    href: `https://dexscreener.com/solana/${analysis.address}`,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '8px 14px',
      borderRadius: '8px',
      textDecoration: 'none',
      background: 'rgba(16,185,129,0.1)',
      border: '1px solid rgba(16,185,129,0.3)',
      color: 'var(--success)',
      fontSize: '0.82rem',
      fontWeight: 'bold'
    }
  }, "\uD83D\uDCC8 DexScreener"), /*#__PURE__*/React.createElement("a", {
    href: `https://birdeye.so/token/${analysis.address}?chain=solana`,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '8px 14px',
      borderRadius: '8px',
      textDecoration: 'none',
      background: 'rgba(245,158,11,0.1)',
      border: '1px solid rgba(245,158,11,0.3)',
      color: 'var(--warning)',
      fontSize: '0.82rem',
      fontWeight: 'bold'
    }
  }, "\uD83E\uDD85 Birdeye"))), (analysis.links?.telegram || analysis.links?.twitter || analysis.links?.website) && /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      marginTop: '12px',
      flexWrap: 'wrap'
    }
  }, analysis.links.telegram && /*#__PURE__*/React.createElement("a", {
    href: analysis.links.telegram,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '7px 12px',
      borderRadius: '8px',
      background: 'rgba(0,136,204,0.12)',
      border: '1px solid rgba(0,136,204,0.4)',
      color: '#29b6f6',
      fontSize: '0.82rem',
      fontWeight: 'bold',
      textDecoration: 'none'
    }
  }, "\uD83D\uDCE3 Telegram"), analysis.links.twitter && /*#__PURE__*/React.createElement("a", {
    href: analysis.links.twitter,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '7px 12px',
      borderRadius: '8px',
      background: 'rgba(255,255,255,0.06)',
      border: '1px solid rgba(255,255,255,0.2)',
      color: 'var(--text-primary)',
      fontSize: '0.82rem',
      fontWeight: 'bold',
      textDecoration: 'none'
    }
  }, "\uD83D\uDC26 Twitter/X"), analysis.links.website && /*#__PURE__*/React.createElement("a", {
    href: analysis.links.website,
    target: "_blank",
    rel: "noreferrer",
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '5px',
      padding: '7px 12px',
      borderRadius: '8px',
      background: 'rgba(16,185,129,0.1)',
      border: '1px solid rgba(16,185,129,0.3)',
      color: 'var(--success)',
      fontSize: '0.82rem',
      fontWeight: 'bold',
      textDecoration: 'none'
    }
  }, "\uD83C\uDF10 Website")), /*#__PURE__*/React.createElement("button", {
    onClick: registerTrade,
    className: "success",
    style: {
      marginTop: '20px',
      fontSize: '1rem',
      padding: '14px 28px',
      letterSpacing: '1px',
      width: '100%'
    }
  }, "\uD83D\uDE80 APE"))), activeTab === 'portfolio' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      flexWrap: 'wrap',
      gap: '10px',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("h2", null, "\uD83D\uDCCA Portfolio"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '10px',
      alignItems: 'center'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '8px 16px',
      background: 'var(--bg-card)',
      borderRadius: '8px',
      border: '1px solid var(--border)',
      fontSize: '0.9rem'
    }
  }, "\uD83D\uDCB0 Balance: ", /*#__PURE__*/React.createElement("strong", null, (user.balance || 0).toFixed(2), " SOL")), /*#__PURE__*/React.createElement("button", {
    onClick: () => {
      if (confirm('Clear ALL trades? (cannot undo)')) {
        setUser({
          ...user,
          trades: [],
          balance: 5.0
        });
        showToast('Trades reset!', 'success');
      }
    },
    className: "danger",
    style: {
      fontSize: '0.8rem',
      padding: '8px 14px'
    }
  }, "\uD83D\uDDD1\uFE0F Reset Trades"))), /*#__PURE__*/React.createElement("div", {
    className: "card"
  }, /*#__PURE__*/React.createElement("h3", null, "Active Positions (", user.trades?.filter(t => t.status === 'active').length || 0, ")"), user.trades?.filter(t => t.status === 'active').length === 0 ? /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      marginTop: '15px'
    }
  }, "No active trades. Go to Analysis tab to buy tokens!") : user.trades.filter(t => t.status === 'active').map(trade => {
    const currentPrice = trade.currentPrice || trade.avgEntryPrice;
    const priceChange = (currentPrice - trade.avgEntryPrice) / trade.avgEntryPrice * 100;
    const partialPnl = (trade.partialExits || []).reduce((sum, exit) => sum + exit.pnl, 0);
    const unrealizedPnl = trade.totalInvested * (priceChange / 100);
    const totalPnl = partialPnl + unrealizedPnl - (trade.slippageCost || 0);
    return /*#__PURE__*/React.createElement("div", {
      key: trade.id,
      className: "slide-in",
      style: {
        background: 'var(--bg-primary)',
        padding: '20px',
        borderRadius: '10px',
        marginTop: '15px',
        border: `1px solid ${totalPnl >= 0 ? 'rgba(16,185,129,0.3)' : 'rgba(239,68,68,0.3)'}`,
        cursor: 'pointer',
        transition: 'border-color 0.2s'
      }
    }, /*#__PURE__*/React.createElement("div", {
      onClick: () => setPortfolioModal(trade),
      style: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'flex-start',
        marginBottom: '15px',
        flexWrap: 'wrap',
        gap: '8px'
      }
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '8px'
      }
    }, /*#__PURE__*/React.createElement("h3", {
      style: {
        cursor: 'pointer'
      }
    }, trade.tokenSymbol), /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.7rem',
        padding: '2px 8px',
        borderRadius: '10px',
        background: 'var(--bg-secondary)',
        color: 'var(--text-secondary)'
      }
    }, "details"), trade.buyReason && /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.7rem',
        padding: '2px 8px',
        borderRadius: '10px',
        background: 'rgba(59,130,246,0.15)',
        color: 'var(--accent)'
      }
    }, trade.buyReason), trade.slippagePct && /*#__PURE__*/React.createElement("span", {
      title: `Slippage cost: -${(trade.slippageCost || 0).toFixed(4)} SOL`,
      style: {
        fontSize: '0.68rem',
        padding: '2px 7px',
        borderRadius: '10px',
        background: 'rgba(239,68,68,0.12)',
        color: 'var(--danger)'
      }
    }, "~", (trade.slippagePct * 100).toFixed(1), "% slip")), /*#__PURE__*/React.createElement("small", {
      style: {
        color: 'var(--text-secondary)'
      }
    }, trade.tokenName, " \u2022 ", trade.entries.length, " ", trade.entries.length === 1 ? 'entry' : 'entries')), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '1.2rem',
        fontWeight: 'bold',
        color: totalPnl >= 0 ? 'var(--success)' : 'var(--danger)'
      }
    }, totalPnl >= 0 ? '+' : '', totalPnl.toFixed(3), " SOL"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.8rem',
        color: totalPnl >= 0 ? 'var(--success)' : 'var(--danger)',
        opacity: 0.75
      }
    }, totalPnl >= 0 ? '+' : '', toUSD(Math.abs(totalPnl))), /*#__PURE__*/React.createElement("small", {
      style: {
        color: priceChange >= 0 ? 'var(--success)' : 'var(--danger)'
      }
    }, priceChange >= 0 ? '+' : '', priceChange.toFixed(1), "%"))), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'grid',
        gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))',
        gap: '10px',
        marginBottom: '15px'
      }
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("small", {
      style: {
        color: 'var(--text-secondary)'
      }
    }, "Invested"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold'
      }
    }, trade.totalInvested.toFixed(3), " SOL"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'rgba(255,255,255,0.4)',
        marginTop: '1px'
      }
    }, toUSD(trade.totalInvested))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("small", {
      style: {
        color: 'var(--text-secondary)'
      }
    }, "Avg Price"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold'
      }
    }, "$", trade.avgEntryPrice.toFixed(8))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("small", {
      style: {
        color: 'var(--text-secondary)'
      }
    }, "Current Price"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold'
      }
    }, "$", currentPrice.toFixed(8)))), (trade.partialExits || []).length > 0 && /*#__PURE__*/React.createElement("div", {
      style: {
        marginBottom: '15px',
        padding: '10px',
        background: 'var(--bg-secondary)',
        borderRadius: '6px'
      }
    }, /*#__PURE__*/React.createElement("small", {
      style: {
        color: 'var(--text-secondary)'
      }
    }, "Partial Exits: ", trade.partialExits.length), /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        color: 'var(--success)'
      }
    }, "Realized: +", partialPnl.toFixed(3), " SOL")), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        gap: '8px',
        flexWrap: 'wrap',
        marginTop: '15px',
        alignItems: 'center'
      }
    }, /*#__PURE__*/React.createElement("button", {
      onClick: e => {
        e.stopPropagation();
        handleDCA(trade);
      },
      className: "success",
      style: {
        fontSize: '0.85rem'
      }
    }, "\uD83D\uDCC9 DCA"), /*#__PURE__*/React.createElement("button", {
      onClick: e => {
        e.stopPropagation();
        handlePartialSell(trade);
      },
      className: "warning",
      style: {
        fontSize: '0.85rem'
      }
    }, "\uD83D\uDCCA Partial Sell"), /*#__PURE__*/React.createElement("button", {
      onClick: e => {
        e.stopPropagation();
        handleCloseTrade(trade.id);
      },
      className: "danger",
      style: {
        fontSize: '0.85rem'
      }
    }, "\uD83D\uDCB0 Close Position"), /*#__PURE__*/React.createElement("button", {
      onClick: e => {
        e.stopPropagation();
        updateTradePrice(trade);
      },
      style: {
        fontSize: '0.85rem'
      }
    }, "\uD83D\uDD04 Update"), /*#__PURE__*/React.createElement("button", {
      onClick: e => {
        e.stopPropagation();
        window.open(`https://dexscreener.com/solana/${trade.tokenAddress}`, '_blank');
      },
      style: {
        fontSize: '0.75rem',
        padding: '6px 10px',
        margin: 0,
        background: 'rgba(16,185,129,0.15)',
        border: '1px solid var(--success)',
        borderRadius: '6px',
        color: 'var(--success)',
        cursor: 'pointer'
      }
    }, "\uD83D\uDCC8 DEX"), trade.tokenAddress && /*#__PURE__*/React.createElement("button", {
      onClick: e => {
        e.stopPropagation();
        setChartTrade(trade);
      },
      style: {
        fontSize: '0.75rem',
        padding: '6px 10px',
        margin: 0,
        background: 'rgba(139,92,246,0.15)',
        border: '1px solid rgba(139,92,246,0.5)',
        borderRadius: '6px',
        color: '#a78bfa',
        cursor: 'pointer'
      }
    }, "\uD83D\uDCCA Chart")));
  })), /*#__PURE__*/React.createElement("div", {
    className: "card"
  }, /*#__PURE__*/React.createElement("h3", null, "Trade History (", user.trades?.filter(t => t.status === 'closed').length || 0, ")"), user.trades?.filter(t => t.status === 'closed').length === 0 ? /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      marginTop: '15px'
    }
  }, "No closed trades yet") : user.trades.filter(t => t.status === 'closed').slice().reverse().map(trade => {
    const totalPnl = trade.totalPnl || 0;
    const pnlPercentage = totalPnl / trade.totalInvested * 100;
    return /*#__PURE__*/React.createElement("div", {
      key: trade.id,
      style: {
        background: 'var(--bg-primary)',
        padding: '12px',
        borderRadius: '8px',
        margin: '8px 0',
        borderLeft: `3px solid ${totalPnl >= 0 ? 'var(--success)' : 'var(--danger)'}`
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        flexWrap: 'wrap',
        gap: '10px'
      }
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("strong", null, trade.tokenSymbol), /*#__PURE__*/React.createElement("br", null), /*#__PURE__*/React.createElement("small", {
      style: {
        color: 'var(--text-secondary)'
      }
    }, trade.entries?.length || 1, " entries \u2022 Avg: $", trade.avgEntryPrice.toFixed(8))), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '1.1rem',
        color: totalPnl >= 0 ? 'var(--success)' : 'var(--danger)'
      }
    }, totalPnl >= 0 ? '+' : '', totalPnl.toFixed(3), " SOL"), /*#__PURE__*/React.createElement("small", {
      style: {
        color: 'var(--text-secondary)'
      }
    }, "(", pnlPercentage >= 0 ? '+' : '', pnlPercentage.toFixed(1), "%)"))), (trade.partialExits || []).length > 0 && /*#__PURE__*/React.createElement("div", {
      style: {
        marginTop: '8px',
        fontSize: '0.85rem',
        color: 'var(--text-secondary)'
      }
    }, trade.partialExits.length, " partial exit(s)"));
  }))), activeTab === 'narratives' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '20px'
    }
  }, /*#__PURE__*/React.createElement("h2", null, "\uD83C\uDF0A Narratives"), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      alignItems: 'center'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.76rem',
      padding: '4px 10px',
      borderRadius: '20px',
      background: 'var(--bg-card)',
      border: '1px solid var(--border)'
    }
  }, "\uD83D\uDD04 Resets every Monday"), /*#__PURE__*/React.createElement("button", {
    onClick: async () => {
      setNarrativesLoading(true);
      try {
        if (window.storage) {
          const r = await window.storage.get(NARR_KEY, true).catch(() => null);
          if (r?.value) {
            const shared = JSON.parse(r.value);
            setNarratives(NARR_BASE.map(n => ({
              ...n,
              votes: shared[n.id] ?? n.votes
            })));
          }
        }
      } catch (e) {}
      setNarrativesLoading(false);
    },
    disabled: narrativesLoading,
    style: {
      margin: 0,
      padding: '4px 10px',
      fontSize: '0.75rem',
      background: 'transparent',
      border: '1px solid var(--border)',
      borderRadius: '20px',
      color: 'var(--text-secondary)',
      cursor: 'pointer'
    }
  }, narrativesLoading ? '‚è≥' : '‚Üª'))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'grid',
      gridTemplateColumns: 'repeat(auto-fill, minmax(130px, 1fr))',
      gap: '12px'
    }
  }, [...narratives].sort((a, b) => b.votes - a.votes).map((n, i) => {
    const voted = !!userVotes[n.id];
    const medals = ['ü•á', 'ü•à', 'ü•â'];
    const isTop = i < 3;
    const borderCol = i === 0 ? '#fbbf24' : i === 1 ? '#94a3b8' : i === 2 ? '#cd7f32' : voted ? 'var(--accent)' : 'var(--border)';
    return /*#__PURE__*/React.createElement("div", {
      key: n.id,
      onClick: () => handleVoteWithMission(n.id),
      style: {
        position: 'relative',
        borderRadius: '14px',
        aspectRatio: '1',
        cursor: 'pointer',
        background: 'var(--bg-card)',
        border: `2px solid ${borderCol}`,
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        justifyContent: 'center',
        gap: '8px',
        padding: '12px',
        transition: 'transform 0.15s, box-shadow 0.15s',
        boxShadow: voted ? '0 0 16px rgba(59,130,246,0.35)' : isTop ? `0 0 10px ${i === 0 ? 'rgba(251,191,36,0.25)' : 'rgba(148,163,184,0.15)'}` : 'none',
        userSelect: 'none'
      },
      onMouseEnter: e => e.currentTarget.style.transform = 'scale(1.04)',
      onMouseLeave: e => e.currentTarget.style.transform = 'scale(1)'
    }, isTop && /*#__PURE__*/React.createElement("div", {
      style: {
        position: 'absolute',
        top: '8px',
        left: '8px',
        fontSize: '1rem',
        lineHeight: 1
      }
    }, medals[i]), /*#__PURE__*/React.createElement("div", {
      style: {
        position: 'absolute',
        top: '8px',
        right: '8px',
        background: voted ? 'var(--accent)' : 'var(--bg-primary)',
        color: voted ? 'white' : 'var(--text-secondary)',
        borderRadius: '20px',
        padding: '2px 7px',
        fontSize: '0.72rem',
        fontWeight: 'bold'
      }
    }, n.votes), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '2.8rem',
        lineHeight: 1,
        filter: voted ? 'none' : 'grayscale(20%)'
      }
    }, voted ? 'üî•' : n.emoji), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.82rem',
        fontWeight: 'bold',
        textAlign: 'center',
        color: 'var(--text-primary)',
        lineHeight: 1.2
      }
    }, n.title));
  })), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.76rem',
      textAlign: 'center',
      marginTop: '16px'
    }
  }, "Tap to vote \xB7 Tap again to remove \xB7 1 vote per narrative")), activeTab === 'badges' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("h2", null, "\uD83C\uDFC6 Badges"), /*#__PURE__*/React.createElement("div", {
    className: "card"
  }, /*#__PURE__*/React.createElement("h3", {
    style: {
      marginBottom: '20px'
    }
  }, "Unlocked: ", user.badges?.length || 0, " / ", Object.keys(ALL_BADGES).length), /*#__PURE__*/React.createElement("div", {
    className: "badge-grid"
  }, Object.entries(ALL_BADGES).map(([id, badge]) => {
    const isUnlocked = user.badges?.includes(id);
    return /*#__PURE__*/React.createElement("div", {
      key: id,
      className: `badge-item ${isUnlocked ? 'unlocked' : 'locked'}`,
      title: badge.desc
    }, /*#__PURE__*/React.createElement("div", {
      className: "badge-icon"
    }, badge.icon), /*#__PURE__*/React.createElement("div", {
      className: "badge-name"
    }, badge.name), /*#__PURE__*/React.createElement("div", {
      className: "badge-desc"
    }, badge.desc));
  })))), activeTab === 'ranking' && /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '10px'
    }
  }, /*#__PURE__*/React.createElement("h2", null, "\uD83E\uDD47 Global Ranking"), /*#__PURE__*/React.createElement("button", {
    onClick: fetchRanking,
    style: {
      padding: '8px 16px',
      fontSize: '0.82rem',
      margin: 0
    },
    disabled: rankingLoading
  }, rankingLoading ? '‚è≥' : 'üîÑ Update')), (() => {
    const sorted = [...ranking].sort((a, b) => b.xp - a.xp);
    const myPos = sorted.findIndex(r => r.id === user.id);
    if (myPos < 0) return null;
    const me = sorted[myPos];
    return /*#__PURE__*/React.createElement("div", {
      style: {
        padding: '14px 18px',
        borderRadius: '12px',
        marginBottom: '16px',
        background: 'linear-gradient(135deg, rgba(59,130,246,0.12), rgba(139,92,246,0.12))',
        border: '1px solid rgba(59,130,246,0.35)'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center'
      }
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      style: {
        color: 'var(--text-secondary)',
        fontSize: '0.78rem'
      }
    }, "Your position"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '1.4rem',
        fontWeight: 'bold',
        color: 'var(--accent)'
      }
    }, "#", myPos + 1, " ", /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.95rem',
        color: 'var(--text-primary)'
      }
    }, me.username))), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right'
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '1.1rem',
        fontWeight: 'bold',
        color: 'var(--accent)'
      }
    }, me.xp.toLocaleString(), " XP"), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.8rem',
        color: 'var(--text-secondary)'
      }
    }, "of ", sorted.length, " traders"))));
  })(), /*#__PURE__*/React.createElement(RankingTable, {
    ranking: ranking,
    rankingLoading: rankingLoading,
    userId: user.id,
    user: user
  })), activeTab === 'community' && /*#__PURE__*/React.createElement(CommunityTab, {
    user: user,
    onXPChange: addXP,
    traderWinRate: traderProfile.winRate
  })), activeTab === 'learn' && React.createElement("div", {className:"container",style:{paddingTop:"20px",paddingBottom:"40px"}},
    React.createElement("div",{style:{textAlign:"center",marginBottom:"28px"}},
      React.createElement("div",{style:{fontSize:"2.5rem",marginBottom:"8px"}},"üìö"),
      React.createElement("h2",{style:{marginBottom:"4px"}},"Memecoin Trading Guide"),
      React.createElement("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"}},"Knowledge from real traders ‚Äî learn before you ape")
    ),
    React.createElement("div", {
        key: "1", style: {background:"rgba(59,130,246,0.15)", border:"1px solid rgba(59,130,246,0.3)", borderRadius:"14px", padding:"20px", marginBottom:"16px"}
      },
      React.createElement("div", {style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"14px"}},
        React.createElement("div", {style:{fontSize:"1.8rem"}}, "üéØ"),
        React.createElement("div", null,
          React.createElement("div", {style:{fontSize:"0.68rem",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.08em"}}, "Rule 1"),
          React.createElement("div", {style:{fontWeight:"bold",fontSize:"1.05rem"}}, "Find a Good Entry")
        )
      ),
      React.createElement("div", {style:{display:"flex",flexDirection:"column",gap:"7px"}},
        React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Look for tokens with MC $10k‚Äì$100k with locked liquidity')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Use GMGN, Photon or Pump.fun to scan new launches')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Never buy the top ‚Äî wait for the first dip or consolidation')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Incomplete holder distribution = red flag before entering'))
      )
    ),
React.createElement("div", {
        key: "2", style: {background:"rgba(139,92,246,0.15)", border:"1px solid rgba(139,92,246,0.3)", borderRadius:"14px", padding:"20px", marginBottom:"16px"}
      },
      React.createElement("div", {style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"14px"}},
        React.createElement("div", {style:{fontSize:"1.8rem"}}, "üêã"),
        React.createElement("div", null,
          React.createElement("div", {style:{fontSize:"0.68rem",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.08em"}}, "Rule 2"),
          React.createElement("div", {style:{fontWeight:"bold",fontSize:"1.05rem"}}, "Follow Smart Money")
        )
      ),
      React.createElement("div", {style:{display:"flex",flexDirection:"column",gap:"7px"}},
        React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Track whale wallets on SolScan ‚Äî if big wallets accumulate, good sign')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Check BubbleMaps for connected wallets to avoid developer dumps')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'If insiders start dumping early, exit immediately ‚Äî do not be liquidity')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Any BubbleMaps cluster above 4% should be treated as a red flag'))
      )
    ),
React.createElement("div", {
        key: "3", style: {background:"rgba(16,185,129,0.15)", border:"1px solid rgba(16,185,129,0.3)", borderRadius:"14px", padding:"20px", marginBottom:"16px"}
      },
      React.createElement("div", {style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"14px"}},
        React.createElement("div", {style:{fontSize:"1.8rem"}}, "üì£"),
        React.createElement("div", null,
          React.createElement("div", {style:{fontSize:"0.68rem",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.08em"}}, "Rule 3"),
          React.createElement("div", {style:{fontWeight:"bold",fontSize:"1.05rem"}}, "Read the Hype & Narrative")
        )
      ),
      React.createElement("div", {style:{display:"flex",flexDirection:"column",gap:"7px"}},
        React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Is Crypto Twitter genuinely excited or are they all paid shills?')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Telegram chat growing? Check for real engagement vs bots')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Follow trending narratives ‚Äî track the meta on X')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'When influencers start shilling hard, begin selling ‚Äî not buying'))
      )
    ),
React.createElement("div", {
        key: "4", style: {background:"rgba(251,146,60,0.15)", border:"1px solid rgba(251,146,60,0.3)", borderRadius:"14px", padding:"20px", marginBottom:"16px"}
      },
      React.createElement("div", {style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"14px"}},
        React.createElement("div", {style:{fontSize:"1.8rem"}}, "üö™"),
        React.createElement("div", null,
          React.createElement("div", {style:{fontSize:"0.68rem",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.08em"}}, "Rule 4"),
          React.createElement("div", {style:{fontWeight:"bold",fontSize:"1.05rem"}}, "Have an Exit Plan Before Entering")
        )
      ),
      React.createElement("div", {style:{display:"flex",flexDirection:"column",gap:"7px"}},
        React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'DCA your exit: take profits at 2x, 5x, 10x instead of waiting for 100x')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'When CT influencers start shilling, begin selling ‚Äî not buying')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Always leave a moonbag, but be careful ‚Äî memecoins die fast')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Define your stop-loss before entering. -50% drop: dip or rug?'))
      )
    ),
React.createElement("div", {
        key: "5", style: {background:"rgba(239,68,68,0.15)", border:"1px solid rgba(239,68,68,0.3)", borderRadius:"14px", padding:"20px", marginBottom:"16px"}
      },
      React.createElement("div", {style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"14px"}},
        React.createElement("div", {style:{fontSize:"1.8rem"}}, "üõë"),
        React.createElement("div", null,
          React.createElement("div", {style:{fontSize:"0.68rem",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.08em"}}, "Rule 5"),
          React.createElement("div", {style:{fontWeight:"bold",fontSize:"1.05rem"}}, "Do Not Hold Bags")
        )
      ),
      React.createElement("div", {style:{display:"flex",flexDirection:"column",gap:"7px"}},
        React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'If volume drops, whales dump, or liquidity decreases ‚Äî exit')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Price drops -70% in minutes? That is not just a dip')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Rule #1: Take profits before someone else takes them from you')),React.createElement("div",{style:{display:"flex",gap:"8px",fontSize:"0.86rem",color:"var(--text-secondary)",lineHeight:"1.45"}},React.createElement("span",{style:{opacity:0.5,flexShrink:0}},"‚ñ∏"),React.createElement("span",null,'Memecoins move in cycles: hype, pump, dump, dead. Know where you are'))
      )
    ),
    React.createElement("div",{style:{background:"rgba(255,255,255,0.03)",border:"1px solid var(--border)",borderRadius:"14px",padding:"20px",marginTop:"8px"}},
      React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"}},
        React.createElement("span",{style:{fontSize:"1.6rem"}},"ü´ß"),
        React.createElement("div",null,
          React.createElement("div",{style:{fontSize:"0.68rem",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.08em"}},"Advanced Analysis"),
          React.createElement("div",{style:{fontWeight:"bold",fontSize:"1.05rem"}},"BubbleMaps CEX Cluster Guide")
        )
      ),
      React.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:"10px"}},
        React.createElement("div",{key:"CEX Main Cluster",style:{background:"var(--bg-primary)",borderRadius:"10px",padding:"12px"}},
      React.createElement("div",{style:{fontWeight:"bold",fontSize:"0.82rem",marginBottom:"8px"}},'CEX Main Cluster'),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--success)"}},"‚úÖ OK"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," 50%‚Äì55%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--warning)"}},"‚ö†Ô∏è Watch"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," >60% or <45%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--danger)"}},"üö® Flag"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," >65% or <40%"))
      )
    ),
React.createElement("div",{key:"Binance fd",style:{background:"var(--bg-primary)",borderRadius:"10px",padding:"12px"}},
      React.createElement("div",{style:{fontWeight:"bold",fontSize:"0.82rem",marginBottom:"8px"}},'Binance fd'),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--success)"}},"‚úÖ OK"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," 15%‚Äì25%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--warning)"}},"‚ö†Ô∏è Watch"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," 25%‚Äì30%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--danger)"}},"üö® Flag"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," >30% or <10%"))
      )
    ),
React.createElement("div",{key:"Coinbase fd",style:{background:"var(--bg-primary)",borderRadius:"10px",padding:"12px"}},
      React.createElement("div",{style:{fontWeight:"bold",fontSize:"0.82rem",marginBottom:"8px"}},'Coinbase fd'),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--success)"}},"‚úÖ OK"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," 15%‚Äì25%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--warning)"}},"‚ö†Ô∏è Watch"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," 25%‚Äì30%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--danger)"}},"üö® Flag"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," >30% or <10%"))
      )
    ),
React.createElement("div",{key:"ChangeNow fd",style:{background:"var(--bg-primary)",borderRadius:"10px",padding:"12px"}},
      React.createElement("div",{style:{fontWeight:"bold",fontSize:"0.82rem",marginBottom:"8px"}},'ChangeNow fd'),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--success)"}},"‚úÖ OK"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," < 3%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--warning)"}},"‚ö†Ô∏è Watch"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," 3%‚Äì10%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--danger)"}},"üö® Flag"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," > 10%"))
      )
    ),
React.createElement("div",{key:"MEXC fd",style:{background:"var(--bg-primary)",borderRadius:"10px",padding:"12px"}},
      React.createElement("div",{style:{fontWeight:"bold",fontSize:"0.82rem",marginBottom:"8px"}},'MEXC fd'),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--success)"}},"‚úÖ OK"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," < 5%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--warning)"}},"‚ö†Ô∏è Watch"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," 5%‚Äì10%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--danger)"}},"üö® Flag"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," > 10%"))
      )
    ),
React.createElement("div",{key:"KuCoin fd",style:{background:"var(--bg-primary)",borderRadius:"10px",padding:"12px"}},
      React.createElement("div",{style:{fontWeight:"bold",fontSize:"0.82rem",marginBottom:"8px"}},'KuCoin fd'),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--success)"}},"‚úÖ OK"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," 5%‚Äì7%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--warning)"}},"‚ö†Ô∏è Watch"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," 7%‚Äì10%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--danger)"}},"üö® Flag"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," > 10%"))
      )
    ),
React.createElement("div",{key:"Crypto.com fd",style:{background:"var(--bg-primary)",borderRadius:"10px",padding:"12px"}},
      React.createElement("div",{style:{fontWeight:"bold",fontSize:"0.82rem",marginBottom:"8px"}},'Crypto.com fd'),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--success)"}},"‚úÖ OK"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," < 5%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--warning)"}},"‚ö†Ô∏è Watch"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," 5%‚Äì8%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--danger)"}},"üö® Flag"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," > 8%"))
      )
    ),
React.createElement("div",{key:"HTX / OKX fd",style:{background:"var(--bg-primary)",borderRadius:"10px",padding:"12px"}},
      React.createElement("div",{style:{fontWeight:"bold",fontSize:"0.82rem",marginBottom:"8px"}},'HTX / OKX fd'),
      React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--success)"}},"‚úÖ OK"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," < 5%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--warning)"}},"‚ö†Ô∏è Watch"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," 5%‚Äì8%")),
        React.createElement("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem"}},React.createElement("span",{style:{color:"var(--danger)"}},"üö® Flag"),React.createElement("span",{style:{color:"var(--text-secondary)"}}," > 8%"))
      )
    )
      )
    )
  ), toast && /*#__PURE__*/React.createElement(Toast, {
    message: toast.message,
    type: toast.type,
    onClose: () => setToast(null)
  }), xpPopup && /*#__PURE__*/React.createElement(XPGainPopup, {
    xp: xpPopup.xp,
    reason: xpPopup.reason,
    onClose: () => setXPPopup(null)
  }), showWeeklyReport && /*#__PURE__*/React.createElement(WeeklyReportModal, {
    user: user,
    traderProfile: traderProfile,
    onClose: () => setShowWeeklyReport(false)
  }), showXPTable && /*#__PURE__*/React.createElement(XPTableModal, {
    onClose: () => setShowXPTable(false)
  }), tutorialStep >= 0 && /*#__PURE__*/React.createElement(TutorialOverlay, {
    step: tutorialStep,
    onNext: () => setTutorialStep(s => s >= 7 ? -1 : s + 1),
    onSkip: () => setTutorialStep(-1)
  }), buyModal?.type === 'ape' && /*#__PURE__*/React.createElement(ApeModal, {
    analysis: analysis,
    balance: user?.balance || 0,
    onConfirm: confirmApe,
    onClose: () => setBuyModal(null)
  }), buyModal?.type === 'dca' && /*#__PURE__*/React.createElement(DCAModal, {
    trade: buyModal.trade,
    balance: user?.balance || 0,
    onConfirm: confirmDCA,
    onClose: () => setBuyModal(null)
  }), buyModal?.type === 'partial' && /*#__PURE__*/React.createElement(PartialModal, {
    trade: buyModal.trade,
    onConfirm: confirmPartialSell,
    onClose: () => setBuyModal(null)
  }), closeModal && /*#__PURE__*/React.createElement(CloseModal, {
    trade: closeModal,
    onConfirm: confirmCloseTrade,
    onClose: () => setCloseModal(null)
  }), portfolioModal && /*#__PURE__*/React.createElement(TradeInfoModal, {
    trade: portfolioModal,
    onClose: () => setPortfolioModal(null)
  }), showBankrupt && !showMissions && /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.92)',
      zIndex: 1100,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '20px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '20px',
      maxWidth: '400px',
      width: '100%',
      border: '1px solid var(--danger)',
      boxShadow: '0 0 40px rgba(239,68,68,0.3)',
      padding: '32px',
      textAlign: 'center'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '4rem',
      marginBottom: '12px'
    }
  }, "\uD83D\uDCB8"), /*#__PURE__*/React.createElement("h2", {
    style: {
      color: 'var(--danger)',
      marginBottom: '8px',
      fontSize: '1.5rem'
    }
  }, "Bankrupt!"), /*#__PURE__*/React.createElement("p", {
    style: {
      color: 'var(--text-secondary)',
      fontSize: '0.9rem',
      marginBottom: '28px',
      lineHeight: 1.6
    }
  }, "You ran out of SOL.", /*#__PURE__*/React.createElement("br", null), "Earn ", /*#__PURE__*/React.createElement("strong", {
    style: {
      color: 'var(--success)'
    }
  }, "+", REWARD_SOL, " SOL"), " to keep trading."), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      flexDirection: 'column',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: startWatchAd,
    disabled: adWatching || getAdsToday() >= MAX_ADS_PER_DAY,
    style: {
      padding: '14px',
      fontSize: '1rem',
      fontWeight: 'bold',
      background: 'linear-gradient(135deg,#f59e0b,#d97706)',
      border: 'none',
      borderRadius: '12px',
      color: 'white',
      cursor: 'pointer',
      opacity: adWatching || getAdsToday() >= MAX_ADS_PER_DAY ? 0.5 : 1
    }
  }, adWatching ? `üì∫ Watching ad... ${adTimer}s` : getAdsToday() >= MAX_ADS_PER_DAY ? `üì∫ Ads limit reached (${MAX_ADS_PER_DAY}/day)` : `üì∫ Watch Ad  ‚Üí  +${REWARD_SOL} SOL`), /*#__PURE__*/React.createElement("button", {
    onClick: () => setShowMissions(true),
    style: {
      padding: '14px',
      fontSize: '1rem',
      fontWeight: 'bold',
      background: 'linear-gradient(135deg,#3b82f6,#8b5cf6)',
      border: 'none',
      borderRadius: '12px',
      color: 'white',
      cursor: 'pointer'
    }
  }, "\uD83D\uDCCB Complete a Mission  \u2192  +", REWARD_SOL, " SOL")), getAdsToday() > 0 && /*#__PURE__*/React.createElement("p", {
    style: {
      marginTop: '16px',
      fontSize: '0.75rem',
      color: 'var(--text-secondary)'
    }
  }, getAdsToday(), "/", MAX_ADS_PER_DAY, " ads watched today"))), showMissions && /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.92)',
      zIndex: 1100,
      display: 'flex',
      alignItems: 'flex-start',
      justifyContent: 'center',
      padding: '16px',
      overflowY: 'auto'
    },
    onClick: () => setShowMissions(false)
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      background: 'var(--bg-card)',
      borderRadius: '20px',
      maxWidth: '460px',
      width: '100%',
      border: '1px solid var(--border)',
      boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
      marginTop: '20px'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '18px 22px',
      borderBottom: '1px solid var(--border)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'space-between'
    }
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '1.05rem'
    }
  }, "\uD83D\uDCCB Daily Missions"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.75rem',
      color: 'var(--text-secondary)',
      marginTop: '2px'
    }
  }, "Complete missions to earn SOL")), /*#__PURE__*/React.createElement("button", {
    onClick: () => setShowMissions(false),
    style: {
      margin: 0,
      padding: '5px 10px',
      fontSize: '0.82rem',
      background: 'transparent',
      border: '1px solid var(--border)'
    }
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '16px'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '14px',
      borderRadius: '12px',
      marginBottom: '10px',
      background: 'rgba(245,158,11,0.08)',
      border: `1px solid ${getAdsToday() >= MAX_ADS_PER_DAY ? 'var(--border)' : 'rgba(245,158,11,0.4)'}`
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '12px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '1.6rem'
    }
  }, "\uD83D\uDCFA"), /*#__PURE__*/React.createElement("div", {
    style: {
      flex: 1
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      fontWeight: 'bold',
      fontSize: '0.9rem'
    }
  }, "Watch an Ad"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.78rem',
      color: 'var(--text-secondary)'
    }
  }, "Support the platform \xB7 15 seconds"), /*#__PURE__*/React.createElement("div", {
    style: {
      fontSize: '0.72rem',
      color: 'var(--text-secondary)',
      marginTop: '2px'
    }
  }, getAdsToday(), "/", MAX_ADS_PER_DAY, " today")), /*#__PURE__*/React.createElement("button", {
    onClick: startWatchAd,
    disabled: adWatching || getAdsToday() >= MAX_ADS_PER_DAY,
    style: {
      margin: 0,
      padding: '8px 14px',
      fontSize: '0.82rem',
      fontWeight: 'bold',
      background: getAdsToday() >= MAX_ADS_PER_DAY ? 'var(--bg-secondary)' : '#f59e0b',
      border: 'none',
      borderRadius: '8px',
      color: getAdsToday() >= MAX_ADS_PER_DAY ? 'var(--text-secondary)' : '#000',
      cursor: 'pointer',
      whiteSpace: 'nowrap',
      opacity: adWatching ? 0.6 : 1
    }
  }, adWatching ? `${adTimer}s...` : getAdsToday() >= MAX_ADS_PER_DAY ? 'Limit' : '‚ñ∂ Watch'))), MISSIONS.map(m => {
    const done = isMissionDone(m.id);
    return /*#__PURE__*/React.createElement("div", {
      key: m.id,
      style: {
        padding: '14px',
        borderRadius: '12px',
        marginBottom: '8px',
        background: done ? 'rgba(16,185,129,0.06)' : 'var(--bg-primary)',
        border: `1px solid ${done ? 'rgba(16,185,129,0.3)' : 'var(--border)'}`
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        alignItems: 'center',
        gap: '12px'
      }
    }, /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '1.5rem',
        opacity: done ? 0.5 : 1
      }
    }, m.icon), /*#__PURE__*/React.createElement("div", {
      style: {
        flex: 1
      }
    }, /*#__PURE__*/React.createElement("div", {
      style: {
        fontWeight: 'bold',
        fontSize: '0.88rem',
        color: done ? 'var(--text-secondary)' : 'var(--text-primary)',
        textDecoration: done ? 'line-through' : 'none'
      }
    }, m.label), /*#__PURE__*/React.createElement("div", {
      style: {
        fontSize: '0.75rem',
        color: 'var(--text-secondary)'
      }
    }, m.desc)), /*#__PURE__*/React.createElement("div", {
      style: {
        textAlign: 'right',
        flexShrink: 0
      }
    }, done ? /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.82rem',
        color: 'var(--success)',
        fontWeight: 'bold'
      }
    }, "\u2713 Done") : /*#__PURE__*/React.createElement("span", {
      style: {
        fontSize: '0.82rem',
        color: 'var(--success)',
        fontWeight: 'bold'
      }
    }, "+", m.reward, " SOL"))));
  })), /*#__PURE__*/React.createElement("div", {
    style: {
      padding: '12px 22px',
      borderTop: '1px solid var(--border)',
      textAlign: 'center'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => setShowMissions(false),
    style: {
      margin: 0,
      padding: '10px 28px',
      fontSize: '0.9rem',
      background: 'var(--bg-secondary)',
      border: '1px solid var(--border)',
      borderRadius: '10px'
    }
  }, "Close")))), chartTrade && /*#__PURE__*/React.createElement("div", {
    style: {
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.9)',
      zIndex: 1001,
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '16px'
    },
    onClick: () => setChartTrade(null)
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      width: '100%',
      maxWidth: '900px',
      background: 'var(--bg-card)',
      borderRadius: '16px',
      border: '1px solid var(--border)',
      overflow: 'hidden',
      display: 'flex',
      flexDirection: 'column'
    },
    onClick: e => e.stopPropagation()
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'space-between',
      padding: '14px 18px',
      borderBottom: '1px solid var(--border)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      alignItems: 'center',
      gap: '10px'
    }
  }, /*#__PURE__*/React.createElement("span", {
    style: {
      fontWeight: 'bold',
      fontSize: '1rem'
    }
  }, "\uD83D\uDCCA ", chartTrade.tokenSymbol), /*#__PURE__*/React.createElement("span", {
    style: {
      fontSize: '0.75rem',
      color: 'var(--text-secondary)',
      fontFamily: 'monospace'
    }
  }, chartTrade.tokenAddress?.slice(0, 8), "...", chartTrade.tokenAddress?.slice(-6))), /*#__PURE__*/React.createElement("div", {
    style: {
      display: 'flex',
      gap: '8px',
      alignItems: 'center'
    }
  }, /*#__PURE__*/React.createElement("button", {
    onClick: () => window.open(`https://dexscreener.com/solana/${chartTrade.tokenAddress}`, '_blank'),
    style: {
      margin: 0,
      padding: '5px 10px',
      fontSize: '0.75rem',
      background: 'rgba(16,185,129,0.15)',
      border: '1px solid var(--success)',
      color: 'var(--success)',
      borderRadius: '6px'
    }
  }, "\u2197 DexScreener"), /*#__PURE__*/React.createElement("button", {
    onClick: () => setChartTrade(null),
    style: {
      margin: 0,
      padding: '5px 10px',
      fontSize: '0.82rem',
      background: 'transparent',
      border: '1px solid var(--border)'
    }
  }, "\u2715"))), /*#__PURE__*/React.createElement("iframe", {
    src: `https://dexscreener.com/solana/${chartTrade.tokenAddress}?embed=1&theme=dark&trades=1&info=0`,
    style: {
      width: '100%',
      height: '500px',
      border: 'none',
      display: 'block'
    },
    title: "DexScreener Chart",
    allow: "clipboard-write"
  })), /*#__PURE__*/React.createElement("div", {
    style: {
      marginTop: '10px',
      fontSize: '0.75rem',
      color: 'rgba(255,255,255,0.3)'
    }
  }, "Click outside to close"))));
}
ReactDOM.render(/*#__PURE__*/React.createElement(HelmApp, null), document.getElementById('root'));

</script>
</body>
</html>
